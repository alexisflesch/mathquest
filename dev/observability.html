<!doctype html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.23" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/styles/screenshots.css"><title>Observability Runbooks | Kutsum</title><meta name="description" content="Alternative libre et open source à Kahoot, pour les enseignants et leurs élèves.">
    <link rel="preload" href="/assets/style-Dkmw-xJK.css" as="style"><link rel="stylesheet" href="/assets/style-Dkmw-xJK.css">
    <link rel="modulepreload" href="/assets/app-Blvv7Pu1.js"><link rel="modulepreload" href="/assets/observability.html-DkPbL3ic.js">
    <link rel="prefetch" href="/assets/index.html-BgWsLJk5.js" as="script"><link rel="prefetch" href="/assets/index.html-CxFhQ9yh.js" as="script"><link rel="prefetch" href="/assets/api.html-B_bdbqlW.js" as="script"><link rel="prefetch" href="/assets/architecture.html-C2TIKhjm.js" as="script"><link rel="prefetch" href="/assets/backend-services.html-B5XZ0b45.js" as="script"><link rel="prefetch" href="/assets/configuration.html-CSBv4zlE.js" as="script"><link rel="prefetch" href="/assets/database.html-zDPra4qo.js" as="script"><link rel="prefetch" href="/assets/deployement.html-Cb8coLaH.js" as="script"><link rel="prefetch" href="/assets/landing-page.html-DFa_9Yed.js" as="script"><link rel="prefetch" href="/assets/performance-monitoring.html-DkqiKT9u.js" as="script"><link rel="prefetch" href="/assets/question-editor.html-KCmeVQ8t.js" as="script"><link rel="prefetch" href="/assets/scoring.html-BgDchvD2.js" as="script"><link rel="prefetch" href="/assets/security.html-CR7bBL-N.js" as="script"><link rel="prefetch" href="/assets/tests.html-DOtCFwSL.js" as="script"><link rel="prefetch" href="/assets/troubleshooting.html-G-04tDSs.js" as="script"><link rel="prefetch" href="/assets/diagnostics.html-DKbQEDup.js" as="script"><link rel="prefetch" href="/assets/index.html-Tv1AKkVx.js" as="script"><link rel="prefetch" href="/assets/index.html-D4Ge4R3B.js" as="script"><link rel="prefetch" href="/assets/aflesch-espaces-vectoriels-notes.html-CarfwQKl.js" as="script"><link rel="prefetch" href="/assets/contribuer.html-BFpj89FN.js" as="script"><link rel="prefetch" href="/assets/index.html-JVJ8j1aq.js" as="script"><link rel="prefetch" href="/assets/entrainement.html-DAbAqH-4.js" as="script"><link rel="prefetch" href="/assets/quiz.html-H3MzSQm9.js" as="script"><link rel="prefetch" href="/assets/tournoi.html-DylmTv1c.js" as="script"><link rel="prefetch" href="/assets/404.html-T_x5-zmb.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="/assets/logo.svg" alt="Kutsum"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">Kutsum</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Accueil"><!--[--><!--[--><!--]--><!--]-->Accueil<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/utilisation/" aria-label="Utilisation de l&#39;appli"><!--[--><!--[--><!--]--><!--]-->Utilisation de l&#39;appli<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/questions-yaml/" aria-label="Création de questions"><!--[--><!--[--><!--]--><!--]-->Création de questions<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/installation/" aria-label="Installation"><!--[--><!--[--><!--]--><!--]-->Installation<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/details-techniques/" aria-label="Détails techniques"><!--[--><!--[--><!--]--><!--]-->Détails techniques<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/dev/" aria-label="Dev"><!--[--><!--[--><!--]--><!--]-->Dev<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="Accueil"><!--[--><!--[--><!--]--><!--]-->Accueil<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/utilisation/" aria-label="Utilisation de l&#39;appli"><!--[--><!--[--><!--]--><!--]-->Utilisation de l&#39;appli<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/questions-yaml/" aria-label="Création de questions"><!--[--><!--[--><!--]--><!--]-->Création de questions<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/installation/" aria-label="Installation"><!--[--><!--[--><!--]--><!--]-->Installation<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/details-techniques/" aria-label="Détails techniques"><!--[--><!--[--><!--]--><!--]-->Détails techniques<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/dev/" aria-label="Dev"><!--[--><!--[--><!--]--><!--]-->Dev<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Developer Documentation <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/dev/observability.html" aria-label="Observability Runbooks"><!--[--><!--[--><!--]--><!--]-->Observability Runbooks<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="observability-runbooks" tabindex="-1"><a class="header-anchor" href="#observability-runbooks"><span>Observability Runbooks</span></a></h1><p>Phase 5 observability features provide tools for tracing requests and monitoring system health.</p><h2 id="correlation-id-tracing" tabindex="-1"><a class="header-anchor" href="#correlation-id-tracing"><span>Correlation ID Tracing</span></a></h2><h3 id="overview" tabindex="-1"><a class="header-anchor" href="#overview"><span>Overview</span></a></h3><p>Every client request generates a unique <strong>correlation ID</strong> that flows through the entire system, enabling end-to-end tracing.</p><p><strong>Format:</strong> <code>{prefix}-{timestamp}-{random}</code></p><ul><li>Example: <code>client-1730000000000-a1b2c3d4</code></li><li>Prefix: <code>client</code> (frontend) or <code>server</code> (backend)</li><li>Timestamp: 13-digit Unix timestamp (milliseconds)</li><li>Random: 8-character lowercase alphanumeric</li></ul><h3 id="how-to-trace-a-session" tabindex="-1"><a class="header-anchor" href="#how-to-trace-a-session"><span>How to Trace a Session</span></a></h3><h4 id="_1-find-the-correlation-id" tabindex="-1"><a class="header-anchor" href="#_1-find-the-correlation-id"><span>1. Find the Correlation ID</span></a></h4><p><strong>In browser console logs:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">[10:23:45] [INFO] [useGameSocket] [CID:a1b2c3d4] Emitting join_game</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>In backend logs:</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">2025-10-27 10:23:45.123 info [JoinGameHandler] [CID:a1b2c3d4] Received join_game payload</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>The <code>[CID:xxxxxxxx]</code> marker shows the last 8 characters of the correlation ID.</p><h4 id="_2-search-logs-for-the-full-flow" tabindex="-1"><a class="header-anchor" href="#_2-search-logs-for-the-full-flow"><span>2. Search Logs for the Full Flow</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Search backend logs for a specific correlation ID</span></span>
<span class="line"><span class="token function">grep</span> <span class="token string">&quot;a1b2c3d4&quot;</span> /path/to/backend/logs/combined.log</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Search frontend browser console</span></span>
<span class="line"><span class="token comment"># Open DevTools → Console → Filter: &quot;a1b2c3d4&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-typical-flow-pattern" tabindex="-1"><a class="header-anchor" href="#_3-typical-flow-pattern"><span>3. Typical Flow Pattern</span></a></h4><p>A complete join→question→answer flow will show:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">[Frontend] [CID:a1b2c3d4] Emitting join_game</span>
<span class="line">[Backend]  [CID:a1b2c3d4] Received join_game payload</span>
<span class="line">[Backend]  [CID:a1b2c3d4] Looking up gameInstance</span>
<span class="line">[Backend]  [CID:a1b2c3d4] Emitting game_joined</span>
<span class="line">[Frontend] [CID:a1b2c3d4] Received game_joined</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="common-scenarios" tabindex="-1"><a class="header-anchor" href="#common-scenarios"><span>Common Scenarios</span></a></h3><h4 id="trace-a-specific-user-s-issue" tabindex="-1"><a class="header-anchor" href="#trace-a-specific-user-s-issue"><span>Trace a Specific User&#39;s Issue</span></a></h4><ol><li>Ask user to open browser console</li><li>Have them perform the action (e.g., join game)</li><li>Look for <code>[CID:xxxxxxxx]</code> in their console logs</li><li>Search backend logs for matching correlation ID</li><li>Trace full request flow to find where it broke</li></ol><h4 id="investigate-stuck-join-requests" tabindex="-1"><a class="header-anchor" href="#investigate-stuck-join-requests"><span>Investigate &quot;Stuck&quot; Join Requests</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Find all join_game events in last hour</span></span>
<span class="line"><span class="token function">grep</span> <span class="token string">&quot;join_game&quot;</span> logs/combined.log <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> <span class="token parameter variable">-d</span> <span class="token string">&#39;1 hour ago&#39;</span> <span class="token string">&#39;+%Y-%m-%d %H&#39;</span><span class="token variable">)</span></span>&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Look for correlation IDs without corresponding &quot;game_joined&quot;</span></span>
<span class="line"><span class="token comment"># These indicate failed or stuck requests</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="metrics-monitoring" tabindex="-1"><a class="header-anchor" href="#metrics-monitoring"><span>Metrics Monitoring</span></a></h2><h3 id="enable-metrics-collection" tabindex="-1"><a class="header-anchor" href="#enable-metrics-collection"><span>Enable Metrics Collection</span></a></h3><p>Set environment variable:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token assign-left variable">ENABLE_METRICS</span><span class="token operator">=</span>true</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>Note:</strong> Only enable in dev/staging environments. Not intended for production load.</p><h3 id="access-metrics-endpoint" tabindex="-1"><a class="header-anchor" href="#access-metrics-endpoint"><span>Access Metrics Endpoint</span></a></h3><p><strong>Current snapshot:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">curl</span> http://localhost:3000/api/v1/metrics</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>Response:</strong></p><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;enabled&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;currentMinute&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;joinGame&quot;</span><span class="token operator">:</span> <span class="token number">45</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;gameQuestion&quot;</span><span class="token operator">:</span> <span class="token number">120</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;submitAnswer&quot;</span><span class="token operator">:</span> <span class="token number">380</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;rates&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;joinGamePerMin&quot;</span><span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;gameQuestionPerMin&quot;</span><span class="token operator">:</span> <span class="token number">115</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;submitAnswerPerMin&quot;</span><span class="token operator">:</span> <span class="token number">365</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;alerts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;metric&quot;</span><span class="token operator">:</span> <span class="token string">&quot;submit_answer&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;rate&quot;</span><span class="token operator">:</span> <span class="token number">530</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;threshold&quot;</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;severity&quot;</span><span class="token operator">:</span> <span class="token string">&quot;warning&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;timestamp&quot;</span><span class="token operator">:</span> <span class="token number">1730000000000</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Historical data:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">curl</span> http://localhost:3000/api/v1/metrics/history?minutes<span class="token operator">=</span><span class="token number">10</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="alert-thresholds" tabindex="-1"><a class="header-anchor" href="#alert-thresholds"><span>Alert Thresholds</span></a></h3><table><thead><tr><th>Metric</th><th>Threshold (per minute)</th><th>Interpretation</th></tr></thead><tbody><tr><td><code>join_game</code></td><td>100</td><td>&gt;100 joins/min indicates potential spam or load test</td></tr><tr><td><code>game_question</code></td><td>200</td><td>&gt;200 questions/min indicates rapid teacher question switching</td></tr><tr><td><code>submit_answer</code></td><td>500</td><td>&gt;500 answers/min indicates high concurrent gameplay or storm</td></tr></tbody></table><p><strong>Severity Levels:</strong></p><ul><li><code>warning</code>: Rate &gt; threshold</li><li><code>critical</code>: Rate &gt; threshold × 2</li></ul><h3 id="investigating-storm-events" tabindex="-1"><a class="header-anchor" href="#investigating-storm-events"><span>Investigating Storm Events</span></a></h3><p>A &quot;storm&quot; occurs when many users submit answers simultaneously, overwhelming the system.</p><h4 id="_1-check-metrics-for-spikes" tabindex="-1"><a class="header-anchor" href="#_1-check-metrics-for-spikes"><span>1. Check Metrics for Spikes</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">curl</span> http://localhost:3000/api/v1/metrics <span class="token operator">|</span> jq <span class="token string">&#39;.alerts&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>If <code>submit_answer</code> shows critical alert, investigate:</p><h4 id="_2-find-affected-game" tabindex="-1"><a class="header-anchor" href="#_2-find-affected-game"><span>2. Find Affected Game</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Search for submit_answer events in last 5 minutes</span></span>
<span class="line"><span class="token function">grep</span> <span class="token string">&quot;submit_answer&quot;</span> logs/combined.log <span class="token operator">|</span> <span class="token function">tail</span> <span class="token parameter variable">-100</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Look for accessCode patterns</span></span>
<span class="line"><span class="token function">grep</span> <span class="token parameter variable">-oP</span> <span class="token string">&#39;accessCode&quot;:&quot;\\K[^&quot;]+&#39;</span> logs/combined.log <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-check-redis-queue-depth" tabindex="-1"><a class="header-anchor" href="#_3-check-redis-queue-depth"><span>3. Check Redis Queue Depth</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Connect to Redis</span></span>
<span class="line">redis-cli</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check pending answer queue (if implemented)</span></span>
<span class="line">LLEN mathquest:queue:answers</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check game participant counts</span></span>
<span class="line">HLEN mathquest:game:participants:GAME123</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-correlate-with-timer-events" tabindex="-1"><a class="header-anchor" href="#_4-correlate-with-timer-events"><span>4. Correlate with Timer Events</span></a></h4><p>Storm events often occur at timer expiration. Check:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Find timer_expired events near storm timestamp</span></span>
<span class="line"><span class="token function">grep</span> <span class="token string">&quot;timer_expired&quot;</span> logs/combined.log <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;2025-10-27 10:23&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="troubleshooting-guide" tabindex="-1"><a class="header-anchor" href="#troubleshooting-guide"><span>Troubleshooting Guide</span></a></h2><h3 id="symptom-user-reports-stuck-on-loading" tabindex="-1"><a class="header-anchor" href="#symptom-user-reports-stuck-on-loading"><span>Symptom: User Reports &quot;Stuck on Loading&quot;</span></a></h3><p><strong>Steps:</strong></p><ol><li>Get correlation ID from user&#39;s browser console</li><li>Search backend logs for that ID</li><li>Look for error responses or missing <code>game_joined</code> event</li><li>Common causes: <ul><li>Invalid access code (check <code>game_error</code> emission)</li><li>Database timeout (check <code>gameInstance lookup</code> timing)</li><li>WebSocket disconnect (check connection handlers)</li></ul></li></ol><h3 id="symptom-leaderboard-not-updating" tabindex="-1"><a class="header-anchor" href="#symptom-leaderboard-not-updating"><span>Symptom: Leaderboard Not Updating</span></a></h3><p><strong>Steps:</strong></p><ol><li>Check if correlation IDs flow through <code>submit_answer</code></li><li>Verify Redis score updates: <code>ZSCORE mathquest:game:leaderboard:GAME123 userId</code></li><li>Check for idempotency guard blocks (duplicate submissions)</li><li>Verify <code>leaderboard_update</code> emission after score change</li></ol><h3 id="symptom-high-alert-rate-on-metrics" tabindex="-1"><a class="header-anchor" href="#symptom-high-alert-rate-on-metrics"><span>Symptom: High Alert Rate on Metrics</span></a></h3><p><strong>Steps:</strong></p><ol><li>Check <code>/api/v1/metrics</code> for alert severity</li><li>If warning: Monitor, may be legitimate load</li><li>If critical: Investigate immediately <ul><li>Check for infinite loops (same correlation ID repeating)</li><li>Check for spam/bot activity (rapid joins from same IP)</li><li>Check for teacher rapidly clicking buttons</li></ul></li></ol><h2 id="best-practices" tabindex="-1"><a class="header-anchor" href="#best-practices"><span>Best Practices</span></a></h2><h3 id="for-developers" tabindex="-1"><a class="header-anchor" href="#for-developers"><span>For Developers</span></a></h3><ol><li><strong>Always include correlation IDs</strong> in new socket event payloads</li><li><strong>Log correlation IDs</strong> at key decision points (validation, database queries, emissions)</li><li><strong>Use structured logging</strong> with metadata objects (not string concatenation)</li><li><strong>Preserve correlation IDs</strong> across async boundaries</li></ol><h3 id="for-operators" tabindex="-1"><a class="header-anchor" href="#for-operators"><span>For Operators</span></a></h3><ol><li><strong>Enable metrics in staging</strong> to establish baseline rates</li><li><strong>Monitor alerts</strong> for unusual patterns</li><li><strong>Keep logs</strong> for at least 7 days for post-incident analysis</li><li><strong>Document incidents</strong> with correlation ID examples for future reference</li></ol><h2 id="architecture-notes" tabindex="-1"><a class="header-anchor" href="#architecture-notes"><span>Architecture Notes</span></a></h2><h3 id="correlation-id-lifecycle" tabindex="-1"><a class="header-anchor" href="#correlation-id-lifecycle"><span>Correlation ID Lifecycle</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">┌─────────────┐</span>
<span class="line">│   Client    │ Generates: client-timestamp-random</span>
<span class="line">│  (Browser)  │</span>
<span class="line">└──────┬──────┘</span>
<span class="line">       │ WebSocket (join_game payload)</span>
<span class="line">       ▼</span>
<span class="line">┌─────────────┐</span>
<span class="line">│   Backend   │ Extracts from payload</span>
<span class="line">│  (Socket)   │ Logs with [CID:xxxxxxxx]</span>
<span class="line">└──────┬──────┘</span>
<span class="line">       │ Responses flow back with same ID</span>
<span class="line">       ▼</span>
<span class="line">┌─────────────┐</span>
<span class="line">│   Client    │ Logs received events with [CID:xxxxxxxx]</span>
<span class="line">│  (Browser)  │</span>
<span class="line">└─────────────┘</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="metrics-collection" tabindex="-1"><a class="header-anchor" href="#metrics-collection"><span>Metrics Collection</span></a></h3><ul><li><strong>In-memory only</strong> (no database writes)</li><li><strong>1-minute buckets</strong> (rolling window)</li><li><strong>10-minute history</strong> (last 10 buckets kept)</li><li><strong>Automatic rotation</strong> every 60 seconds</li><li><strong>Gated by env var</strong> (disabled by default)</li></ul><h3 id="why-not-production" tabindex="-1"><a class="header-anchor" href="#why-not-production"><span>Why Not Production?</span></a></h3><p>Current metrics implementation:</p><ul><li>❌ No persistence (lost on restart)</li><li>❌ No aggregation across instances</li><li>❌ No historical analysis</li><li>❌ Limited alert capabilities</li></ul><p>For production observability, integrate:</p><ul><li>Prometheus for metrics</li><li>Grafana for visualization</li><li>ELK/Loki for log aggregation</li><li>Distributed tracing (Jaeger/Zipkin)</li></ul></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Dernière mise à jour: </span><time class="meta-item-info" datetime="2025-10-27T20:56:31.000Z" data-allow-mismatch>27/10/2025 21:56</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: alexis.flesch@gmail.com">alexisflesch</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-Blvv7Pu1.js" defer></script>
  </body>
</html>
