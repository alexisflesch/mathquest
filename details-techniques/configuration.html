<!doctype html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.23" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/mathquest/favicon.ico"><link rel="stylesheet" href="/mathquest/styles/screenshots.css"><title>Configuration et environnement | MathQuest</title><meta name="description" content="Alternative libre et open source à Kahoot, pour les enseignants et leurs élèves.">
    <link rel="preload" href="/mathquest/assets/style-Dkmw-xJK.css" as="style"><link rel="stylesheet" href="/mathquest/assets/style-Dkmw-xJK.css">
    <link rel="modulepreload" href="/mathquest/assets/app-DoDG4mLI.js"><link rel="modulepreload" href="/mathquest/assets/configuration.html-CK6wnHSc.js">
    <link rel="prefetch" href="/mathquest/assets/index.html-DVgZZIvh.js" as="script"><link rel="prefetch" href="/mathquest/assets/index.html-D41YBSyI.js" as="script"><link rel="prefetch" href="/mathquest/assets/api.html-DuEObc8p.js" as="script"><link rel="prefetch" href="/mathquest/assets/architecture.html-u6XaedTl.js" as="script"><link rel="prefetch" href="/mathquest/assets/backend-services.html-Bn7Sl0dY.js" as="script"><link rel="prefetch" href="/mathquest/assets/database.html-Cst-518d.js" as="script"><link rel="prefetch" href="/mathquest/assets/deployement.html-DyDpUuyd.js" as="script"><link rel="prefetch" href="/mathquest/assets/performance-monitoring.html-rC33no4g.js" as="script"><link rel="prefetch" href="/mathquest/assets/scoring.html-Bcr7KETl.js" as="script"><link rel="prefetch" href="/mathquest/assets/security.html-CnxCz1Mf.js" as="script"><link rel="prefetch" href="/mathquest/assets/tests.html-hRJAedr5.js" as="script"><link rel="prefetch" href="/mathquest/assets/troubleshooting.html-CcGeBJgq.js" as="script"><link rel="prefetch" href="/mathquest/assets/index.html-BOckdlIK.js" as="script"><link rel="prefetch" href="/mathquest/assets/index.html-C5kHWhGv.js" as="script"><link rel="prefetch" href="/mathquest/assets/contribuer.html-BwIMJqK-.js" as="script"><link rel="prefetch" href="/mathquest/assets/index.html-XR6uVX9n.js" as="script"><link rel="prefetch" href="/mathquest/assets/entrainement.html-ruDYf3W6.js" as="script"><link rel="prefetch" href="/mathquest/assets/quiz.html-Jk8e0nUz.js" as="script"><link rel="prefetch" href="/mathquest/assets/tournoi.html-DqqXOLYd.js" as="script"><link rel="prefetch" href="/mathquest/assets/404.html-DZLuBRi1.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/mathquest/"><img class="vp-site-logo" src="/mathquest/assets/logo.svg" alt="MathQuest"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">MathQuest</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/" aria-label="Accueil"><!--[--><!--[--><!--]--><!--]-->Accueil<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/utilisation/" aria-label="Utilisation de l&#39;appli"><!--[--><!--[--><!--]--><!--]-->Utilisation de l&#39;appli<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/questions-yaml/" aria-label="Écriture de questions"><!--[--><!--[--><!--]--><!--]-->Écriture de questions<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/installation/" aria-label="Installation"><!--[--><!--[--><!--]--><!--]-->Installation<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/mathquest/details-techniques/" aria-label="Détails techniques"><!--[--><!--[--><!--]--><!--]-->Détails techniques<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/" aria-label="Accueil"><!--[--><!--[--><!--]--><!--]-->Accueil<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/utilisation/" aria-label="Utilisation de l&#39;appli"><!--[--><!--[--><!--]--><!--]-->Utilisation de l&#39;appli<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/questions-yaml/" aria-label="Écriture de questions"><!--[--><!--[--><!--]--><!--]-->Écriture de questions<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/installation/" aria-label="Installation"><!--[--><!--[--><!--]--><!--]-->Installation<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/mathquest/details-techniques/" aria-label="Détails techniques"><!--[--><!--[--><!--]--><!--]-->Détails techniques<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Détails techniques (utilisateurs avancés seulement) <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item" href="/mathquest/details-techniques/" aria-label="Détails techniques (utilisateurs avancés seulement)"><!--[--><!--[--><!--]--><!--]-->Détails techniques (utilisateurs avancés seulement)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/architecture.html" aria-label="Architecture générale"><!--[--><!--[--><!--]--><!--]-->Architecture générale<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/database.html" aria-label="Base de données"><!--[--><!--[--><!--]--><!--]-->Base de données<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/scoring.html" aria-label="Système de scoring"><!--[--><!--[--><!--]--><!--]-->Système de scoring<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/backend-services.html" aria-label="Services backend"><!--[--><!--[--><!--]--><!--]-->Services backend<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/api.html" aria-label="API REST"><!--[--><!--[--><!--]--><!--]-->API REST<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/mathquest/details-techniques/configuration.html" aria-label="Configuration et environnement"><!--[--><!--[--><!--]--><!--]-->Configuration et environnement<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/tests.html" aria-label="Tests et qualité"><!--[--><!--[--><!--]--><!--]-->Tests et qualité<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/deployement.html" aria-label="Déploiement et DevOps"><!--[--><!--[--><!--]--><!--]-->Déploiement et DevOps<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/security.html" aria-label="Security Documentation"><!--[--><!--[--><!--]--><!--]-->Security Documentation<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/performance-monitoring.html" aria-label="Performance &amp; Monitoring"><!--[--><!--[--><!--]--><!--]-->Performance &amp; Monitoring<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/troubleshooting.html" aria-label="Troubleshooting Guide"><!--[--><!--[--><!--]--><!--]-->Troubleshooting Guide<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="configuration-et-environnement" tabindex="-1"><a class="header-anchor" href="#configuration-et-environnement"><span>Configuration et environnement</span></a></h1><h2 id="vue-d-ensemble" tabindex="-1"><a class="header-anchor" href="#vue-d-ensemble"><span>Vue d&#39;ensemble</span></a></h2><p>MathQuest utilise plusieurs fichiers de configuration et variables d&#39;environnement pour gérer différents aspects de l&#39;application. Cette section détaille toutes les options de configuration disponibles.</p><h2 id="variables-d-environnement" tabindex="-1"><a class="header-anchor" href="#variables-d-environnement"><span>Variables d&#39;environnement</span></a></h2><h3 id="variables-obligatoires" tabindex="-1"><a class="header-anchor" href="#variables-obligatoires"><span>Variables obligatoires</span></a></h3><h4 id="base-de-donnees" tabindex="-1"><a class="header-anchor" href="#base-de-donnees"><span>Base de données</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># URL de connexion PostgreSQL</span></span>
<span class="line"><span class="token assign-left variable">DATABASE_URL</span><span class="token operator">=</span><span class="token string">&quot;postgresql://username:password@localhost:5432/mathquest&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="cache-redis" tabindex="-1"><a class="header-anchor" href="#cache-redis"><span>Cache Redis</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># URL de connexion Redis</span></span>
<span class="line"><span class="token assign-left variable">REDIS_URL</span><span class="token operator">=</span><span class="token string">&quot;redis://localhost:6379&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="authentification-jwt" tabindex="-1"><a class="header-anchor" href="#authentification-jwt"><span>Authentification JWT</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Clé secrète pour les tokens JWT (minimum 32 caractères)</span></span>
<span class="line"><span class="token assign-left variable">JWT_SECRET</span><span class="token operator">=</span><span class="token string">&quot;your_super_secure_jwt_secret_key_here&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="variables-recommandees" tabindex="-1"><a class="header-anchor" href="#variables-recommandees"><span>Variables recommandées</span></a></h3><h4 id="configuration-serveur" tabindex="-1"><a class="header-anchor" href="#configuration-serveur"><span>Configuration serveur</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Port d&#39;écoute du serveur (défaut: 3007)</span></span>
<span class="line"><span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token number">3007</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Niveau de log (DEBUG, INFO, WARN, ERROR)</span></span>
<span class="line"><span class="token assign-left variable">LOG_LEVEL</span><span class="token operator">=</span>INFO</span>
<span class="line"></span>
<span class="line"><span class="token comment"># URL du frontend pour CORS (production)</span></span>
<span class="line"><span class="token assign-left variable">FRONTEND_URL</span><span class="token operator">=</span><span class="token string">&quot;https://yourdomain.com&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Domaine de l&#39;application</span></span>
<span class="line"><span class="token assign-left variable">APP_DOMAIN</span><span class="token operator">=</span><span class="token string">&quot;yourdomain.com&quot;</span></span>
<span class="line"><span class="token assign-left variable">APP_NAME</span><span class="token operator">=</span><span class="token string">&quot;MathQuest&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="securite" tabindex="-1"><a class="header-anchor" href="#securite"><span>Sécurité</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Mot de passe administrateur pour les inscriptions enseignants</span></span>
<span class="line"><span class="token assign-left variable">ADMIN_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;secure_admin_password&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Configuration email (Brevo/Sendinblue)</span></span>
<span class="line"><span class="token assign-left variable">BREVO_API_KEY</span><span class="token operator">=</span><span class="token string">&quot;your_brevo_api_key&quot;</span></span>
<span class="line"><span class="token assign-left variable">BREVO_SENDER_EMAIL</span><span class="token operator">=</span><span class="token string">&quot;noreply@yourdomain.com&quot;</span></span>
<span class="line"><span class="token assign-left variable">BREVO_SENDER_NAME</span><span class="token operator">=</span><span class="token string">&quot;MathQuest&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="email-et-verification" tabindex="-1"><a class="header-anchor" href="#email-et-verification"><span>Email et vérification</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Durée d&#39;expiration des tokens</span></span>
<span class="line"><span class="token assign-left variable">EMAIL_VERIFICATION_TOKEN_EXPIRY</span><span class="token operator">=</span><span class="token string">&quot;24h&quot;</span></span>
<span class="line"><span class="token assign-left variable">PASSWORD_RESET_TOKEN_EXPIRY</span><span class="token operator">=</span><span class="token string">&quot;1h&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="fichiers-de-configuration" tabindex="-1"><a class="header-anchor" href="#fichiers-de-configuration"><span>Fichiers de configuration</span></a></h2><h3 id="pm2-ecosystem-configuration" tabindex="-1"><a class="header-anchor" href="#pm2-ecosystem-configuration"><span>PM2 Ecosystem Configuration</span></a></h3><p>Le fichier <code>ecosystem.config.js</code> configure le déploiement avec PM2 :</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">apps</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;mathquest-backend&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">script</span><span class="token operator">:</span> <span class="token string">&quot;npm&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">cwd</span><span class="token operator">:</span> <span class="token string">&quot;./backend&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token string">&quot;run start&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token constant">REDIS_URL</span><span class="token operator">:</span> <span class="token string">&quot;redis://localhost:6379&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token constant">DATABASE_URL</span><span class="token operator">:</span> <span class="token string">&quot;postgresql://...&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token constant">JWT_SECRET</span><span class="token operator">:</span> <span class="token string">&quot;...&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token constant">FRONTEND_URL</span><span class="token operator">:</span> <span class="token string">&quot;https://yourdomain.com&quot;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">log_file</span><span class="token operator">:</span> <span class="token string">&quot;./logs/pm2-backend.log&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">out_file</span><span class="token operator">:</span> <span class="token string">&quot;./logs/pm2-backend-out.log&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">error_file</span><span class="token operator">:</span> <span class="token string">&quot;./logs/pm2-backend-error.log&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">log_date_format</span><span class="token operator">:</span> <span class="token string">&quot;YYYY-MM-DD HH:mm:ss Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">merge_logs</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">max_memory_restart</span><span class="token operator">:</span> <span class="token string">&quot;400M&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;mathquest-frontend&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">script</span><span class="token operator">:</span> <span class="token string">&quot;npm&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">cwd</span><span class="token operator">:</span> <span class="token string">&quot;./frontend&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token string">&quot;run start:minimal&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                <span class="token constant">NODE_ENV</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span></span>
<span class="line">                <span class="token constant">NEXT_TELEMETRY_DISABLED</span><span class="token operator">:</span> <span class="token string">&quot;1&quot;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">log_file</span><span class="token operator">:</span> <span class="token string">&quot;./logs/pm2-frontend.log&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">out_file</span><span class="token operator">:</span> <span class="token string">&quot;./logs/pm2-frontend-out.log&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">error_file</span><span class="token operator">:</span> <span class="token string">&quot;./logs/pm2-frontend-error.log&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">log_date_format</span><span class="token operator">:</span> <span class="token string">&quot;YYYY-MM-DD HH:mm:ss Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">merge_logs</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">            <span class="token literal-property property">max_memory_restart</span><span class="token operator">:</span> <span class="token string">&quot;300M&quot;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="configuration-next-js" tabindex="-1"><a class="header-anchor" href="#configuration-next-js"><span>Configuration Next.js</span></a></h3><p>Le fichier <code>next.config.ts</code> configure l&#39;application frontend :</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token punctuation">{</span>import(&#39;next&#39;).NextConfig<span class="token punctuation">}</span> */</span></span>
<span class="line"><span class="token keyword">const</span> nextConfig <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// Configuration de base</span></span>
<span class="line">  reactStrictMode<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Configuration des images</span></span>
<span class="line">  images<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    domains<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;localhost&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    unoptimized<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;development&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Headers de sécurité</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        source<span class="token operator">:</span> <span class="token string">&#39;/(.*)&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        headers<span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            key<span class="token operator">:</span> <span class="token string">&#39;X-Frame-Options&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            value<span class="token operator">:</span> <span class="token string">&#39;DENY&#39;</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            key<span class="token operator">:</span> <span class="token string">&#39;X-Content-Type-Options&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            value<span class="token operator">:</span> <span class="token string">&#39;nosniff&#39;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// Variables d&#39;environnement exposées au frontend</span></span>
<span class="line">  env<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token constant">NEXT_PUBLIC_APP_NAME</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">APP_NAME</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token constant">NEXT_PUBLIC_APP_DOMAIN</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">APP_DOMAIN</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> nextConfig<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="configuration-eslint" tabindex="-1"><a class="header-anchor" href="#configuration-eslint"><span>Configuration ESLint</span></a></h3><p>Le fichier <code>eslint.config.mjs</code> définit les règles de linting :</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;eslint-define-config&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">browser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">es2021</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string">&#39;eslint:recommended&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;@typescript-eslint/recommended&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;plugin:react/recommended&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;plugin:react-hooks/recommended&#39;</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">&#39;@typescript-eslint/parser&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">ecmaFeatures</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">jsx</span><span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&#39;module&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;react&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;@typescript-eslint&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Règles personnalisées</span></span>
<span class="line">    <span class="token string-property property">&#39;react/react-in-jsx-scope&#39;</span><span class="token operator">:</span> <span class="token string">&#39;off&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&#39;@typescript-eslint/no-unused-vars&#39;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">argsIgnorePattern</span><span class="token operator">:</span> <span class="token string">&#39;^_&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&#39;no-console&#39;</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span> <span class="token operator">?</span> <span class="token string">&#39;error&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;warn&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">settings</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">react</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">&#39;detect&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="configuration-de-la-base-de-donnees" tabindex="-1"><a class="header-anchor" href="#configuration-de-la-base-de-donnees"><span>Configuration de la base de données</span></a></h2><h3 id="prisma-schema" tabindex="-1"><a class="header-anchor" href="#prisma-schema"><span>Prisma Schema</span></a></h3><p>Le fichier <code>schema.prisma</code> définit le modèle de données :</p><div class="language-prisma line-numbers-mode" data-highlighter="prismjs" data-ext="prisma"><pre><code class="language-prisma"><span class="line">generator client {</span>
<span class="line">  provider = &quot;prisma-client-js&quot;</span>
<span class="line">  output   = &quot;../src/db/generated/client&quot;</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">datasource db {</span>
<span class="line">  provider = &quot;postgresql&quot;</span>
<span class="line">  url      = env(&quot;DATABASE_URL&quot;)</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">// Modèles de données...</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="configuration-de-connexion" tabindex="-1"><a class="header-anchor" href="#configuration-de-connexion"><span>Configuration de connexion</span></a></h3><p>La connexion Prisma est configurée dans <code>src/db/prisma.ts</code> :</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> PrismaClient <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;@/db/generated/client&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Singleton pattern pour éviter les connexions multiples</span></span>
<span class="line"><span class="token keyword">declare</span> global <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">var</span> prisma<span class="token operator">:</span> PrismaClient <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> prisma <span class="token operator">=</span> global<span class="token punctuation">.</span>prisma <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">PrismaClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  log<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;development&#39;</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token string">&#39;query&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;warn&#39;</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">&#39;production&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  global<span class="token punctuation">.</span>prisma <span class="token operator">=</span> prisma<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="configuration-redis" tabindex="-1"><a class="header-anchor" href="#configuration-redis"><span>Configuration Redis</span></a></h2><h3 id="connexion-redis" tabindex="-1"><a class="header-anchor" href="#connexion-redis"><span>Connexion Redis</span></a></h3><p>Le fichier <code>src/config/redis.ts</code> configure la connexion Redis :</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> Redis <span class="token keyword">from</span> <span class="token string">&#39;ioredis&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> logger <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;../utils/logger&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> redisUrl <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">REDIS_URL</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>redisUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;REDIS_URL is not defined in environment variables.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;REDIS_URL is not defined.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> redisClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Redis</span><span class="token punctuation">(</span>redisUrl<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  maxRetriesPerRequest<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">  enableReadyCheck<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">  retryDelayOnFailover<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span></span>
<span class="line">  maxRetriesPerRequest<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span></span>
<span class="line">  lazyConnect<span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">redisClient<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;connect&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&#39;Successfully connected to Redis.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">redisClient<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;Redis connection error:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token punctuation">{</span> redisClient <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cles-redis-utilisees" tabindex="-1"><a class="header-anchor" href="#cles-redis-utilisees"><span>Clés Redis utilisées</span></a></h3><p>MathQuest utilise plusieurs patterns de clés Redis :</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"># États de partie</span>
<span class="line">mathquest:game:{accessCode}</span>
<span class="line"></span>
<span class="line"># Timers de questions</span>
<span class="line">mathquest:timer:{accessCode}:{questionUid}</span>
<span class="line"></span>
<span class="line"># Sessions utilisateur</span>
<span class="line">mathquest:session:{userId}</span>
<span class="line"></span>
<span class="line"># Cache des questions</span>
<span class="line">mathquest:question:{questionUid}</span>
<span class="line"></span>
<span class="line"># Leaderboards</span>
<span class="line">mathquest:leaderboard:{gameId}</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="configuration-cors" tabindex="-1"><a class="header-anchor" href="#configuration-cors"><span>Configuration CORS</span></a></h2><h3 id="middleware-cors" tabindex="-1"><a class="header-anchor" href="#middleware-cors"><span>Middleware CORS</span></a></h3><p>Le serveur configure CORS dans <code>src/server.ts</code> :</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  origin<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;production&#39;</span></span>
<span class="line">    <span class="token operator">?</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FRONTEND_URL</span> <span class="token operator">||</span> <span class="token string">&#39;https://mathquest.example.com&#39;</span></span>
<span class="line">    <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;http://localhost:3000&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;http://localhost:3001&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;http://localhost:3008&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  methods<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;PUT&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;DELETE&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;OPTIONS&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  credentials<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">  allowedHeaders<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;Content-Type&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Authorization&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;X-Requested-With&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="configuration-des-logs" tabindex="-1"><a class="header-anchor" href="#configuration-des-logs"><span>Configuration des logs</span></a></h2><h3 id="logger-personnalise" tabindex="-1"><a class="header-anchor" href="#logger-personnalise"><span>Logger personnalisé</span></a></h3><p>Le système de logging utilise <code>winston</code> avec configuration dans <code>src/utils/logger.ts</code> :</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> winston <span class="token keyword">from</span> <span class="token string">&#39;winston&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> logLevel <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">LOG_LEVEL</span> <span class="token operator">||</span> <span class="token string">&#39;info&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> logger <span class="token operator">=</span> winston<span class="token punctuation">.</span><span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  level<span class="token operator">:</span> logLevel<span class="token punctuation">,</span></span>
<span class="line">  format<span class="token operator">:</span> winston<span class="token punctuation">.</span>format<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span></span>
<span class="line">    winston<span class="token punctuation">.</span>format<span class="token punctuation">.</span><span class="token function">timestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    winston<span class="token punctuation">.</span>format<span class="token punctuation">.</span><span class="token function">errors</span><span class="token punctuation">(</span><span class="token punctuation">{</span> stack<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    winston<span class="token punctuation">.</span>format<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  defaultMeta<span class="token operator">:</span> <span class="token punctuation">{</span> service<span class="token operator">:</span> <span class="token string">&#39;mathquest&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  transports<span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">winston</span><span class="token punctuation">.</span>transports<span class="token punctuation">.</span><span class="token function">Console</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      format<span class="token operator">:</span> winston<span class="token punctuation">.</span>format<span class="token punctuation">.</span><span class="token function">combine</span><span class="token punctuation">(</span></span>
<span class="line">        winston<span class="token punctuation">.</span>format<span class="token punctuation">.</span><span class="token function">colorize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        winston<span class="token punctuation">.</span>format<span class="token punctuation">.</span><span class="token function">simple</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">winston</span><span class="token punctuation">.</span>transports<span class="token punctuation">.</span><span class="token function">File</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      filename<span class="token operator">:</span> <span class="token string">&#39;logs/error.log&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      level<span class="token operator">:</span> <span class="token string">&#39;error&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">new</span> <span class="token class-name">winston</span><span class="token punctuation">.</span>transports<span class="token punctuation">.</span><span class="token function">File</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      filename<span class="token operator">:</span> <span class="token string">&#39;logs/combined.log&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> logger<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="configuration-des-tests" tabindex="-1"><a class="header-anchor" href="#configuration-des-tests"><span>Configuration des tests</span></a></h2><h3 id="jest-configuration" tabindex="-1"><a class="header-anchor" href="#jest-configuration"><span>Jest Configuration</span></a></h3><p>Le fichier <code>jest.config.js</code> configure les tests :</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">preset</span><span class="token operator">:</span> <span class="token string">&#39;ts-jest&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">testEnvironment</span><span class="token operator">:</span> <span class="token string">&#39;node&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">roots</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;&lt;rootDir&gt;/src&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;&lt;rootDir&gt;/tests&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">testMatch</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token string">&#39;**/__tests__/**/*.+(ts|tsx|js)&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string">&#39;**/?(*.)+(spec|test).+(ts|tsx|js)&#39;</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">moduleFileExtensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;ts&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;tsx&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;js&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;jsx&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;json&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;node&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">collectCoverage</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">clearMocks</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">globalSetup</span><span class="token operator">:</span> <span class="token string">&#39;&lt;rootDir&gt;/tests/support/globalSetup.ts&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">globalTeardown</span><span class="token operator">:</span> <span class="token string">&#39;&lt;rootDir&gt;/tests/support/globalTeardown.ts&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">setupFiles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;&lt;rootDir&gt;/tests/setupTestEnv.js&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">moduleNameMapper</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&#39;^@/(.*)$&#39;</span><span class="token operator">:</span> <span class="token string">&#39;&lt;rootDir&gt;/src/$1&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&#39;^@shared/(.*)$&#39;</span><span class="token operator">:</span> <span class="token string">&#39;&lt;rootDir&gt;/../shared/$1&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">maxConcurrency</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">maxWorkers</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">forceExit</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">testTimeout</span><span class="token operator">:</span> <span class="token number">10000</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="variables-d-environnement-par-environnement" tabindex="-1"><a class="header-anchor" href="#variables-d-environnement-par-environnement"><span>Variables d&#39;environnement par environnement</span></a></h2><h3 id="developpement" tabindex="-1"><a class="header-anchor" href="#developpement"><span>Développement</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># .env</span></span>
<span class="line"><span class="token assign-left variable">NODE_ENV</span><span class="token operator">=</span>development</span>
<span class="line"><span class="token assign-left variable">DATABASE_URL</span><span class="token operator">=</span><span class="token string">&quot;postgresql://postgres:password@localhost:5432/mathquest_dev&quot;</span></span>
<span class="line"><span class="token assign-left variable">REDIS_URL</span><span class="token operator">=</span><span class="token string">&quot;redis://localhost:6379&quot;</span></span>
<span class="line"><span class="token assign-left variable">JWT_SECRET</span><span class="token operator">=</span><span class="token string">&quot;dev_secret_key_not_for_production&quot;</span></span>
<span class="line"><span class="token assign-left variable">LOG_LEVEL</span><span class="token operator">=</span>DEBUG</span>
<span class="line"><span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token number">3007</span></span>
<span class="line"><span class="token assign-left variable">FRONTEND_URL</span><span class="token operator">=</span><span class="token string">&quot;http://localhost:3000&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="production" tabindex="-1"><a class="header-anchor" href="#production"><span>Production</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># .env</span></span>
<span class="line"><span class="token assign-left variable">NODE_ENV</span><span class="token operator">=</span>production</span>
<span class="line"><span class="token assign-left variable">DATABASE_URL</span><span class="token operator">=</span><span class="token string">&quot;postgresql://user:password@prod-db-host:5432/mathquest_prod&quot;</span></span>
<span class="line"><span class="token assign-left variable">REDIS_URL</span><span class="token operator">=</span><span class="token string">&quot;redis://prod-redis-host:6379&quot;</span></span>
<span class="line"><span class="token assign-left variable">JWT_SECRET</span><span class="token operator">=</span><span class="token string">&quot;production_secret_key_very_secure&quot;</span></span>
<span class="line"><span class="token assign-left variable">LOG_LEVEL</span><span class="token operator">=</span>WARN</span>
<span class="line"><span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token number">3007</span></span>
<span class="line"><span class="token assign-left variable">FRONTEND_URL</span><span class="token operator">=</span><span class="token string">&quot;https://mathquest.example.com&quot;</span></span>
<span class="line"><span class="token assign-left variable">APP_DOMAIN</span><span class="token operator">=</span><span class="token string">&quot;mathquest.example.com&quot;</span></span>
<span class="line"><span class="token assign-left variable">BREVO_API_KEY</span><span class="token operator">=</span><span class="token string">&quot;prod_brevo_key&quot;</span></span>
<span class="line"><span class="token assign-left variable">ADMIN_PASSWORD</span><span class="token operator">=</span><span class="token string">&quot;secure_prod_admin_password&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="test" tabindex="-1"><a class="header-anchor" href="#test"><span>Test</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># .env.test</span></span>
<span class="line"><span class="token assign-left variable">NODE_ENV</span><span class="token operator">=</span>test</span>
<span class="line"><span class="token assign-left variable">DATABASE_URL</span><span class="token operator">=</span><span class="token string">&quot;postgresql://postgres:password@localhost:5432/mathquest_test&quot;</span></span>
<span class="line"><span class="token assign-left variable">REDIS_URL</span><span class="token operator">=</span><span class="token string">&quot;redis://localhost:6379&quot;</span></span>
<span class="line"><span class="token assign-left variable">JWT_SECRET</span><span class="token operator">=</span><span class="token string">&quot;test_secret_key&quot;</span></span>
<span class="line"><span class="token assign-left variable">LOG_LEVEL</span><span class="token operator">=</span>ERROR</span>
<span class="line"><span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token number">3008</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="scripts-de-deploiement" tabindex="-1"><a class="header-anchor" href="#scripts-de-deploiement"><span>Scripts de déploiement</span></a></h2><h3 id="scripts-disponibles" tabindex="-1"><a class="header-anchor" href="#scripts-disponibles"><span>Scripts disponibles</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Construction complète</span></span>
<span class="line">./build-all.sh</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Construction pour VPS</span></span>
<span class="line">./build-vps.sh</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Démarrage avec PM2</span></span>
<span class="line"><span class="token function">npm</span> run pm2:start</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Redémarrage des services</span></span>
<span class="line"><span class="token function">npm</span> run pm2:restart</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Arrêt des services</span></span>
<span class="line"><span class="token function">npm</span> run pm2:stop</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Logs PM2</span></span>
<span class="line"><span class="token function">npm</span> run pm2:logs</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="script-de-construction-complet" tabindex="-1"><a class="header-anchor" href="#script-de-construction-complet"><span>Script de construction complet</span></a></h3><p>Le fichier <code>build-all.sh</code> :</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Construction du backend</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;Building backend...&quot;</span></span>
<span class="line"><span class="token builtin class-name">cd</span> backend</span>
<span class="line"><span class="token function">npm</span> <span class="token function">install</span></span>
<span class="line"><span class="token function">npm</span> run build</span>
<span class="line"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Construction du frontend</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;Building frontend...&quot;</span></span>
<span class="line"><span class="token builtin class-name">cd</span> frontend</span>
<span class="line"><span class="token function">npm</span> <span class="token function">install</span></span>
<span class="line"><span class="token function">npm</span> run build</span>
<span class="line"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Construction de la documentation</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;Building docs...&quot;</span></span>
<span class="line"><span class="token builtin class-name">cd</span> vuepress</span>
<span class="line"><span class="token function">npm</span> <span class="token function">install</span></span>
<span class="line"><span class="token function">npm</span> run build</span>
<span class="line"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;Build completed!&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="monitoring-et-metriques" tabindex="-1"><a class="header-anchor" href="#monitoring-et-metriques"><span>Monitoring et métriques</span></a></h2><h3 id="endpoints-de-sante" tabindex="-1"><a class="header-anchor" href="#endpoints-de-sante"><span>Endpoints de santé</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Santé générale</span></span>
<span class="line">GET /health</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Métriques mémoire</span></span>
<span class="line">GET /health/memory</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Métriques détaillées (authentification requise)</span></span>
<span class="line">GET /api/v1/health/metrics</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="metriques-collectees" tabindex="-1"><a class="header-anchor" href="#metriques-collectees"><span>Métriques collectées</span></a></h3><ul><li>Utilisation mémoire (heap, RSS, external)</li><li>Uptime du processus</li><li>Nombre de connexions Socket.IO actives</li><li>Latence base de données</li><li>Taux d&#39;erreur des requêtes</li><li>Métriques Redis (connexions, commandes/seconde)</li></ul><h2 id="securite-1" tabindex="-1"><a class="header-anchor" href="#securite-1"><span>Sécurité</span></a></h2><h3 id="headers-de-securite" tabindex="-1"><a class="header-anchor" href="#headers-de-securite"><span>Headers de sécurité</span></a></h3><p>Configuration des headers dans Next.js :</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">async</span> <span class="token function">headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      source<span class="token operator">:</span> <span class="token string">&#39;/(.*)&#39;</span><span class="token punctuation">,</span></span>
<span class="line">      headers<span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">&#39;X-Frame-Options&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&#39;DENY&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">&#39;X-Content-Type-Options&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&#39;nosniff&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">&#39;Referrer-Policy&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&#39;strict-origin-when-cross-origin&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span> key<span class="token operator">:</span> <span class="token string">&#39;Permissions-Policy&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token string">&#39;camera=(), microphone=()&#39;</span> <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="validation-des-entrees" tabindex="-1"><a class="header-anchor" href="#validation-des-entrees"><span>Validation des entrées</span></a></h3><p>Toutes les entrées utilisateur sont validées avec Zod :</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> z <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;zod&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">const</span> UserInputSchema <span class="token operator">=</span> z<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  email<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">email</span><span class="token punctuation">(</span><span class="token string">&#39;Email invalide&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  password<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">&#39;Mot de passe trop court&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  username<span class="token operator">:</span> z<span class="token punctuation">.</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&#39;Nom d\&#39;utilisateur trop court&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="migration-et-mise-a-jour" tabindex="-1"><a class="header-anchor" href="#migration-et-mise-a-jour"><span>Migration et mise à jour</span></a></h2><h3 id="variables-d-environnement-critiques" tabindex="-1"><a class="header-anchor" href="#variables-d-environnement-critiques"><span>Variables d&#39;environnement critiques</span></a></h3><p>Lors des mises à jour, vérifier ces variables :</p><ol><li><code>DATABASE_URL</code> - Peut changer avec la migration DB</li><li><code>REDIS_URL</code> - Peut changer avec le scaling</li><li><code>JWT_SECRET</code> - Ne jamais changer en production</li><li><code>BREVO_API_KEY</code> - Peut nécessiter rotation</li><li><code>ADMIN_PASSWORD</code> - À changer régulièrement</li></ol><h3 id="commandes-de-migration" tabindex="-1"><a class="header-anchor" href="#commandes-de-migration"><span>Commandes de migration</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Migration base de données</span></span>
<span class="line"><span class="token builtin class-name">cd</span> backend</span>
<span class="line">npx prisma migrate deploy</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Génération du client Prisma</span></span>
<span class="line">npx prisma generate</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Redémarrage des services</span></span>
<span class="line"><span class="token function">npm</span> run pm2:restart</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Dernière mise à jour: </span><time class="meta-item-info" datetime="2025-09-19T13:01:15.000Z" data-allow-mismatch>19/09/2025 15:01</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: alexis.flesch@gmail.com">alexisflesch</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/mathquest/details-techniques/api.html" aria-label="API REST"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">API REST</span></div><!--]--></a><a class="route-link auto-link next" href="/mathquest/details-techniques/tests.html" aria-label="Tests et qualité"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">Tests et qualité</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/mathquest/assets/app-DoDG4mLI.js" defer></script>
  </body>
</html>
