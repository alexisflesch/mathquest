<!doctype html>
<html lang="fr-FR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.23" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/mathquest/favicon.ico"><link rel="stylesheet" href="/mathquest/styles/screenshots.css"><title>Performance & Monitoring | MathQuest</title><meta name="description" content="Performance optimization strategies, monitoring endpoints, and caching mechanisms for MathQuest">
    <link rel="preload" href="/mathquest/assets/style-Dkmw-xJK.css" as="style"><link rel="stylesheet" href="/mathquest/assets/style-Dkmw-xJK.css">
    <link rel="modulepreload" href="/mathquest/assets/app-DoDG4mLI.js"><link rel="modulepreload" href="/mathquest/assets/performance-monitoring.html-rC33no4g.js">
    <link rel="prefetch" href="/mathquest/assets/index.html-DVgZZIvh.js" as="script"><link rel="prefetch" href="/mathquest/assets/index.html-D41YBSyI.js" as="script"><link rel="prefetch" href="/mathquest/assets/api.html-DuEObc8p.js" as="script"><link rel="prefetch" href="/mathquest/assets/architecture.html-u6XaedTl.js" as="script"><link rel="prefetch" href="/mathquest/assets/backend-services.html-Bn7Sl0dY.js" as="script"><link rel="prefetch" href="/mathquest/assets/configuration.html-CK6wnHSc.js" as="script"><link rel="prefetch" href="/mathquest/assets/database.html-Cst-518d.js" as="script"><link rel="prefetch" href="/mathquest/assets/deployement.html-DyDpUuyd.js" as="script"><link rel="prefetch" href="/mathquest/assets/scoring.html-Bcr7KETl.js" as="script"><link rel="prefetch" href="/mathquest/assets/security.html-CnxCz1Mf.js" as="script"><link rel="prefetch" href="/mathquest/assets/tests.html-hRJAedr5.js" as="script"><link rel="prefetch" href="/mathquest/assets/troubleshooting.html-CcGeBJgq.js" as="script"><link rel="prefetch" href="/mathquest/assets/index.html-BOckdlIK.js" as="script"><link rel="prefetch" href="/mathquest/assets/index.html-C5kHWhGv.js" as="script"><link rel="prefetch" href="/mathquest/assets/contribuer.html-BwIMJqK-.js" as="script"><link rel="prefetch" href="/mathquest/assets/index.html-XR6uVX9n.js" as="script"><link rel="prefetch" href="/mathquest/assets/entrainement.html-ruDYf3W6.js" as="script"><link rel="prefetch" href="/mathquest/assets/quiz.html-Jk8e0nUz.js" as="script"><link rel="prefetch" href="/mathquest/assets/tournoi.html-DqqXOLYd.js" as="script"><link rel="prefetch" href="/mathquest/assets/404.html-DZLuBRi1.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/mathquest/"><img class="vp-site-logo" src="/mathquest/assets/logo.svg" alt="MathQuest"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">MathQuest</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/" aria-label="Accueil"><!--[--><!--[--><!--]--><!--]-->Accueil<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/utilisation/" aria-label="Utilisation de l&#39;appli"><!--[--><!--[--><!--]--><!--]-->Utilisation de l&#39;appli<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/questions-yaml/" aria-label="Écriture de questions"><!--[--><!--[--><!--]--><!--]-->Écriture de questions<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/installation/" aria-label="Installation"><!--[--><!--[--><!--]--><!--]-->Installation<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/mathquest/details-techniques/" aria-label="Détails techniques"><!--[--><!--[--><!--]--><!--]-->Détails techniques<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/" aria-label="Accueil"><!--[--><!--[--><!--]--><!--]-->Accueil<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/utilisation/" aria-label="Utilisation de l&#39;appli"><!--[--><!--[--><!--]--><!--]-->Utilisation de l&#39;appli<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/questions-yaml/" aria-label="Écriture de questions"><!--[--><!--[--><!--]--><!--]-->Écriture de questions<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/mathquest/installation/" aria-label="Installation"><!--[--><!--[--><!--]--><!--]-->Installation<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/mathquest/details-techniques/" aria-label="Détails techniques"><!--[--><!--[--><!--]--><!--]-->Détails techniques<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Détails techniques (utilisateurs avancés seulement) <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item" href="/mathquest/details-techniques/" aria-label="Détails techniques (utilisateurs avancés seulement)"><!--[--><!--[--><!--]--><!--]-->Détails techniques (utilisateurs avancés seulement)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/architecture.html" aria-label="Architecture générale"><!--[--><!--[--><!--]--><!--]-->Architecture générale<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/database.html" aria-label="Base de données"><!--[--><!--[--><!--]--><!--]-->Base de données<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/scoring.html" aria-label="Système de scoring"><!--[--><!--[--><!--]--><!--]-->Système de scoring<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/backend-services.html" aria-label="Services backend"><!--[--><!--[--><!--]--><!--]-->Services backend<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/api.html" aria-label="API REST"><!--[--><!--[--><!--]--><!--]-->API REST<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/configuration.html" aria-label="Configuration et environnement"><!--[--><!--[--><!--]--><!--]-->Configuration et environnement<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/tests.html" aria-label="Tests et qualité"><!--[--><!--[--><!--]--><!--]-->Tests et qualité<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/deployement.html" aria-label="Déploiement et DevOps"><!--[--><!--[--><!--]--><!--]-->Déploiement et DevOps<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/security.html" aria-label="Security Documentation"><!--[--><!--[--><!--]--><!--]-->Security Documentation<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/mathquest/details-techniques/performance-monitoring.html" aria-label="Performance &amp; Monitoring"><!--[--><!--[--><!--]--><!--]-->Performance &amp; Monitoring<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/mathquest/details-techniques/troubleshooting.html" aria-label="Troubleshooting Guide"><!--[--><!--[--><!--]--><!--]-->Troubleshooting Guide<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="performance-monitoring-documentation" tabindex="-1"><a class="header-anchor" href="#performance-monitoring-documentation"><span>Performance &amp; Monitoring Documentation</span></a></h1><p>This document covers the performance optimization strategies, monitoring capabilities, and caching mechanisms implemented in MathQuest.</p><h2 id="memory-optimization" tabindex="-1"><a class="header-anchor" href="#memory-optimization"><span>Memory Optimization</span></a></h2><h3 id="vps-memory-constraints" tabindex="-1"><a class="header-anchor" href="#vps-memory-constraints"><span>VPS Memory Constraints</span></a></h3><p>MathQuest is optimized to run efficiently on low-cost VPS environments with limited memory:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// PM2 ecosystem configuration for memory management</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;mathquest-backend&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">script</span><span class="token operator">:</span> <span class="token string">&quot;npm&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token string">&quot;run start:memory-limited&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">max_memory_restart</span><span class="token operator">:</span> <span class="token string">&quot;400M&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">log_file</span><span class="token operator">:</span> <span class="token string">&quot;./logs/pm2-backend.log&quot;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;mathquest-frontend&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">script</span><span class="token operator">:</span> <span class="token string">&quot;npm&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token string">&quot;run start:minimal&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">max_memory_restart</span><span class="token operator">:</span> <span class="token string">&quot;300M&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">log_file</span><span class="token operator">:</span> <span class="token string">&quot;./logs/pm2-frontend.log&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Memory Limits:</strong></p><ul><li><strong>Backend</strong>: 400MB maximum before automatic restart</li><li><strong>Frontend</strong>: 300MB maximum before automatic restart</li><li><strong>Build Process</strong>: 1GB limit for compilation</li><li><strong>PWA Cache</strong>: 2MB per file size limit</li></ul><h3 id="node-js-memory-configuration" tabindex="-1"><a class="header-anchor" href="#node-js-memory-configuration"><span>Node.js Memory Configuration</span></a></h3><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line"><span class="token comment">// Backend memory optimization scripts</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;start:memory-limited&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node --max-old-space-size=256 --max-semi-space-size=64 --max-new-space-size=32 -r dotenv/config dist/backend/src/server.js&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;start:ultra-limited&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node --max-old-space-size=128 --max-semi-space-size=32 --max-new-space-size=16 -r dotenv/config dist/backend/src/server.js&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Frontend memory optimization</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;start:minimal&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NODE_OPTIONS=&#39;--max-old-space-size=256 --max-semi-space-size=64&#39; NEXT_TELEMETRY_DISABLED=1 next start -p 3008 --quiet&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;start:quiet&quot;</span><span class="token operator">:</span> <span class="token string">&quot;NODE_OPTIONS=&#39;--max-old-space-size=512 --max-semi-space-size=128&#39; NEXT_TELEMETRY_DISABLED=1 next start -p 3008 --quiet&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="redis-caching-strategy" tabindex="-1"><a class="header-anchor" href="#redis-caching-strategy"><span>Redis Caching Strategy</span></a></h2><h3 id="connection-configuration" tabindex="-1"><a class="header-anchor" href="#connection-configuration"><span>Connection Configuration</span></a></h3><p>MathQuest uses Redis for high-performance caching and session management:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Redis client configuration</span></span>
<span class="line"><span class="token keyword">const</span> redisClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Redis</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">REDIS_URL</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    maxRetriesPerRequest<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// Keep trying to reconnect</span></span>
<span class="line">    enableReadyCheck<span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Connection event handling</span></span>
<span class="line">redisClient<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;connect&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&#39;Successfully connected to Redis.&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">redisClient<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;Redis connection error:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="caching-use-cases" tabindex="-1"><a class="header-anchor" href="#caching-use-cases"><span>Caching Use Cases</span></a></h3><p><strong>Session Management:</strong></p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// User session storage in Redis</span></span>
<span class="line"><span class="token keyword">const</span> sessionKey <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">session:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sessionId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">await</span> redisClient<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>sessionKey<span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>sessionData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Game State Caching:</strong></p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Game timer state caching</span></span>
<span class="line"><span class="token keyword">const</span> timerKey <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">game:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>gameId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:timer</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">await</span> redisClient<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>timerKey<span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>timerState<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Leaderboard caching</span></span>
<span class="line"><span class="token keyword">const</span> leaderboardKey <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">game:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>gameId<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:leaderboard</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">await</span> redisClient<span class="token punctuation">.</span><span class="token function">setex</span><span class="token punctuation">(</span>leaderboardKey<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>leaderboard<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Real-time Data:</strong></p><ul><li><strong>Timer States</strong>: Cached for 1 hour with automatic expiration</li><li><strong>Participant Scores</strong>: Cached for 5 minutes during active games</li><li><strong>Game Metadata</strong>: Cached for 30 minutes</li><li><strong>User Sessions</strong>: Cached for 1 hour with sliding expiration</li></ul><h3 id="socket-io-redis-adapter" tabindex="-1"><a class="header-anchor" href="#socket-io-redis-adapter"><span>Socket.IO Redis Adapter</span></a></h3><p>For horizontal scaling and real-time performance:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Redis adapter for Socket.IO clustering</span></span>
<span class="line"><span class="token keyword">const</span> subClient <span class="token operator">=</span> redisClient<span class="token punctuation">.</span><span class="token function">duplicate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">io<span class="token punctuation">.</span><span class="token function">adapter</span><span class="token punctuation">(</span><span class="token function">createAdapter</span><span class="token punctuation">(</span>redisClient<span class="token punctuation">,</span> subClient<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Benefits:</strong></p><ul><li><strong>Horizontal Scaling</strong>: Support for multiple server instances</li><li><strong>Message Broadcasting</strong>: Efficient cross-server communication</li><li><strong>Session Persistence</strong>: Real-time state synchronization</li><li><strong>Load Distribution</strong>: Automatic connection distribution</li></ul><h2 id="performance-monitoring" tabindex="-1"><a class="header-anchor" href="#performance-monitoring"><span>Performance Monitoring</span></a></h2><h3 id="health-check-endpoints" tabindex="-1"><a class="header-anchor" href="#health-check-endpoints"><span>Health Check Endpoints</span></a></h3><p>MathQuest provides comprehensive health monitoring:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Basic health check</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/health&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;OK&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Detailed memory monitoring</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/health/memory&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> memUsage <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">memoryUsage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> uptime <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">uptime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">        status<span class="token operator">:</span> <span class="token string">&#39;OK&#39;</span><span class="token punctuation">,</span></span>
<span class="line">        memory<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            used<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>memUsage<span class="token punctuation">.</span>heapUsed <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// MB</span></span>
<span class="line">            total<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>memUsage<span class="token punctuation">.</span>heapTotal <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// MB</span></span>
<span class="line">            external<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>memUsage<span class="token punctuation">.</span>external <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// MB</span></span>
<span class="line">            rss<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>memUsage<span class="token punctuation">.</span>rss <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token comment">// MB</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        uptime<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>uptime<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// seconds</span></span>
<span class="line">        timestamp<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Monitoring Data:</strong></p><ul><li><strong>Heap Usage</strong>: JavaScript heap memory consumption</li><li><strong>External Memory</strong>: C++ objects bound to JavaScript objects</li><li><strong>RSS</strong>: Resident Set Size (total memory allocated)</li><li><strong>Uptime</strong>: Server uptime in seconds</li><li><strong>Timestamp</strong>: Current server time</li></ul><h3 id="pm2-process-monitoring" tabindex="-1"><a class="header-anchor" href="#pm2-process-monitoring"><span>PM2 Process Monitoring</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// PM2 ecosystem configuration with monitoring</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;mathquest-backend&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">max_memory_restart</span><span class="token operator">:</span> <span class="token string">&quot;400M&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">log_file</span><span class="token operator">:</span> <span class="token string">&quot;./logs/pm2-backend.log&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">out_file</span><span class="token operator">:</span> <span class="token string">&quot;./logs/pm2-backend-out.log&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">error_file</span><span class="token operator">:</span> <span class="token string">&quot;./logs/pm2-backend-error.log&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">log_date_format</span><span class="token operator">:</span> <span class="token string">&quot;YYYY-MM-DD HH:mm:ss Z&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">merge_logs</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">autorestart</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Monitoring Features:</strong></p><ul><li><strong>Automatic Restart</strong>: Memory threshold-based restarts</li><li><strong>Log Management</strong>: Structured logging with timestamps</li><li><strong>Process Stats</strong>: CPU, memory, and uptime tracking</li><li><strong>Cluster Mode</strong>: Multiple process instances for load balancing</li></ul><h3 id="application-logging" tabindex="-1"><a class="header-anchor" href="#application-logging"><span>Application Logging</span></a></h3><p>Comprehensive logging for performance monitoring:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Performance logging</span></span>
<span class="line">logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&#39;Game started&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    gameId<span class="token operator">:</span> game<span class="token punctuation">.</span>id<span class="token punctuation">,</span></span>
<span class="line">    participantCount<span class="token operator">:</span> participants<span class="token punctuation">.</span>length<span class="token punctuation">,</span></span>
<span class="line">    timestamp<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Memory usage logging</span></span>
<span class="line"><span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> memUsage <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">memoryUsage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&#39;Memory usage&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">        heapUsed<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>memUsage<span class="token punctuation">.</span>heapUsed <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        heapTotal<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>memUsage<span class="token punctuation">.</span>heapTotal <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        external<span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>memUsage<span class="token punctuation">.</span>external <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        timestamp<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">300000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Every 5 minutes</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="database-performance" tabindex="-1"><a class="header-anchor" href="#database-performance"><span>Database Performance</span></a></h2><h3 id="prisma-query-optimization" tabindex="-1"><a class="header-anchor" href="#prisma-query-optimization"><span>Prisma Query Optimization</span></a></h3><p>MathQuest uses Prisma ORM with optimized query patterns:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Optimized user lookup with select</span></span>
<span class="line"><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">findUnique</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    where<span class="token operator">:</span> <span class="token punctuation">{</span> email<span class="token operator">:</span> email <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    select<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        id<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        email<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        password<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        role<span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Efficient game queries with relations</span></span>
<span class="line"><span class="token keyword">const</span> game <span class="token operator">=</span> <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>gameInstance<span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    where<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        gameCode<span class="token operator">:</span> gameCode<span class="token punctuation">,</span></span>
<span class="line">        status<span class="token operator">:</span> <span class="token string">&#39;ACTIVE&#39;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    include<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        participants<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            select<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">                id<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                name<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">                score<span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Optimization Techniques:</strong></p><ul><li><strong>Selective Queries</strong>: Only fetch required fields</li><li><strong>Relation Loading</strong>: Efficient eager loading of related data</li><li><strong>Connection Pooling</strong>: Automatic connection management</li><li><strong>Query Caching</strong>: Database-level query result caching</li></ul><h3 id="connection-pooling" tabindex="-1"><a class="header-anchor" href="#connection-pooling"><span>Connection Pooling</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Prisma connection configuration</span></span>
<span class="line"><span class="token keyword">const</span> prisma <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrismaClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    datasources<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        db<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            url<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">DATABASE_URL</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    log<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;development&#39;</span></span>
<span class="line">        <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token string">&#39;query&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;info&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;warn&#39;</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;warn&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;error&#39;</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="scoring-performance" tabindex="-1"><a class="header-anchor" href="#scoring-performance"><span>Scoring Performance</span></a></h2><h3 id="optimized-scoring-algorithm" tabindex="-1"><a class="header-anchor" href="#optimized-scoring-algorithm"><span>Optimized Scoring Algorithm</span></a></h3><p>The scoring service implements performance-optimized calculations:</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Efficient scoring calculation</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">calculateAnswerScore</span><span class="token punctuation">(</span></span>
<span class="line">    question<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span></span>
<span class="line">    answer<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span></span>
<span class="line">    serverTimeSpent<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span></span>
<span class="line">    totalPresentationTime<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span></span>
<span class="line">    accessCode<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token punctuation">{</span> score<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> timePenalty<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Fast correctness check</span></span>
<span class="line">    <span class="token keyword">const</span> isCorrect <span class="token operator">=</span> <span class="token function">checkAnswerCorrectness</span><span class="token punctuation">(</span>question<span class="token punctuation">,</span> answer<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isCorrect<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> score<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> timePenalty<span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Optimized time penalty calculation</span></span>
<span class="line">    <span class="token keyword">const</span> timePenalty <span class="token operator">=</span> <span class="token function">calculateTimePenalty</span><span class="token punctuation">(</span>serverTimeSpent<span class="token punctuation">,</span> question<span class="token punctuation">.</span>timeLimit<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Base score calculation</span></span>
<span class="line">    <span class="token keyword">const</span> baseScore <span class="token operator">=</span> question<span class="token punctuation">.</span>points <span class="token operator">||</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> finalScore <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> baseScore <span class="token operator">-</span> timePenalty<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> <span class="token punctuation">{</span> score<span class="token operator">:</span> finalScore<span class="token punctuation">,</span> timePenalty <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Performance Features:</strong></p><ul><li><strong>Early Returns</strong>: Fast rejection of incorrect answers</li><li><strong>Cached Calculations</strong>: Time penalty pre-computation</li><li><strong>Memory Efficient</strong>: Minimal object creation</li><li><strong>Async Optimization</strong>: Non-blocking database operations</li></ul><h2 id="real-time-performance" tabindex="-1"><a class="header-anchor" href="#real-time-performance"><span>Real-time Performance</span></a></h2><h3 id="socket-io-optimization" tabindex="-1"><a class="header-anchor" href="#socket-io-optimization"><span>Socket.IO Optimization</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Optimized Socket.IO configuration</span></span>
<span class="line"><span class="token keyword">const</span> io <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SocketIOServer</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    cors<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        origin<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FRONTEND_URL</span><span class="token punctuation">,</span></span>
<span class="line">        methods<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;GET&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;POST&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        credentials<span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    path<span class="token operator">:</span> <span class="token string">&#39;/api/socket.io&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    transports<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;websocket&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;polling&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    pingTimeout<span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>    <span class="token comment">// 30 seconds</span></span>
<span class="line">    pingInterval<span class="token operator">:</span> <span class="token number">25000</span>    <span class="token comment">// 25 seconds</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Performance Optimizations:</strong></p><ul><li><strong>WebSocket Priority</strong>: Preferred transport for lower latency</li><li><strong>Connection Pooling</strong>: Efficient connection management</li><li><strong>Heartbeat Optimization</strong>: Balanced ping/pong intervals</li><li><strong>Room-based Isolation</strong>: Targeted message delivery</li></ul><h3 id="event-handling-optimization" tabindex="-1"><a class="header-anchor" href="#event-handling-optimization"><span>Event Handling Optimization</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Efficient event broadcasting</span></span>
<span class="line">io<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>gameRoom<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;leaderboardUpdate&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    leaderboard<span class="token operator">:</span> cachedLeaderboard<span class="token punctuation">,</span></span>
<span class="line">    timestamp<span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Targeted participant updates</span></span>
<span class="line">socket<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>participantId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;scoreUpdate&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    score<span class="token operator">:</span> newScore<span class="token punctuation">,</span></span>
<span class="line">    totalScore<span class="token operator">:</span> totalScore</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="build-performance" tabindex="-1"><a class="header-anchor" href="#build-performance"><span>Build Performance</span></a></h2><h3 id="memory-constrained-build-process" tabindex="-1"><a class="header-anchor" href="#memory-constrained-build-process"><span>Memory-Constrained Build Process</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Low-memory build configuration</span></span>
<span class="line"><span class="token assign-left variable">NODE_OPTIONS</span><span class="token operator">=</span><span class="token string">&quot;--max-old-space-size=1024 --max-semi-space-size=256&quot;</span> <span class="token function">npm</span> run build</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Parallel build optimization</span></span>
<span class="line"><span class="token function">npm</span> run build:backend <span class="token operator">&amp;</span> <span class="token function">npm</span> run build:frontend <span class="token operator">&amp;</span> <span class="token function">wait</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Build Optimizations:</strong></p><ul><li><strong>Memory Limits</strong>: Controlled memory usage during compilation</li><li><strong>Parallel Processing</strong>: Concurrent backend and frontend builds</li><li><strong>Dependency Optimization</strong>: Minimal bundle sizes</li><li><strong>Tree Shaking</strong>: Removal of unused code</li></ul><h2 id="monitoring-dashboard" tabindex="-1"><a class="header-anchor" href="#monitoring-dashboard"><span>Monitoring Dashboard</span></a></h2><h3 id="key-metrics-to-monitor" tabindex="-1"><a class="header-anchor" href="#key-metrics-to-monitor"><span>Key Metrics to Monitor</span></a></h3><p><strong>System Metrics:</strong></p><ul><li><strong>Memory Usage</strong>: Heap, external, and RSS monitoring</li><li><strong>CPU Usage</strong>: Process and system CPU consumption</li><li><strong>Disk I/O</strong>: Database and log file operations</li><li><strong>Network I/O</strong>: Socket connections and API requests</li></ul><p><strong>Application Metrics:</strong></p><ul><li><strong>Active Games</strong>: Current number of running games</li><li><strong>Connected Users</strong>: Real-time user connections</li><li><strong>Response Times</strong>: API endpoint performance</li><li><strong>Error Rates</strong>: Application error frequency</li></ul><p><strong>Database Metrics:</strong></p><ul><li><strong>Connection Pool</strong>: Active and idle connections</li><li><strong>Query Performance</strong>: Slow query identification</li><li><strong>Cache Hit Rates</strong>: Redis cache effectiveness</li><li><strong>Transaction Rates</strong>: Database operation frequency</li></ul><h3 id="alert-configuration" tabindex="-1"><a class="header-anchor" href="#alert-configuration"><span>Alert Configuration</span></a></h3><p><strong>Memory Alerts:</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// PM2 memory threshold alerts</span></span>
<span class="line"><span class="token literal-property property">max_memory_restart</span><span class="token operator">:</span> <span class="token string">&quot;400M&quot;</span>  <span class="token comment">// Restart at 400MB usage</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Performance Alerts:</strong></p><ul><li>Response time &gt; 2 seconds</li><li>Error rate &gt; 5%</li><li>Memory usage &gt; 80%</li><li>Database connection pool exhausted</li></ul><h2 id="performance-testing" tabindex="-1"><a class="header-anchor" href="#performance-testing"><span>Performance Testing</span></a></h2><h3 id="load-testing-strategy" tabindex="-1"><a class="header-anchor" href="#load-testing-strategy"><span>Load Testing Strategy</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Socket connection load test</span></span>
<span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;Socket.IO Performance&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should handle 1000 concurrent connections&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Load testing implementation</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&#39;should maintain &amp;lt;100ms response time under load&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Performance benchmarking</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Test Scenarios:</strong></p><ul><li><strong>Connection Scaling</strong>: Maximum concurrent users</li><li><strong>Message Broadcasting</strong>: High-frequency event handling</li><li><strong>Database Load</strong>: Concurrent read/write operations</li><li><strong>Memory Leak Detection</strong>: Long-running stability tests</li></ul><h2 id="optimization-checklist" tabindex="-1"><a class="header-anchor" href="#optimization-checklist"><span>Optimization Checklist</span></a></h2><h3 id="pre-deployment-performance-review" tabindex="-1"><a class="header-anchor" href="#pre-deployment-performance-review"><span>Pre-Deployment Performance Review</span></a></h3><ul><li>[ ] Memory limits configured for target environment</li><li>[ ] Redis caching enabled and optimized</li><li>[ ] Database connection pooling configured</li><li>[ ] Socket.IO adapter properly configured</li><li>[ ] PM2 monitoring and auto-restart enabled</li><li>[ ] Build process optimized for memory constraints</li><li>[ ] Logging configured for performance monitoring</li><li>[ ] Health check endpoints accessible</li></ul><h3 id="ongoing-performance-maintenance" tabindex="-1"><a class="header-anchor" href="#ongoing-performance-maintenance"><span>Ongoing Performance Maintenance</span></a></h3><ul><li>[ ] Regular memory usage monitoring</li><li>[ ] Database query performance analysis</li><li>[ ] Cache hit rate optimization</li><li>[ ] Socket connection monitoring</li><li>[ ] Build time optimization</li><li>[ ] Dependency updates for performance improvements</li><li>[ ] Load testing after significant changes</li></ul><h2 id="troubleshooting-performance-issues" tabindex="-1"><a class="header-anchor" href="#troubleshooting-performance-issues"><span>Troubleshooting Performance Issues</span></a></h2><h3 id="common-performance-problems" tabindex="-1"><a class="header-anchor" href="#common-performance-problems"><span>Common Performance Problems</span></a></h3><p><strong>Memory Issues:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Check memory usage</span></span>
<span class="line"><span class="token function">curl</span> http://localhost:3007/health/memory</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Monitor PM2 processes</span></span>
<span class="line">pm2 monit</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Database Performance:</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token comment">-- Identify slow queries</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> pg_stat_activity</span>
<span class="line"><span class="token keyword">WHERE</span> state <span class="token operator">=</span> <span class="token string">&#39;active&#39;</span> <span class="token operator">AND</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> query_start <span class="token operator">&gt;</span> <span class="token keyword">interval</span> <span class="token string">&#39;1 second&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Redis Performance:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Check Redis memory usage</span></span>
<span class="line">redis-cli info memory</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Monitor Redis operations</span></span>
<span class="line">redis-cli monitor</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Socket.IO Performance:</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Monitor connection counts</span></span>
<span class="line">io<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>clientsCount</span>
<span class="line"></span>
<span class="line"><span class="token comment">// Check room membership</span></span>
<span class="line">io<span class="token punctuation">.</span>sockets<span class="token punctuation">.</span>adapter<span class="token punctuation">.</span>rooms</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This performance documentation should be regularly updated as new optimizations are implemented and monitoring capabilities are enhanced.</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Dernière mise à jour: </span><time class="meta-item-info" datetime="2025-09-19T18:21:53.000Z" data-allow-mismatch>19/09/2025 20:21</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: alexis.flesch@gmail.com">alexisflesch</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/mathquest/details-techniques/security.html" aria-label="Security Documentation"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">Security Documentation</span></div><!--]--></a><a class="route-link auto-link next" href="/mathquest/details-techniques/troubleshooting.html" aria-label="Troubleshooting Guide"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">Troubleshooting Guide</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/mathquest/assets/app-DoDG4mLI.js" defer></script>
  </body>
</html>
