import{_ as a,c as s,a as i,o as n}from"./app-Blvv7Pu1.js";const o={};function t(l,e){return n(),s("div",null,e[0]||(e[0]=[i(`<h1 id="frontend-diagnostics-capture-for-live-sessions" tabindex="-1"><a class="header-anchor" href="#frontend-diagnostics-capture-for-live-sessions"><span>Frontend Diagnostics Capture for Live Sessions</span></a></h1><p>This page documents the opt-in diagnostics capture to help investigate intermittent crashes (e.g., STATUS_STACK_OVERFLOW) on the live game page.</p><h2 id="enable-diagnostics" tabindex="-1"><a class="header-anchor" href="#enable-diagnostics"><span>Enable diagnostics</span></a></h2><ul><li>Append <code>?mqdebug=1</code> to any Live page URL, for example: <ul><li><code>/live/1234?mqdebug=1</code></li></ul></li><li>Alternatively, set the flag persistently in the browser: <ul><li><code>localStorage.setItem(&#39;MQ_DEBUG_CAPTURE&#39;, &#39;1&#39;)</code></li></ul></li></ul><p>Enabling diagnostics will:</p><ul><li>Set client log level to DEBUG</li><li>Buffer all client logs into an in-memory ring buffer</li><li>Capture: <ul><li>window errors and unhandled promise rejections</li><li>visibility/page lifecycle events (pageshow/pagehide, focus/blur)</li><li>online/offline network changes</li><li>WebSocket open/error/close (code, reason, wasClean)</li></ul></li></ul><p>Nothing is sent over the network. Data remains local to your browser until you explicitly download it.</p><h2 id="download-logs" tabindex="-1"><a class="header-anchor" href="#download-logs"><span>Download logs</span></a></h2><ol><li>Reproduce the issue while diagnostics is enabled.</li><li>Open the browser DevTools console and run:</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">window<span class="token punctuation">.</span>__mqDiag <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>__mqDiag<span class="token punctuation">.</span>download <span class="token operator">&amp;&amp;</span> window<span class="token punctuation">.</span>__mqDiag<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This downloads a <code>mathquest-diag-&lt;timestamp&gt;.json</code> file containing structured events. If download fails, the buffer will be printed in the console.</p><h2 id="data-format" tabindex="-1"><a class="header-anchor" href="#data-format"><span>Data format</span></a></h2><p>The file is an array of JSON entries including:</p><ul><li>Logger entries: <code>{ ts, level, context, message, args }</code></li><li>Lifecycle entries: <code>{ ts, type: &#39;document.visibilitychange&#39;|&#39;window.pagehide&#39;|&#39;window.pageshow&#39;|&#39;window.focus&#39;|&#39;window.blur&#39;, data }</code></li><li>Network entries: <code>{ ts, type: &#39;window.online&#39;|&#39;window.offline&#39; }</code></li><li>WebSocket entries: <code>{ ts, type: &#39;ws.open&#39;|&#39;ws.error&#39;|&#39;ws.close&#39;, data: { url, code, reason, wasClean } }</code></li><li>Error entries: <code>{ ts, type: &#39;window.error&#39;|&#39;window.unhandledrejection&#39;, data: { message/stack/... } }</code></li></ul><p>Sample filter keys you can use when sharing:</p><ul><li><code>context === &#39;useStudentGameSocket&#39;</code></li><li><code>type.startsWith(&#39;ws.&#39;)</code></li><li><code>message</code> containing &#39;LATE-JOIN-RECOVERY&#39; or &#39;QUESTION UPDATE&#39;</li></ul><h2 id="scope-and-safety" tabindex="-1"><a class="header-anchor" href="#scope-and-safety"><span>Scope and safety</span></a></h2><ul><li>This is entirely client-side and opt-in.</li><li>No PII is collected beyond what is already present in logs (e.g., accessCode/userId in existing debug messages). Share logs prudently.</li><li>Disable by removing <code>?mqdebug=1</code> and running <code>localStorage.removeItem(&#39;MQ_DEBUG_CAPTURE&#39;)</code>.</li></ul><h2 id="change-log" tabindex="-1"><a class="header-anchor" href="#change-log"><span>Change log</span></a></h2><ul><li>2025-10-25: Added diagnostics capture (<code>src/diagnostics/initDiagnostics.ts</code>) and logger buffering (<code>src/clientLogger.ts</code>). Live page initializes diagnostics on demand.</li></ul>`,20)]))}const d=a(o,[["render",t]]),r=JSON.parse('{"path":"/dev/diagnostics.html","title":"Frontend Diagnostics Capture for Live Sessions","lang":"fr-FR","frontmatter":{},"git":{"updatedTime":1761379347000,"contributors":[{"name":"alexisflesch","username":"alexisflesch","email":"alexis.flesch@gmail.com","commits":1,"url":"https://github.com/alexisflesch"}],"changelog":[{"hash":"117b2c9dd034ecf4cd53d50cf39f4fa92195df52","time":1761379347000,"email":"alexis.flesch@gmail.com","author":"alexisflesch","message":"feat: Implement MathQuest Stability Plan and diagnostics capture"}]},"filePathRelative":"dev/diagnostics.md"}');export{d as comp,r as data};
