import{_ as n,c as a,a as e,o as i}from"./app-Blvv7Pu1.js";const l={};function p(t,s){return i(),a("div",null,s[0]||(s[0]=[e(`<h1 id="troubleshooting-guide" tabindex="-1"><a class="header-anchor" href="#troubleshooting-guide"><span>Troubleshooting Guide</span></a></h1><p>This guide covers common issues, debugging procedures, and solutions for MathQuest deployment and development.</p><h2 id="quick-diagnosis" tabindex="-1"><a class="header-anchor" href="#quick-diagnosis"><span>Quick Diagnosis</span></a></h2><h3 id="health-check-commands" tabindex="-1"><a class="header-anchor" href="#health-check-commands"><span>Health Check Commands</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Check all services status</span></span>
<span class="line">pm2 status</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check memory usage</span></span>
<span class="line"><span class="token function">curl</span> http://localhost:3007/health/memory</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check basic health</span></span>
<span class="line"><span class="token function">curl</span> http://localhost:3007/health</span>
<span class="line"></span>
<span class="line"><span class="token comment"># View recent logs</span></span>
<span class="line">pm2 logs <span class="token parameter variable">--lines</span> <span class="token number">50</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check Redis connection</span></span>
<span class="line">redis-cli <span class="token function">ping</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="common-symptoms-and-solutions" tabindex="-1"><a class="header-anchor" href="#common-symptoms-and-solutions"><span>Common Symptoms and Solutions</span></a></h3><h2 id="memory-issues" tabindex="-1"><a class="header-anchor" href="#memory-issues"><span>Memory Issues</span></a></h2><h3 id="symptom-application-crashes-with-javascript-heap-out-of-memory" tabindex="-1"><a class="header-anchor" href="#symptom-application-crashes-with-javascript-heap-out-of-memory"><span>Symptom: Application crashes with &quot;JavaScript heap out of memory&quot;</span></a></h3><p><strong>Solutions:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 1. Check current memory usage</span></span>
<span class="line"><span class="token function">curl</span> http://localhost:3007/health/memory</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. Restart with ultra-limited memory settings</span></span>
<span class="line"><span class="token builtin class-name">cd</span> backend <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run start:ultra-limited</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. Check PM2 memory limits</span></span>
<span class="line">pm2 show mathquest-backend</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. Rebuild with low-memory optimization</span></span>
<span class="line"><span class="token function">bash</span> build-vps.sh</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Prevention:</strong></p><ul><li>Use <code>build-vps.sh</code> for VPS deployment</li><li>Monitor memory with <code>/health/memory</code> endpoint</li><li>Set appropriate PM2 memory limits in <code>ecosystem.config.js</code></li></ul><h3 id="symptom-pm2-auto-restarts-due-to-memory-limits" tabindex="-1"><a class="header-anchor" href="#symptom-pm2-auto-restarts-due-to-memory-limits"><span>Symptom: PM2 auto-restarts due to memory limits</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Check restart history</span></span>
<span class="line">pm2 show mathquest-backend</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Adjust memory limits in ecosystem.config.js</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;max_memory_restart&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;500M&quot;</span>,  // Increase <span class="token keyword">if</span> needed</span>
<span class="line">    <span class="token string">&quot;max_memory_restart&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;300M&quot;</span>   // For frontend</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="database-connection-issues" tabindex="-1"><a class="header-anchor" href="#database-connection-issues"><span>Database Connection Issues</span></a></h2><h3 id="symptom-can-t-reach-database-server-or-connection-timeouts" tabindex="-1"><a class="header-anchor" href="#symptom-can-t-reach-database-server-or-connection-timeouts"><span>Symptom: &quot;Can&#39;t reach database server&quot; or connection timeouts</span></a></h3><p><strong>Diagnosis:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Check database connectivity</span></span>
<span class="line">psql <span class="token parameter variable">-h</span> localhost <span class="token parameter variable">-U</span> postgre <span class="token parameter variable">-d</span> mathquest <span class="token parameter variable">-c</span> <span class="token string">&quot;SELECT 1;&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check Prisma connection</span></span>
<span class="line"><span class="token builtin class-name">cd</span> backend <span class="token operator">&amp;&amp;</span> npx prisma db push --preview-feature</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Verify environment variables</span></span>
<span class="line"><span class="token function">cat</span> backend/.env <span class="token operator">|</span> <span class="token function">grep</span> DATABASE_URL</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Solutions:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 1. Restart PostgreSQL service</span></span>
<span class="line"><span class="token function">sudo</span> systemctl restart postgresql</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. Check database logs</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">tail</span> <span class="token parameter variable">-f</span> /var/log/postgresql/postgresql-*.log</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. Verify connection string</span></span>
<span class="line"><span class="token assign-left variable">DATABASE_URL</span><span class="token operator">=</span><span class="token string">&quot;postgresql://postgre:dev123@localhost:5432/mathquest&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. Reset database connection pool</span></span>
<span class="line">pm2 restart mathquest-backend</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="symptom-prisma-migration-errors" tabindex="-1"><a class="header-anchor" href="#symptom-prisma-migration-errors"><span>Symptom: Prisma migration errors</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Check migration status</span></span>
<span class="line"><span class="token builtin class-name">cd</span> backend <span class="token operator">&amp;&amp;</span> npx prisma migrate status</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Apply pending migrations</span></span>
<span class="line">npx prisma migrate deploy</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Reset database (development only)</span></span>
<span class="line">npx prisma migrate reset <span class="token parameter variable">--force</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="redis-connection-issues" tabindex="-1"><a class="header-anchor" href="#redis-connection-issues"><span>Redis Connection Issues</span></a></h2><h3 id="symptom-redis-connection-failed-or-caching-not-working" tabindex="-1"><a class="header-anchor" href="#symptom-redis-connection-failed-or-caching-not-working"><span>Symptom: &quot;Redis connection failed&quot; or caching not working</span></a></h3><p><strong>Diagnosis:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Check Redis service</span></span>
<span class="line">redis-cli <span class="token function">ping</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check Redis memory usage</span></span>
<span class="line">redis-cli info memory</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Verify Redis URL in environment</span></span>
<span class="line"><span class="token function">cat</span> backend/.env <span class="token operator">|</span> <span class="token function">grep</span> REDIS_URL</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Solutions:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 1. Start Redis service</span></span>
<span class="line"><span class="token function">sudo</span> systemctl start redis-server</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. Check Redis configuration</span></span>
<span class="line">redis-cli config get maxmemory</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. Clear Redis cache (if needed)</span></span>
<span class="line">redis-cli FLUSHALL</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. Restart application</span></span>
<span class="line">pm2 restart mathquest-backend</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="socket-io-connection-issues" tabindex="-1"><a class="header-anchor" href="#socket-io-connection-issues"><span>Socket.IO Connection Issues</span></a></h2><h3 id="symptom-real-time-features-not-working-timers-live-updates" tabindex="-1"><a class="header-anchor" href="#symptom-real-time-features-not-working-timers-live-updates"><span>Symptom: Real-time features not working (timers, live updates)</span></a></h3><p><strong>Diagnosis:</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Check Socket.IO connection in browser console</span></span>
<span class="line"><span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token function">io</span><span class="token punctuation">(</span><span class="token string">&#39;http://localhost:3007&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;connect&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Connected&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;connect_error&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Connection error:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Solutions:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 1. Check Socket.IO server logs</span></span>
<span class="line">pm2 logs mathquest-backend <span class="token operator">|</span> <span class="token function">grep</span> socket</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. Verify CORS configuration</span></span>
<span class="line"><span class="token function">curl</span> <span class="token parameter variable">-H</span> <span class="token string">&quot;Origin: http://localhost:3008&quot;</span> http://localhost:3007/api/socket.io/</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. Check Redis adapter (if using multiple servers)</span></span>
<span class="line">redis-cli keys <span class="token string">&quot;socket.io*&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. Restart Socket.IO server</span></span>
<span class="line">pm2 restart mathquest-backend</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="symptom-websocket-connections-failing-in-production" tabindex="-1"><a class="header-anchor" href="#symptom-websocket-connections-failing-in-production"><span>Symptom: WebSocket connections failing in production</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># Nginx configuration for WebSocket proxy</span></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> /api/socket.io/</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://127.0.0.1:3007/api/socket.io/</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;upgrade&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="authentication-issues" tabindex="-1"><a class="header-anchor" href="#authentication-issues"><span>Authentication Issues</span></a></h2><h3 id="symptom-users-can-t-log-in-or-jwt-tokens-are-invalid" tabindex="-1"><a class="header-anchor" href="#symptom-users-can-t-log-in-or-jwt-tokens-are-invalid"><span>Symptom: Users can&#39;t log in or JWT tokens are invalid</span></a></h3><p><strong>Diagnosis:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Check JWT secret configuration</span></span>
<span class="line"><span class="token function">cat</span> backend/.env <span class="token operator">|</span> <span class="token function">grep</span> JWT_SECRET</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Verify token format in browser dev tools</span></span>
<span class="line"><span class="token comment"># Application &gt; Local Storage &gt; auth_token</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Solutions:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 1. Generate new JWT secret</span></span>
<span class="line"><span class="token function">node</span> <span class="token parameter variable">-e</span> <span class="token string">&quot;console.log(require(&#39;crypto&#39;).randomBytes(64).toString(&#39;hex&#39;))&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. Update environment file</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;JWT_SECRET=your-new-secret-here&quot;</span> <span class="token operator">&gt;&gt;</span> backend/.env</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. Clear browser cookies and local storage</span></span>
<span class="line"><span class="token comment"># Browser Dev Tools &gt; Application &gt; Clear storage</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. Restart backend</span></span>
<span class="line">pm2 restart mathquest-backend</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="symptom-password-reset-emails-not-sending" tabindex="-1"><a class="header-anchor" href="#symptom-password-reset-emails-not-sending"><span>Symptom: Password reset emails not sending</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Check Brevo API configuration</span></span>
<span class="line"><span class="token function">cat</span> backend/.env <span class="token operator">|</span> <span class="token function">grep</span> BREVO</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Test email service</span></span>
<span class="line"><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST https://api.brevo.com/v3/smtp/email <span class="token punctuation">\\</span></span>
<span class="line">  <span class="token parameter variable">-H</span> <span class="token string">&quot;api-key: YOUR_API_KEY&quot;</span> <span class="token punctuation">\\</span></span>
<span class="line">  <span class="token parameter variable">-H</span> <span class="token string">&quot;Content-Type: application/json&quot;</span> <span class="token punctuation">\\</span></span>
<span class="line">  <span class="token parameter variable">-d</span> <span class="token string">&#39;{&quot;to&quot;:[{&quot;email&quot;:&quot;test@example.com&quot;}],&quot;templateId&quot;:1}&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="build-and-deployment-issues" tabindex="-1"><a class="header-anchor" href="#build-and-deployment-issues"><span>Build and Deployment Issues</span></a></h2><h3 id="symptom-build-fails-with-memory-errors" tabindex="-1"><a class="header-anchor" href="#symptom-build-fails-with-memory-errors"><span>Symptom: Build fails with memory errors</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Use low-memory build mode</span></span>
<span class="line"><span class="token function">bash</span> build-all.sh --low-memory</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Or set memory limits manually</span></span>
<span class="line"><span class="token assign-left variable">NODE_OPTIONS</span><span class="token operator">=</span><span class="token string">&quot;--max-old-space-size=1024&quot;</span> <span class="token function">npm</span> run build</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="symptom-frontend-build-hangs-or-fails" tabindex="-1"><a class="header-anchor" href="#symptom-frontend-build-hangs-or-fails"><span>Symptom: Frontend build hangs or fails</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Clear Next.js cache</span></span>
<span class="line"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> frontend/.next</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check Node.js version compatibility</span></span>
<span class="line"><span class="token function">node</span> <span class="token parameter variable">--version</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Rebuild with verbose logging</span></span>
<span class="line"><span class="token builtin class-name">cd</span> frontend <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run build <span class="token parameter variable">--verbose</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="symptom-pm2-fails-to-start-services" tabindex="-1"><a class="header-anchor" href="#symptom-pm2-fails-to-start-services"><span>Symptom: PM2 fails to start services</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Check PM2 logs</span></span>
<span class="line">pm2 logs</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Delete and recreate PM2 processes</span></span>
<span class="line">pm2 delete all</span>
<span class="line">pm2 start ecosystem.config.js</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check file permissions</span></span>
<span class="line"><span class="token function">ls</span> <span class="token parameter variable">-la</span> start-all.sh</span>
<span class="line"><span class="token function">chmod</span> +x start-all.sh</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pwa-and-service-worker-issues" tabindex="-1"><a class="header-anchor" href="#pwa-and-service-worker-issues"><span>PWA and Service Worker Issues</span></a></h2><h3 id="symptom-service-worker-javascript-errors-ref-is-not-defined" tabindex="-1"><a class="header-anchor" href="#symptom-service-worker-javascript-errors-ref-is-not-defined"><span>Symptom: Service worker JavaScript errors (<code>_ref is not defined</code>)</span></a></h3><p><strong>Cause:</strong> Bug in <code>@ducanh2912/next-pwa</code> library causing serialization issues with async cache plugins.</p><p><strong>Symptoms:</strong></p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Browser console error</span></span>
<span class="line">sw<span class="token operator">-</span>v3<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">1</span> <span class="token function">Uncaught</span> <span class="token punctuation">(</span><span class="token keyword">in</span> promise<span class="token punctuation">)</span> ReferenceError<span class="token operator">:</span> _ref is not defined</span>
<span class="line">    at Object<span class="token punctuation">.</span><span class="token function">cacheWillUpdate</span> <span class="token punctuation">(</span>sw<span class="token operator">-</span>v3<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">12607</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Solutions:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 1. Update service worker configuration in next.config.ts</span></span>
<span class="line"><span class="token comment"># Change NetworkFirst to StaleWhileRevalidate without plugins</span></span>
<span class="line">runtimeCaching: <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        urlPattern: <span class="token string">&#39;/&#39;</span>,</span>
<span class="line">        handler: <span class="token string">&#39;StaleWhileRevalidate&#39;</span>,</span>
<span class="line">        options: <span class="token punctuation">{</span></span>
<span class="line">            cacheName: <span class="token string">&#39;start-url&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span>,</span>
<span class="line">    <span class="token punctuation">}</span>,</span>
<span class="line"><span class="token punctuation">]</span>,</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. Rebuild the frontend (postbuild script will automatically fix SW)</span></span>
<span class="line"><span class="token builtin class-name">cd</span> frontend <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run build</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. Hard refresh browser or update service worker</span></span>
<span class="line"><span class="token comment"># In DevTools: Application → Service Workers → Update/Unregister</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Note:</strong> A postbuild script automatically removes any broken registerRoute from the generated service worker. This ensures the fix is applied consistently after each build. The bug can be reproduced using <code>node scripts/test-ref-bug.js</code> on an unfixed service worker.</p><h3 id="update-2025-10-01-middleware-allowlist-for-service-worker-assets" tabindex="-1"><a class="header-anchor" href="#update-2025-10-01-middleware-allowlist-for-service-worker-assets"><span>Update 2025-10-01: Middleware allowlist for service worker assets</span></a></h3><ul><li><strong>Motivation:</strong> Anonymous users attempting to load <code>/sw.js</code> were intercepted by the authentication middleware and redirected to <code>/login</code>, preventing the PWA from registering.</li><li><strong>Fix:</strong> Updated <code>src/middleware.ts</code> to explicitly allow service worker bundles (<code>/sw.js</code>, <code>workbox-*</code>, <code>fallback-*</code>) and refined the middleware matcher to exclude these assets from execution.</li><li><strong>Regression tests:</strong> Added <code>should allow service worker requests without redirect</code> scenario in <code>tests/unit/middleware-auth-redirects.test.ts</code> to guard the new allowlist.</li><li><strong>Validation:</strong> <code>npm run test -- middleware-auth-redirects</code> and <code>npm run type-check</code> both pass after the change.</li></ul><h2 id="performance-issues" tabindex="-1"><a class="header-anchor" href="#performance-issues"><span>Performance Issues</span></a></h2><h3 id="symptom-application-is-slow-or-unresponsive" tabindex="-1"><a class="header-anchor" href="#symptom-application-is-slow-or-unresponsive"><span>Symptom: Application is slow or unresponsive</span></a></h3><p><strong>Diagnosis:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Check memory usage</span></span>
<span class="line"><span class="token function">curl</span> http://localhost:3007/health/memory</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Monitor PM2 processes</span></span>
<span class="line">pm2 monit</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check database query performance</span></span>
<span class="line"><span class="token comment"># Enable query logging in development</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Solutions:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 1. Restart services</span></span>
<span class="line">pm2 restart all</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. Clear caches</span></span>
<span class="line">redis-cli FLUSHALL</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. Check database connections</span></span>
<span class="line">psql <span class="token parameter variable">-h</span> localhost <span class="token parameter variable">-U</span> postgre <span class="token parameter variable">-d</span> mathquest <span class="token parameter variable">-c</span> <span class="token string">&quot;SELECT count(*) FROM pg_stat_activity;&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. Optimize memory usage</span></span>
<span class="line"><span class="token function">bash</span> build-vps.sh <span class="token operator">&amp;&amp;</span> <span class="token function">bash</span> start-all.sh</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="symptom-high-cpu-usage" tabindex="-1"><a class="header-anchor" href="#symptom-high-cpu-usage"><span>Symptom: High CPU usage</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Check process CPU usage</span></span>
<span class="line">pm2 monit</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Profile Node.js application</span></span>
<span class="line"><span class="token builtin class-name">cd</span> backend <span class="token operator">&amp;&amp;</span> <span class="token function">npm</span> run monitor:memory</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check for infinite loops in logs</span></span>
<span class="line">pm2 logs <span class="token parameter variable">--lines</span> <span class="token number">100</span> <span class="token operator">|</span> <span class="token function">grep</span> error</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="network-and-cors-issues" tabindex="-1"><a class="header-anchor" href="#network-and-cors-issues"><span>Network and CORS Issues</span></a></h2><h3 id="symptom-cors-errors-in-browser-console" tabindex="-1"><a class="header-anchor" href="#symptom-cors-errors-in-browser-console"><span>Symptom: CORS errors in browser console</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Error: Access to XMLHttpRequest has been blocked by CORS policy</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>Solutions:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 1. Check CORS configuration in server.ts</span></span>
<span class="line"><span class="token function">grep</span> <span class="token parameter variable">-n</span> <span class="token string">&quot;cors&quot;</span> backend/src/server.ts</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. Verify frontend URL in environment</span></span>
<span class="line"><span class="token function">cat</span> backend/.env <span class="token operator">|</span> <span class="token function">grep</span> FRONTEND_URL</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. Update CORS origins for production</span></span>
<span class="line">const corsOptions <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    origin: process.env.NODE_ENV <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">&#39;production&#39;</span></span>
<span class="line">        ? process.env.FRONTEND_URL</span>
<span class="line">        <span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&#39;http://localhost:3000&#39;</span>, <span class="token string">&#39;http://localhost:3008&#39;</span><span class="token punctuation">]</span>,</span>
<span class="line">    credentials: <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="symptom-nginx-proxy-errors" tabindex="-1"><a class="header-anchor" href="#symptom-nginx-proxy-errors"><span>Symptom: Nginx proxy errors</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># Check Nginx configuration</span></span>
<span class="line">sudo nginx -t</span>
<span class="line"></span>
<span class="line"><span class="token comment"># View Nginx error logs</span></span>
<span class="line">sudo tail -f /var/log/nginx/error.log</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Test proxy configuration</span></span>
<span class="line">curl -H &quot;Host: yourdomain.com&quot; http://127.0.0.1/api/v1/health</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="development-environment-issues" tabindex="-1"><a class="header-anchor" href="#development-environment-issues"><span>Development Environment Issues</span></a></h2><h3 id="symptom-hot-reload-not-working" tabindex="-1"><a class="header-anchor" href="#symptom-hot-reload-not-working"><span>Symptom: Hot reload not working</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Check file watching limits</span></span>
<span class="line"><span class="token function">cat</span> /proc/sys/fs/inotify/max_user_watches</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Increase watch limits if needed</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token assign-left variable">fs.inotify.max_user_watches</span><span class="token operator">=</span><span class="token number">524288</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> <span class="token parameter variable">-a</span> /etc/sysctl.conf</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">sysctl</span> <span class="token parameter variable">-p</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="symptom-typescript-compilation-errors" tabindex="-1"><a class="header-anchor" href="#symptom-typescript-compilation-errors"><span>Symptom: TypeScript compilation errors</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Clear TypeScript cache</span></span>
<span class="line"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> backend/dist frontend/.next</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check TypeScript configuration</span></span>
<span class="line"><span class="token builtin class-name">cd</span> backend <span class="token operator">&amp;&amp;</span> npx tsc <span class="token parameter variable">--noEmit</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Reinstall dependencies</span></span>
<span class="line"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> node_modules package-lock.json</span>
<span class="line"><span class="token function">npm</span> <span class="token function">install</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="database-migration-issues" tabindex="-1"><a class="header-anchor" href="#database-migration-issues"><span>Database Migration Issues</span></a></h2><h3 id="symptom-prisma-schema-changes-not-applied" tabindex="-1"><a class="header-anchor" href="#symptom-prisma-schema-changes-not-applied"><span>Symptom: Prisma schema changes not applied</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Check migration status</span></span>
<span class="line"><span class="token builtin class-name">cd</span> backend <span class="token operator">&amp;&amp;</span> npx prisma migrate status</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Generate Prisma client</span></span>
<span class="line">npx prisma generate</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Apply migrations</span></span>
<span class="line">npx prisma migrate deploy</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Reset database (development only)</span></span>
<span class="line">npx prisma migrate reset</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="symptom-database-schema-drift" tabindex="-1"><a class="header-anchor" href="#symptom-database-schema-drift"><span>Symptom: Database schema drift</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Check for schema differences</span></span>
<span class="line"><span class="token builtin class-name">cd</span> backend <span class="token operator">&amp;&amp;</span> npx prisma db push --preview-feature</span>
<span class="line"></span>
<span class="line"><span class="token comment"># View current schema</span></span>
<span class="line">npx prisma db pull</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Reset and reapply schema</span></span>
<span class="line">npx prisma migrate reset <span class="token parameter variable">--force</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="logging-and-debugging" tabindex="-1"><a class="header-anchor" href="#logging-and-debugging"><span>Logging and Debugging</span></a></h2><h3 id="enable-debug-logging" tabindex="-1"><a class="header-anchor" href="#enable-debug-logging"><span>Enable Debug Logging</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Set log level to debug</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;LOG_LEVEL=debug&quot;</span> <span class="token operator">&gt;&gt;</span> backend/.env</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Restart services</span></span>
<span class="line">pm2 restart mathquest-backend</span>
<span class="line"></span>
<span class="line"><span class="token comment"># View debug logs</span></span>
<span class="line">pm2 logs mathquest-backend <span class="token parameter variable">--lines</span> <span class="token number">100</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="browser-debugging" tabindex="-1"><a class="header-anchor" href="#browser-debugging"><span>Browser Debugging</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Enable Socket.IO debug logging</span></span>
<span class="line">localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">&#39;debug&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;socket.io-client:*&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Monitor network requests</span></span>
<span class="line"><span class="token comment">// Browser Dev Tools &gt; Network &gt; Filter by WS (WebSocket)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Check console for errors</span></span>
<span class="line"><span class="token comment">// Browser Dev Tools &gt; Console</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="database-debugging" tabindex="-1"><a class="header-anchor" href="#database-debugging"><span>Database Debugging</span></a></h3><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token comment">-- Check active connections</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> pg_stat_activity<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- View slow queries</span></span>
<span class="line"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> pg_stat_statements</span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> total_time <span class="token keyword">DESC</span></span>
<span class="line"><span class="token keyword">LIMIT</span> <span class="token number">10</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- Check table sizes</span></span>
<span class="line"><span class="token keyword">SELECT</span> schemaname<span class="token punctuation">,</span> tablename<span class="token punctuation">,</span></span>
<span class="line">       pg_size_pretty<span class="token punctuation">(</span>pg_total_relation_size<span class="token punctuation">(</span>schemaname<span class="token operator">||</span><span class="token string">&#39;.&#39;</span><span class="token operator">||</span>tablename<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">FROM</span> pg_tables</span>
<span class="line"><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> pg_total_relation_size<span class="token punctuation">(</span>schemaname<span class="token operator">||</span><span class="token string">&#39;.&#39;</span><span class="token operator">||</span>tablename<span class="token punctuation">)</span> <span class="token keyword">DESC</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="emergency-recovery" tabindex="-1"><a class="header-anchor" href="#emergency-recovery"><span>Emergency Recovery</span></a></h2><h3 id="complete-system-reset" tabindex="-1"><a class="header-anchor" href="#complete-system-reset"><span>Complete System Reset</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Stop all services</span></span>
<span class="line">pm2 stop all</span>
<span class="line">pm2 delete all</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Clear caches</span></span>
<span class="line">redis-cli FLUSHALL</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Reset database (CAUTION: destroys data)</span></span>
<span class="line"><span class="token builtin class-name">cd</span> backend <span class="token operator">&amp;&amp;</span> npx prisma migrate reset <span class="token parameter variable">--force</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Rebuild application</span></span>
<span class="line"><span class="token function">bash</span> build-vps.sh</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Restart services</span></span>
<span class="line"><span class="token function">bash</span> start-all.sh</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="data-recovery" tabindex="-1"><a class="header-anchor" href="#data-recovery"><span>Data Recovery</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Create database backup</span></span>
<span class="line">pg_dump <span class="token parameter variable">-U</span> postgre <span class="token parameter variable">-h</span> localhost mathquest <span class="token operator">&gt;</span> backup.sql</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Restore from backup</span></span>
<span class="line">psql <span class="token parameter variable">-U</span> postgre <span class="token parameter variable">-h</span> localhost mathquest <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span> backup.sql</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="getting-help" tabindex="-1"><a class="header-anchor" href="#getting-help"><span>Getting Help</span></a></h2><h3 id="diagnostic-information-to-collect" tabindex="-1"><a class="header-anchor" href="#diagnostic-information-to-collect"><span>Diagnostic Information to Collect</span></a></h3><p>When reporting issues, please include:</p><ol><li><p><strong>System Information:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">uname</span> <span class="token parameter variable">-a</span></span>
<span class="line"><span class="token function">node</span> <span class="token parameter variable">--version</span></span>
<span class="line"><span class="token function">npm</span> <span class="token parameter variable">--version</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Service Status:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">pm2 status</span>
<span class="line">pm2 logs <span class="token parameter variable">--lines</span> <span class="token number">20</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Memory and Performance:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">curl</span> http://localhost:3007/health/memory</span>
<span class="line"><span class="token function">free</span> <span class="token parameter variable">-h</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Configuration:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">cat</span> backend/.env <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> PASSWORD</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>Error Logs:</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">pm2 logs mathquest-backend <span class="token parameter variable">--err</span> <span class="token parameter variable">--lines</span> <span class="token number">50</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><h3 id="support-resources" tabindex="-1"><a class="header-anchor" href="#support-resources"><span>Support Resources</span></a></h3><ul><li><strong>GitHub Issues</strong>: Report bugs and request features</li><li><strong>Documentation</strong>: Check VuePress docs for detailed guides</li><li><strong>Community</strong>: Join discussions for common solutions</li><li><strong>Logs</strong>: Always include relevant log output with issues</li></ul><h2 id="prevention-best-practices" tabindex="-1"><a class="header-anchor" href="#prevention-best-practices"><span>Prevention Best Practices</span></a></h2><h3 id="regular-maintenance" tabindex="-1"><a class="header-anchor" href="#regular-maintenance"><span>Regular Maintenance</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Weekly maintenance script</span></span>
<span class="line"><span class="token comment">#!/bin/bash</span></span>
<span class="line"><span class="token comment"># Clear old logs</span></span>
<span class="line">pm2 flush</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Check disk space</span></span>
<span class="line"><span class="token function">df</span> <span class="token parameter variable">-h</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Verify service health</span></span>
<span class="line"><span class="token function">curl</span> http://localhost:3007/health</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Update dependencies</span></span>
<span class="line"><span class="token function">npm</span> audit fix</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="monitoring-setup" tabindex="-1"><a class="header-anchor" href="#monitoring-setup"><span>Monitoring Setup</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Install monitoring tools</span></span>
<span class="line"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> pm2-logrotate</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Configure log rotation</span></span>
<span class="line">pm2 <span class="token function">install</span> pm2-logrotate</span>
<span class="line">pm2 <span class="token builtin class-name">set</span> pm2-logrotate:max_size 10M</span>
<span class="line">pm2 <span class="token builtin class-name">set</span> pm2-logrotate:retain <span class="token number">7</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="backup-strategy" tabindex="-1"><a class="header-anchor" href="#backup-strategy"><span>Backup Strategy</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Daily backup script</span></span>
<span class="line"><span class="token comment">#!/bin/bash</span></span>
<span class="line"><span class="token assign-left variable">DATE</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y%m%d<span class="token variable">)</span></span></span>
<span class="line">pg_dump <span class="token parameter variable">-U</span> postgre mathquest <span class="token operator">&gt;</span> <span class="token string">&quot;backup_<span class="token variable">$DATE</span>.sql&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Keep last 7 days</span></span>
<span class="line"><span class="token function">ls</span> backup_*.sql <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token parameter variable">-7</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This troubleshooting guide should be updated as new issues are discovered and resolved.</p>`,112)]))}const r=n(l,[["render",p]]),o=JSON.parse('{"path":"/details-techniques/troubleshooting.html","title":"Troubleshooting Guide","lang":"fr-FR","frontmatter":{"title":"Troubleshooting Guide","description":"Common issues, debugging procedures, and solutions for MathQuest deployment and development"},"git":{"updatedTime":1759305012000,"contributors":[{"name":"alexisflesch","username":"alexisflesch","email":"alexis.flesch@gmail.com","commits":4,"url":"https://github.com/alexisflesch"}],"changelog":[{"hash":"4bc1083d98d397744f39bac111bd4915194ddd62","time":1759305012000,"email":"alexis.flesch@gmail.com","author":"alexisflesch","message":"The app is now a PWA (again) \\\\o/. Fixed bug in nextjs pwa (_ref issue)"},{"hash":"a437090bff3d3972b2efa32e1bd3f21217a4fde4","time":1758519400000,"email":"alexis.flesch@gmail.com","author":"alexisflesch","message":"sw fix again"},{"hash":"ae9a15a776e52f16050f3ed102efa019223bc059","time":1758306113000,"email":"alexis.flesch@gmail.com","author":"alexisflesch","message":"cleaning up \\"class\\" mode which was legacy"},{"hash":"8fbb71211cc25ed6748dfb46362eb2796047c9da","time":1758286875000,"email":"alexis.flesch@gmail.com","author":"alexisflesch","message":"updating doc"}]},"filePathRelative":"details-techniques/troubleshooting.md"}');export{r as comp,o as data};
