import{_ as n,c as a,a as e,o as t}from"./app-Blvv7Pu1.js";const p={};function i(o,s){return t(),a("div",null,s[0]||(s[0]=[e(`<h1 id="services-backend" tabindex="-1"><a class="header-anchor" href="#services-backend"><span>Services backend</span></a></h1><h2 id="vue-d-ensemble-des-services" tabindex="-1"><a class="header-anchor" href="#vue-d-ensemble-des-services"><span>Vue d&#39;ensemble des services</span></a></h2><p>Le backend de MathQuest est organisé autour de plusieurs services métier qui gèrent les différentes fonctionnalités de l&#39;application. L&#39;architecture suit le principe de responsabilité unique avec une séparation claire entre les couches.</p><h2 id="architecture-des-services" tabindex="-1"><a class="header-anchor" href="#architecture-des-services"><span>Architecture des services</span></a></h2><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">backend/src/core/services/</span>
<span class="line">├── scoringService.ts          # Calcul des scores et pénalités</span>
<span class="line">├── canonicalTimerService.ts   # Gestion centralisée des timers</span>
<span class="line">├── gameStateService.ts        # État des parties (Redis)</span>
<span class="line">├── gameParticipantService.ts  # Gestion des participants</span>
<span class="line">├── timerKeyUtil.ts           # Utilitaires pour les clés Redis</span>
<span class="line">└── ...</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="gestion-des-evenements-quiz" tabindex="-1"><a class="header-anchor" href="#gestion-des-evenements-quiz"><span>Gestion des événements quiz</span></a></h2><h3 id="flux-d-un-evenement-quiz-typique" tabindex="-1"><a class="header-anchor" href="#flux-d-un-evenement-quiz-typique"><span>Flux d&#39;un événement quiz typique</span></a></h3><ol><li><strong>Réception de la réponse</strong> (<code>GAME_ANSWER</code>)</li><li><strong>Validation de la payload</strong></li><li><strong>Résolution du contexte</strong> (gameInstance, participant, question)</li><li><strong>Calcul du score</strong> via <code>ScoringService</code></li><li><strong>Mise à jour de la base de données</strong></li><li><strong>Diffusion des mises à jour</strong> via Socket.IO</li></ol><h3 id="gestionnaire-principal-game-index-ts" tabindex="-1"><a class="header-anchor" href="#gestionnaire-principal-game-index-ts"><span>Gestionnaire principal (<code>game/index.ts</code>)</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Extrait du gestionnaire GAME_ANSWER</span></span>
<span class="line">socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token constant">GAME_EVENTS</span><span class="token punctuation">.</span><span class="token constant">GAME_ANSWER</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// 1. Validation du payload avec Zod</span></span>
<span class="line">  <span class="token keyword">const</span> parseResult <span class="token operator">=</span> AnswerSubmissionPayloadSchema<span class="token punctuation">.</span><span class="token function">safeParse</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 2. Résolution du contexte</span></span>
<span class="line">  <span class="token keyword">const</span> gameInstance <span class="token operator">=</span> <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>gameInstance<span class="token punctuation">.</span><span class="token function">findUnique</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    where<span class="token operator">:</span> <span class="token punctuation">{</span> accessCode<span class="token operator">:</span> payload<span class="token punctuation">.</span>accessCode <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 3. Récupération du participant</span></span>
<span class="line">  <span class="token keyword">const</span> participant <span class="token operator">=</span> <span class="token keyword">await</span> prisma<span class="token punctuation">.</span>gameParticipant<span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    where<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      gameInstanceId<span class="token operator">:</span> gameInstance<span class="token punctuation">.</span>id<span class="token punctuation">,</span></span>
<span class="line">      userId<span class="token operator">:</span> payload<span class="token punctuation">.</span>userId</span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 4. Calcul du score</span></span>
<span class="line">  <span class="token keyword">const</span> scoreResult <span class="token operator">=</span> <span class="token keyword">await</span> ScoringService<span class="token punctuation">.</span><span class="token function">submitAnswerWithScoring</span><span class="token punctuation">(</span></span>
<span class="line">    gameInstance<span class="token punctuation">.</span>id<span class="token punctuation">,</span></span>
<span class="line">    payload<span class="token punctuation">.</span>userId<span class="token punctuation">,</span></span>
<span class="line">    answerData</span>
<span class="line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token comment">// 5. Diffusion des résultats</span></span>
<span class="line">  io<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>accessCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token constant">GAME_EVENTS</span><span class="token punctuation">.</span><span class="token constant">LEADERBOARD_UPDATE</span><span class="token punctuation">,</span> leaderboard<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="service-de-scoring-scoringservice" tabindex="-1"><a class="header-anchor" href="#service-de-scoring-scoringservice"><span>Service de scoring (<code>ScoringService</code>)</span></a></h2><h3 id="interface-principale" tabindex="-1"><a class="header-anchor" href="#interface-principale"><span>Interface principale</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">interface</span> <span class="token class-name">ScoreResult</span> <span class="token punctuation">{</span></span>
<span class="line">  scoreUpdated<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span></span>
<span class="line">  scoreAdded<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span></span>
<span class="line">  totalScore<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span></span>
<span class="line">  answerChanged<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span></span>
<span class="line">  previousAnswer<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span></span>
<span class="line">  message<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span></span>
<span class="line">  timePenalty<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">ScoringService</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">submitAnswerWithScoring</span><span class="token punctuation">(</span></span>
<span class="line">    gameInstanceId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line">    userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span></span>
<span class="line">    answerData<span class="token operator">:</span> AnswerSubmissionPayload</span>
<span class="line">  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>ScoreResult<span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Logique complète de scoring</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">calculateAnswerScore</span><span class="token punctuation">(</span></span>
<span class="line">    question<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span></span>
<span class="line">    answer<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span></span>
<span class="line">    serverTimeSpent<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span></span>
<span class="line">    totalPresentationTime<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span></span>
<span class="line">    accessCode<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span></span>
<span class="line">  <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token punctuation">{</span> score<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> timePenalty<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Calcul détaillé du score</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="fonctionnement-interne" tabindex="-1"><a class="header-anchor" href="#fonctionnement-interne"><span>Fonctionnement interne</span></a></h3><ol><li><strong>Validation de l&#39;intégrité</strong> : Vérification que la réponse n&#39;a pas été modifiée</li><li><strong>Calcul de la correction</strong> : Selon le type de question (QCM/numérique)</li><li><strong>Application des pénalités</strong> : Temporelles et selon les redémarrages</li><li><strong>Mise à jour atomique</strong> : Score en base + cache Redis</li></ol><h2 id="service-des-timers-canonicaltimerservice" tabindex="-1"><a class="header-anchor" href="#service-des-timers-canonicaltimerservice"><span>Service des timers (<code>CanonicalTimerService</code>)</span></a></h2><h3 id="role-central" tabindex="-1"><a class="header-anchor" href="#role-central"><span>Rôle central</span></a></h3><p>Le <code>CanonicalTimerService</code> gère tous les aspects temporels :</p><ul><li><strong>Démarrage des timers</strong> pour chaque question</li><li><strong>Suivi du temps serveur</strong> vs temps client</li><li><strong>Gestion des redémarrages</strong> de timer</li><li><strong>Calcul des pénalités</strong> basées sur le temps</li></ul><h3 id="structure-des-donnees-redis" tabindex="-1"><a class="header-anchor" href="#structure-des-donnees-redis"><span>Structure des données Redis</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Clé : mathquest:timer:{accessCode}:{questionUid}</span></span>
<span class="line"><span class="token comment">// Valeur :</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;durationMs&quot;</span><span class="token operator">:</span> <span class="token number">60000</span><span class="token punctuation">,</span>           <span class="token comment">// Durée totale en ms</span></span>
<span class="line">  <span class="token string-property property">&quot;startTime&quot;</span><span class="token operator">:</span> <span class="token number">1640000000000</span><span class="token punctuation">,</span>    <span class="token comment">// Timestamp de démarrage</span></span>
<span class="line">  <span class="token string-property property">&quot;restartCount&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>             <span class="token comment">// Nombre de redémarrages</span></span>
<span class="line">  <span class="token string-property property">&quot;lastRestartTime&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>       <span class="token comment">// Dernier redémarrage</span></span>
<span class="line">  <span class="token string-property property">&quot;totalPausedTime&quot;</span><span class="token operator">:</span> <span class="token number">0</span>           <span class="token comment">// Temps total en pause</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="methodes-principales" tabindex="-1"><a class="header-anchor" href="#methodes-principales"><span>Méthodes principales</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">CanonicalTimerService</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">startTimer</span><span class="token punctuation">(</span>accessCode<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> questionUid<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> durationMs<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">getRemainingTime</span><span class="token punctuation">(</span>accessCode<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> questionUid<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">restartTimer</span><span class="token punctuation">(</span>accessCode<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> questionUid<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token keyword">async</span> <span class="token function">getServerTimeSpent</span><span class="token punctuation">(</span>accessCode<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> questionUid<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token builtin">number</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="service-d-etat-des-parties-gamestateservice" tabindex="-1"><a class="header-anchor" href="#service-d-etat-des-parties-gamestateservice"><span>Service d&#39;état des parties (<code>GameStateService</code>)</span></a></h2><h3 id="stockage-en-redis" tabindex="-1"><a class="header-anchor" href="#stockage-en-redis"><span>Stockage en Redis</span></a></h3><p>L&#39;état des parties est stocké dans Redis pour des accès rapides :</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// Clé : mathquest:game:{accessCode}</span></span>
<span class="line"><span class="token comment">// Valeur :</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string-property property">&quot;gameState&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;questionUids&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;q1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;q2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;q3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;currentQuestionIndex&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token string-property property">&quot;startTime&quot;</span><span class="token operator">:</span> <span class="token number">1640000000000</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string-property property">&quot;participants&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string-property property">&quot;user123&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string-property property">&quot;score&quot;</span><span class="token operator">:</span> <span class="token number">150</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token string-property property">&quot;answers&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">&quot;q1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span> <span class="token string-property property">&quot;q2&quot;</span><span class="token operator">:</span> <span class="token string">&quot;B&quot;</span> <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="methodes-cles" tabindex="-1"><a class="header-anchor" href="#methodes-cles"><span>Méthodes clés</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">GameStateService</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getFullGameState</span><span class="token punctuation">(</span>sessionKey<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">updateParticipantScore</span><span class="token punctuation">(</span>accessCode<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> score<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">addParticipant</span><span class="token punctuation">(</span>accessCode<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> username<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">removeParticipant</span><span class="token punctuation">(</span>accessCode<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="gestion-des-participants" tabindex="-1"><a class="header-anchor" href="#gestion-des-participants"><span>Gestion des participants</span></a></h2><h3 id="service-dedie-gameparticipantservice" tabindex="-1"><a class="header-anchor" href="#service-dedie-gameparticipantservice"><span>Service dédié (<code>GameParticipantService</code>)</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">GameParticipantService</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">joinGame</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> accessCode<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>JoinResult<span class="token operator">&gt;</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">leaveGame</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> gameInstanceId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">updateScore</span><span class="token punctuation">(</span>userId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> gameInstanceId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> score<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span></span>
<span class="line">  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getLeaderboard</span><span class="token punctuation">(</span>gameInstanceId<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>LeaderboardEntry<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="flux-d-integration-d-un-participant" tabindex="-1"><a class="header-anchor" href="#flux-d-integration-d-un-participant"><span>Flux d&#39;intégration d&#39;un participant</span></a></h3><ol><li><strong>Validation du code d&#39;accès</strong></li><li><strong>Vérification des droits</strong> (place disponible, partie pas commencée)</li><li><strong>Création de l&#39;entrée</strong> en base de données</li><li><strong>Ajout au cache Redis</strong></li><li><strong>Notification Socket.IO</strong> aux autres participants</li></ol><h2 id="communication-socket-io" tabindex="-1"><a class="header-anchor" href="#communication-socket-io"><span>Communication Socket.IO</span></a></h2><h3 id="evenements-principaux" tabindex="-1"><a class="header-anchor" href="#evenements-principaux"><span>Événements principaux</span></a></h3><h4 id="cote-client-→-serveur" tabindex="-1"><a class="header-anchor" href="#cote-client-→-serveur"><span>Côté client → serveur</span></a></h4><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Rejoindre une partie</span></span>
<span class="line">socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;JOIN_GAME&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  accessCode<span class="token operator">:</span> <span class="token string">&#39;ABC123&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  userId<span class="token operator">:</span> <span class="token string">&#39;user123&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  username<span class="token operator">:</span> <span class="token string">&#39;Alice&#39;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Soumettre une réponse</span></span>
<span class="line">socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;GAME_ANSWER&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  accessCode<span class="token operator">:</span> <span class="token string">&#39;ABC123&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  userId<span class="token operator">:</span> <span class="token string">&#39;user123&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  questionUid<span class="token operator">:</span> <span class="token string">&#39;q1&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  answer<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;A&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  timeSpent<span class="token operator">:</span> <span class="token number">25000</span>  <span class="token comment">// millisecondes</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="cote-serveur-→-client" tabindex="-1"><a class="header-anchor" href="#cote-serveur-→-client"><span>Côté serveur → client</span></a></h4><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Nouvelle question</span></span>
<span class="line">io<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>accessCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;QUESTION_START&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  question<span class="token operator">:</span> questionData<span class="token punctuation">,</span></span>
<span class="line">  timeLimit<span class="token operator">:</span> <span class="token number">60000</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Mise à jour du leaderboard</span></span>
<span class="line">io<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>accessCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;LEADERBOARD_UPDATE&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  leaderboard<span class="token operator">:</span> sortedParticipants<span class="token punctuation">,</span></span>
<span class="line">  currentQuestionIndex<span class="token operator">:</span> <span class="token number">2</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Fin de la partie</span></span>
<span class="line">io<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>accessCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;GAME_END&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  finalLeaderboard<span class="token operator">:</span> finalResults<span class="token punctuation">,</span></span>
<span class="line">  winner<span class="token operator">:</span> topParticipant</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="gestion-des-rooms" tabindex="-1"><a class="header-anchor" href="#gestion-des-rooms"><span>Gestion des rooms</span></a></h3><p>Chaque partie utilise une &quot;room&quot; Socket.IO isolée :</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Rejoindre la room de la partie</span></span>
<span class="line">socket<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>accessCode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Émettre uniquement aux participants de cette partie</span></span>
<span class="line">io<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>accessCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;event&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Quitter la room</span></span>
<span class="line">socket<span class="token punctuation">.</span><span class="token function">leave</span><span class="token punctuation">(</span>accessCode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="gestion-des-erreurs-et-logging" tabindex="-1"><a class="header-anchor" href="#gestion-des-erreurs-et-logging"><span>Gestion des erreurs et logging</span></a></h2><h3 id="middleware-de-logging" tabindex="-1"><a class="header-anchor" href="#middleware-de-logging"><span>Middleware de logging</span></a></h3><p>Tous les services utilisent un logger centralisé :</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> createLogger <span class="token keyword">from</span> <span class="token string">&#39;@/utils/logger&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">createLogger</span><span class="token punctuation">(</span><span class="token string">&#39;ScoringService&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  userId<span class="token punctuation">,</span></span>
<span class="line">  gameInstanceId<span class="token punctuation">,</span></span>
<span class="line">  score<span class="token operator">:</span> result<span class="token punctuation">.</span>score<span class="token punctuation">,</span></span>
<span class="line">  timePenalty<span class="token operator">:</span> result<span class="token punctuation">.</span>timePenalty</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&#39;Score calculated successfully&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="gestion-des-erreurs" tabindex="-1"><a class="header-anchor" href="#gestion-des-erreurs"><span>Gestion des erreurs</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> ScoringService<span class="token punctuation">.</span><span class="token function">calculateAnswerScore</span><span class="token punctuation">(</span><span class="token comment">/*...*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span> success<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> data<span class="token operator">:</span> result <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  logger<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">,</span> userId<span class="token punctuation">,</span> questionUid <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&#39;Failed to calculate score&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token punctuation">{</span> success<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> error<span class="token operator">:</span> <span class="token string">&#39;Score calculation failed&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="optimisations-de-performance" tabindex="-1"><a class="header-anchor" href="#optimisations-de-performance"><span>Optimisations de performance</span></a></h2><h3 id="cache-redis" tabindex="-1"><a class="header-anchor" href="#cache-redis"><span>Cache Redis</span></a></h3><ul><li><strong>État des parties</strong> : Accès O(1) aux données de session</li><li><strong>Timers</strong> : Suivi précis du temps serveur</li><li><strong>Leaderboards</strong> : Mise à jour atomique des scores</li></ul><h3 id="base-de-donnees" tabindex="-1"><a class="header-anchor" href="#base-de-donnees"><span>Base de données</span></a></h3><ul><li><strong>Index composites</strong> sur les requêtes fréquentes</li><li><strong>Pooling de connexions</strong> pour éviter la surcharge</li><li><strong>Transactions</strong> pour les opérations critiques</li></ul><h3 id="socket-io" tabindex="-1"><a class="header-anchor" href="#socket-io"><span>Socket.IO</span></a></h3><ul><li><strong>Compression</strong> des messages pour réduire la bande passante</li><li><strong>Batching</strong> des mises à jour pour éviter le spam</li><li><strong>Heartbeat</strong> pour détecter les déconnexions</li></ul><h2 id="tests-et-validation" tabindex="-1"><a class="header-anchor" href="#tests-et-validation"><span>Tests et validation</span></a></h2><h3 id="tests-unitaires" tabindex="-1"><a class="header-anchor" href="#tests-unitaires"><span>Tests unitaires</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">&#39;ScoringService&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&#39;should calculate correct score for perfect QCM answer&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> ScoringService<span class="token punctuation">.</span><span class="token function">calculateAnswerScore</span><span class="token punctuation">(</span></span>
<span class="line">      mockQuestion<span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">[</span><span class="token string">&#39;A&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// Correct answer</span></span>
<span class="line">      <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// 30 seconds</span></span>
<span class="line">      <span class="token number">30000</span><span class="token punctuation">,</span> <span class="token comment">// Same as server time</span></span>
<span class="line">      <span class="token string">&#39;TEST123&#39;</span></span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>score<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeGreaterThan</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token function">expect</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>timePenalty<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeLessThan</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="tests-d-integration" tabindex="-1"><a class="header-anchor" href="#tests-d-integration"><span>Tests d&#39;intégration</span></a></h3><p>Les tests d&#39;intégration valident les interactions entre services :</p><ul><li><strong>Flux complet</strong> : De la réponse à la mise à jour du leaderboard</li><li><strong>Concurrence</strong> : Gestion des réponses simultanées</li><li><strong>Déconnexions</strong> : Récupération après perte de connexion</li></ul><p>Cette architecture modulaire assure la maintenabilité, l&#39;évolutivité et la fiabilité du système de gestion des quiz de MathQuest.</p><h2 id="evenements-socket-io" tabindex="-1"><a class="header-anchor" href="#evenements-socket-io"><span>Événements Socket.IO</span></a></h2><p>MathQuest utilise Socket.IO pour la communication temps réel bidirectionnelle entre le frontend et le backend. Tous les événements sont définis dans <code>shared/types/socket/events.ts</code> pour assurer la cohérence.</p><h3 id="evenements-enseignant-teacher-events" tabindex="-1"><a class="header-anchor" href="#evenements-enseignant-teacher-events"><span>Événements Enseignant (TEACHER_EVENTS)</span></a></h3><h4 id="connexion-et-etat" tabindex="-1"><a class="header-anchor" href="#connexion-et-etat"><span>Connexion et état</span></a></h4><ul><li><code>JOIN_DASHBOARD</code> : Rejoindre le tableau de bord enseignant</li><li><code>GET_GAME_STATE</code> : Récupérer l&#39;état actuel du jeu</li></ul><h4 id="controle-des-questions" tabindex="-1"><a class="header-anchor" href="#controle-des-questions"><span>Contrôle des questions</span></a></h4><ul><li><code>SET_QUESTION</code> : Définir la question active</li></ul><h4 id="controle-du-timer" tabindex="-1"><a class="header-anchor" href="#controle-du-timer"><span>Contrôle du timer</span></a></h4><ul><li><code>TIMER_ACTION</code> : Action générale sur le timer</li><li><code>START_TIMER</code> : Démarrer le timer</li><li><code>PAUSE_TIMER</code> : Mettre en pause le timer</li><li><code>TIMER_SET_DURATION</code> : Définir la durée du timer</li></ul><h4 id="controle-du-jeu" tabindex="-1"><a class="header-anchor" href="#controle-du-jeu"><span>Contrôle du jeu</span></a></h4><ul><li><code>LOCK_ANSWERS</code> : Verrouiller les réponses</li><li><code>END_GAME</code> : Terminer le jeu</li></ul><h4 id="actions-declenchees-par-l-enseignant" tabindex="-1"><a class="header-anchor" href="#actions-declenchees-par-l-enseignant"><span>Actions déclenchées par l&#39;enseignant</span></a></h4><ul><li><code>SHOW_CORRECT_ANSWERS</code> : Afficher les bonnes réponses</li><li><code>TOGGLE_PROJECTION_STATS</code> : Basculer les statistiques sur la projection</li><li><code>REVEAL_LEADERBOARD</code> : Révéler le classement</li></ul><h4 id="evenements-de-diffusion-serveur-→-client" tabindex="-1"><a class="header-anchor" href="#evenements-de-diffusion-serveur-→-client"><span>Événements de diffusion (serveur → client)</span></a></h4><ul><li><code>GAME_CONTROL_STATE</code> : État du contrôle du jeu</li><li><code>DASHBOARD_JOINED</code> : Confirmation de connexion au dashboard</li><li><code>TIMER_UPDATE</code> : Mise à jour du timer</li><li><code>CONNECTED_COUNT</code> : Nombre de connexions</li></ul><h4 id="evenements-specifiques-au-dashboard" tabindex="-1"><a class="header-anchor" href="#evenements-specifiques-au-dashboard"><span>Événements spécifiques au dashboard</span></a></h4><ul><li><code>DASHBOARD_QUESTION_CHANGED</code> : Question changée</li><li><code>DASHBOARD_TIMER_UPDATED</code> : Timer mis à jour</li><li><code>DASHBOARD_ANSWERS_LOCK_CHANGED</code> : Verrouillage des réponses changé</li><li><code>DASHBOARD_GAME_STATUS_CHANGED</code> : Statut du jeu changé</li><li><code>DASHBOARD_ANSWER_STATS_UPDATE</code> : Statistiques des réponses mises à jour</li></ul><h3 id="evenements-tournoi-tournament-events" tabindex="-1"><a class="header-anchor" href="#evenements-tournoi-tournament-events"><span>Événements Tournoi (TOURNAMENT_EVENTS)</span></a></h3><h4 id="actions-des-joueurs" tabindex="-1"><a class="header-anchor" href="#actions-des-joueurs"><span>Actions des joueurs</span></a></h4><ul><li><code>START_TOURNAMENT</code> : Démarrer un tournoi</li><li><code>JOIN_TOURNAMENT</code> : Rejoindre un tournoi</li><li><code>TOURNAMENT_ANSWER</code> : Soumettre une réponse au tournoi</li></ul><h4 id="reponses-du-serveur" tabindex="-1"><a class="header-anchor" href="#reponses-du-serveur"><span>Réponses du serveur</span></a></h4><ul><li><code>TOURNAMENT_STARTED</code> : Tournoi démarré</li><li><code>TOURNAMENT_JOINED</code> : Joueur rejoint le tournoi</li><li><code>TOURNAMENT_PLAYER_JOINED</code> : Nouveau joueur rejoint</li><li><code>TOURNAMENT_STATE_UPDATE</code> : Mise à jour de l&#39;état du tournoi</li><li><code>TOURNAMENT_ANSWER_RESULT</code> : Résultat de la réponse</li><li><code>TOURNAMENT_QUESTION_UPDATE</code> : Question mise à jour</li><li><code>TOURNAMENT_QUESTION_STATE_UPDATE</code> : État de la question mis à jour</li><li><code>TOURNAMENT_LEADERBOARD_UPDATE</code> : Classement mis à jour</li><li><code>TOURNAMENT_ENDED</code> : Tournoi terminé</li><li><code>TOURNAMENT_TIMER_UPDATE</code> : Timer mis à jour</li></ul><h3 id="evenements-de-projection-projector-events" tabindex="-1"><a class="header-anchor" href="#evenements-de-projection-projector-events"><span>Événements de Projection (PROJECTOR_EVENTS)</span></a></h3><h4 id="actions-de-projection" tabindex="-1"><a class="header-anchor" href="#actions-de-projection"><span>Actions de projection</span></a></h4><ul><li><code>JOIN_PROJECTION</code> : Rejoindre la projection</li><li><code>LEAVE_PROJECTION</code> : Quitter la projection</li></ul><h4 id="reponses-du-serveur-1" tabindex="-1"><a class="header-anchor" href="#reponses-du-serveur-1"><span>Réponses du serveur</span></a></h4><ul><li><code>PROJECTION_JOINED</code> : Projection rejointe</li><li><code>PROJECTION_LEFT</code> : Projection quittée</li><li><code>PROJECTION_ERROR</code> : Erreur de projection</li><li><code>PROJECTION_QUESTION_CHANGED</code> : Question changée sur la projection</li><li><code>PROJECTION_CONNECTED_COUNT</code> : Nombre de connexions à la projection</li><li><code>PROJECTION_STATE</code> : État de la projection</li><li><code>PROJECTION_LEADERBOARD_UPDATE</code> : Classement mis à jour sur la projection</li></ul><h4 id="controles-d-affichage" tabindex="-1"><a class="header-anchor" href="#controles-d-affichage"><span>Contrôles d&#39;affichage</span></a></h4><ul><li><code>PROJECTION_SHOW_STATS</code> : Afficher les statistiques</li><li><code>PROJECTION_HIDE_STATS</code> : Masquer les statistiques</li><li><code>PROJECTION_CORRECT_ANSWERS</code> : Afficher les bonnes réponses</li><li><code>PROJECTION_STATS_STATE</code> : État canonique des statistiques</li></ul><h3 id="evenements-de-jeu-quiz-game-events" tabindex="-1"><a class="header-anchor" href="#evenements-de-jeu-quiz-game-events"><span>Événements de Jeu/Quiz (GAME_EVENTS)</span></a></h3><h4 id="actions-des-joueurs-flux-de-connexion-unifie" tabindex="-1"><a class="header-anchor" href="#actions-des-joueurs-flux-de-connexion-unifie"><span>Actions des joueurs - Flux de connexion unifié</span></a></h4><ul><li><code>JOIN_GAME</code> : Rejoindre un jeu (remplace JOIN_LOBBY)</li><li><code>LEAVE_GAME</code> : Quitter un jeu (remplace LEAVE_LOBBY)</li><li><code>GAME_ANSWER</code> : Soumettre une réponse</li><li><code>REQUEST_PARTICIPANTS</code> : Demander la liste des participants</li><li><code>REQUEST_NEXT_QUESTION</code> : Demander la question suivante</li><li><code>START_GAME</code> : Démarrer le jeu</li></ul><h4 id="reponses-du-serveur-2" tabindex="-1"><a class="header-anchor" href="#reponses-du-serveur-2"><span>Réponses du serveur</span></a></h4><ul><li><code>GAME_JOINED</code> : Jeu rejoint</li><li><code>PLAYER_JOINED_GAME</code> : Nouveau joueur rejoint le jeu</li><li><code>PLAYER_LEFT_GAME</code> : Joueur a quitté le jeu</li><li><code>GAME_PARTICIPANTS</code> : Liste des participants</li><li><code>GAME_QUESTION</code> : Question du jeu</li><li><code>ANSWER_RECEIVED</code> : Réponse reçue</li><li><code>ANSWER_FEEDBACK</code> : Feedback de la réponse</li><li><code>GAME_ENDED</code> : Jeu terminé</li><li><code>GAME_ERROR</code> : Erreur de jeu</li><li><code>GAME_ANSWERS_LOCK_CHANGED</code> : Verrouillage des réponses changé</li><li><code>LEADERBOARD_UPDATE</code> : Mise à jour du classement</li></ul><h4 id="evenements-du-timer" tabindex="-1"><a class="header-anchor" href="#evenements-du-timer"><span>Événements du timer</span></a></h4><ul><li><code>GAME_TIMER_UPDATED</code> : Timer mis à jour (événement primaire)</li><li><code>TIMER_UPDATE</code> : Mise à jour du timer</li><li><code>GAME_UPDATE</code> : Mise à jour du jeu</li><li><code>TIMER_SET</code> : Timer défini</li></ul><h4 id="evenements-d-etat-du-jeu" tabindex="-1"><a class="header-anchor" href="#evenements-d-etat-du-jeu"><span>Événements d&#39;état du jeu</span></a></h4><ul><li><code>GAME_STATE_UPDATE</code> : Mise à jour de l&#39;état du jeu</li><li><code>CORRECT_ANSWERS</code> : Bonnes réponses</li><li><code>GAME_ALREADY_PLAYED</code> : Jeu déjà joué</li><li><code>GAME_REDIRECT_TO_LOBBY</code> : Redirection vers le lobby</li><li><code>GAME_CODE_UPDATED</code> : Code du jeu mis à jour</li><li><code>GAME_FINISHED_REDIRECT</code> : Redirection après fin du jeu</li></ul><h4 id="evenements-supplementaires" tabindex="-1"><a class="header-anchor" href="#evenements-supplementaires"><span>Événements supplémentaires</span></a></h4><ul><li><code>EXPLICATION</code> : Explication</li><li><code>FEEDBACK</code> : Feedback</li><li><code>LIVE_QUESTION</code> : Question en direct</li></ul><h3 id="gestion-des-rooms-socket-io" tabindex="-1"><a class="header-anchor" href="#gestion-des-rooms-socket-io"><span>Gestion des rooms Socket.IO</span></a></h3><p>Chaque partie utilise une &quot;room&quot; Socket.IO isolée pour la communication :</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token comment">// Rejoindre la room d&#39;une partie</span></span>
<span class="line">socket<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>accessCode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Émettre uniquement aux participants de cette partie</span></span>
<span class="line">io<span class="token punctuation">.</span><span class="token function">to</span><span class="token punctuation">(</span>accessCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;event&#39;</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Quitter la room</span></span>
<span class="line">socket<span class="token punctuation">.</span><span class="token function">leave</span><span class="token punctuation">(</span>accessCode<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="evenements-de-connexion" tabindex="-1"><a class="header-anchor" href="#evenements-de-connexion"><span>Événements de connexion</span></a></h3><ul><li><code>CONNECT</code> : Connexion établie</li><li><code>DISCONNECT</code> : Déconnexion</li><li><code>CONNECT_ERROR</code> : Erreur de connexion</li><li><code>CONNECTION_ESTABLISHED</code> : Connexion confirmée</li></ul>`,108)]))}const l=n(p,[["render",i]]),r=JSON.parse(`{"path":"/details-techniques/backend-services.html","title":"Services backend","lang":"fr-FR","frontmatter":{},"git":{"updatedTime":1761744616000,"contributors":[{"name":"alexisflesch","username":"alexisflesch","email":"alexis.flesch@gmail.com","commits":2,"url":"https://github.com/alexisflesch"}],"changelog":[{"hash":"fdd26df1cce915a183383c73c35f38c43863332b","time":1761744616000,"email":"alexis.flesch@gmail.com","author":"alexisflesch","message":"essayer l'appli plutôt que essayer gratuitement"},{"hash":"8fbb71211cc25ed6748dfb46362eb2796047c9da","time":1758286875000,"email":"alexis.flesch@gmail.com","author":"alexisflesch","message":"updating doc"}]},"filePathRelative":"details-techniques/backend-services.md"}`);export{l as comp,r as data};
