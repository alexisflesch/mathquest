# Test info

- Name: Teacher question editor - MathJax scrollbars >> no useless horizontal scrollbars in preview when toggling and typing
- Location: /home/aflesch/mathquest/app/tests/e2e/teacher-editor-scrollbars.spec.ts:83:9

# Error details

```
Error: locator.fill: Test timeout of 10000ms exceeded.
Call log:
  - waiting for locator('input[placeholder^="RÃ©ponse"], input[placeholder^="Reponse"]').nth(1)

    at setMathAnswersInForm (/home/aflesch/mathquest/app/tests/e2e/teacher-editor-scrollbars.spec.ts:70:21)
    at /home/aflesch/mathquest/app/tests/e2e/teacher-editor-scrollbars.spec.ts:94:9
```

# Page snapshot

```yaml
- alert
- button "Open Next.js Dev Tools":
  - img
- button "Open issues overlay": 1 Issue
- button "Collapse issues badge":
  - img
- complementary:
  - button "RÃ©duire le menu"
  - text: france-lyne ðŸŒ
  - navigation:
    - link "Accueil":
      - /url: /
    - link "EntraÃ®nement libre":
      - /url: /student/create-game?training=true
    - link "Rejoindre une activitÃ©":
      - /url: /student/join
    - link "CrÃ©er un tournoi":
      - /url: /student/create-game
    - link "Historique":
      - /url: /my-tournaments
    - text: Enseignant
    - link "Mes activitÃ©s":
      - /url: /teacher/games
    - link "CrÃ©er une activitÃ©":
      - /url: /teacher/games/new
    - link "Ã‰diter des questions":
      - /url: /teacher/questions/edit
    - text: Compte
    - link "Mon profil":
      - /url: /profile
  - button "Passer en mode clair": ThÃ¨me systÃ¨me
  - button "DÃ©connexion"
- main:
  - heading "Ã‰diteur de Questions" [level=1]
  - button "Importer"
  - button "Exporter"
  - button "Expand questions list"
  - button "Question 1": "1"
  - button "Supprimer la question 1"
  - button "Ajouter une question": +
  - button "Formulaire"
  - button "YAML"
  - heading "ParamÃ¨tres" [level=2]
  - textbox "Titre de la question"
  - button "CE1"
  - button "SÃ©lectionner une discipline"
  - button "SÃ©lectionner un ou plusieurs thÃ¨mes" [disabled]
  - button "SÃ©lectionner un ou plusieurs tags" [disabled]
  - textbox "Identifiant unique de la question (modifiable).": question-1760815536197
  - textbox "Auteur": Teacher
  - button "NumÃ©rique"
  - spinbutton "Temps allouÃ© (secondes)": "30"
  - button "1"
  - heading "Question" [level=2]
  - textbox "Texte de la question (LaTeX supportÃ©)."
  - spinbutton: "2"
  - heading "Explication" [level=2]
  - textbox "Explication Ã  afficher aprÃ¨s la correction"
  - spinbutton "Temps durant lequel l'explication sera affichÃ©e en mode tournoi": "15"
  - text: 9:41
  - img
  - img
  - img
  - img
  - text: Sans titre 30
  - heading "Question 1 / 1" [level=3]
  - text: "RÃ©ponse : 2"
```

# Test source

```ts
   1 | import { test, expect, Page } from '@playwright/test';
   2 | import { TestDataHelper, LoginHelper } from './helpers/test-helpers';
   3 |
   4 | async function ensureLoggedInTeacher(page: Page) {
   5 |     const dataHelper = new TestDataHelper(page);
   6 |     const login = new LoginHelper(page);
   7 |     const creds = dataHelper.generateTestData('teacher_editor_scroll');
   8 |
   9 |     // Create teacher
   10 |     await dataHelper.createTeacher({
   11 |         username: creds.username,
   12 |         email: creds.email,
   13 |         password: creds.password,
   14 |     });
   15 |
   16 |     // Login via UI (helper is robust to current login UX)
   17 |     await login.loginAsTeacher({ email: creds.email, password: creds.password });
   18 |     await expect(page).toHaveURL(/\//);
   19 | }
   20 |
   21 | async function countAnswerHorizontalScrollbars(page: Page) {
   22 |     // Count answer content spans that actually show horizontal scrollbars
   23 |     // using scrollWidth > clientWidth AND overflow-x allowing scroll.
   24 |     return page.evaluate(() => {
   25 |         const container = document.querySelector('.card .tqcard-content');
   26 |         if (!container) return -1; // not ready yet
   27 |         const spans = container.querySelectorAll('button.tqcard-answer > span:first-child');
   28 |         let count = 0;
   29 |         spans.forEach((s: Element) => {
   30 |             const el = s as HTMLElement;
   31 |             const style = getComputedStyle(el);
   32 |             const allowsScroll = style.overflowX === 'auto' || style.overflowX === 'scroll';
   33 |             if (allowsScroll && el.scrollWidth > el.clientWidth + 1) count++;
   34 |         });
   35 |         return count;
   36 |     });
   37 | }
   38 |
   39 | async function assertNoAnswerScrollbars(page: Page) {
   40 |     const count = await countAnswerHorizontalScrollbars(page);
   41 |     expect(count).toBe(0);
   42 | }
   43 |
   44 | async function typeInQuestionTextarea(page: Page, text: string) {
   45 |     // Locate the question textarea on the left form (label: Question)
   46 |     const locator = page.locator('textarea[placeholder*="question" i]');
   47 |     await locator.first().click();
   48 |     await locator.first().type(text);
   49 | }
   50 |
   51 | async function setMathAnswersInForm(page: Page) {
   52 |     // Ensure we are on Formulaire tab
   53 |     const formTab = page.getByRole('button', { name: /Formulaire/i });
   54 |     if (await formTab.isVisible()) await formTab.click();
   55 |
   56 |     // Make sure answer inputs are visible
   57 |     const answerInputs = page.locator('input[placeholder^="RÃ©ponse"], input[placeholder^="Reponse"]');
   58 |     await answerInputs.first().waitFor({ state: 'visible' });
   59 |
   60 |     // Fill first 4 answers with display-math-rich content
   61 |     const formulas = [
   62 |         String.raw`\\[ \\sqrt{2} \\in \\mathbb{Q} \\]`,
   63 |         String.raw`\\[ \\sqrt{2} \\subset \\mathbb{C} \\]`,
   64 |         String.raw`\\[ \\{ \\sqrt{2}, \\pi \\} \\in \\mathbb{R} \\]`,
   65 |         String.raw`\\[ \\{ \\sqrt{2}, \\pi \\} \\subset \\mathbb{C} \\]`,
   66 |     ];
   67 |
   68 |     for (let i = 0; i < 4; i++) {
   69 |         const input = answerInputs.nth(i);
>  70 |         await input.fill('');
      |                     ^ Error: locator.fill: Test timeout of 10000ms exceeded.
   71 |         await input.type(formulas[i]);
   72 |     }
   73 |
   74 |     // Wait for MathJax wrappers to appear inside the preview answers
   75 |     await page.waitForFunction(() => {
   76 |         const spans = document.querySelectorAll('button.tqcard-answer > span:first-child');
   77 |         if (!spans.length) return false;
   78 |         return Array.from(spans).some(s => s.querySelector('mjx-container,.mjx-chtml,.MathJax'));
   79 |     }, { timeout: 5000 });
   80 | }
   81 |
   82 | test.describe('Teacher question editor - MathJax scrollbars', () => {
   83 |     test('no useless horizontal scrollbars in preview when toggling and typing', async ({ page }) => {
   84 |         await ensureLoggedInTeacher(page);
   85 |
   86 |         // Go to the editor page
   87 |         await page.goto('/teacher/questions/edit');
   88 |         await page.waitForLoadState('networkidle');
   89 |
   90 |         // Ensure preview card is present
   91 |         await page.waitForSelector('.card .tqcard-content');
   92 |
   93 |         // Fill answers with display math to trigger the real layout case
   94 |         await setMathAnswersInForm(page);
   95 |
   96 |         // Baseline: should be zero scrollbars in answers
   97 |         await assertNoAnswerScrollbars(page);
   98 |
   99 |         // Toggle YAML, then back to Formulaire
  100 |         await page.getByRole('button', { name: /YAML/i }).click();
  101 |         await page.getByRole('button', { name: /Formulaire/i }).click();
  102 |
  103 |         // After toggling: still expected zero â€” current bug likely shows 1 (this should fail until fixed)
  104 |         await assertNoAnswerScrollbars(page);
  105 |
  106 |         // Simulate typing in the question textarea to trigger live re-typeset
  107 |         await typeInQuestionTextarea(page, ' abcdef');
  108 |
  109 |         // After typing: still expected zero â€” bug often grows scrollbars (this should fail until fixed)
  110 |         await assertNoAnswerScrollbars(page);
  111 |     });
  112 | });
  113 |
```