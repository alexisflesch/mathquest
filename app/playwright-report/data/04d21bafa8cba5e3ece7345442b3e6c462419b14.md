# Test info

- Name: Tournament Mode E2E >> Tournament Mode: Multiple students compete with real-time leaderboard
- Location: /home/aflesch/mathquest/app/tests/e2e/tournament-mode.spec.ts:34:9

# Error details

```
Error: Timed out 3000ms waiting for expect(locator).toHaveURL(expected)

Locator: locator(':root')
Expected string: "http://localhost:3008/teacher/home"
Received string: "http://localhost:3008/"
Call log:
  - expect.toHaveURL with timeout 3000ms
  - waiting for locator(':root')
    7 Ã— locator resolved to <html lang="fr" data-theme="light" class="__className_f367f3">â€¦</html>
      - unexpected value "http://localhost:3008/"

    at /home/aflesch/mathquest/app/tests/e2e/tournament-mode.spec.ts:51:35
```

# Page snapshot

```yaml
- alert: Kutsum
- button "Open Next.js Dev Tools":
  - img
- complementary:
  - button "RÃ©duire le menu"
  - text: cheyenne ðŸŠ
  - navigation:
    - link "Accueil":
      - /url: /
    - link "EntraÃ®nement libre":
      - /url: /student/create-game?training=true
    - link "Rejoindre une activitÃ©":
      - /url: /student/join
    - link "CrÃ©er un tournoi":
      - /url: /student/create-game
    - link "Historique":
      - /url: /my-tournaments
    - text: Enseignant
    - link "Mes activitÃ©s":
      - /url: /teacher/games
    - link "CrÃ©er une activitÃ©":
      - /url: /teacher/games/new
    - link "Ã‰diter des questions":
      - /url: /teacher/questions/edit
    - text: Compte
    - link "Mon profil":
      - /url: /profile
  - button "Passer en mode clair": ThÃ¨me systÃ¨me
  - button "DÃ©connexion"
- main:
  - img "Kutsum logo"
  - heading "Kutsum" [level=1]
  - paragraph: Keep Up The Speed, Unleash Mastery !
  - paragraph: Bonjour cheyenne ðŸ‘‹, ravi de vous revoir !
  - paragraph: "Utilisez le menu Ã  gauche pour naviguer dans l'application. Vous pouvez :"
  - list:
    - listitem:
      - strong: GÃ©rer vos activitÃ©s existantes
      - text: ": gÃ©rer vos sessions et tournois existants"
    - listitem:
      - strong: CrÃ©er de nouvelles activitÃ©s
      - text: ": prÃ©parer de nouveaux quiz ou tournois pour vos Ã©lÃ¨ves en piochant dans la base de donnÃ©es"
  - paragraph: "Pour en savoir plus :"
  - link "Site du projet Kutsum":
    - /url: https://kutsum.org
    - text: Site du projet
  - link "Documentation externe":
    - /url: https://docs.kutsum.org
    - text: Documentation
  - link "Contribuer sur GitHub":
    - /url: https://github.com/alexisflesch/mathquest
    - text: Contribuer
  - strong: "âš ï¸ En dÃ©veloppement :"
  - text: le service peut Ãªtre interrompu pour mise Ã  jour.
```

# Test source

```ts
   1 | import { test, expect, Page } from '@playwright/test';
   2 | import { TestDataHelper, LoginHelper, SocketHelper } from './helpers/test-helpers';
   3 |
   4 | test.describe('Tournament Mode E2E', () => {
   5 |     let teacherPage: Page;
   6 |     let studentPages: Page[] = [];
   7 |     let testData: any;
   8 |     const numStudents = 4;
   9 |
   10 |     test.beforeAll(async ({ browser }) => {
   11 |         // Create separate browser contexts for teacher and multiple students
   12 |         const teacherContext = await browser.newContext();
   13 |         teacherPage = await teacherContext.newPage();
   14 |
   15 |         // Create 4 student pages for tournament
   16 |         for (let i = 0; i < numStudents; i++) {
   17 |             const studentContext = await browser.newContext();
   18 |             const studentPage = await studentContext.newPage();
   19 |             studentPages.push(studentPage);
   20 |         }
   21 |
   22 |         // Generate test data
   23 |         const dataHelper = new TestDataHelper(teacherPage);
   24 |         testData = dataHelper.generateTestData('tournament_e2e');
   25 |     });
   26 |
   27 |     test.afterAll(async () => {
   28 |         await teacherPage?.close();
   29 |         for (const page of studentPages) {
   30 |             await page?.close();
   31 |         }
   32 |     });
   33 |
   34 |     test('Tournament Mode: Multiple students compete with real-time leaderboard', async () => {
   35 |         const dataHelper = new TestDataHelper(teacherPage);
   36 |         const teacherLogin = new LoginHelper(teacherPage);
   37 |         const teacherSocket = new SocketHelper(teacherPage);
   38 |
   39 |         // Step 1: Create teacher account and login
   40 |         await dataHelper.createTeacher({
   41 |             username: testData.username,
   42 |             email: testData.email,
   43 |             password: testData.password
   44 |         });
   45 |
   46 |         await teacherLogin.loginAsTeacher({
   47 |             email: testData.email,
   48 |             password: testData.password
   49 |         });
   50 |
>  51 |         await expect(teacherPage).toHaveURL('/teacher/home');
      |                                   ^ Error: Timed out 3000ms waiting for expect(locator).toHaveURL(expected)
   52 |
   53 |         // Step 2: Create tournament with specific themes/difficulty
   54 |         await teacherPage.click('[data-testid="create-tournament-button"]');
   55 |         await teacherPage.fill('[data-testid="tournament-name-input"]', testData.tournamentName);
   56 |
   57 |         // Set tournament configuration
   58 |         await teacherPage.selectOption('[data-testid="tournament-theme"]', 'arithmetic');
   59 |         await teacherPage.selectOption('[data-testid="tournament-difficulty"]', 'medium');
   60 |         await teacherPage.fill('[data-testid="tournament-questions-count"]', '5');
   61 |         await teacherPage.fill('[data-testid="tournament-time-per-question"]', '30');
   62 |
   63 |         await teacherPage.click('[data-testid="create-tournament-confirm"]');
   64 |
   65 |         // Step 3: Start tournament and get access code
   66 |         await teacherPage.click('[data-testid="start-tournament-button"]');
   67 |         await teacherSocket.waitForSocketConnection();
   68 |
   69 |         const accessCode = await teacherPage.locator('[data-testid="access-code"]').textContent();
   70 |         expect(accessCode).toBeTruthy();
   71 |         expect(accessCode).toMatch(/^\d{6}$/);
   72 |
   73 |         // Step 4: Students join tournament lobby
   74 |         const studentHelpers = [];
   75 |         for (let i = 0; i < numStudents; i++) {
   76 |             const studentPage = studentPages[i];
   77 |             const studentLogin = new LoginHelper(studentPage);
   78 |             const studentSocket = new SocketHelper(studentPage);
   79 |
   80 |             studentHelpers.push({ page: studentPage, login: studentLogin, socket: studentSocket });
   81 |
   82 |             // Student joins tournament
   83 |             await studentPage.goto('/student/join');
   84 |             await studentPage.fill('[data-testid="access-code-input"]', accessCode!);
   85 |             await studentPage.fill('[data-testid="username-input"]', `${testData.username}_student${i + 1}`);
   86 |             await studentPage.click('[data-testid="join-tournament-button"]');
   87 |             await studentSocket.waitForSocketConnection();
   88 |         }
   89 |
   90 |         // Verify all students are in lobby
   91 |         await expect(teacherPage.locator('[data-testid="participant-count"]')).toContainText(`${numStudents}`);
   92 |
   93 |         // Step 5: Tournament starts with countdown
   94 |         await teacherPage.click('[data-testid="start-tournament-countdown"]');
   95 |
   96 |         // Verify countdown appears on all clients
   97 |         await expect(teacherPage.locator('[data-testid="tournament-countdown"]')).toBeVisible();
   98 |         for (const helper of studentHelpers) {
   99 |             await expect(helper.page.locator('[data-testid="tournament-countdown"]')).toBeVisible();
  100 |         }
  101 |
  102 |         // Wait for countdown to complete
  103 |         await teacherPage.waitForSelector('[data-testid="tournament-active"]', { timeout: 10000 });
  104 |
  105 |         // Step 6: Students answer questions simultaneously
  106 |         for (let questionIndex = 0; questionIndex < 5; questionIndex++) {
  107 |             // Verify question appears on all clients
  108 |             await expect(teacherPage.locator('[data-testid="tournament-question"]')).toBeVisible();
  109 |             for (const helper of studentHelpers) {
  110 |                 await expect(helper.page.locator('[data-testid="tournament-question"]')).toBeVisible();
  111 |             }
  112 |
  113 |             // Students submit answers with different response times and accuracy
  114 |             for (let i = 0; i < numStudents; i++) {
  115 |                 const studentPage = studentHelpers[i].page;
  116 |
  117 |                 // Simulate different answer patterns for realistic competition
  118 |                 const answerIndex = (i + questionIndex) % 4; // Different answers
  119 |                 const delay = i * 500; // Staggered response times
  120 |
  121 |                 await studentPage.waitForTimeout(delay);
  122 |                 await studentPage.click(`[data-testid="answer-option-${answerIndex}"]`);
  123 |                 await studentPage.click('[data-testid="submit-answer-button"]');
  124 |             }
  125 |
  126 |             // Step 7: Verify live leaderboard updates after each question
  127 |             await expect(teacherPage.locator('[data-testid="live-leaderboard"]')).toBeVisible();
  128 |
  129 |             // Check that leaderboard shows all participants
  130 |             for (let i = 0; i < numStudents; i++) {
  131 |                 const studentName = `${testData.username}_student${i + 1}`;
  132 |                 await expect(teacherPage.locator('[data-testid="live-leaderboard"]')).toContainText(studentName);
  133 |             }
  134 |
  135 |             // Verify leaderboard updates on student clients
  136 |             for (const helper of studentHelpers) {
  137 |                 await expect(helper.page.locator('[data-testid="live-leaderboard"]')).toBeVisible();
  138 |             }
  139 |
  140 |             // Wait for question to complete before next iteration
  141 |             if (questionIndex < 4) {
  142 |                 await teacherPage.waitForSelector('[data-testid="question-complete"]');
  143 |             }
  144 |         }
  145 |
  146 |         // Step 8: Tournament concludes with final rankings
  147 |         await expect(teacherPage.locator('[data-testid="tournament-results"]')).toBeVisible();
  148 |
  149 |         // Verify final leaderboard accuracy
  150 |         const finalLeaderboard = teacherPage.locator('[data-testid="final-tournament-leaderboard"]');
  151 |         await expect(finalLeaderboard).toBeVisible();
```