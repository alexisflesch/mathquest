# Test info

- Name: Teacher Timer Controls E2E >> Teacher Timer Controls: Pause, resume, extend, and manual advance
- Location: /home/aflesch/mathquest/app/tests/e2e/teacher-timer-controls.spec.ts:34:9

# Error details

```
Error: Timed out 3000ms waiting for expect(locator).toHaveURL(expected)

Locator: locator(':root')
Expected string: "http://localhost:3008/teacher/home"
Received string: "http://localhost:3008/"
Call log:
  - expect.toHaveURL with timeout 3000ms
  - waiting for locator(':root')
    7 × locator resolved to <html lang="fr" data-theme="light" class="__className_f367f3">…</html>
      - unexpected value "http://localhost:3008/"

    at /home/aflesch/mathquest/app/tests/e2e/teacher-timer-controls.spec.ts:51:35
```

# Test source

```ts
   1 | import { test, expect, Page } from '@playwright/test';
   2 | import { TestDataHelper, LoginHelper, SocketHelper } from './helpers/test-helpers';
   3 |
   4 | test.describe('Teacher Timer Controls E2E', () => {
   5 |     let teacherPage: Page;
   6 |     let studentPages: Page[] = [];
   7 |     let testData: any;
   8 |     const numStudents = 3;
   9 |
   10 |     test.beforeAll(async ({ browser }) => {
   11 |         // Create separate browser contexts
   12 |         const teacherContext = await browser.newContext();
   13 |         teacherPage = await teacherContext.newPage();
   14 |
   15 |         // Create student pages
   16 |         for (let i = 0; i < numStudents; i++) {
   17 |             const studentContext = await browser.newContext();
   18 |             const studentPage = await studentContext.newPage();
   19 |             studentPages.push(studentPage);
   20 |         }
   21 |
   22 |         // Generate test data
   23 |         const dataHelper = new TestDataHelper(teacherPage);
   24 |         testData = dataHelper.generateTestData('timer_controls_e2e');
   25 |     });
   26 |
   27 |     test.afterAll(async () => {
   28 |         await teacherPage?.close();
   29 |         for (const page of studentPages) {
   30 |             await page?.close();
   31 |         }
   32 |     });
   33 |
   34 |     test('Teacher Timer Controls: Pause, resume, extend, and manual advance', async () => {
   35 |         const dataHelper = new TestDataHelper(teacherPage);
   36 |         const teacherLogin = new LoginHelper(teacherPage);
   37 |         const teacherSocket = new SocketHelper(teacherPage);
   38 |
   39 |         // Step 1: Create teacher account and login
   40 |         await dataHelper.createTeacher({
   41 |             username: testData.username,
   42 |             email: testData.email,
   43 |             password: testData.password
   44 |         });
   45 |
   46 |         await teacherLogin.loginAsTeacher({
   47 |             email: testData.email,
   48 |             password: testData.password
   49 |         });
   50 |
>  51 |         await expect(teacherPage).toHaveURL('/teacher/home');
      |                                   ^ Error: Timed out 3000ms waiting for expect(locator).toHaveURL(expected)
   52 |
   53 |         // Step 2: Create quiz with timer-enabled questions
   54 |         await teacherPage.click('[data-testid="create-quiz-button"]');
   55 |         await teacherPage.fill('[data-testid="quiz-name-input"]', testData.quizName);
   56 |
   57 |         // Add questions with different timer settings
   58 |         for (let i = 0; i < 3; i++) {
   59 |             await teacherPage.click('[data-testid="add-question-button"]');
   60 |             await teacherPage.click(`[data-testid="question-select-${i}"]`);
   61 |         }
   62 |
   63 |         // Enable timer for quiz
   64 |         await teacherPage.check('[data-testid="enable-timer-checkbox"]');
   65 |         await teacherPage.fill('[data-testid="default-timer-duration"]', '30'); // 30 seconds per question
   66 |
   67 |         await teacherPage.click('[data-testid="create-quiz-confirm"]');
   68 |         await teacherPage.click('[data-testid="start-quiz-button"]');
   69 |         await teacherSocket.waitForSocketConnection();
   70 |
   71 |         const accessCode = await teacherPage.locator('[data-testid="access-code"]').textContent();
   72 |         expect(accessCode).toBeTruthy();
   73 |
   74 |         // Step 3: Students join the quiz
   75 |         const studentHelpers = [];
   76 |         for (let i = 0; i < numStudents; i++) {
   77 |             const studentPage = studentPages[i];
   78 |             const studentSocket = new SocketHelper(studentPage);
   79 |
   80 |             studentHelpers.push({ page: studentPage, socket: studentSocket });
   81 |
   82 |             await studentPage.goto('/student/join');
   83 |             await studentPage.fill('[data-testid="access-code-input"]', accessCode!);
   84 |             await studentPage.fill('[data-testid="username-input"]', `${testData.username}_student${i + 1}`);
   85 |             await studentPage.click('[data-testid="join-quiz-button"]');
   86 |             await studentSocket.waitForSocketConnection();
   87 |         }
   88 |
   89 |         await expect(teacherPage.locator('[data-testid="participant-count"]')).toContainText(`${numStudents}`);
   90 |
   91 |         // Step 4: Start first question with timer and test pause functionality
   92 |         await teacherPage.click('[data-testid="start-question-button"]');
   93 |
   94 |         // Verify timer appears on all clients
   95 |         await expect(teacherPage.locator('[data-testid="timer-display"]')).toBeVisible();
   96 |         for (const helper of studentHelpers) {
   97 |             await expect(helper.page.locator('[data-testid="timer-display"]')).toBeVisible();
   98 |         }
   99 |
  100 |         // Wait a few seconds, then pause timer
  101 |         await teacherPage.waitForTimeout(3000);
  102 |         const timerBeforePause = await teacherPage.locator('[data-testid="timer-display"]').textContent();
  103 |
  104 |         await teacherPage.click('[data-testid="pause-timer-button"]');
  105 |
  106 |         // Step 5: Verify all student interfaces show paused state
  107 |         await expect(teacherPage.locator('[data-testid="timer-paused-indicator"]')).toBeVisible();
  108 |         for (const helper of studentHelpers) {
  109 |             await expect(helper.page.locator('[data-testid="timer-paused-indicator"]')).toBeVisible();
  110 |             await expect(helper.page.locator('[data-testid="timer-paused-message"]')).toBeVisible();
  111 |         }
  112 |
  113 |         // Verify timer stays paused (doesn't continue counting down)
  114 |         await teacherPage.waitForTimeout(2000);
  115 |         const timerDuringPause = await teacherPage.locator('[data-testid="timer-display"]').textContent();
  116 |         expect(timerDuringPause).toBe(timerBeforePause);
  117 |
  118 |         // Step 6: Resume timer and verify countdown continues
  119 |         await teacherPage.click('[data-testid="resume-timer-button"]');
  120 |
  121 |         // Verify paused indicators disappear
  122 |         await expect(teacherPage.locator('[data-testid="timer-paused-indicator"]')).not.toBeVisible();
  123 |         for (const helper of studentHelpers) {
  124 |             await expect(helper.page.locator('[data-testid="timer-paused-indicator"]')).not.toBeVisible();
  125 |         }
  126 |
  127 |         // Verify timer resumes counting down
  128 |         await teacherPage.waitForTimeout(2000);
  129 |         const timerAfterResume = await teacherPage.locator('[data-testid="timer-display"]').textContent();
  130 |         expect(parseInt(timerAfterResume!)).toBeLessThan(parseInt(timerDuringPause!));
  131 |
  132 |         // Step 7: Test timer extension during active question
  133 |         await teacherPage.click('[data-testid="extend-timer-button"]');
  134 |         await teacherPage.fill('[data-testid="extend-timer-input"]', '15'); // Add 15 seconds
  135 |         await teacherPage.click('[data-testid="confirm-extend-timer"]');
  136 |
  137 |         // Verify timer extension reflects on all clients
  138 |         const extendedTimer = await teacherPage.locator('[data-testid="timer-display"]').textContent();
  139 |         expect(parseInt(extendedTimer!)).toBeGreaterThan(parseInt(timerAfterResume!));
  140 |
  141 |         for (const helper of studentHelpers) {
  142 |             const studentTimer = await helper.page.locator('[data-testid="timer-display"]').textContent();
  143 |             expect(parseInt(studentTimer!)).toBeGreaterThan(parseInt(timerAfterResume!));
  144 |         }
  145 |
  146 |         // Let students answer before moving to next question
  147 |         for (let i = 0; i < studentHelpers.length; i++) {
  148 |             const helper = studentHelpers[i];
  149 |             await helper.page.click('[data-testid="answer-option-0"]');
  150 |             await helper.page.click('[data-testid="submit-answer-button"]');
  151 |         }
```