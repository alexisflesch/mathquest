# Test info

- Name: Practice Session Recovery E2E >> Practice Session: Recovery after page refresh
- Location: /home/aflesch/mathquest/app/tests/e2e/practice-session-recovery.spec.ts:15:9

# Error details

```
TimeoutError: page.waitForURL: Timeout 10000ms exceeded.
=========================== logs ===========================
waiting for navigation to "**/student/create-game?training=true" until "load"
  navigated to "http://localhost:3008/login?returnTo=%2Fstudent%2Fcreate-game%3Ftraining%3Dtrue"
============================================================
    at /home/aflesch/mathquest/app/tests/e2e/practice-session-recovery.spec.ts:86:28
```

# Test source

```ts
   1 | import { test, expect, Page } from '@playwright/test';
   2 |
   3 | test.describe('Practice Session Recovery E2E', () => {
   4 |     let page: Page;
   5 |
   6 |     test.beforeEach(async ({ browser }) => {
   7 |         const context = await browser.newContext();
   8 |         page = await context.newPage();
   9 |     });
   10 |
   11 |     test.afterEach(async () => {
   12 |         await page?.close();
   13 |     });
   14 |
   15 |     test('Practice Session: Recovery after page refresh', async () => {
   16 |         console.log('ðŸ” Starting practice session recovery test...');
   17 |
   18 |         test.setTimeout(60000); // Increase timeout to 60 seconds
   19 |
   20 |         try {
   21 |             // Step 1: Login
   22 |             console.log('ðŸ”‘ Logging in...');
   23 |             await page.goto('/login');
   24 |             await page.waitForLoadState('networkidle');
   25 |             await page.waitForTimeout(2000);
   26 |
   27 |             // Fill username
   28 |             const usernameInput = page.locator('.username-selector input').first();
   29 |             await usernameInput.fill('ALEX');
   30 |             console.log('âœ… Username filled');
   31 |
   32 |             // Close any open dropdown by clicking outside
   33 |             await page.locator('body').click();
   34 |             await page.waitForTimeout(500);
   35 |
   36 |             // Select avatar
   37 |             const avatarButton = page.locator('button').filter({ hasText: 'ðŸ¶' }).first();
   38 |             await avatarButton.click();
   39 |             console.log('âœ… Avatar selected');
   40 |
   41 |             // Submit login
   42 |             const submitButton = page.locator('button[type="submit"]').first();
   43 |             await submitButton.click();
   44 |             console.log('ðŸš€ Login submitted');
   45 |
   46 |             // Wait for redirect to home
   47 |             await page.waitForURL('**/');
   48 |             console.log('âœ… Login successful, on home page');
   49 |
   50 |             // Step 2: Navigate to practice session creation
   51 |             console.log('ðŸŽ¯ Navigating to practice session...');
   52 |             await page.goto('/student/create-game?training=true', { waitUntil: 'networkidle' });
   53 |             console.log('âœ… Navigation to practice page completed');
   54 |
   55 |             const currentUrl = page.url();
   56 |             console.log(`Final URL: ${currentUrl}`);
   57 |
   58 |             // Check if redirected to login - if so, login again
   59 |             if (currentUrl.includes('/login')) {
   60 |                 console.log('ðŸ”„ Redirected to login, re-authenticating...');
   61 |
   62 |                 // Re-do login process
   63 |                 await page.waitForLoadState('networkidle');
   64 |                 await page.waitForTimeout(2000);
   65 |
   66 |                 // Fill username
   67 |                 const usernameInput = page.locator('.username-selector input').first();
   68 |                 await usernameInput.fill('ALEX');
   69 |                 console.log('âœ… Username re-filled');
   70 |
   71 |                 // Close any open dropdown by clicking outside
   72 |                 await page.locator('body').click();
   73 |                 await page.waitForTimeout(500);
   74 |
   75 |                 // Select avatar
   76 |                 const avatarButton = page.locator('button').filter({ hasText: 'ðŸ¶' }).first();
   77 |                 await avatarButton.click();
   78 |                 console.log('âœ… Avatar re-selected');
   79 |
   80 |                 // Submit login
   81 |                 const submitButton = page.locator('button[type="submit"]').first();
   82 |                 await submitButton.click();
   83 |                 console.log('ðŸš€ Login re-submitted');
   84 |
   85 |                 // Wait for redirect
>  86 |                 await page.waitForURL('**/student/create-game?training=true', { timeout: 10000 });
      |                            ^ TimeoutError: page.waitForURL: Timeout 10000ms exceeded.
   87 |                 console.log('âœ… Re-login successful, on practice page');
   88 |             }
   89 |
   90 |             if (currentUrl.includes('create-game') || currentUrl.includes('training') || currentUrl.includes('practice') || currentUrl.includes('/student/create-game?training=true')) {
   91 |                 console.log('âœ… On practice session creation page');
   92 |
   93 |                 // Complete wizard quickly
   94 |                 const niveauButton = page.locator('button').filter({ hasText: 'Niveau' }).first();
   95 |                 await niveauButton.click();
   96 |                 await page.waitForTimeout(500);
   97 |
   98 |                 const gradeOption = page.locator('button.enhanced-single-dropdown-option').filter({ hasText: 'CP' }).first();
   99 |                 await gradeOption.click();
  100 |                 console.log('âœ… Grade level selected (CP)');
  101 |                 await page.waitForTimeout(1000);
  102 |                 console.log('âœ… Grade level selected (CP)');
  103 |                 await page.waitForTimeout(1000);
  104 |
  105 |                 const disciplineButton = page.locator('button').filter({ hasText: 'Discipline' }).first();
  106 |                 await disciplineButton.click();
  107 |                 await page.waitForTimeout(500);
  108 |
  109 |                 const disciplineOption = page.locator('button.enhanced-single-dropdown-option').first();
  110 |                 await disciplineOption.click();
  111 |                 console.log('âœ… Discipline selected');
  112 |                 await page.waitForTimeout(1000);
  113 |
  114 |                 const themeButton = page.locator('button').filter({ hasText: 'ThÃ¨mes' }).first();
  115 |                 await themeButton.click();
  116 |                 await page.waitForTimeout(500);
  117 |
  118 |                 const themeCheckboxes = page.locator('input[type="checkbox"]');
  119 |                 if (await themeCheckboxes.count() > 0) {
  120 |                     await themeCheckboxes.first().check();
  121 |                     console.log('âœ… Theme selected');
  122 |                     await page.waitForTimeout(500);
  123 |
  124 |                     const validateButton = page.locator('button').filter({ hasText: 'Valider' }).first();
  125 |                     await validateButton.click();
  126 |                     console.log('âœ… Themes validated');
  127 |                     await page.waitForTimeout(1000);
  128 |                 }
  129 |
  130 |                 const questionButton = page.locator('button').filter({ hasText: '5' }).first();
  131 |                 await questionButton.click();
  132 |                 console.log('âœ… Question count selected (5)');
  133 |                 await page.waitForTimeout(1000);
  134 |
  135 |                 const startButton = page.locator('button').filter({ hasText: 'DÃ©marrer' }).first();
  136 |                 await startButton.click();
  137 |                 console.log('âœ… Practice session started');
  138 |                 await page.waitForTimeout(2000);
  139 |
  140 |                 const newUrl = page.url();
  141 |                 console.log(`URL after starting session: ${newUrl}`);
  142 |
  143 |                 if (newUrl !== currentUrl) {
  144 |                     console.log('âœ… Navigation occurred - practice session started');
  145 |
  146 |                     // Step 3: Test answer button detection
  147 |                     console.log('â“ Testing answer button detection...');
  148 |                     await page.waitForTimeout(3000);
  149 |
  150 |                     // Try multiple selectors for answer buttons
  151 |                     console.log('ðŸ” Looking for answer buttons...');
  152 |
  153 |                     // Method 1: CSS classes from user's example
  154 |                     const btnAnswer = page.locator('button.btn-answer');
  155 |                     const btnAnswerCount = await btnAnswer.count();
  156 |                     console.log(`Found ${btnAnswerCount} buttons with class 'btn-answer'`);
  157 |
  158 |                     // Method 2: tqcard-answer class
  159 |                     const tqcardAnswer = page.locator('button.tqcard-answer');
  160 |                     const tqcardCount = await tqcardAnswer.count();
  161 |                     console.log(`Found ${tqcardCount} buttons with class 'tqcard-answer'`);
  162 |
  163 |                     // Method 3: Any button with answer-like text
  164 |                     const textAnswers = page.locator('button').filter({ hasText: /.+/ });
  165 |                     const textCount = await textAnswers.count();
  166 |                     console.log(`Found ${textCount} buttons with any text`);
  167 |
  168 |                     // Log details of found buttons
  169 |                     if (textCount > 0) {
  170 |                         console.log('ðŸ“‹ Button details:');
  171 |                         for (let i = 0; i < Math.min(textCount, 5); i++) {
  172 |                             const button = textAnswers.nth(i);
  173 |                             const text = await button.textContent();
  174 |                             const classes = await button.getAttribute('class');
  175 |                             const disabled = await button.getAttribute('aria-disabled');
  176 |                             console.log(`  Button ${i}: "${text}" | class: ${classes} | disabled: ${disabled}`);
  177 |                         }
  178 |                     }
  179 |
  180 |                     // Try to click the first available answer button
  181 |                     let clicked = false;
  182 |                     if (btnAnswerCount > 0) {
  183 |                         console.log('ðŸŽ¯ Clicking first btn-answer button...');
  184 |                         await btnAnswer.first().click();
  185 |                         clicked = true;
  186 |                     } else if (tqcardCount > 0) {
```