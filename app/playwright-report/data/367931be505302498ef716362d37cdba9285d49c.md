# Test info

- Name: projection zoom controls change scale on question container
- Location: /home/aflesch/mathquest/app/tests/e2e/zoom-controls.spec.ts:17:5

# Error details

```
Error: locator.waitFor: Test timeout of 10000ms exceeded.
Call log:
  - waiting for locator('[data-testid="question"], .question, h2, h3').first() to be visible

    at /home/aflesch/mathquest/app/tests/e2e/zoom-controls.spec.ts:63:45
```

# Page snapshot

```yaml
- alert
- button "Open Next.js Dev Tools":
  - img
- complementary:
  - button "RÃ©duire le menu"
  - text: Pierre ðŸ¦¨
  - navigation:
    - link "Accueil":
      - /url: /
    - link "EntraÃ®nement libre":
      - /url: /student/create-game?training=true
    - link "Rejoindre une activitÃ©":
      - /url: /student/join
    - link "CrÃ©er un tournoi":
      - /url: /student/create-game
    - link "Historique":
      - /url: /my-tournaments
    - text: Enseignant
    - link "Mes activitÃ©s":
      - /url: /teacher/games
    - link "CrÃ©er une activitÃ©":
      - /url: /teacher/games/new
    - link "Ã‰diter des questions":
      - /url: /teacher/questions/edit
    - text: Compte
    - link "Mon profil":
      - /url: /profile
  - button "Passer en mode clair": ThÃ¨me systÃ¨me
  - button "DÃ©connexion"
- main:
  - button "-"
  - button "Zoom out 100% Zoom in 4016":
    - button "Zoom out"
    - text: 100%
    - button "Zoom in"
    - text: "4016"
  - button "4016"
  - button "Zoom out 100% Zoom in 4016":
    - button "Zoom out"
    - text: 100%
    - button "Zoom in"
    - text: "4016"
  - status
```

# Test source

```ts
   1 | import { test, expect, Page } from '@playwright/test';
   2 |
   3 | const TEST_CONFIG = {
   4 |     baseUrl: 'http://localhost:3008',
   5 |     backendUrl: 'http://localhost:3007',
   6 | };
   7 |
   8 | async function loginAsTeacher(page: Page) {
   9 |     const res = await page.request.post(`${TEST_CONFIG.backendUrl}/api/v1/auth`, {
  10 |         data: { action: 'login', email: 'test-teacher@test-mathquest.com', password: 'testpassword123' }
  11 |     });
  12 |     expect(res.ok()).toBeTruthy();
  13 |     const body = await res.json();
  14 |     await page.context().addCookies([{ name: 'teacherToken', value: body.token, domain: 'localhost', path: '/' }]);
  15 | }
  16 |
  17 | test('projection zoom controls change scale on question container', async ({ page }) => {
  18 |     await loginAsTeacher(page);
  19 |
  20 |     // Create a small quiz via backend and get an access code using API (same flow as other tests)
  21 |     const questionsRes = await page.request.get(`${TEST_CONFIG.backendUrl}/api/v1/questions/list`, { params: { limit: '3' } });
  22 |     const questionUids = (await questionsRes.json()) || [];
  23 |     if (questionUids.length === 0) throw new Error('No questions available to create test game');
  24 |
  25 |     const templateRes = await page.request.post(`${TEST_CONFIG.backendUrl}/api/v1/game-templates`, {
  26 |         data: {
  27 |             name: `zoom-test-template-${Date.now()}`,
  28 |             discipline: 'MathÃ©matiques',
  29 |             gradeLevel: 'CP',
  30 |             description: 'zoom test',
  31 |             defaultMode: 'quiz',
  32 |             themes: ['Calcul'],
  33 |             questionUids: questionUids.slice(0, 3),
  34 |             questions: questionUids.slice(0, 3).map((uid: string, i: number) => ({ questionUid: uid, sequence: i }))
  35 |         }
  36 |     });
  37 |     const templateData = await templateRes.json();
  38 |     const templateId = templateData.gameTemplate?.id;
  39 |
  40 |     const gameRes = await page.request.post(`${TEST_CONFIG.backendUrl}/api/v1/games`, {
  41 |         data: { gameTemplateId: templateId, name: `zoom-test-game-${Date.now()}`, playMode: 'quiz' }
  42 |     });
  43 |     const gameData = await gameRes.json();
  44 |     const accessCode = gameData.gameInstance?.accessCode || 'TEST';
  45 |
  46 |     // Go to teacher dashboard and start the quiz so projection will receive a question
  47 |     await page.goto(`${TEST_CONFIG.baseUrl}/teacher/dashboard/${accessCode}`);
  48 |     await page.waitForLoadState('networkidle');
  49 |     // Try to find a start button and click it
  50 |     const startBtn = page.locator('button:has-text("DÃ©marrer"), button:has-text("Start"), button[data-testid="start-quiz"]').first();
  51 |     if (await startBtn.count() > 0) {
  52 |         await startBtn.click();
  53 |     }
  54 |     // Give backend/socket a moment to propagate the question to projection
  55 |     await page.waitForTimeout(800);
  56 |
  57 |     // Open projection page
  58 |     await page.goto(`${TEST_CONFIG.baseUrl}/teacher/projection/${accessCode}`);
  59 |     await page.waitForLoadState('networkidle');
  60 |
  61 |     // Wait for projection to show a question (or related heading) after socket join
  62 |     const projectionQuestionLocator = page.locator('[data-testid="question"], .question, h2, h3');
> 63 |     await projectionQuestionLocator.first().waitFor({ state: 'visible', timeout: 8000 });
     |                                             ^ Error: locator.waitFor: Test timeout of 10000ms exceeded.
  64 |
  65 |     // Find zoom controls and the question wrapper element
  66 |     const zoomIn = page.locator('button[aria-label="Zoom in"]').first();
  67 |     const zoomOut = page.locator('button[aria-label="Zoom out"]').first();
  68 |     const questionWrapper = page.locator('div[style*="transform: scale("]').first();
  69 |
  70 |     // Ensure controls exist
  71 |     await expect(zoomIn).toBeVisible({ timeout: 5000 });
  72 |     await expect(zoomOut).toBeVisible({ timeout: 5000 });
  73 |
  74 |     // Read initial scale numeric value
  75 |     const initialStyle = (await questionWrapper.getAttribute('style')) || '';
  76 |     const initialMatch = initialStyle.match(/scale\(([^)]+)\)/);
  77 |     const initialScale = initialMatch ? parseFloat(initialMatch[1]) : 1;
  78 |
  79 |     // Click zoom in and verify numeric scale increased
  80 |     await zoomIn.click();
  81 |     await page.waitForTimeout(300);
  82 |     const afterInStyle = (await questionWrapper.getAttribute('style')) || '';
  83 |     const afterInMatch = afterInStyle.match(/scale\(([^)]+)\)/);
  84 |     const afterInScale = afterInMatch ? parseFloat(afterInMatch[1]) : initialScale;
  85 |     expect(afterInScale).toBeGreaterThan(initialScale);
  86 |
  87 |     // Click zoom out and verify numeric scale decreased back
  88 |     await zoomOut.click();
  89 |     await page.waitForTimeout(300);
  90 |     const afterOutStyle = (await questionWrapper.getAttribute('style')) || '';
  91 |     const afterOutMatch = afterOutStyle.match(/scale\(([^)]+)\)/);
  92 |     const afterOutScale = afterOutMatch ? parseFloat(afterOutMatch[1]) : afterInScale;
  93 |     expect(afterOutScale).toBeLessThan(afterInScale);
  94 | });
  95 |
```