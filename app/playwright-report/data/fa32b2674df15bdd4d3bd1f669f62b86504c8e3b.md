# Test info

- Name: Complete Quiz Flow E2E >> Complete quiz flow: teacher creates quiz → students join → real-time gameplay → results
- Location: /home/aflesch/mathquest/app/tests/e2e/quiz-flow.spec.ts:31:9

# Error details

```
Error: page.click: Target page, context or browser has been closed
Call log:
  - waiting for locator('[data-testid="create-quiz-button"]')

    at /home/aflesch/mathquest/app/tests/e2e/quiz-flow.spec.ts:62:27
```

# Test source

```ts
   1 | import { test, expect, Page } from '@playwright/test';
   2 | import { TestDataHelper, LoginHelper, SocketHelper } from './helpers/test-helpers';
   3 |
   4 | test.describe('Complete Quiz Flow E2E', () => {
   5 |     let teacherPage: Page;
   6 |     let studentPage1: Page;
   7 |     let studentPage2: Page;
   8 |     let testData: any;
   9 |
   10 |     test.beforeAll(async ({ browser }) => {
   11 |         // Create separate browser contexts for teacher and students
   12 |         const teacherContext = await browser.newContext();
   13 |         const studentContext1 = await browser.newContext();
   14 |         const studentContext2 = await browser.newContext();
   15 |
   16 |         teacherPage = await teacherContext.newPage();
   17 |         studentPage1 = await studentContext1.newPage();
   18 |         studentPage2 = await studentContext2.newPage();
   19 |
   20 |         // Generate test data
   21 |         const dataHelper = new TestDataHelper(teacherPage);
   22 |         testData = dataHelper.generateTestData('quiz_e2e');
   23 |     });
   24 |
   25 |     test.afterAll(async () => {
   26 |         await teacherPage?.close();
   27 |         await studentPage1?.close();
   28 |         await studentPage2?.close();
   29 |     });
   30 |
   31 |     test('Complete quiz flow: teacher creates quiz → students join → real-time gameplay → results', async () => {
   32 |         const dataHelper = new TestDataHelper(teacherPage);
   33 |         const teacherLogin = new LoginHelper(teacherPage);
   34 |         const teacherSocket = new SocketHelper(teacherPage);
   35 |
   36 |         // Step 1: Create teacher account and login
   37 |         const teacherData = await dataHelper.createTeacher({
   38 |             username: testData.username,
   39 |             email: testData.email,
   40 |             password: testData.password
   41 |         });
   42 |
   43 |         await teacherLogin.loginAsTeacher({
   44 |             email: testData.email,
   45 |             password: testData.password
   46 |         });
   47 |
   48 |         // Verify teacher login was successful (check for logout button presence)
   49 |         await expect(teacherPage.locator('button:has-text("Déconnexion")')).toBeVisible();
   50 |
   51 |         // Navigate to teacher dashboard and verify it loads
   52 |         await teacherPage.goto('/teacher/home');
   53 |
   54 |         // Wait for page to load and check for teacher dashboard content
   55 |         // Use actual UI elements instead of data-testid attributes
   56 |         await expect(teacherPage.locator('h1, h2, [role="main"]')).toBeVisible({ timeout: 10000 });
   57 |
   58 |         // Verify we're on a teacher page (not the login page anymore)
   59 |         await expect(teacherPage.locator('h1:has-text("Connexion Enseignant")')).not.toBeVisible();
   60 |
   61 |         // Step 2: Teacher creates a quiz with 3 questions
>  62 |         await teacherPage.click('[data-testid="create-quiz-button"]');
      |                           ^ Error: page.click: Target page, context or browser has been closed
   63 |         await teacherPage.fill('[data-testid="quiz-name-input"]', testData.quizName);
   64 |
   65 |         // Add 3 questions (assuming existing question bank)
   66 |         await teacherPage.click('[data-testid="add-question-button"]');
   67 |         await teacherPage.click('[data-testid="question-select-0"]'); // First question
   68 |
   69 |         await teacherPage.click('[data-testid="add-question-button"]');
   70 |         await teacherPage.click('[data-testid="question-select-1"]'); // Second question
   71 |
   72 |         await teacherPage.click('[data-testid="add-question-button"]');
   73 |         await teacherPage.click('[data-testid="question-select-2"]'); // Third question
   74 |
   75 |         await teacherPage.click('[data-testid="create-quiz-confirm"]');
   76 |
   77 |         // Step 3: Teacher starts the quiz and gets access code
   78 |         await teacherPage.click('[data-testid="start-quiz-button"]');
   79 |         await teacherSocket.waitForSocketConnection();
   80 |
   81 |         const accessCode = await teacherPage.locator('[data-testid="access-code"]').textContent();
   82 |         expect(accessCode).toBeTruthy();
   83 |         expect(accessCode).toMatch(/^\d{6}$/); // 6-digit code
   84 |
   85 |         // Step 4: Students join using access code
   86 |         const student1Login = new LoginHelper(studentPage1);
   87 |         const student2Login = new LoginHelper(studentPage2);
   88 |         const student1Socket = new SocketHelper(studentPage1);
   89 |         const student2Socket = new SocketHelper(studentPage2);
   90 |
   91 |         // Student 1 joins
   92 |         await studentPage1.goto('/student/join');
   93 |         await studentPage1.fill('[data-testid="access-code-input"]', accessCode!);
   94 |         await studentPage1.fill('[data-testid="username-input"]', testData.username + '_student1');
   95 |         await studentPage1.click('[data-testid="join-quiz-button"]');
   96 |         await student1Socket.waitForSocketConnection();
   97 |
   98 |         // Student 2 joins
   99 |         await studentPage2.goto('/student/join');
  100 |         await studentPage2.fill('[data-testid="access-code-input"]', accessCode!);
  101 |         await studentPage2.fill('[data-testid="username-input"]', testData.username + '_student2');
  102 |         await studentPage2.click('[data-testid="join-quiz-button"]');
  103 |         await student2Socket.waitForSocketConnection();
  104 |
  105 |         // Step 5: Verify participants list updates
  106 |         await expect(teacherPage.locator('[data-testid="participant-count"]')).toContainText('2');
  107 |         await expect(teacherPage.locator('[data-testid="participant-list"]')).toContainText(testData.username + '_student1');
  108 |         await expect(teacherPage.locator('[data-testid="participant-list"]')).toContainText(testData.username + '_student2');
  109 |
  110 |         // Step 6: Teacher progresses through questions with timer
  111 |         for (let questionIndex = 0; questionIndex < 3; questionIndex++) {
  112 |             // Start question
  113 |             await teacherPage.click('[data-testid="start-question-button"]');
  114 |
  115 |             // Verify timer synchronization across all clients
  116 |             await expect(teacherPage.locator('[data-testid="timer"]')).toBeVisible();
  117 |             await expect(studentPage1.locator('[data-testid="timer"]')).toBeVisible();
  118 |             await expect(studentPage2.locator('[data-testid="timer"]')).toBeVisible();
  119 |
  120 |             // Students submit answers in real-time
  121 |             await studentPage1.click('[data-testid="answer-option-0"]'); // Student 1 answers A
  122 |             await studentPage1.click('[data-testid="submit-answer-button"]');
  123 |
  124 |             await studentPage2.click('[data-testid="answer-option-1"]'); // Student 2 answers B
  125 |             await studentPage2.click('[data-testid="submit-answer-button"]');
  126 |
  127 |             // Verify answer submission indicators
  128 |             await expect(teacherPage.locator('[data-testid="answers-received"]')).toContainText('2/2');
  129 |
  130 |             // Teacher advances to next question or results
  131 |             if (questionIndex < 2) {
  132 |                 await teacherPage.click('[data-testid="next-question-button"]');
  133 |             } else {
  134 |                 await teacherPage.click('[data-testid="show-results-button"]');
  135 |             }
  136 |         }
  137 |
  138 |         // Step 7: Verify final results and leaderboard accuracy
  139 |         await expect(teacherPage.locator('[data-testid="quiz-results"]')).toBeVisible();
  140 |         await expect(studentPage1.locator('[data-testid="quiz-results"]')).toBeVisible();
  141 |         await expect(studentPage2.locator('[data-testid="quiz-results"]')).toBeVisible();
  142 |
  143 |         // Verify leaderboard shows both students
  144 |         const leaderboard = teacherPage.locator('[data-testid="leaderboard"]');
  145 |         await expect(leaderboard).toContainText(testData.username + '_student1');
  146 |         await expect(leaderboard).toContainText(testData.username + '_student2');
  147 |
  148 |         // Verify scores are calculated correctly
  149 |         const student1Score = await studentPage1.locator('[data-testid="final-score"]').textContent();
  150 |         const student2Score = await studentPage2.locator('[data-testid="final-score"]').textContent();
  151 |
  152 |         expect(student1Score).toBeTruthy();
  153 |         expect(student2Score).toBeTruthy();
  154 |         expect(parseInt(student1Score!)).toBeGreaterThanOrEqual(0);
  155 |         expect(parseInt(student2Score!)).toBeGreaterThanOrEqual(0);
  156 |     });
  157 |
  158 |     test('Socket.IO real-time updates work correctly', async () => {
  159 |         // This test specifically focuses on real-time synchronization
  160 |         // Will be implemented as part of the main test above
  161 |     });
  162 |
```