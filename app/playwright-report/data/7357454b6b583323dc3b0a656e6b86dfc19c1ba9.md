# Test info

- Name: Late-Joiners E2E >> Late-joiners: Different scenarios for joining after session starts
- Location: /home/aflesch/mathquest/app/tests/e2e/late-joiners.spec.ts:41:9

# Error details

```
Error: page.goto: Target page, context or browser has been closed
Call log:
  - navigating to "http://localhost:3008/teacher/quiz/create", waiting until "load"

    at /home/aflesch/mathquest/app/tests/e2e/late-joiners.spec.ts:61:27
```

# Test source

```ts
   1 | import { test, expect, Page } from '@playwright/test';
   2 | import { TestDataHelper, LoginHelper, SocketHelper } from './helpers/test-helpers';
   3 |
   4 | test.describe('Late-Joiners E2E', () => {
   5 |     let teacherPage: Page;
   6 |     let initialStudentPages: Page[] = [];
   7 |     let lateJoinerPages: Page[] = [];
   8 |     let testData: any;
   9 |
   10 |     test.beforeAll(async ({ browser }) => {
   11 |         // Create separate browser contexts
   12 |         const teacherContext = await browser.newContext();
   13 |         teacherPage = await teacherContext.newPage();
   14 |
   15 |         // Create pages for initial students (on-time joiners)
   16 |         for (let i = 0; i < 2; i++) {
   17 |             const studentContext = await browser.newContext();
   18 |             const studentPage = await studentContext.newPage();
   19 |             initialStudentPages.push(studentPage);
   20 |         }
   21 |
   22 |         // Create pages for late joiners
   23 |         for (let i = 0; i < 3; i++) {
   24 |             const studentContext = await browser.newContext();
   25 |             const studentPage = await studentContext.newPage();
   26 |             lateJoinerPages.push(studentPage);
   27 |         }
   28 |
   29 |         // Generate test data
   30 |         const dataHelper = new TestDataHelper(teacherPage);
   31 |         testData = dataHelper.generateTestData('late_joiners_e2e');
   32 |     });
   33 |
   34 |     test.afterAll(async () => {
   35 |         await teacherPage?.close();
   36 |         for (const page of [...initialStudentPages, ...lateJoinerPages]) {
   37 |             await page?.close();
   38 |         }
   39 |     });
   40 |
   41 |     test('Late-joiners: Different scenarios for joining after session starts', async () => {
   42 |         const dataHelper = new TestDataHelper(teacherPage);
   43 |         const teacherLogin = new LoginHelper(teacherPage);
   44 |         const teacherSocket = new SocketHelper(teacherPage);
   45 |
   46 |         // Step 1: Create teacher account and login
   47 |         await dataHelper.createTeacher({
   48 |             username: testData.username,
   49 |             email: testData.email,
   50 |             password: testData.password
   51 |         });
   52 |
   53 |         await teacherLogin.loginAsTeacher({
   54 |             email: testData.email,
   55 |             password: testData.password
   56 |         });
   57 |
   58 |         await expect(teacherPage).toHaveURL('/');
   59 |
   60 |         // Step 2: Navigate to quiz creation page and create quiz
>  61 |         await teacherPage.goto('/teacher/quiz/create');
      |                           ^ Error: page.goto: Target page, context or browser has been closed
   62 |         await teacherPage.click('[data-testid="create-quiz-button"]');
   63 |         await teacherPage.fill('[data-testid="quiz-name-input"]', testData.quizName);
   64 |
   65 |         // Add 4 questions for testing different late-join scenarios
   66 |         for (let i = 0; i < 4; i++) {
   67 |             await teacherPage.click('[data-testid="add-question-button"]');
   68 |             await teacherPage.click(`[data-testid="question-select-${i}"]`);
   69 |         }
   70 |
   71 |         await teacherPage.click('[data-testid="create-quiz-confirm"]');
   72 |         await teacherPage.click('[data-testid="start-quiz-button"]');
   73 |         await teacherSocket.waitForSocketConnection();
   74 |
   75 |         const accessCode = await teacherPage.locator('[data-testid="access-code"]').textContent();
   76 |         expect(accessCode).toBeTruthy();
   77 |
   78 |         // Step 3: Initial students join on time using current join flow
   79 |         const initialHelpers: Array<{ page: Page, socket: SocketHelper }> = [];
   80 |         for (let i = 0; i < initialStudentPages.length; i++) {
   81 |             const studentPage = initialStudentPages[i];
   82 |             const studentSocket = new SocketHelper(studentPage);
   83 |
   84 |             initialHelpers.push({ page: studentPage, socket: studentSocket });
   85 |
   86 |             // Use the current join flow via main page
   87 |             await studentPage.goto('/');
   88 |             await studentPage.click('[data-testid="join-game-button"]');
   89 |             await studentPage.fill('[data-testid="access-code-input"]', accessCode!);
   90 |             await studentPage.fill('[data-testid="username-input"]', `${testData.username}_initial_${i + 1}`);
   91 |             await studentPage.click('[data-testid="join-button"]');
   92 |             await studentSocket.waitForSocketConnection();
   93 |         }
   94 |
   95 |         // Verify initial participants
   96 |         await expect(teacherPage.locator('[data-testid="participant-count"]')).toContainText('2');
   97 |
   98 |         // Step 4: Progress through 1-2 questions with initial participants
   99 |         // Question 1
  100 |         await teacherPage.click('[data-testid="start-question-button"]');
  101 |
  102 |         // Initial students answer
  103 |         for (let i = 0; i < initialHelpers.length; i++) {
  104 |             const helper = initialHelpers[i];
  105 |             await helper.page.click('[data-testid="answer-option-0"]');
  106 |             await helper.page.click('[data-testid="submit-answer-button"]');
  107 |         }
  108 |
  109 |         await teacherPage.click('[data-testid="next-question-button"]');
  110 |
  111 |         // Question 2
  112 |         await teacherPage.click('[data-testid="start-question-button"]');
  113 |
  114 |         // Initial students answer
  115 |         for (let i = 0; i < initialHelpers.length; i++) {
  116 |             const helper = initialHelpers[i];
  117 |             await helper.page.click('[data-testid="answer-option-1"]');
  118 |             await helper.page.click('[data-testid="submit-answer-button"]');
  119 |         }
  120 |
  121 |         // Step 5: Test late-joiner scenario 1 - Early in session (should be allowed)
  122 |         const earlyLateJoiner = lateJoinerPages[0];
  123 |         const earlyLateSocket = new SocketHelper(earlyLateJoiner);
  124 |
  125 |         await earlyLateJoiner.goto('/');
  126 |         await earlyLateJoiner.click('[data-testid="join-game-button"]');
  127 |         await earlyLateJoiner.fill('[data-testid="access-code-input"]', accessCode!);
  128 |         await earlyLateJoiner.fill('[data-testid="username-input"]', `${testData.username}_early_late`);
  129 |         await earlyLateJoiner.click('[data-testid="join-button"]');
  130 |
  131 |         // Check if early late-joiner is allowed or blocked based on settings
  132 |         try {
  133 |             await earlyLateSocket.waitForSocketConnection();
  134 |             // If allowed, verify they join mid-session
  135 |             await expect(earlyLateJoiner.locator('[data-testid="joined-mid-session"]')).toBeVisible();
  136 |             await expect(teacherPage.locator('[data-testid="participant-count"]')).toContainText('3');
  137 |             console.log('✅ Early late-joiner allowed to join mid-session');
  138 |         } catch (error) {
  139 |             // If blocked, verify appropriate messaging
  140 |             await expect(earlyLateJoiner.locator('[data-testid="late-join-blocked"]')).toBeVisible();
  141 |             await expect(earlyLateJoiner.locator('[data-testid="session-already-started-message"]')).toBeVisible();
  142 |             console.log('✅ Early late-joiner appropriately blocked');
  143 |         }
  144 |
  145 |         // Continue to next question for more late-join testing
  146 |         await teacherPage.click('[data-testid="next-question-button"]');
  147 |
  148 |         // Step 6: Test late-joiner scenario 2 - Late in session (should likely be blocked)
  149 |         const lateLateJoiner = lateJoinerPages[1];
  150 |
  151 |         await lateLateJoiner.goto('/');
  152 |         await lateLateJoiner.click('[data-testid="join-game-button"]');
  153 |         await lateLateJoiner.fill('[data-testid="access-code-input"]', accessCode!);
  154 |         await lateLateJoiner.fill('[data-testid="username-input"]', `${testData.username}_very_late`);
  155 |         await lateLateJoiner.click('[data-testid="join-button"]');
  156 |
  157 |         // Very late joiners should typically be blocked
  158 |         await expect(lateLateJoiner.locator('[data-testid="late-join-blocked"]')).toBeVisible();
  159 |         await expect(lateLateJoiner.locator('[data-testid="session-too-far-advanced-message"]')).toBeVisible();
  160 |
  161 |         // Step 7: Test access code validity for late-joiners
```