# Test info

- Name: Quiz Teacher Controls & Real-time Features >> teacher controls affect student quiz interaction
- Location: /home/aflesch/mathquest/app/tests/e2e/suites/teacher-controls.spec.ts:283:9

# Error details

```
Error: page.waitForURL: Target page, context or browser has been closed
=========================== logs ===========================
waiting for navigation to "http://localhost:3008/live/3824" until "load"
============================================================
    at /home/aflesch/mathquest/app/tests/e2e/suites/teacher-controls.spec.ts:320:27
```

# Test source

```ts
  220 |
  221 |     const templateData = await templateResponse.json();
  222 |     const templateId = templateData.gameTemplate?.id;
  223 |     log(`Template created: ${templateId}`);
  224 |
  225 |     // Create game instance
  226 |     const gameResponse = await page.request.post(`${TEST_CONFIG.backendUrl}/api/v1/games`, {
  227 |         data: {
  228 |             gameTemplateId: templateId,
  229 |             name: `Test Quiz Game ${Date.now()}`,
  230 |             playMode: 'quiz',
  231 |             settings: {
  232 |                 avatar: 'üë®‚Äçüè´',
  233 |                 username: 'Pierre',
  234 |                 defaultMode: 'direct'
  235 |             }
  236 |         }
  237 |     });
  238 |
  239 |     if (!gameResponse.ok()) {
  240 |         const errorText = await gameResponse.text();
  241 |         throw new Error(`Failed to create game: ${gameResponse.status()} - ${errorText}`);
  242 |     }
  243 |
  244 |     const gameData = await gameResponse.json();
  245 |     const accessCode = gameData.gameInstance?.accessCode;
  246 |     log(`Game created with access code: ${accessCode}`);
  247 |
  248 |     return accessCode;
  249 | }
  250 |
  251 | test.describe('Quiz Teacher Controls & Real-time Features', () => {
  252 |     let teacherPage: Page;
  253 |     let studentPage: Page;
  254 |     let projectionPage: Page;
  255 |     let browser: Browser;
  256 |
  257 |     test.beforeAll(async ({ browser: b }) => {
  258 |         browser = b;
  259 |
  260 |         // Create separate browser contexts for isolation
  261 |         const teacherContext = await browser.newContext();
  262 |         const studentContext = await browser.newContext();
  263 |         const projectionContext = await browser.newContext();
  264 |
  265 |         teacherPage = await teacherContext.newPage();
  266 |         studentPage = await studentContext.newPage();
  267 |         projectionPage = await projectionContext.newPage();
  268 |     });
  269 |
  270 |     test.afterAll(async () => {
  271 |         await teacherPage?.close();
  272 |         await studentPage?.close();
  273 |         await projectionPage?.close();
  274 |     });
  275 |
  276 |     test('simple guest authentication test', async () => {
  277 |         log('Testing simple guest authentication...');
  278 |
  279 |         await authenticateGuestUser(teacherPage, 'Pierre');
  280 |         log('‚úÖ Simple guest authentication works!');
  281 |     });
  282 |
  283 |     test('teacher controls affect student quiz interaction', async () => {
  284 |         // Ensure test teacher account exists
  285 |         await ensureTestTeacherAccount(teacherPage);
  286 |
  287 |         // Create quiz via API (includes authentication)
  288 |         const accessCode = await createQuizViaAPI(teacherPage);
  289 |         log(`Quiz created with access code: ${accessCode}`);
  290 |
  291 |         // Navigate to teacher dashboard
  292 |         await teacherPage.goto(`${TEST_CONFIG.baseUrl}/teacher/dashboard/${accessCode}`);
  293 |         await teacherPage.waitForLoadState('networkidle');
  294 |
  295 |         // Verify dashboard shows the quiz
  296 |         const dashboardTitle = await teacherPage.locator('h1').first().textContent();
  297 |         const questionCount = await teacherPage.locator('[data-testid="question"], .question-display, .sortable-question').count();
  298 |         log(`Dashboard title: ${dashboardTitle}`);
  299 |         log(`Number of questions visible: ${questionCount}`);
  300 |
  301 |         if (questionCount === 0) {
  302 |             log('‚ùå No questions found on dashboard, checking for error messages...');
  303 |             const errorMessages = await teacherPage.locator('.error, .alert, [class*="error"]').allTextContents();
  304 |             log(`Error messages: ${JSON.stringify(errorMessages)}`);
  305 |
  306 |             // Check if there's a "no questions" message
  307 |             const noQuestionsMessage = await teacherPage.locator('text=/no questions|aucune question|pas de questions/i').textContent();
  308 |             log(`No questions message: ${noQuestionsMessage}`);
  309 |
  310 |             throw new Error('No questions loaded on teacher dashboard');
  311 |         }
  312 |
  313 |         // Student joins the quiz
  314 |         await authenticateGuestUser(studentPage, 'Marie');
  315 |         await studentPage.goto(`${TEST_CONFIG.baseUrl}/student/join`);
  316 |         await studentPage.locator('input[type="tel"]').fill(accessCode);
  317 |         await studentPage.locator('button:has-text("Rejoindre")').click();
  318 |
  319 |         // Wait for redirect to live page
> 320 |         await studentPage.waitForURL(`${TEST_CONFIG.baseUrl}/live/${accessCode}`, { timeout: 10000 });
      |                           ^ Error: page.waitForURL: Target page, context or browser has been closed
  321 |         log('‚úÖ Student redirected to live page');
  322 |
  323 |         await studentPage.waitForTimeout(1000); // Wait for socket connection
  324 |
  325 |         // Projection page - authenticate as teacher
  326 |         await authenticateAsTeacher(projectionPage);
  327 |         await projectionPage.goto(`${TEST_CONFIG.baseUrl}/teacher/projection/${accessCode}`);
  328 |         await projectionPage.waitForLoadState('networkidle');
  329 |         await projectionPage.waitForTimeout(1000); // Wait for socket connection
  330 |
  331 |         log('‚úÖ All participants ready - teacher on dashboard, student joined, projection loaded');
  332 |
  333 |         // Test 1: Initially, students should not see questions (quiz not started)
  334 |         const initialStudentQuestion = await studentPage.locator('[data-testid="question"], .question, h2, h3').count();
  335 |         const initialProjectionQuestion = await projectionPage.locator('[data-testid="question"], .question, h2, h3').count();
  336 |         log(`Initial state - Student questions: ${initialStudentQuestion}, Projection questions: ${initialProjectionQuestion}`);
  337 |
  338 |         // Test 2: Look for play controls without selecting questions first
  339 |         log('Looking for play/pause controls...');
  340 |
  341 |         // Check what buttons are available on the dashboard
  342 |         const allButtons = await teacherPage.locator('button').allTextContents();
  343 |         log(`Available buttons: ${JSON.stringify(allButtons.slice(0, 15))}`); // Show first 15 buttons
  344 |
  345 |         // Look for play/pause/stop buttons with various selectors
  346 |         const playButtonSelectors = [
  347 |             'button[data-play-pause-btn]',
  348 |             'button:has-text("Play")',
  349 |             'button:has-text("‚ñ∂Ô∏è")',
  350 |             'button:has-text("Start")',
  351 |             'button.play-btn',
  352 |             '.play-button button'
  353 |         ];
  354 |
  355 |         let playButton;
  356 |         for (const selector of playButtonSelectors) {
  357 |             const buttons = teacherPage.locator(selector);
  358 |             const count = await buttons.count();
  359 |             log(`Found ${count} buttons with selector: ${selector}`);
  360 |             if (count > 0) {
  361 |                 playButton = buttons.first();
  362 |                 log(`Using first play button with selector: ${selector}`);
  363 |                 break;
  364 |             }
  365 |         }
  366 |
  367 |         if (playButton && await playButton.isVisible({ timeout: 2000 })) {
  368 |             await playButton.click();
  369 |             log('‚úÖ Teacher clicked play button on selected question');
  370 |
  371 |             await teacherPage.waitForTimeout(1000); // Brief wait after play button click
  372 |
  373 |             // Check if question appears for student and projection
  374 |             const studentQuestionAfterStart = await studentPage.locator('[data-testid="question"], .question, h2, h3').count();
  375 |             const projectionQuestionAfterStart = await projectionPage.locator('[data-testid="question"], .question, h2, h3').count();
  376 |
  377 |             log(`After start - Student questions: ${studentQuestionAfterStart}, Projection questions: ${projectionQuestionAfterStart}`);
  378 |
  379 |             if (studentQuestionAfterStart > initialStudentQuestion) {
  380 |                 log('‚úÖ Question visible to students after teacher starts timer');
  381 |             } else {
  382 |                 log('‚ùå Student still cannot see question after teacher starts quiz');
  383 |             }
  384 |
  385 |             // Test 3: Teacher pauses the question
  386 |             const pauseButton = teacherPage.locator('button[data-play-pause-btn]').first();
  387 |             if (await pauseButton.isVisible({ timeout: 5000 })) {
  388 |                 await pauseButton.click();
  389 |                 log('‚úÖ Teacher clicked pause button');
  390 |
  391 |                 await teacherPage.waitForTimeout(2000);
  392 |
  393 |                 // Check if student can still answer (they should be able to during pause)
  394 |                 const answerButtonsDuringPause = studentPage.locator('button:has-text("A"), button:has-text("B"), button:has-text("C"), button:has-text("D"), button:has-text("1"), button:has-text("2"), button:has-text("3"), .answer-choice, [data-testid="answer"]');
  395 |                 const canAnswerDuringPause = await answerButtonsDuringPause.count() > 0;
  396 |                 log(`Student can answer during pause: ${canAnswerDuringPause}`);
  397 |
  398 |                 if (canAnswerDuringPause) {
  399 |                     // Try to click an answer during pause
  400 |                     const firstAnswerDuringPause = answerButtonsDuringPause.first();
  401 |                     await firstAnswerDuringPause.click();
  402 |                     log('‚úÖ Student clicked answer during pause');
  403 |
  404 |                     // Check for feedback/snackbar
  405 |                     try {
  406 |                         await studentPage.waitForSelector('.snackbar, .toast, .notification, [data-testid="feedback-snackbar"]', { timeout: 3000 });
  407 |                         log('‚úÖ Feedback appeared after answering during pause');
  408 |                     } catch {
  409 |                         log('‚ö†Ô∏è No feedback detected after answering during pause');
  410 |                     }
  411 |                 }
  412 |             }
  413 |         }
  414 |
  415 |         // Test 4: Projection page leaderboard functionality
  416 |         log('Testing projection page leaderboard...');
  417 |
  418 |         // Look for trophy/leaderboard button on projection page
  419 |         const trophyButtonSelectors = [
  420 |             'button:has-text("üèÜ")',
```