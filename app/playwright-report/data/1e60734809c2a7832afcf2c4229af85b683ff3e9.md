# Test info

- Name: Tournament Full Flow E2E >> should handle tournament with specific debugging
- Location: /home/aflesch/mathquest/app/tests/e2e/tournament-full-flow-clean.spec.ts:348:9

# Error details

```
Error: Failed to start tournament: page.waitForSelector: Timeout 15000ms exceeded.
Call log:
  - waiting for locator('[data-testid="question-text"], .question-text, .question') to be visible

    at startTournament (/home/aflesch/mathquest/app/tests/e2e/tournament-full-flow-clean.spec.ts:213:15)
    at /home/aflesch/mathquest/app/tests/e2e/tournament-full-flow-clean.spec.ts:376:13
```

# Page snapshot

```yaml
- alert
- button "Open Next.js Dev Tools":
  - img
- complementary:
  - button "R√©duire le menu"
  - text: Pierre üê®
  - navigation:
    - link "Accueil":
      - /url: /
    - link "Entra√Ænement libre":
      - /url: /student/create-game?training=true
    - link "Rejoindre une activit√©":
      - /url: /student/join
    - link "Cr√©er un tournoi":
      - /url: /student/create-game
    - link "Historique":
      - /url: /my-tournaments
    - link "Profil invit√©":
      - /url: /profile
  - button "Passer en mode clair": Th√®me syst√®me
  - button "D√©connexion"
- main:
  - text: üê® Pierre
  - button "Partager"
  - button "QR Code"
  - separator
  - text: Participants connect√©s üê® Pierre
  - button "D√©marrer"
```

# Test source

```ts
  113 |             try {
  114 |                 const result = await fetch('/api/games', {
  115 |                     method: 'POST',
  116 |                     headers: {
  117 |                         'Content-Type': 'application/json'
  118 |                     },
  119 |                     body: JSON.stringify(data),
  120 |                     credentials: 'include'
  121 |                 });
  122 |                 if (!result.ok) {
  123 |                     const errorText = await result.text();
  124 |                     throw new Error(`${result.status} - ${errorText}`);
  125 |                 }
  126 |                 const jsonData = await result.json();
  127 |                 return { success: true, data: jsonData };
  128 |             } catch (error: any) {
  129 |                 return { success: false, error: error.message };
  130 |             }
  131 |         }, {
  132 |             name: TEST_CONFIG.user.username,
  133 |             playMode: 'tournament',
  134 |             gradeLevel: TEST_CONFIG.tournament.gradeLevel,
  135 |             discipline: TEST_CONFIG.tournament.discipline,
  136 |             themes: TEST_CONFIG.tournament.themes,
  137 |             nbOfQuestions: 2,
  138 |             settings: {
  139 |                 defaultMode: 'direct',
  140 |                 avatar: TEST_CONFIG.user.avatar,
  141 |                 username: TEST_CONFIG.user.username
  142 |             }
  143 |         });
  144 |
  145 |         if (!response.success) {
  146 |             throw new Error(`Failed to create tournament: ${response.error}`);
  147 |         }
  148 |
  149 |         const tournamentData = response.data;
  150 |         log('Tournament created successfully', tournamentData);
  151 |
  152 |         return {
  153 |             accessCode: tournamentData.gameInstance.accessCode || tournamentData.gameInstance.code,
  154 |             tournamentId: tournamentData.gameInstance.id
  155 |         };
  156 |
  157 |     } catch (error: unknown) {
  158 |         log('Tournament creation error', { error: error instanceof Error ? error.message : String(error) });
  159 |         throw new Error(`Tournament creation failed: ${error instanceof Error ? error.message : String(error)}`);
  160 |     }
  161 | }
  162 |
  163 | // Helper to start tournament and verify all key elements
  164 | async function startTournament(page: Page, accessCode: string): Promise<void> {
  165 |     log('Starting tournament...');
  166 |
  167 |     try {
  168 |         // Navigate to live page (not lobby - lobby is part of live page)
  169 |         await page.goto(`${TEST_CONFIG.baseUrl}/live/${accessCode}`);
  170 |
  171 |         // Wait for socket connection and game join to complete
  172 |         log('Waiting for socket connection and game join...');
  173 |         await page.waitForTimeout(5000); // Give time for socket to connect and joinGame to execute
  174 |
  175 |         // Wait for lobby to load
  176 |         await page.waitForSelector('text=Participants connect√©s', { timeout: 10000 });
  177 |         log('Lobby loaded successfully');
  178 |
  179 |         // Look for start button and click it
  180 |         const startButton = page.locator('button:has-text("D√©marrer le tournoi")');
  181 |
  182 |         if (await startButton.count() > 0) {
  183 |             await startButton.click();
  184 |             log('Clicked "D√©marrer le tournoi" button');
  185 |
  186 |             // Wait for 5-second countdown
  187 |             log('Waiting for 5-second countdown...');
  188 |             try {
  189 |                 await page.waitForSelector('text=/^[1-5]$/', { timeout: 8000 });
  190 |                 log('Countdown started - waiting for tournament to begin');
  191 |
  192 |                 // Wait for countdown to finish
  193 |                 await page.waitForTimeout(6000);
  194 |             } catch {
  195 |                 log('No countdown detected, tournament may start immediately');
  196 |             }
  197 |         } else {
  198 |             log('No start button found, checking if tournament already started');
  199 |         }
  200 |
  201 |         // Wait for redirect to live page
  202 |         await page.waitForURL(`**/live/${accessCode}`, { timeout: 10000 });
  203 |         log('Redirected to live tournament page');
  204 |
  205 |         // Wait for question to appear
  206 |         await page.waitForSelector('[data-testid="question-text"], .question-text, .question', { timeout: 15000 });
  207 |         log('First question loaded');
  208 |
  209 |         log('Tournament started successfully');
  210 |
  211 |     } catch (error: any) {
  212 |         log('Failed to start tournament', { error: error.message });
> 213 |         throw new Error(`Failed to start tournament: ${error.message}`);
      |               ^ Error: Failed to start tournament: page.waitForSelector: Timeout 15000ms exceeded.
  214 |     }
  215 | }
  216 |
  217 | // Helper to test complete tournament flow with all key elements
  218 | async function testCompleteTournamentFlow(page: Page): Promise<void> {
  219 |     log('Testing complete tournament flow...');
  220 |
  221 |     try {
  222 |         // 1. Verify timer is showing and counting down
  223 |         log('1. Checking timer countdown...');
  224 |         const timerElement = page.locator('[data-testid="timer"], .timer, .countdown, text=/^[0-9]+$/').first();
  225 |
  226 |         if (await timerElement.count() > 0) {
  227 |             const initialTime = await timerElement.textContent();
  228 |             log(`Initial timer value: ${initialTime}`);
  229 |
  230 |             // Wait 2 seconds and check if timer decreased
  231 |             await page.waitForTimeout(2000);
  232 |             const laterTime = await timerElement.textContent();
  233 |             log(`Timer after 2s: ${laterTime}`);
  234 |
  235 |             if (initialTime !== laterTime) {
  236 |                 log('‚úÖ Timer is counting down correctly');
  237 |             } else {
  238 |                 log('‚ö†Ô∏è  Timer may not be running');
  239 |             }
  240 |         } else {
  241 |             log('‚ö†Ô∏è  No timer found');
  242 |         }
  243 |
  244 |         // 2. Try to click an answer and check for snackbar feedback
  245 |         log('2. Testing answer selection and snackbar feedback...');
  246 |         const answerButtons = page.locator('button:has-text(/[A-D]|[0-9]/), .answer-choice, [data-testid="answer"]');
  247 |
  248 |         if (await answerButtons.count() > 0) {
  249 |             const firstAnswer = answerButtons.first();
  250 |             await firstAnswer.click();
  251 |             log('Clicked on first answer choice');
  252 |
  253 |             // Look for snackbar/toast feedback from backend
  254 |             try {
  255 |                 await page.waitForSelector('.snackbar, .toast, .notification, [data-testid="feedback-snackbar"]', { timeout: 3000 });
  256 |                 log('‚úÖ Snackbar feedback appeared after answer click');
  257 |             } catch {
  258 |                 log('‚ö†Ô∏è  No snackbar feedback detected');
  259 |             }
  260 |         } else {
  261 |             log('‚ö†Ô∏è  No answer choices found');
  262 |         }
  263 |
  264 |         // 3. Wait for timer to run out and check for correct answers display
  265 |         log('3. Waiting for timer to finish and checking correct answers...');
  266 |
  267 |         try {
  268 |             await page.waitForSelector('text=/Bonne r√©ponse|Correct answer|Solution/', { timeout: 30000 });
  269 |             log('‚úÖ Correct answers are being shown');
  270 |         } catch {
  271 |             log('‚ö†Ô∏è  Correct answers display not detected');
  272 |         }
  273 |
  274 |         // 4. Check for feedback display (1.5s after correct answers)
  275 |         log('4. Checking for feedback display...');
  276 |
  277 |         try {
  278 |             await page.waitForSelector('.feedback, [data-testid="feedback"], text=/Bravo|Bien jou√©|Correct|Incorrect/', { timeout: 5000 });
  279 |             log('‚úÖ Feedback is being displayed');
  280 |         } catch {
  281 |             log('‚ö†Ô∏è  Feedback display not detected');
  282 |         }
  283 |
  284 |         // 5. Wait for next question or end of tournament
  285 |         log('5. Waiting for next question or tournament end...');
  286 |
  287 |         try {
  288 |             // Either next question appears or we go to leaderboard
  289 |             await Promise.race([
  290 |                 page.waitForSelector('[data-testid="question-text"], .question-text, text=/Question/', { timeout: 10000 }),
  291 |                 page.waitForURL('**/leaderboard/**', { timeout: 10000 })
  292 |             ]);
  293 |
  294 |             if (page.url().includes('/leaderboard/')) {
  295 |                 log('‚úÖ Tournament ended - redirected to leaderboard');
  296 |             } else {
  297 |                 log('‚úÖ Next question loaded');
  298 |             }
  299 |         } catch {
  300 |             log('‚ö†Ô∏è  Next question or leaderboard transition not detected');
  301 |         }
  302 |
  303 |     } catch (error: any) {
  304 |         log('Error during tournament flow test', { error: error.message });
  305 |         throw error;
  306 |     }
  307 | }
  308 |
  309 | // Main test suite
  310 | test.describe('Tournament Full Flow E2E', () => {
  311 |     test.setTimeout(120000); // 2 minutes timeout
  312 |
  313 |     test('should complete full tournament flow with feedback and leaderboard', async ({ page, context }) => {
```