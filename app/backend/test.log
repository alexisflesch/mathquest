
> backend@1.0.0 test
> jest

Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma

‚úî Generated Prisma Client (v6.7.0) to ./src/db/generated/client in 86ms

Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)

Tip: Need your database queries to be 1000x faster? Accelerate offers you that and more: https://pris.ly/tip-2-accelerate

Test setup complete, using port 7175
Database URL: postgresql://postgre:Phuf0pohooFee8auohFahk7vChae4Iv0wiem5voT@localhost:5432/mathquest_test
Redis URL: redis://localhost:6379
Cleaning test database...
Database cleaned successfully
Inserted default test questions.
Seeded integration teacher, template, questions, and game instance.
PASS tests/integration/tournament2.test.ts (47.759 s)
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-09 20:45:19.395] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:19.406] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:19.548] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "playMode": "tournament",
          "gameTemplateId": "3c6b5bff-e73a-4af1-b812-446719d6a4fb",
          "discipline": "math",
          "nbOfQuestions": 1
        },
        "keys": [
          "name",
          "playMode",
          "gameTemplateId",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
          "username": "p1-extended",
          "role": "STUDENT",
          "iat": 1749494719,
          "exp": 1749498319
        },
        "headers": {
          "host": "localhost:40521",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJiMzk0NjU4ZS0yYTM1LTQ1NjktYTBiOC02YzIwYjY1NGEzZDMiLCJ1c2VybmFtZSI6InAxLWV4dGVuZGVkIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk0OTQ3MTksImV4cCI6MTc0OTQ5ODMxOX0.A2lz0MdWZ4BLvupOr1_cxjUdqhvQBVgNpSOPOcmJ06g",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:19.554] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "3c6b5bff-e73a-4af1-b812-446719d6a4fb",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:19.569] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "4088130c-3fe1-42a2-89b8-0453f8e038f3",
        "accessCode": "E3PUSE"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'ACVRpm46f6-tVpYKAAAC',
        finalUserId: 'b394658e-2a35-4569-a0b8-6c20b654a3d3',
        setUserId: 'b394658e-2a35-4569-a0b8-6c20b654a3d3',
        setUserData: {
          userId: 'b394658e-2a35-4569-a0b8-6c20b654a3d3',
          username: 'p1-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-09 20:45:19.733] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "ACVRpm46f6-tVpYKAAAC",
        "user": {
          "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.127] [32mINFO [0m [GameHandlers] {
        "socketId": "ACVRpm46f6-tVpYKAAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.128] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "ACVRpm46f6-tVpYKAAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.131] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ACVRpm46f6-tVpYKAAAC"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: ACVRpm46f6-tVpYKAAAC

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:45:20.131] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "ACVRpm46f6-tVpYKAAAC"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.132] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.132] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.132] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.132] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.133] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.133] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.133] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.133] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.133] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ACVRpm46f6-tVpYKAAAC"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'wVTdz5X7xA49brLIAAAD',
        finalUserId: 'ca8d258d-8e42-486c-9d5a-0588d21bf5fe',
        setUserId: 'ca8d258d-8e42-486c-9d5a-0588d21bf5fe',
        setUserData: {
          userId: 'ca8d258d-8e42-486c-9d5a-0588d21bf5fe',
          username: 'p2-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-09 20:45:20.141] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "wVTdz5X7xA49brLIAAAD",
        "user": {
          "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.141] [32mINFO [0m [GameHandlers] {
        "socketId": "wVTdz5X7xA49brLIAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.141] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "wVTdz5X7xA49brLIAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.142] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "wVTdz5X7xA49brLIAAAD"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: wVTdz5X7xA49brLIAAAD

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:45:20.142] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "wVTdz5X7xA49brLIAAAD"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.142] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.142] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.142] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.142] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.142] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.142] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.143] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.143] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.143] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "wVTdz5X7xA49brLIAAAD"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.145] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_E3PUSE",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.149] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_E3PUSE",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.149] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_E3PUSE",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.149] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_E3PUSE",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.150] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_E3PUSE",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.150] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_E3PUSE",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.150] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_E3PUSE",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.151] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_E3PUSE",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.152] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_E3PUSE",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4088130c-3fe1-42a2-89b8-0453f8e038f3",
          "accessCode": "E3PUSE",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.154] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_E3PUSE",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4088130c-3fe1-42a2-89b8-0453f8e038f3",
          "accessCode": "E3PUSE",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.154] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_E3PUSE",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4088130c-3fe1-42a2-89b8-0453f8e038f3",
          "accessCode": "E3PUSE",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.155] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_E3PUSE",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4088130c-3fe1-42a2-89b8-0453f8e038f3",
          "accessCode": "E3PUSE",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.158] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.158] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.158] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.158] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.176] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "4088130c-3fe1-42a2-89b8-0453f8e038f3",
        "templateId": "3c6b5bff-e73a-4af1-b812-446719d6a4fb",
        "initiator": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "E3PUSE",
        "socketId": "ACVRpm46f6-tVpYKAAAC"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.381] [32mINFO [0m [GameStateService] {
        "accessCode": "E3PUSE"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:20.390] [32mINFO [0m [TournamentHandler] {
        "room": "game_E3PUSE",
        "duration": 5,
        "accessCode": "E3PUSE",
        "socketId": "ACVRpm46f6-tVpYKAAAC"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.401] [32mINFO [0m [GameStateService] {
        "accessCode": "E3PUSE"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.410] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "E3PUSE"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.413] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "E3PUSE",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.413] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "E3PUSE"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.414] [32mINFO [0m [GameStateService] {
        "accessCode": "E3PUSE"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.414] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "E3PUSE",
        "room": "game_E3PUSE",
        "socketIds": [
          "ACVRpm46f6-tVpYKAAAC",
          "wVTdz5X7xA49brLIAAAD"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.414] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "E3PUSE",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.414] [32mINFO [0m [SharedGameFlow] {
        "room": "game_E3PUSE",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-09T18:45:15.479Z",
            "updatedAt": "2025-06-09T18:45:19.496Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.415] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "E3PUSE",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.417] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "ACVRpm46f6-tVpYKAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.418] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "ACVRpm46f6-tVpYKAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.418] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "ACVRpm46f6-tVpYKAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.418] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "ACVRpm46f6-tVpYKAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.419] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "wVTdz5X7xA49brLIAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.419] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "wVTdz5X7xA49brLIAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.420] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "wVTdz5X7xA49brLIAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.420] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "wVTdz5X7xA49brLIAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.428] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.429] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.440] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:25.440] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "E3PUSE",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.416] [32mINFO [0m [SharedGameFlow] {
        "room": "game_E3PUSE",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.416] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "E3PUSE",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.416] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "E3PUSE",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.427] [32mINFO [0m [GameStateService] {
        "accessCode": "E3PUSE",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.429] [32mINFO [0m [GameStateService] {
        "accessCode": "E3PUSE",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.429] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "E3PUSE",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
          "username": "p1-extended",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
          "username": "p2-extended",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament2.test.ts:327:17)

    console.log
      [2025-06-09 20:45:27.444] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "playMode": "tournament",
          "gameTemplateId": "a06f5934-7983-46df-8328-eaaf16b0c71a",
          "discipline": "math",
          "nbOfQuestions": 1
        },
        "keys": [
          "name",
          "playMode",
          "gameTemplateId",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
          "username": "p1-extended",
          "role": "STUDENT",
          "iat": 1749494719,
          "exp": 1749498319
        },
        "headers": {
          "host": "localhost:40521",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJiMzk0NjU4ZS0yYTM1LTQ1NjktYTBiOC02YzIwYjY1NGEzZDMiLCJ1c2VybmFtZSI6InAxLWV4dGVuZGVkIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk0OTQ3MTksImV4cCI6MTc0OTQ5ODMxOX0.A2lz0MdWZ4BLvupOr1_cxjUdqhvQBVgNpSOPOcmJ06g",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.444] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "a06f5934-7983-46df-8328-eaaf16b0c71a",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.457] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "4346639f-b07b-4f13-9c5a-a4c4e11a0696",
        "accessCode": "2G8E9J"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: '7XYIFHVykZLwiGWKAAAG',
        finalUserId: 'b394658e-2a35-4569-a0b8-6c20b654a3d3',
        setUserId: 'b394658e-2a35-4569-a0b8-6c20b654a3d3',
        setUserData: {
          userId: 'b394658e-2a35-4569-a0b8-6c20b654a3d3',
          username: 'p1-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-09 20:45:27.591] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "7XYIFHVykZLwiGWKAAAG",
        "user": {
          "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.591] [32mINFO [0m [GameHandlers] {
        "socketId": "7XYIFHVykZLwiGWKAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.592] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "7XYIFHVykZLwiGWKAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.592] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "7XYIFHVykZLwiGWKAAAG"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 7XYIFHVykZLwiGWKAAAG

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:45:27.592] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "7XYIFHVykZLwiGWKAAAG"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.592] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.596] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.596] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.597] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.597] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.597] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.597] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.597] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.597] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "7XYIFHVykZLwiGWKAAAG"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'T7G59uCDgwAyE-P3AAAH',
        finalUserId: 'ca8d258d-8e42-486c-9d5a-0588d21bf5fe',
        setUserId: 'ca8d258d-8e42-486c-9d5a-0588d21bf5fe',
        setUserData: {
          userId: 'ca8d258d-8e42-486c-9d5a-0588d21bf5fe',
          username: 'p2-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-09 20:45:27.600] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "T7G59uCDgwAyE-P3AAAH",
        "user": {
          "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.601] [32mINFO [0m [GameHandlers] {
        "socketId": "T7G59uCDgwAyE-P3AAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.601] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "T7G59uCDgwAyE-P3AAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.601] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "T7G59uCDgwAyE-P3AAAH"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: T7G59uCDgwAyE-P3AAAH

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:45:27.601] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "T7G59uCDgwAyE-P3AAAH"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.602] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.602] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.602] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.602] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.602] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.602] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.602] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.602] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.602] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "T7G59uCDgwAyE-P3AAAH"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.603] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_2G8E9J",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.603] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_2G8E9J",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.603] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_2G8E9J",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.603] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_2G8E9J",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.604] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_2G8E9J",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.604] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_2G8E9J",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.604] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_2G8E9J",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.604] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_2G8E9J",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.605] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_2G8E9J",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4346639f-b07b-4f13-9c5a-a4c4e11a0696",
          "accessCode": "2G8E9J",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.606] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_2G8E9J",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4346639f-b07b-4f13-9c5a-a4c4e11a0696",
          "accessCode": "2G8E9J",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.606] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_2G8E9J",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4346639f-b07b-4f13-9c5a-a4c4e11a0696",
          "accessCode": "2G8E9J",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.606] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_2G8E9J",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4346639f-b07b-4f13-9c5a-a4c4e11a0696",
          "accessCode": "2G8E9J",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.609] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.609] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.609] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.609] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.622] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "4346639f-b07b-4f13-9c5a-a4c4e11a0696",
        "templateId": "a06f5934-7983-46df-8328-eaaf16b0c71a",
        "initiator": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "2G8E9J",
        "socketId": "7XYIFHVykZLwiGWKAAAG"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.825] [32mINFO [0m [GameStateService] {
        "accessCode": "2G8E9J"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:27.834] [32mINFO [0m [TournamentHandler] {
        "room": "game_2G8E9J",
        "duration": 5,
        "accessCode": "2G8E9J",
        "socketId": "7XYIFHVykZLwiGWKAAAG"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:29.430] [32mINFO [0m [SharedGameFlow] {
        "room": "game_E3PUSE",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:29.430] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "E3PUSE",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:29.430] [32mINFO [0m [SharedGameFlow] {
        "room": "game_E3PUSE",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:29.431] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "E3PUSE",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.845] [32mINFO [0m [GameStateService] {
        "accessCode": "2G8E9J"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.856] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2G8E9J"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.857] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2G8E9J",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.857] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2G8E9J"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.858] [32mINFO [0m [GameStateService] {
        "accessCode": "2G8E9J"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.859] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2G8E9J",
        "room": "game_2G8E9J",
        "socketIds": [
          "7XYIFHVykZLwiGWKAAAG",
          "T7G59uCDgwAyE-P3AAAH"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.859] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2G8E9J",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.859] [32mINFO [0m [SharedGameFlow] {
        "room": "game_2G8E9J",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-09T18:45:15.479Z",
            "updatedAt": "2025-06-09T18:45:19.496Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.860] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2G8E9J",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.862] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "7XYIFHVykZLwiGWKAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.862] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "7XYIFHVykZLwiGWKAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.862] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "7XYIFHVykZLwiGWKAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.862] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "7XYIFHVykZLwiGWKAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.863] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "T7G59uCDgwAyE-P3AAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.863] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "T7G59uCDgwAyE-P3AAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.863] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "T7G59uCDgwAyE-P3AAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.863] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "T7G59uCDgwAyE-P3AAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.866] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1"
      } Participant already answered this question. Updating answer.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.870] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.871] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.872] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:32.883] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2G8E9J",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:34.861] [32mINFO [0m [SharedGameFlow] {
        "room": "game_2G8E9J",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:34.862] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2G8E9J",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:34.862] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2G8E9J",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:34.870] [32mINFO [0m [GameStateService] {
        "accessCode": "2G8E9J",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:34.870] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2G8E9J",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:34.874] [32mINFO [0m [GameStateService] {
        "accessCode": "2G8E9J",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
          "username": "p1-extended",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
          "username": "p2-extended",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament2.test.ts:442:17)

    console.log
      [2025-06-09 20:45:34.885] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "playMode": "tournament",
          "gameTemplateId": "c268cf81-922b-435d-988f-ce2952449441",
          "discipline": "math",
          "nbOfQuestions": 2
        },
        "keys": [
          "name",
          "playMode",
          "gameTemplateId",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
          "username": "p1-extended",
          "role": "STUDENT",
          "iat": 1749494719,
          "exp": 1749498319
        },
        "headers": {
          "host": "localhost:40521",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJiMzk0NjU4ZS0yYTM1LTQ1NjktYTBiOC02YzIwYjY1NGEzZDMiLCJ1c2VybmFtZSI6InAxLWV4dGVuZGVkIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk0OTQ3MTksImV4cCI6MTc0OTQ5ODMxOX0.A2lz0MdWZ4BLvupOr1_cxjUdqhvQBVgNpSOPOcmJ06g",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:34.886] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "c268cf81-922b-435d-988f-ce2952449441",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:34.903] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "4021399f-7938-447f-8a20-817ded0b442f",
        "accessCode": "R4BFUB"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: '5QG2NuZYQrT77L4MAAAK',
        finalUserId: 'b394658e-2a35-4569-a0b8-6c20b654a3d3',
        setUserId: 'b394658e-2a35-4569-a0b8-6c20b654a3d3',
        setUserData: {
          userId: 'b394658e-2a35-4569-a0b8-6c20b654a3d3',
          username: 'p1-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-09 20:45:35.052] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "5QG2NuZYQrT77L4MAAAK",
        "user": {
          "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.052] [32mINFO [0m [GameHandlers] {
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.053] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.053] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 5QG2NuZYQrT77L4MAAAK

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:45:35.053] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.053] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.053] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.053] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.053] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.053] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.054] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.054] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.054] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.054] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'ebskwWbSG456BcSCAAAL',
        finalUserId: 'ca8d258d-8e42-486c-9d5a-0588d21bf5fe',
        setUserId: 'ca8d258d-8e42-486c-9d5a-0588d21bf5fe',
        setUserData: {
          userId: 'ca8d258d-8e42-486c-9d5a-0588d21bf5fe',
          username: 'p2-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-09 20:45:35.056] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "ebskwWbSG456BcSCAAAL",
        "user": {
          "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.056] [32mINFO [0m [GameHandlers] {
        "socketId": "ebskwWbSG456BcSCAAAL"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.056] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "ebskwWbSG456BcSCAAAL"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.060] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ebskwWbSG456BcSCAAAL"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: ebskwWbSG456BcSCAAAL

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:45:35.060] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "ebskwWbSG456BcSCAAAL"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.060] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.060] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.060] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.060] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.061] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.061] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.061] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.061] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.061] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ebskwWbSG456BcSCAAAL"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.062] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_R4BFUB",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.062] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_R4BFUB",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.062] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_R4BFUB",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.063] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_R4BFUB",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.063] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_R4BFUB",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.063] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_R4BFUB",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.063] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_R4BFUB",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.064] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_R4BFUB",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.065] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_R4BFUB",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4021399f-7938-447f-8a20-817ded0b442f",
          "accessCode": "R4BFUB",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.065] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_R4BFUB",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4021399f-7938-447f-8a20-817ded0b442f",
          "accessCode": "R4BFUB",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.066] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_R4BFUB",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4021399f-7938-447f-8a20-817ded0b442f",
          "accessCode": "R4BFUB",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.066] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_R4BFUB",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4021399f-7938-447f-8a20-817ded0b442f",
          "accessCode": "R4BFUB",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.067] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.068] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.068] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.068] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.080] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "4021399f-7938-447f-8a20-817ded0b442f",
        "templateId": "c268cf81-922b-435d-988f-ce2952449441",
        "initiator": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 2,
        "nbParticipants": 2,
        "accessCode": "R4BFUB",
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.284] [32mINFO [0m [GameStateService] {
        "accessCode": "R4BFUB"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:35.297] [32mINFO [0m [TournamentHandler] {
        "room": "game_R4BFUB",
        "duration": 5,
        "accessCode": "R4BFUB",
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:36.870] [32mINFO [0m [SharedGameFlow] {
        "room": "game_2G8E9J",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:36.871] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2G8E9J",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:36.871] [32mINFO [0m [SharedGameFlow] {
        "room": "game_2G8E9J",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:36.872] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2G8E9J",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.313] [32mINFO [0m [GameStateService] {
        "accessCode": "R4BFUB"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.324] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.324] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB",
        "playMode": "tournament",
        "questionCount": 2
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.325] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.328] [32mINFO [0m [GameStateService] {
        "accessCode": "R4BFUB"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.329] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB",
        "room": "game_R4BFUB",
        "socketIds": [
          "5QG2NuZYQrT77L4MAAAK",
          "ebskwWbSG456BcSCAAAL"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.329] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.329] [32mINFO [0m [SharedGameFlow] {
        "room": "game_R4BFUB",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-09T18:45:15.479Z",
            "updatedAt": "2025-06-09T18:45:19.496Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.330] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.334] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.334] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.335] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.335] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.335] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "ebskwWbSG456BcSCAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.335] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "ebskwWbSG456BcSCAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.338] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "ebskwWbSG456BcSCAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.339] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "ebskwWbSG456BcSCAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.341] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1"
      } Participant already answered this question. Updating answer.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.346] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.346] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.346] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:40.347] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:42.331] [32mINFO [0m [SharedGameFlow] {
        "room": "game_R4BFUB",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:42.332] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:42.332] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:42.340] [32mINFO [0m [GameStateService] {
        "accessCode": "R4BFUB",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:42.340] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.342] [32mINFO [0m [SharedGameFlow] {
        "room": "game_R4BFUB",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.344] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.349] [32mINFO [0m [GameStateService] {
        "accessCode": "R4BFUB"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.350] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB",
        "questionIndex": 1,
        "questionUid": "q-late-2"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.350] [32mINFO [0m [SharedGameFlow] {
        "room": "game_R4BFUB",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-2",
            "title": null,
            "text": "What is 7 x 3?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "multiplication"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "multiplication",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-09T18:45:15.479Z",
            "updatedAt": "2025-06-09T18:45:19.499Z",
            "answerOptions": [
              "20",
              "21",
              "24",
              "27"
            ],
            "correctAnswers": [
              false,
              true,
              false,
              false
            ],
            "feedbackWaitTime": 0
          },
          "index": 1,
          "feedbackWaitTime": 1.5
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.351] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB",
        "event": "game_question",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.355] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.355] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.356] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.356] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.357] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "ebskwWbSG456BcSCAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.358] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "ebskwWbSG456BcSCAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.360] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "ebskwWbSG456BcSCAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.361] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "ebskwWbSG456BcSCAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.367] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.367] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.367] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:44.367] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "R4BFUB",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.353] [32mINFO [0m [SharedGameFlow] {
        "room": "game_R4BFUB",
        "event": "correct_answers",
        "questionId": "q-late-2"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.355] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB",
        "event": "correct_answers",
        "questionUid": "q-late-2"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.356] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB",
        "questionId": "q-late-2"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.372] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "playMode": "tournament",
          "gameTemplateId": "bacb39d6-7e3f-44e2-b230-b9442a3ad77f",
          "discipline": "math",
          "nbOfQuestions": 2
        },
        "keys": [
          "name",
          "playMode",
          "gameTemplateId",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
          "username": "p1-extended",
          "role": "STUDENT",
          "iat": 1749494719,
          "exp": 1749498319
        },
        "headers": {
          "host": "localhost:40521",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJiMzk0NjU4ZS0yYTM1LTQ1NjktYTBiOC02YzIwYjY1NGEzZDMiLCJ1c2VybmFtZSI6InAxLWV4dGVuZGVkIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk0OTQ3MTksImV4cCI6MTc0OTQ5ODMxOX0.A2lz0MdWZ4BLvupOr1_cxjUdqhvQBVgNpSOPOcmJ06g",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.372] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "bacb39d6-7e3f-44e2-b230-b9442a3ad77f",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.375] [32mINFO [0m [GameStateService] {
        "accessCode": "R4BFUB",
        "questionId": "q-late-2"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.376] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB",
        "questionId": "q-late-2"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.386] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "bf3f7004-e623-4e87-b83b-0da41f51835b",
        "accessCode": "XNTKK6"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'JPwFRPUhofAAp2P0AAAO',
        finalUserId: 'b394658e-2a35-4569-a0b8-6c20b654a3d3',
        setUserId: 'b394658e-2a35-4569-a0b8-6c20b654a3d3',
        setUserData: {
          userId: 'b394658e-2a35-4569-a0b8-6c20b654a3d3',
          username: 'p1-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-09 20:45:46.517] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "JPwFRPUhofAAp2P0AAAO",
        "user": {
          "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.517] [32mINFO [0m [GameHandlers] {
        "socketId": "JPwFRPUhofAAp2P0AAAO"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.517] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "JPwFRPUhofAAp2P0AAAO"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.517] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "JPwFRPUhofAAp2P0AAAO"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: JPwFRPUhofAAp2P0AAAO

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:45:46.518] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "JPwFRPUhofAAp2P0AAAO"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.518] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.518] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.518] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.518] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.518] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.518] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.519] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.521] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.521] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "JPwFRPUhofAAp2P0AAAO"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'BUciLws9jwAAmV3yAAAP',
        finalUserId: 'ca8d258d-8e42-486c-9d5a-0588d21bf5fe',
        setUserId: 'ca8d258d-8e42-486c-9d5a-0588d21bf5fe',
        setUserData: {
          userId: 'ca8d258d-8e42-486c-9d5a-0588d21bf5fe',
          username: 'p2-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-09 20:45:46.523] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "BUciLws9jwAAmV3yAAAP",
        "user": {
          "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.523] [32mINFO [0m [GameHandlers] {
        "socketId": "BUciLws9jwAAmV3yAAAP"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.523] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "BUciLws9jwAAmV3yAAAP"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.523] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "BUciLws9jwAAmV3yAAAP"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: BUciLws9jwAAmV3yAAAP

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:45:46.524] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "BUciLws9jwAAmV3yAAAP"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.524] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.524] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.527] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.527] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.527] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.527] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.527] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.527] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.527] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "BUciLws9jwAAmV3yAAAP"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.529] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_XNTKK6",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.529] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_XNTKK6",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.529] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_XNTKK6",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.529] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_XNTKK6",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.530] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_XNTKK6",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.530] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_XNTKK6",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.530] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_XNTKK6",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.533] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_XNTKK6",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.534] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_XNTKK6",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "bf3f7004-e623-4e87-b83b-0da41f51835b",
          "accessCode": "XNTKK6",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.534] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "room": "game_XNTKK6",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "bf3f7004-e623-4e87-b83b-0da41f51835b",
          "accessCode": "XNTKK6",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.535] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_XNTKK6",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "bf3f7004-e623-4e87-b83b-0da41f51835b",
          "accessCode": "XNTKK6",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.535] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "room": "game_XNTKK6",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "bf3f7004-e623-4e87-b83b-0da41f51835b",
          "accessCode": "XNTKK6",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.536] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.536] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.537] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.537] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.548] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "bf3f7004-e623-4e87-b83b-0da41f51835b",
        "templateId": "bacb39d6-7e3f-44e2-b230-b9442a3ad77f",
        "initiator": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 2,
        "nbParticipants": 2,
        "accessCode": "XNTKK6",
        "socketId": "JPwFRPUhofAAp2P0AAAO"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.753] [32mINFO [0m [GameStateService] {
        "accessCode": "XNTKK6"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:46.764] [32mINFO [0m [TournamentHandler] {
        "room": "game_XNTKK6",
        "duration": 5,
        "accessCode": "XNTKK6",
        "socketId": "JPwFRPUhofAAp2P0AAAO"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:47.877] [32mINFO [0m [SharedGameFlow] {
        "room": "game_R4BFUB",
        "event": "feedback",
        "questionId": "q-late-2"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:47.878] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB",
        "event": "feedback",
        "questionUid": "q-late-2"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:47.879] [32mINFO [0m [SharedGameFlow] {
        "room": "game_R4BFUB",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:47.879] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "R4BFUB",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.780] [32mINFO [0m [GameStateService] {
        "accessCode": "XNTKK6"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.794] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.795] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6",
        "playMode": "tournament",
        "questionCount": 2
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.795] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.799] [32mINFO [0m [GameStateService] {
        "accessCode": "XNTKK6"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.800] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6",
        "room": "game_XNTKK6",
        "socketIds": [
          "JPwFRPUhofAAp2P0AAAO",
          "BUciLws9jwAAmV3yAAAP"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.800] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.800] [32mINFO [0m [SharedGameFlow] {
        "room": "game_XNTKK6",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-09T18:45:15.479Z",
            "updatedAt": "2025-06-09T18:45:19.496Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.801] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.803] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "JPwFRPUhofAAp2P0AAAO"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.804] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "JPwFRPUhofAAp2P0AAAO"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.804] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "JPwFRPUhofAAp2P0AAAO"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.804] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "JPwFRPUhofAAp2P0AAAO"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.804] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "BUciLws9jwAAmV3yAAAP"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.805] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "BUciLws9jwAAmV3yAAAP"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.805] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "BUciLws9jwAAmV3yAAAP"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.805] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "BUciLws9jwAAmV3yAAAP"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.811] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.811] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.811] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:51.812] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:53.802] [32mINFO [0m [SharedGameFlow] {
        "room": "game_XNTKK6",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:53.803] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:53.806] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:53.815] [32mINFO [0m [GameStateService] {
        "accessCode": "XNTKK6",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:53.815] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'R5eYfkIo8BKJzGcrAAAR',
        finalUserId: 'c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e',
        setUserId: 'c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e',
        setUserData: {
          userId: 'c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e',
          username: 'p3',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-09 20:45:54.099] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "R5eYfkIo8BKJzGcrAAAR",
        "user": {
          "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
          "username": "p3",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.099] [32mINFO [0m [GameHandlers] {
        "socketId": "R5eYfkIo8BKJzGcrAAAR"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.099] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "R5eYfkIo8BKJzGcrAAAR"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.099] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "R5eYfkIo8BKJzGcrAAAR"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: R5eYfkIo8BKJzGcrAAAR

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:45:54.100] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "R5eYfkIo8BKJzGcrAAAR"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.100] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.101] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.102] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.102] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.102] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.102] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.102] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.102] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.102] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "R5eYfkIo8BKJzGcrAAAR"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.103] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "room": "game_XNTKK6",
        "playMode": "tournament",
        "username": "p3"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.103] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "room": "game_XNTKK6",
        "playMode": "tournament",
        "username": "p3"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.103] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "room": "game_XNTKK6",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.103] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "room": "game_XNTKK6",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.109] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "room": "game_XNTKK6",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "bf3f7004-e623-4e87-b83b-0da41f51835b",
          "accessCode": "XNTKK6",
          "status": "active",
          "currentQuestionIndex": 0,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 1749494751796,
            "duration": 2000,
            "isPaused": false
          },
          "question": {
            "uid": "q-late-1",
            "type": "single_correct",
            "text": "What is 10 + 5?",
            "answers": [
              "12",
              "13",
              "14",
              "15"
            ]
          }
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.110] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "room": "game_XNTKK6",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "bf3f7004-e623-4e87-b83b-0da41f51835b",
          "accessCode": "XNTKK6",
          "status": "active",
          "currentQuestionIndex": 0,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 1749494751796,
            "duration": 2000,
            "isPaused": false
          },
          "question": {
            "uid": "q-late-1",
            "type": "single_correct",
            "text": "What is 10 + 5?",
            "answers": [
              "12",
              "13",
              "14",
              "15"
            ]
          }
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.112] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.112] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.115] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "socketId": "R5eYfkIo8BKJzGcrAAAR",
        "liveRoom": "game_XNTKK6",
        "socketIds": [
          "JPwFRPUhofAAp2P0AAAO",
          "BUciLws9jwAAmV3yAAAP",
          "R5eYfkIo8BKJzGcrAAAR"
        ]
      } [DEBUG] Late joiner socket and current live room members before emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.115] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "currentIndex": 0,
        "questionId": "q-late-1",
        "questionState": "stopped",
        "timer": 0,
        "playMode": "tournament",
        "phase": "show_answers",
        "feedbackRemaining": 0
      } [DEBUG] Emitted game_question to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.116] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "questionId": "q-late-1",
        "playMode": "tournament",
        "questionState": "stopped",
        "phase": "show_answers"
      } [DEBUG] Emitted correct_answers to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.116] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "socketId": "R5eYfkIo8BKJzGcrAAAR",
        "liveRoom": "game_XNTKK6",
        "socketIds": [
          "JPwFRPUhofAAp2P0AAAO",
          "BUciLws9jwAAmV3yAAAP",
          "R5eYfkIo8BKJzGcrAAAR"
        ]
      } [DEBUG] Late joiner socket and current live room members before emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.116] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "currentIndex": 0,
        "questionId": "q-late-1",
        "questionState": "stopped",
        "timer": 0,
        "playMode": "tournament",
        "phase": "show_answers",
        "feedbackRemaining": 0
      } [DEBUG] Emitted game_question to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:54.116] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "questionId": "q-late-1",
        "playMode": "tournament",
        "questionState": "stopped",
        "phase": "show_answers"
      } [DEBUG] Emitted correct_answers to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:55.817] [32mINFO [0m [SharedGameFlow] {
        "room": "game_XNTKK6",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:55.818] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:55.821] [32mINFO [0m [GameStateService] {
        "accessCode": "XNTKK6"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:55.822] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6",
        "questionIndex": 1,
        "questionUid": "q-late-2"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:55.822] [32mINFO [0m [SharedGameFlow] {
        "room": "game_XNTKK6",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-2",
            "title": null,
            "text": "What is 7 x 3?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "multiplication"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "multiplication",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-09T18:45:15.479Z",
            "updatedAt": "2025-06-09T18:45:19.499Z",
            "answerOptions": [
              "20",
              "21",
              "24",
              "27"
            ],
            "correctAnswers": [
              false,
              true,
              false,
              false
            ],
            "feedbackWaitTime": 0
          },
          "index": 1,
          "feedbackWaitTime": 1.5
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:55.823] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6",
        "event": "game_question",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:57.824] [32mINFO [0m [SharedGameFlow] {
        "room": "game_XNTKK6",
        "event": "correct_answers",
        "questionId": "q-late-2"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:57.825] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6",
        "event": "correct_answers",
        "questionUid": "q-late-2"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:57.826] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6",
        "questionId": "q-late-2"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:57.830] [32mINFO [0m [GameStateService] {
        "accessCode": "XNTKK6",
        "questionId": "q-late-2"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:57.831] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6",
        "questionId": "q-late-2"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.332] [32mINFO [0m [SharedGameFlow] {
        "room": "game_XNTKK6",
        "event": "feedback",
        "questionId": "q-late-2"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.334] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6",
        "event": "feedback",
        "questionUid": "q-late-2"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.334] [32mINFO [0m [SharedGameFlow] {
        "room": "game_XNTKK6",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.334] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XNTKK6",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.336] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "receivedPlayMode": "tournament",
        "socketId": "R5eYfkIo8BKJzGcrAAAR"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.337] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "finalPlayMode": "tournament",
        "socketId": "R5eYfkIo8BKJzGcrAAAR"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.337] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "receivedPlayMode": "tournament",
        "socketId": "R5eYfkIo8BKJzGcrAAAR"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.338] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "finalPlayMode": "tournament",
        "socketId": "R5eYfkIo8BKJzGcrAAAR"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.340] [33mWARN [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "questionId": "q-late-1"
      } Answer submitted after timer expired (tournament mode).

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.341] [33mWARN [0m [SharedLiveHandler] {
        "accessCode": "XNTKK6",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "questionId": "q-late-1"
      } Answer submitted after timer expired (tournament mode).

      at log (src/utils/logger.ts:102:21)

    console.log
      socket3 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:790:33)

    console.log
      Starting afterAll cleanup...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:74:17)

    console.log
      Processing socket1...

      at disconnectSocket (tests/integration/tournament2.test.ts:82:21)

    console.log
      socket1 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament2.test.ts:87:25)

    console.log
      socket1 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:97:37)

    console.log
      socket1 processing complete.

      at disconnectSocket (tests/integration/tournament2.test.ts:113:21)

    console.log
      Processing socket2...

      at disconnectSocket (tests/integration/tournament2.test.ts:82:21)

    console.log
      socket2 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament2.test.ts:87:25)

    console.log
      socket2 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:97:37)

    console.log
      socket2 processing complete.

      at disconnectSocket (tests/integration/tournament2.test.ts:113:21)

    console.log
      [2025-06-09 20:45:59.351] [32mINFO [0m [DisconnectHandler] {
        "socketId": "R5eYfkIo8BKJzGcrAAAR",
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "accessCode": "XNTKK6",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.356] [32mINFO [0m [DisconnectHandler] {
        "socketId": "JPwFRPUhofAAp2P0AAAO",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "accessCode": "XNTKK6",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.357] [32mINFO [0m [DisconnectHandler] {
        "socketId": "BUciLws9jwAAmV3yAAAP",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "accessCode": "XNTKK6",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.362] [32mINFO [0m [DisconnectHandler] {
        "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
        "accessCode": "XNTKK6",
        "socketId": "R5eYfkIo8BKJzGcrAAAR"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.362] [32mINFO [0m [DisconnectHandler] {
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "accessCode": "XNTKK6",
        "socketId": "JPwFRPUhofAAp2P0AAAO"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.362] [32mINFO [0m [DisconnectHandler] {
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "accessCode": "XNTKK6",
        "socketId": "BUciLws9jwAAmV3yAAAP"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.364] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "c9d13a03-b3ca-4c37-a3a2-d0fc9ee2220e",
          "socketId": "R5eYfkIo8BKJzGcrAAAR"
        },
        "room": "game_XNTKK6"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.365] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
          "socketId": "JPwFRPUhofAAp2P0AAAO"
        },
        "room": "game_XNTKK6"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.365] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
          "socketId": "BUciLws9jwAAmV3yAAAP"
        },
        "room": "game_XNTKK6"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.366] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "XNTKK6",
        "gameId": "bf3f7004-e623-4e87-b83b-0da41f51835b",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.368] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "XNTKK6",
        "gameId": "bf3f7004-e623-4e87-b83b-0da41f51835b",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.368] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "XNTKK6",
        "gameId": "bf3f7004-e623-4e87-b83b-0da41f51835b",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing Socket.IO server...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:124:21)

    console.log
      [2025-06-09 20:45:59.850] [32mINFO [0m [DisconnectHandler] {
        "socketId": "ACVRpm46f6-tVpYKAAAC",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "accessCode": "E3PUSE",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-09 20:45:59.851] [32mINFO [0m [DisconnectHandler] {
        "socketId": "wVTdz5X7xA49brLIAAAD",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "accessCode": "E3PUSE",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-09 20:45:59.852] [32mINFO [0m [DisconnectHandler] {
        "socketId": "7XYIFHVykZLwiGWKAAAG",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "accessCode": "2G8E9J",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-09 20:45:59.852] [32mINFO [0m [DisconnectHandler] {
        "socketId": "T7G59uCDgwAyE-P3AAAH",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "accessCode": "2G8E9J",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-09 20:45:59.852] [32mINFO [0m [DisconnectHandler] {
        "socketId": "5QG2NuZYQrT77L4MAAAK",
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "accessCode": "R4BFUB",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-09 20:45:59.853] [32mINFO [0m [DisconnectHandler] {
        "socketId": "ebskwWbSG456BcSCAAAL",
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "accessCode": "R4BFUB",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      Socket.IO server closed successfully.

      at Server.<anonymous> (tests/integration/tournament2.test.ts:136:33)

    console.log
      Attempting to close HTTP server...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:144:17)

    console.log
      HTTP server was not listening. Assuming already closed or handled by Socket.IO close.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:164:25)

    console.log
      Waiting longer for server resources to release before closing Redis...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:170:17)

    console.log
      [2025-06-09 20:45:59.869] [32mINFO [0m [DisconnectHandler] {
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "accessCode": "E3PUSE",
        "socketId": "ACVRpm46f6-tVpYKAAAC"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.869] [32mINFO [0m [DisconnectHandler] {
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "accessCode": "E3PUSE",
        "socketId": "wVTdz5X7xA49brLIAAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.869] [32mINFO [0m [DisconnectHandler] {
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "accessCode": "2G8E9J",
        "socketId": "7XYIFHVykZLwiGWKAAAG"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.870] [32mINFO [0m [DisconnectHandler] {
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "accessCode": "2G8E9J",
        "socketId": "T7G59uCDgwAyE-P3AAAH"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.870] [32mINFO [0m [DisconnectHandler] {
        "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
        "accessCode": "R4BFUB",
        "socketId": "5QG2NuZYQrT77L4MAAAK"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.870] [32mINFO [0m [DisconnectHandler] {
        "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
        "accessCode": "R4BFUB",
        "socketId": "ebskwWbSG456BcSCAAAL"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.873] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
          "socketId": "ACVRpm46f6-tVpYKAAAC"
        },
        "room": "game_E3PUSE"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.874] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
          "socketId": "wVTdz5X7xA49brLIAAAD"
        },
        "room": "game_E3PUSE"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.874] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
          "socketId": "7XYIFHVykZLwiGWKAAAG"
        },
        "room": "game_2G8E9J"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.875] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
          "socketId": "T7G59uCDgwAyE-P3AAAH"
        },
        "room": "game_2G8E9J"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.875] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "b394658e-2a35-4569-a0b8-6c20b654a3d3",
          "socketId": "5QG2NuZYQrT77L4MAAAK"
        },
        "room": "game_R4BFUB"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.875] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "ca8d258d-8e42-486c-9d5a-0588d21bf5fe",
          "socketId": "ebskwWbSG456BcSCAAAL"
        },
        "room": "game_R4BFUB"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.876] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "E3PUSE",
        "gameId": "4088130c-3fe1-42a2-89b8-0453f8e038f3",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.877] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "E3PUSE",
        "gameId": "4088130c-3fe1-42a2-89b8-0453f8e038f3",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.878] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "2G8E9J",
        "gameId": "4346639f-b07b-4f13-9c5a-a4c4e11a0696",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.878] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "2G8E9J",
        "gameId": "4346639f-b07b-4f13-9c5a-a4c4e11a0696",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.878] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "R4BFUB",
        "gameId": "4021399f-7938-447f-8a20-817ded0b442f",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:45:59.878] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "R4BFUB",
        "gameId": "4021399f-7938-447f-8a20-817ded0b442f",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing SocketIO Redis clients (subClient)...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:174:17)

    console.log
      SocketIO Redis clients closed.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:177:21)

    console.log
      Closing main Redis client...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:185:17)

    console.log
      Main Redis client quit successfully.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:189:25)

    console.log
      Cleaning up database...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:200:17)

    console.log
      Database cleanup successful.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:212:21)

    console.warn
      Error cleaning up Redis keys: Connection is closed.

      222 |             }
      223 |         } catch (e: any) {
    > 224 |             console.warn('Error cleaning up Redis keys:', e.message || e);
          |                     ^
      225 |         }
      226 |
      227 |         await new Promise(resolve => setTimeout(resolve, 300));

      at Object.<anonymous> (tests/integration/tournament2.test.ts:224:21)

    console.log
      afterAll cleanup complete.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:228:17)

PASS tests/integration/tournament.test.ts (19.591 s)
  ‚óè Console

    console.log
      [2025-06-09 20:46:04.181] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.313] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "playMode": "tournament",
          "gameTemplateId": "63e2bca4-d604-4554-adf9-5f53bd26fe38",
          "discipline": "math",
          "nbOfQuestions": 1
        },
        "keys": [
          "name",
          "playMode",
          "gameTemplateId",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
          "username": "p1-basic",
          "role": "STUDENT",
          "iat": 1749494764,
          "exp": 1749498364
        },
        "headers": {
          "host": "localhost:37782",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIzMTBkMjYyNS1kYmZiLTRkYjctYjM3ZC1mOGQzOTE5MWI5ZTciLCJ1c2VybmFtZSI6InAxLWJhc2ljIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk0OTQ3NjQsImV4cCI6MTc0OTQ5ODM2NH0.t9OV-QVHkzg7QNw3DbY_heIJdiu87TmHYzNaXuKLJuc",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.313] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "63e2bca4-d604-4554-adf9-5f53bd26fe38",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.337] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "77811e1d-9780-4824-82ed-8ce71df02965",
        "accessCode": "PMYFFH"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.492] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "_VATZF8D0teEXEMLAAAC",
        "user": {
          "id": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
          "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
          "username": "p1-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.498] [32mINFO [0m [GameHandlers] {
        "socketId": "_VATZF8D0teEXEMLAAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.498] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "_VATZF8D0teEXEMLAAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.498] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "_VATZF8D0teEXEMLAAAC"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: _VATZF8D0teEXEMLAAAC

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:04.499] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "_VATZF8D0teEXEMLAAAC"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.499] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.499] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.499] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.499] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.499] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.499] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.499] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.499] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.499] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "_VATZF8D0teEXEMLAAAC"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.501] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "he5dMKKErW3irNKDAAAD",
        "user": {
          "id": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
          "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
          "username": "p2-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.501] [32mINFO [0m [GameHandlers] {
        "socketId": "he5dMKKErW3irNKDAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.501] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "he5dMKKErW3irNKDAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.501] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "he5dMKKErW3irNKDAAAD"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: he5dMKKErW3irNKDAAAD

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:04.501] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "he5dMKKErW3irNKDAAAD"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.502] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.502] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.502] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.502] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.502] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.502] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.502] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.502] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.502] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "he5dMKKErW3irNKDAAAD"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.503] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "room": "game_PMYFFH",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.503] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "room": "game_PMYFFH",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.504] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "room": "game_PMYFFH",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.504] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "room": "game_PMYFFH",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.504] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "room": "game_PMYFFH",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.504] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "room": "game_PMYFFH",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.504] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "room": "game_PMYFFH",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.504] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "room": "game_PMYFFH",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.505] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "room": "game_PMYFFH",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "77811e1d-9780-4824-82ed-8ce71df02965",
          "accessCode": "PMYFFH",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.506] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "room": "game_PMYFFH",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "77811e1d-9780-4824-82ed-8ce71df02965",
          "accessCode": "PMYFFH",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.506] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "room": "game_PMYFFH",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "77811e1d-9780-4824-82ed-8ce71df02965",
          "accessCode": "PMYFFH",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.507] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "room": "game_PMYFFH",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "77811e1d-9780-4824-82ed-8ce71df02965",
          "accessCode": "PMYFFH",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.508] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.508] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.508] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.509] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.521] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "77811e1d-9780-4824-82ed-8ce71df02965",
        "templateId": "63e2bca4-d604-4554-adf9-5f53bd26fe38",
        "initiator": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "PMYFFH",
        "socketId": "_VATZF8D0teEXEMLAAAC"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.724] [32mINFO [0m [GameStateService] {
        "accessCode": "PMYFFH"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:04.731] [32mINFO [0m [TournamentHandler] {
        "room": "game_PMYFFH",
        "duration": 5,
        "accessCode": "PMYFFH",
        "socketId": "_VATZF8D0teEXEMLAAAC"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.746] [32mINFO [0m [GameStateService] {
        "accessCode": "PMYFFH"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.761] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PMYFFH"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.761] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PMYFFH",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.761] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PMYFFH"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.765] [32mINFO [0m [GameStateService] {
        "accessCode": "PMYFFH"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.765] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PMYFFH",
        "room": "game_PMYFFH",
        "socketIds": [
          "_VATZF8D0teEXEMLAAAC",
          "he5dMKKErW3irNKDAAAD"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.766] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PMYFFH",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.766] [32mINFO [0m [SharedGameFlow] {
        "room": "game_PMYFFH",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-09T18:46:04.273Z",
            "updatedAt": "2025-06-09T18:46:04.295Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.766] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PMYFFH",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.773] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "_VATZF8D0teEXEMLAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.773] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "_VATZF8D0teEXEMLAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.773] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "_VATZF8D0teEXEMLAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.773] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "_VATZF8D0teEXEMLAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.773] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "he5dMKKErW3irNKDAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.774] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "he5dMKKErW3irNKDAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.774] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "he5dMKKErW3irNKDAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.774] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "he5dMKKErW3irNKDAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.776] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "questionId": "q-late-1"
      } Participant already answered this question. Updating answer.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.779] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.779] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.780] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:09.788] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PMYFFH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.768] [32mINFO [0m [SharedGameFlow] {
        "room": "game_PMYFFH",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.769] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PMYFFH",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.770] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PMYFFH",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.779] [32mINFO [0m [GameStateService] {
        "accessCode": "PMYFFH",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.780] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PMYFFH",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.784] [32mINFO [0m [GameStateService] {
        "accessCode": "PMYFFH",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
          "username": "p1-basic",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
          "username": "p2-basic",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament.test.ts:342:17)

    console.log
      [2025-06-09 20:46:11.800] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "playMode": "tournament",
          "gameTemplateId": "bb2f32ac-7a2e-44a9-ba03-92474938a95d",
          "discipline": "math",
          "nbOfQuestions": 1
        },
        "keys": [
          "name",
          "playMode",
          "gameTemplateId",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
          "username": "p1-basic",
          "role": "STUDENT",
          "iat": 1749494764,
          "exp": 1749498364
        },
        "headers": {
          "host": "localhost:37782",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIzMTBkMjYyNS1kYmZiLTRkYjctYjM3ZC1mOGQzOTE5MWI5ZTciLCJ1c2VybmFtZSI6InAxLWJhc2ljIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk0OTQ3NjQsImV4cCI6MTc0OTQ5ODM2NH0.t9OV-QVHkzg7QNw3DbY_heIJdiu87TmHYzNaXuKLJuc",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.801] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "bb2f32ac-7a2e-44a9-ba03-92474938a95d",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.812] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "64557737-ae52-4955-a656-97a4c95d8565",
        "accessCode": "XE6RQZ"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.954] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "FU_2LuiipLsm9LnzAAAG",
        "user": {
          "id": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
          "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
          "username": "p1-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.955] [32mINFO [0m [GameHandlers] {
        "socketId": "FU_2LuiipLsm9LnzAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.955] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "FU_2LuiipLsm9LnzAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.955] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "FU_2LuiipLsm9LnzAAAG"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: FU_2LuiipLsm9LnzAAAG

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:11.955] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "FU_2LuiipLsm9LnzAAAG"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.955] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.955] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.955] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.955] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.955] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.955] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.956] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.956] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.956] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "FU_2LuiipLsm9LnzAAAG"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.957] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "ktTP50q6gKV98AHGAAAH",
        "user": {
          "id": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
          "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
          "username": "p2-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.957] [32mINFO [0m [GameHandlers] {
        "socketId": "ktTP50q6gKV98AHGAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.957] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "ktTP50q6gKV98AHGAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.957] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ktTP50q6gKV98AHGAAAH"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: ktTP50q6gKV98AHGAAAH

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:11.957] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "ktTP50q6gKV98AHGAAAH"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.957] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.958] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.958] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.958] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.958] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.958] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.958] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.958] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.958] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ktTP50q6gKV98AHGAAAH"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.958] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "room": "game_XE6RQZ",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.959] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "room": "game_XE6RQZ",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.959] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "room": "game_XE6RQZ",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.959] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "room": "game_XE6RQZ",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.959] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "room": "game_XE6RQZ",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.959] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "room": "game_XE6RQZ",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.959] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "room": "game_XE6RQZ",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.959] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "room": "game_XE6RQZ",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.965] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "room": "game_XE6RQZ",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "64557737-ae52-4955-a656-97a4c95d8565",
          "accessCode": "XE6RQZ",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.965] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "room": "game_XE6RQZ",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "64557737-ae52-4955-a656-97a4c95d8565",
          "accessCode": "XE6RQZ",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.966] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "room": "game_XE6RQZ",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "64557737-ae52-4955-a656-97a4c95d8565",
          "accessCode": "XE6RQZ",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.966] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "room": "game_XE6RQZ",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "64557737-ae52-4955-a656-97a4c95d8565",
          "accessCode": "XE6RQZ",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.968] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.968] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.969] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.969] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:11.980] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "64557737-ae52-4955-a656-97a4c95d8565",
        "templateId": "bb2f32ac-7a2e-44a9-ba03-92474938a95d",
        "initiator": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "XE6RQZ",
        "socketId": "FU_2LuiipLsm9LnzAAAG"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:12.184] [32mINFO [0m [GameStateService] {
        "accessCode": "XE6RQZ"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:12.195] [32mINFO [0m [TournamentHandler] {
        "room": "game_XE6RQZ",
        "duration": 5,
        "accessCode": "XE6RQZ",
        "socketId": "FU_2LuiipLsm9LnzAAAG"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:13.781] [32mINFO [0m [SharedGameFlow] {
        "room": "game_PMYFFH",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:13.782] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PMYFFH",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:13.782] [32mINFO [0m [SharedGameFlow] {
        "room": "game_PMYFFH",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:13.782] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PMYFFH",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.209] [32mINFO [0m [GameStateService] {
        "accessCode": "XE6RQZ"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.218] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XE6RQZ"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.218] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XE6RQZ",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.219] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XE6RQZ"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.220] [32mINFO [0m [GameStateService] {
        "accessCode": "XE6RQZ"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.220] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XE6RQZ",
        "room": "game_XE6RQZ",
        "socketIds": [
          "FU_2LuiipLsm9LnzAAAG",
          "ktTP50q6gKV98AHGAAAH"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.220] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XE6RQZ",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.220] [32mINFO [0m [SharedGameFlow] {
        "room": "game_XE6RQZ",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-09T18:46:04.273Z",
            "updatedAt": "2025-06-09T18:46:04.295Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.220] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XE6RQZ",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.221] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "FU_2LuiipLsm9LnzAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.222] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "FU_2LuiipLsm9LnzAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.222] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "FU_2LuiipLsm9LnzAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.222] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "FU_2LuiipLsm9LnzAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.222] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "ktTP50q6gKV98AHGAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.222] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "ktTP50q6gKV98AHGAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.222] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "ktTP50q6gKV98AHGAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.222] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "ktTP50q6gKV98AHGAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.224] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "questionId": "q-late-1"
      } Participant already answered this question. Updating answer.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.225] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.226] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.226] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:17.227] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "XE6RQZ",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.221] [32mINFO [0m [SharedGameFlow] {
        "room": "game_XE6RQZ",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.223] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XE6RQZ",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.223] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XE6RQZ",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.230] [32mINFO [0m [GameStateService] {
        "accessCode": "XE6RQZ",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.231] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XE6RQZ",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.232] [32mINFO [0m [GameStateService] {
        "accessCode": "XE6RQZ",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
          "username": "p1-basic",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
          "username": "p2-basic",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament.test.ts:469:17)

    console.log
      Starting afterAll cleanup...

      at Object.<anonymous> (tests/integration/tournament.test.ts:77:17)

    console.log
      Processing socket1...

      at disconnectSocket (tests/integration/tournament.test.ts:85:21)

    console.log
      socket1 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament.test.ts:90:25)

    console.log
      socket1 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament.test.ts:100:37)

    console.log
      socket1 processing complete.

      at disconnectSocket (tests/integration/tournament.test.ts:116:21)

    console.log
      Processing socket2...

      at disconnectSocket (tests/integration/tournament.test.ts:85:21)

    console.log
      socket2 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament.test.ts:90:25)

    console.log
      socket2 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament.test.ts:100:37)

    console.log
      socket2 processing complete.

      at disconnectSocket (tests/integration/tournament.test.ts:116:21)

    console.log
      [2025-06-09 20:46:19.236] [32mINFO [0m [DisconnectHandler] {
        "socketId": "FU_2LuiipLsm9LnzAAAG",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "accessCode": "XE6RQZ",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.237] [32mINFO [0m [DisconnectHandler] {
        "socketId": "ktTP50q6gKV98AHGAAAH",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "accessCode": "XE6RQZ",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.238] [32mINFO [0m [DisconnectHandler] {
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "accessCode": "XE6RQZ",
        "socketId": "FU_2LuiipLsm9LnzAAAG"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.239] [32mINFO [0m [DisconnectHandler] {
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "accessCode": "XE6RQZ",
        "socketId": "ktTP50q6gKV98AHGAAAH"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.240] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
          "socketId": "FU_2LuiipLsm9LnzAAAG"
        },
        "room": "game_XE6RQZ"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.240] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
          "socketId": "ktTP50q6gKV98AHGAAAH"
        },
        "room": "game_XE6RQZ"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.242] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "XE6RQZ",
        "gameId": "64557737-ae52-4955-a656-97a4c95d8565",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.242] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "XE6RQZ",
        "gameId": "64557737-ae52-4955-a656-97a4c95d8565",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing Socket.IO server...

      at Object.<anonymous> (tests/integration/tournament.test.ts:127:21)

    console.log
      [2025-06-09 20:46:19.737] [32mINFO [0m [DisconnectHandler] {
        "socketId": "_VATZF8D0teEXEMLAAAC",
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "accessCode": "PMYFFH",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-09 20:46:19.738] [32mINFO [0m [DisconnectHandler] {
        "socketId": "he5dMKKErW3irNKDAAAD",
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "accessCode": "PMYFFH",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-09 20:46:19.741] [32mINFO [0m [DisconnectHandler] {
        "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
        "accessCode": "PMYFFH",
        "socketId": "_VATZF8D0teEXEMLAAAC"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket.IO server closed successfully.

      at Server.<anonymous> (tests/integration/tournament.test.ts:139:33)

    console.log
      Attempting to close HTTP server...

      at Object.<anonymous> (tests/integration/tournament.test.ts:147:17)

    console.log
      HTTP server was not listening. Assuming already closed or handled by Socket.IO close.

      at Object.<anonymous> (tests/integration/tournament.test.ts:167:25)

    console.log
      Waiting longer for server resources to release before closing Redis...

      at Object.<anonymous> (tests/integration/tournament.test.ts:173:17)

    console.log
      [2025-06-09 20:46:19.743] [32mINFO [0m [DisconnectHandler] {
        "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
        "accessCode": "PMYFFH",
        "socketId": "he5dMKKErW3irNKDAAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.745] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "310d2625-dbfb-4db7-b37d-f8d39191b9e7",
          "socketId": "_VATZF8D0teEXEMLAAAC"
        },
        "room": "game_PMYFFH"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.746] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "84d0c1e1-5a5e-4445-b67e-82ce330a0554",
          "socketId": "he5dMKKErW3irNKDAAAD"
        },
        "room": "game_PMYFFH"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.747] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "PMYFFH",
        "gameId": "77811e1d-9780-4824-82ed-8ce71df02965",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:19.748] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "PMYFFH",
        "gameId": "77811e1d-9780-4824-82ed-8ce71df02965",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:21.234] [32mINFO [0m [SharedGameFlow] {
        "room": "game_XE6RQZ",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:21.235] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XE6RQZ",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:21.236] [32mINFO [0m [SharedGameFlow] {
        "room": "game_XE6RQZ",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:21.236] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "XE6RQZ",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing SocketIO Redis clients (subClient)...

      at Object.<anonymous> (tests/integration/tournament.test.ts:177:17)

    console.log
      SocketIO Redis clients closed.

      at Object.<anonymous> (tests/integration/tournament.test.ts:180:21)

    console.log
      Closing main Redis client...

      at Object.<anonymous> (tests/integration/tournament.test.ts:188:17)

    console.log
      Main Redis client quit successfully.

      at Object.<anonymous> (tests/integration/tournament.test.ts:192:25)

    console.log
      Cleaning up database...

      at Object.<anonymous> (tests/integration/tournament.test.ts:203:17)

    console.log
      Database cleanup successful.

      at Object.<anonymous> (tests/integration/tournament.test.ts:215:21)

    console.warn
      Error cleaning up Redis keys: Connection is closed.

      225 |             }
      226 |         } catch (e: any) {
    > 227 |             console.warn('Error cleaning up Redis keys:', e.message || e);
          |                     ^
      228 |         }
      229 |
      230 |         await new Promise(resolve => setTimeout(resolve, 300));

      at Object.<anonymous> (tests/integration/tournament.test.ts:227:21)

    console.log
      afterAll cleanup complete.

      at Object.<anonymous> (tests/integration/tournament.test.ts:231:17)

FAIL tests/integration/teacherQuiz.test.ts
  ‚óè Console

    console.log
      [2025-06-09 20:46:23.757] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      Creating game template with payload: {
        name: 'My First Quiz Template',
        discipline: 'math',
        gradeLevel: 'middle',
        themes: [ 'arithmetic' ],
        questions: [ { questionUid: 'test-q-quiz-1', sequence: 1 } ]
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:95:17)

    console.log
      [2025-06-09 20:46:23.855] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OTAxMTJjMi0yYzkzLTRhYzAtOTZhNC1kMzBmZWVlYWUzOWUiLCJ1c2VybmFtZSI6InF1aXpUZWFjaGVyIiwicm9sZSI6IlRFQUNIRVIiLCJpYXQiOjE3NDk0OTQ3ODMsImV4cCI6MTc0OTQ5ODM4M30.JNQCYXegHbYaHnkELDbPjaJy1RJ_xBJuBfG_rUljtes"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.856] [32mINFO [0m [GameTemplatesAPI] {
        "body": {
          "name": "My First Quiz Template",
          "discipline": "math",
          "gradeLevel": "middle",
          "themes": [
            "arithmetic"
          ],
          "questions": [
            {
              "questionUid": "test-q-quiz-1",
              "sequence": 1
            }
          ]
        },
        "user": {
          "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
          "username": "quizTeacher",
          "role": "TEACHER",
          "iat": 1749494783,
          "exp": 1749498383
        }
      } Received request for game template creation

      at log (src/utils/logger.ts:102:21)

    console.log
      Game template response status: 201

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:112:17)

    console.log
      Game template response body: {
        gameTemplate: {
          id: 'df0f208a-9d95-410a-81ef-b14e5be5df8c',
          name: 'My First Quiz Template',
          gradeLevel: 'middle',
          themes: [ 'arithmetic' ],
          discipline: 'math',
          description: null,
          defaultMode: null,
          createdAt: '2025-06-09T18:46:23.860Z',
          updatedAt: '2025-06-09T18:46:23.860Z',
          creatorId: '690112c2-2c93-4ac0-96a4-d30feeeae39e',
          questions: [ [Object] ]
        }
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:113:17)

    console.log
      Creating game instance with payload: {
        name: 'Live Quiz Session 1',
        playMode: 'quiz',
        gameTemplateId: 'df0f208a-9d95-410a-81ef-b14e5be5df8c'
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:119:17)

    console.log
      [2025-06-09 20:46:23.866] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Live Quiz Session 1",
          "playMode": "quiz",
          "gameTemplateId": "df0f208a-9d95-410a-81ef-b14e5be5df8c"
        },
        "keys": [
          "name",
          "playMode",
          "gameTemplateId"
        ],
        "user": {
          "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
          "username": "quizTeacher",
          "role": "TEACHER",
          "iat": 1749494783,
          "exp": 1749498383
        },
        "headers": {
          "host": "localhost:39624",
          "accept-encoding": "gzip, deflate",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OTAxMTJjMi0yYzkzLTRhYzAtOTZhNC1kMzBmZWVlYWUzOWUiLCJ1c2VybmFtZSI6InF1aXpUZWFjaGVyIiwicm9sZSI6IlRFQUNIRVIiLCJpYXQiOjE3NDk0OTQ3ODMsImV4cCI6MTc0OTQ5ODM4M30.JNQCYXegHbYaHnkELDbPjaJy1RJ_xBJuBfG_rUljtes",
          "content-type": "application/json",
          "content-length": "104",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.866] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Live Quiz Session 1",
        "finalgameTemplateId": "df0f208a-9d95-410a-81ef-b14e5be5df8c",
        "playMode": "quiz",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.873] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "accessCode": "TNPFWV"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      Game instance response status: 201

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:132:17)

    console.log
      Game instance response body: {
        gameInstance: {
          id: 'e1b64fcb-b333-4d51-985c-f20420db12f7',
          name: 'Live Quiz Session 1',
          accessCode: 'TNPFWV',
          status: 'pending',
          playMode: 'quiz',
          leaderboard: null,
          currentQuestionIndex: null,
          settings: {},
          createdAt: '2025-06-09T18:46:23.869Z',
          startedAt: null,
          endedAt: null,
          differedAvailableFrom: null,
          differedAvailableTo: null,
          isDiffered: false,
          gameTemplateId: 'df0f208a-9d95-410a-81ef-b14e5be5df8c',
          initiatorUserId: '690112c2-2c93-4ac0-96a4-d30feeeae39e',
          gameTemplate: {
            name: 'My First Quiz Template',
            themes: [Array],
            discipline: 'math',
            gradeLevel: 'middle'
          }
        }
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:133:17)

    console.log
      [2025-06-09 20:46:23.876] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "accessCode": "TNPFWV"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.879] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "CV7vmMZFSHPhiIHLAAAB",
        "user": {
          "id": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
          "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
          "username": "quizTeacher",
          "role": "TEACHER"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.889] [32mINFO [0m [GameHandlers] {
        "socketId": "CV7vmMZFSHPhiIHLAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.889] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "CV7vmMZFSHPhiIHLAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.889] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "CV7vmMZFSHPhiIHLAAAB"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: CV7vmMZFSHPhiIHLAAAB

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:23.890] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "CV7vmMZFSHPhiIHLAAAB"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.890] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.890] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.891] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.891] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.891] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.891] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.892] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.892] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.892] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "CV7vmMZFSHPhiIHLAAAB"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      Emitting join_dashboard with: {
        gameId: 'e1b64fcb-b333-4d51-985c-f20420db12f7',
        userId: '690112c2-2c93-4ac0-96a4-d30feeeae39e',
        username: 'quizTeacher'
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:163:17)

    console.log
      [2025-06-09 20:46:23.894] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "CV7vmMZFSHPhiIHLAAAB",
        "payload": {
          "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
          "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
          "username": "quizTeacher"
        }
      } joinDashboardHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.895] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "CV7vmMZFSHPhiIHLAAAB",
        "socketData": {
          "user": {
            "id": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
            "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
            "username": "quizTeacher",
            "role": "TEACHER"
          }
        },
        "auth": {},
        "headers": {
          "sec-websocket-version": "13",
          "sec-websocket-key": "BQ8sBaVJzSxFlTttUYY8Lw==",
          "connection": "Upgrade",
          "upgrade": "websocket",
          "sec-websocket-extensions": "permessage-deflate; client_max_window_bits",
          "host": "localhost:39624"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.896] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
        "socketId": "CV7vmMZFSHPhiIHLAAAB"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.897] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "CV7vmMZFSHPhiIHLAAAB",
        "allRooms": [
          "CV7vmMZFSHPhiIHLAAAB",
          "dashboard_e1b64fcb-b333-4d51-985c-f20420db12f7",
          "projection_e1b64fcb-b333-4d51-985c-f20420db12f7"
        ],
        "dashboardRoom": "dashboard_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "dashboardSockets": [
          "CV7vmMZFSHPhiIHLAAAB"
        ],
        "projectionRoom": "projection_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "projectionSockets": [
          "CV7vmMZFSHPhiIHLAAAB"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.898] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
        "isTestEnvironment": true
      } Fetching game control state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.901] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "gameInstanceId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "accessCode": "TNPFWV"
      } Found game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.903] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "templateId": "df0f208a-9d95-410a-81ef-b14e5be5df8c",
        "questionCount": 1
      } Found game template

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.904] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
        "socketId": "CV7vmMZFSHPhiIHLAAAB"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:222:25)

    console.log
      [teacherSocket] Event: game_control_state [{"gameId":"e1b64fcb-b333-4d51-985c-f20420db12f7","accessCode":"TNPFWV","status":"pending","currentQuestionUid":null,"questions":[{"uid":"test-q-quiz-1","title":null,"text":"What is 2+2 for quiz?","questionType":"multiple_choice_single_answer","timeLimit":null,"difficulty":1,"discipline":"math","themes":["arithmetic"],"answerOptions":["3","4","5"],"correctAnswers":[false,true,false]}],"timer":{"status":"pause","timeLeft":0,"duration":30,"timestamp":1749494783904,"localTimeLeft":0},"answersLocked":false,"participantCount":0}]

      at Socket.<anonymous> (tests/integration/teacherQuiz.test.ts:160:21)

    console.log
      [teacherSocket] Event: quiz_connected_count [{"count":0}]

      at Socket.<anonymous> (tests/integration/teacherQuiz.test.ts:160:21)

    console.log
      [2025-06-09 20:46:23.907] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "GwZmniZLtt2zE2XQAAAD",
        "user": {
          "id": "833966e5-edb6-4413-bb83-486ac675062d",
          "userId": "833966e5-edb6-4413-bb83-486ac675062d",
          "username": "quizPlayer1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.907] [32mINFO [0m [GameHandlers] {
        "socketId": "GwZmniZLtt2zE2XQAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.907] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "GwZmniZLtt2zE2XQAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.908] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "GwZmniZLtt2zE2XQAAAD"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: GwZmniZLtt2zE2XQAAAD

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:23.908] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "GwZmniZLtt2zE2XQAAAD"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.908] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.908] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.908] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.908] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.908] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.908] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.908] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.908] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.908] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "GwZmniZLtt2zE2XQAAAD"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TNPFWV',
        socketId: 'GwZmniZLtt2zE2XQAAAD',
        joinedRoomSocketIds: [ 'GwZmniZLtt2zE2XQAAAD' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:112:25)

    console.log
      [2025-06-09 20:46:23.926] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TNPFWV",
        "userId": "833966e5-edb6-4413-bb83-486ac675062d",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.926] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TNPFWV",
        "userId": "833966e5-edb6-4413-bb83-486ac675062d",
        "room": "game_TNPFWV",
        "playMode": "quiz",
        "username": "quizPlayer1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.926] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TNPFWV",
        "userId": "833966e5-edb6-4413-bb83-486ac675062d",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.927] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TNPFWV",
        "userId": "833966e5-edb6-4413-bb83-486ac675062d",
        "room": "game_TNPFWV",
        "playMode": "quiz",
        "username": "quizPlayer1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.927] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TNPFWV",
        "userId": "833966e5-edb6-4413-bb83-486ac675062d",
        "room": "game_TNPFWV",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.927] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TNPFWV",
        "userId": "833966e5-edb6-4413-bb83-486ac675062d",
        "room": "game_TNPFWV",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.928] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TNPFWV",
        "userId": "833966e5-edb6-4413-bb83-486ac675062d",
        "room": "game_TNPFWV",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
          "accessCode": "TNPFWV",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.929] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TNPFWV",
        "userId": "833966e5-edb6-4413-bb83-486ac675062d",
        "room": "game_TNPFWV",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
          "accessCode": "TNPFWV",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.935] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
        "questionUid": "test-q-quiz-1"
      } Setting question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.938] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TNPFWV",
        "userId": "833966e5-edb6-4413-bb83-486ac675062d",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.939] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TNPFWV",
        "userId": "833966e5-edb6-4413-bb83-486ac675062d",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.942] [32mINFO [0m [GameStateService] {
        "accessCode": "TNPFWV"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.942] [32mINFO [0m [SetQuestionHandler] {
        "liveRoom": "game_TNPFWV",
        "liveRoomSocketIds": [
          "GwZmniZLtt2zE2XQAAAD"
        ],
        "payload": {
          "question": {
            "uid": "test-q-quiz-1",
            "text": "What is 2+2 for quiz?",
            "answerOptions": [
              "3",
              "4",
              "5"
            ],
            "correctAnswers": [
              false,
              false,
              false
            ],
            "questionType": "multiple_choice_single_answer",
            "timeLimit": 30,
            "currentQuestionIndex": 0,
            "totalQuestions": 1
          },
          "timer": {
            "startedAt": 1749494783941,
            "duration": 30000,
            "isPaused": true
          }
        }
      } [DEBUG] Emitting game_question to live room

      at log (src/utils/logger.ts:102:21)

    console.log
      [setQuestion] Emitting game_question: {
        liveRoom: 'game_TNPFWV',
        liveRoomSocketIds: [ 'GwZmniZLtt2zE2XQAAAD' ],
        payload: {
          question: {
            uid: 'test-q-quiz-1',
            title: undefined,
            text: 'What is 2+2 for quiz?',
            answerOptions: [Array],
            correctAnswers: [Array],
            questionType: 'multiple_choice_single_answer',
            timeLimit: 30,
            currentQuestionIndex: 0,
            totalQuestions: 1
          },
          timer: { startedAt: 1749494783941, duration: 30000, isPaused: true }
        }
      }

      at Socket.log (src/sockets/handlers/teacherControl/setQuestion.ts:193:25)

    console.log
      [2025-06-09 20:46:23.943] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "questionUid": "test-q-quiz-1",
        "questionIndex": 0
      } Question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.944] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TNPFWV",
          "participant": {
            "id": "f86023d0-5b76-44f1-9d03-abf0d2e52c8a",
            "userId": "833966e5-edb6-4413-bb83-486ac675062d",
            "username": "quizPlayer1",
            "avatar": "üòÄ",
            "score": 0,
            "joinedAt": "2025-06-09T18:46:23.933Z",
            "online": true
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.944] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "f86023d0-5b76-44f1-9d03-abf0d2e52c8a",
            "userId": "833966e5-edb6-4413-bb83-486ac675062d",
            "username": "quizPlayer1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TNPFWV"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.945] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
          "action": "resume"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.946] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
        "action": "resume"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.946] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
        "action": "resume"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.947] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TNPFWV",
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "lobbyCount": 0,
        "gameCount": 1,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.949] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 1,
        "room": "game_TNPFWV"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.949] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "resume",
        "timer": {
          "startedAt": 1749494783949,
          "duration": 30000,
          "isPaused": false
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.950] [32mINFO [0m [GameStateService] {
        "accessCode": "TNPFWV"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.950] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "resume",
        "dashboardRoom": "dashboard_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "liveRoom": "game_TNPFWV",
        "projectionRoom": "projection_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "timer": {
          "startedAt": 1749494783949,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.950] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "resume",
        "dashboardRoom": "dashboard_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "timer": {
          "startedAt": 1749494783949,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.950] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "resume",
        "liveRoom": "game_TNPFWV",
        "timer": {
          "startedAt": 1749494783949,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.951] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "resume",
        "projectionRoom": "projection_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "timer": {
          "startedAt": 1749494783949,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.951] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "resume"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.952] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
          "action": "pause"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.953] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
        "action": "pause"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.953] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
        "action": "pause"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.955] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "pause",
        "timer": {
          "startedAt": 1749494783949,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1749494783955,
          "timeRemaining": 29994
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.955] [32mINFO [0m [GameStateService] {
        "accessCode": "TNPFWV"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.956] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "pause",
        "dashboardRoom": "dashboard_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "liveRoom": "game_TNPFWV",
        "projectionRoom": "projection_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "timer": {
          "startedAt": 1749494783949,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1749494783955,
          "timeRemaining": 29994
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.956] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "pause",
        "dashboardRoom": "dashboard_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "timer": {
          "startedAt": 1749494783949,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1749494783955,
          "timeRemaining": 29994
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.957] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "pause",
        "liveRoom": "game_TNPFWV",
        "timer": {
          "startedAt": 1749494783949,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1749494783955,
          "timeRemaining": 29994
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.957] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "pause",
        "projectionRoom": "projection_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "timer": {
          "startedAt": 1749494783949,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1749494783955,
          "timeRemaining": 29994
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:23.957] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "pause"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.960] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
          "action": "resume"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.961] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
        "action": "resume"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.961] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
        "action": "resume"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.969] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "resume",
        "timer": {
          "startedAt": 1749494784969,
          "duration": 29994,
          "isPaused": false
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.970] [32mINFO [0m [GameStateService] {
        "accessCode": "TNPFWV"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.970] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "resume",
        "dashboardRoom": "dashboard_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "liveRoom": "game_TNPFWV",
        "projectionRoom": "projection_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "timer": {
          "startedAt": 1749494784969,
          "duration": 29994,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.971] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "resume",
        "dashboardRoom": "dashboard_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "timer": {
          "startedAt": 1749494784969,
          "duration": 29994,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.971] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "resume",
        "liveRoom": "game_TNPFWV",
        "timer": {
          "startedAt": 1749494784969,
          "duration": 29994,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.972] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "resume",
        "projectionRoom": "projection_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "timer": {
          "startedAt": 1749494784969,
          "duration": 29994,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.972] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "resume"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.975] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
          "action": "stop"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.976] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
        "action": "stop"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.976] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "userId": "690112c2-2c93-4ac0-96a4-d30feeeae39e",
        "action": "stop"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.979] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "stop",
        "timer": {
          "startedAt": 0,
          "duration": 29994,
          "isPaused": true,
          "timeRemaining": 0
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.979] [32mINFO [0m [GameStateService] {
        "accessCode": "TNPFWV"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.979] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "stop",
        "dashboardRoom": "dashboard_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "liveRoom": "game_TNPFWV",
        "projectionRoom": "projection_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "timer": {
          "startedAt": 0,
          "duration": 29994,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.980] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "stop",
        "dashboardRoom": "dashboard_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "timer": {
          "startedAt": 0,
          "duration": 29994,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.980] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "stop",
        "liveRoom": "game_TNPFWV",
        "timer": {
          "startedAt": 0,
          "duration": 29994,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.980] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "stop",
        "projectionRoom": "projection_e1b64fcb-b333-4d51-985c-f20420db12f7",
        "timer": {
          "startedAt": 0,
          "duration": 29994,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.980] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e1b64fcb-b333-4d51-985c-f20420db12f7",
        "action": "stop"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.982] [32mINFO [0m [DisconnectHandler] {
        "socketId": "CV7vmMZFSHPhiIHLAAAB",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.982] [33mWARN [0m [DisconnectHandler] {
        "socketId": "CV7vmMZFSHPhiIHLAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.982] [32mINFO [0m [DisconnectHandler] {
        "socketId": "GwZmniZLtt2zE2XQAAAD",
        "userId": "833966e5-edb6-4413-bb83-486ac675062d",
        "accessCode": "TNPFWV",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.986] [32mINFO [0m [DisconnectHandler] {
        "userId": "833966e5-edb6-4413-bb83-486ac675062d",
        "accessCode": "TNPFWV",
        "socketId": "GwZmniZLtt2zE2XQAAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.987] [31mERROR[0m [Server] Redis connection error: {
        "errno": -32,
        "code": "EPIPE",
        "syscall": "write"
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.988] [33mWARN [0m [DisconnectHandler] {
        "socketId": "GwZmniZLtt2zE2XQAAAD"
      } Redis connection closed during teacher disconnect handling, skipping cleanup

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.989] [33mWARN [0m [DisconnectHandler] {
        "socketId": "CV7vmMZFSHPhiIHLAAAB"
      } Redis connection closed during teacher disconnect handling, skipping cleanup

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:24.989] [33mWARN [0m [DisconnectHandler] {
        "socketId": "GwZmniZLtt2zE2XQAAAD",
        "userId": "833966e5-edb6-4413-bb83-486ac675062d",
        "accessCode": "TNPFWV"
      } Redis connection closed during disconnect handling, skipping cleanup

      at log (src/utils/logger.ts:102:21)



  ‚óè Test suite failed to run

    Connection is closed.

      at close (node_modules/ioredis/built/redis/event_handler.js:189:25)
      at Socket.<anonymous> (node_modules/ioredis/built/redis/event_handler.js:156:20)

  ‚óè Test suite failed to run

    Connection is closed.

      at close (node_modules/ioredis/built/redis/event_handler.js:189:25)
      at Socket.<anonymous> (node_modules/ioredis/built/redis/event_handler.js:156:20)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-09 20:46:27.422] [32mINFO [0m [DisconnectHandler] {
      "socketId": "2T9o23euRv3rPdNKAAAB",
      "userId": "test-teacher-123",
      "reason": "client namespace disconnect"
    } Client disconnected".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at Socket.info (src/sockets/handlers/disconnectHandler.ts:20:16)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-09 20:46:27.423] [33mWARN [0m [DisconnectHandler] {
      "socketId": "2T9o23euRv3rPdNKAAAB",
      "reason": "client namespace disconnect"
    } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as warn] (src/utils/logger.ts:119:35)
      at Socket.warn (src/sockets/handlers/disconnectHandler.ts:25:20)
      at Socket.emitReserved (node_modules/socket.io/dist/typed-events.js:56:22)
      at Socket._onclose (node_modules/socket.io/dist/socket.js:554:14)
      at Socket.ondisconnect (node_modules/socket.io/dist/socket.js:513:14)
      at Socket._onpacket (node_modules/socket.io/dist/socket.js:442:22)
      at node_modules/socket.io/dist/client.js:214:24

PASS tests/debug/socket-debug.test.ts
  ‚óè Console

    console.log
      [2025-06-09 20:46:25.291] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.292] [32mINFO [0m [DebugSocketTest] Test server listening on port 3555

      at log (src/utils/logger.ts:102:21)

    console.log
      Creating client socket...

      at Object.<anonymous> (tests/debug/socket-debug.test.ts:41:17)

    console.log
      [2025-06-09 20:46:25.303] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: '2T9o23euRv3rPdNKAAAB',
        finalUserId: 'test-teacher-123',
        setUserId: 'test-teacher-123',
        setUserData: { userId: 'test-teacher-123', role: 'TEACHER' }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-09 20:46:25.307] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "2T9o23euRv3rPdNKAAAB",
        "user": {
          "userId": "test-teacher-123",
          "role": "TEACHER"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.315] [32mINFO [0m [GameHandlers] {
        "socketId": "2T9o23euRv3rPdNKAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.315] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "2T9o23euRv3rPdNKAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.315] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "2T9o23euRv3rPdNKAAAB"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 2T9o23euRv3rPdNKAAAB

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:25.315] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "2T9o23euRv3rPdNKAAAB"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.316] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.316] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.316] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.316] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.316] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.316] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.316] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.316] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.316] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "2T9o23euRv3rPdNKAAAB"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket connected successfully: 2T9o23euRv3rPdNKAAAB

      at Socket.<anonymous> (tests/debug/socket-debug.test.ts:60:25)

    console.log
      Emitting join_dashboard...

      at Object.<anonymous> (tests/debug/socket-debug.test.ts:71:17)

    console.log
      [2025-06-09 20:46:25.319] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "2T9o23euRv3rPdNKAAAB",
        "payload": {
          "gameId": "test-game-123"
        }
      } joinDashboardHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.320] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "2T9o23euRv3rPdNKAAAB",
        "socketData": {
          "user": {
            "userId": "test-teacher-123",
            "role": "TEACHER"
          },
          "userId": "test-teacher-123",
          "connectionInfo": {
            "id": "2T9o23euRv3rPdNKAAAB",
            "address": "::ffff:127.0.0.1",
            "time": "2025-06-09T18:46:25.307Z"
          }
        },
        "auth": {
          "userId": "test-teacher-123",
          "userType": "teacher"
        },
        "headers": {
          "sec-websocket-version": "13",
          "sec-websocket-key": "4ydDWjPRSrjHtsJovfRqtw==",
          "connection": "Upgrade",
          "upgrade": "websocket",
          "sec-websocket-extensions": "permessage-deflate; client_max_window_bits",
          "host": "localhost:3555"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.320] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "test-game-123",
        "userId": "test-teacher-123",
        "socketId": "2T9o23euRv3rPdNKAAAB"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:25.366] [33mWARN [0m [JoinDashboardHandler] {
        "gameId": "test-game-123"
      } Game not found

      at log (src/utils/logger.ts:102:21)

    console.log
      Received event: error_dashboard [
        {
          code: 'GAME_NOT_FOUND',
          message: 'Game not found with the provided ID or access code'
        }
      ]

      at Socket.<anonymous> (tests/debug/socket-debug.test.ts:75:21)

    console.log
      Test completed

      at Object.<anonymous> (tests/debug/socket-debug.test.ts:83:17)

PASS tests/integration/teacherDashboard.test.ts
  ‚óè Console

    console.log
      [2025-06-09 20:46:27.857] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:27.994] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "accessCode": "TEST123"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.019] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "FSHec3UpGnefOJKvAAAB",
        "user": {
          "id": "teacher-1",
          "userId": "teacher-1",
          "username": "testteacher",
          "role": "TEACHER"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.025] [32mINFO [0m [GameHandlers] {
        "socketId": "FSHec3UpGnefOJKvAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.025] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "FSHec3UpGnefOJKvAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.025] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "FSHec3UpGnefOJKvAAAB"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: FSHec3UpGnefOJKvAAAB

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:28.026] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "FSHec3UpGnefOJKvAAAB"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.026] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.026] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.026] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.026] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.026] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.026] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.026] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.027] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.027] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "FSHec3UpGnefOJKvAAAB"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.035] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "FSHec3UpGnefOJKvAAAB",
        "payload": {
          "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9"
        }
      } joinDashboardHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.035] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "FSHec3UpGnefOJKvAAAB",
        "socketData": {
          "user": {
            "id": "teacher-1",
            "userId": "teacher-1",
            "username": "testteacher",
            "role": "TEACHER"
          }
        },
        "auth": {},
        "headers": {
          "sec-websocket-version": "13",
          "sec-websocket-key": "6b8OwKmCVD0pqlH2lrJm/g==",
          "connection": "Upgrade",
          "upgrade": "websocket",
          "sec-websocket-extensions": "permessage-deflate; client_max_window_bits",
          "host": "localhost:31059"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.036] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "socketId": "FSHec3UpGnefOJKvAAAB"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.037] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "FSHec3UpGnefOJKvAAAB",
        "allRooms": [
          "FSHec3UpGnefOJKvAAAB",
          "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
          "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9"
        ],
        "dashboardRoom": "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "dashboardSockets": [
          "FSHec3UpGnefOJKvAAAB"
        ],
        "projectionRoom": "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "projectionSockets": [
          "FSHec3UpGnefOJKvAAAB"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.038] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "isTestEnvironment": true
      } Fetching game control state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.039] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "gameInstanceId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "accessCode": "TEST123"
      } Found game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.043] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "templateId": "quiz-1",
        "questionCount": 14
      } Found game template

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.045] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "socketId": "FSHec3UpGnefOJKvAAAB"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:222:25)

    console.log
      [2025-06-09 20:46:28.046] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "FSHec3UpGnefOJKvAAAB",
        "payload": {
          "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9"
        }
      } joinDashboardHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.046] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "FSHec3UpGnefOJKvAAAB",
        "socketData": {
          "user": {
            "id": "teacher-1",
            "userId": "teacher-1",
            "username": "testteacher",
            "role": "TEACHER"
          }
        },
        "auth": {},
        "headers": {
          "sec-websocket-version": "13",
          "sec-websocket-key": "6b8OwKmCVD0pqlH2lrJm/g==",
          "connection": "Upgrade",
          "upgrade": "websocket",
          "sec-websocket-extensions": "permessage-deflate; client_max_window_bits",
          "host": "localhost:31059"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.046] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "socketId": "FSHec3UpGnefOJKvAAAB"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.048] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "FSHec3UpGnefOJKvAAAB",
        "allRooms": [
          "FSHec3UpGnefOJKvAAAB",
          "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
          "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9"
        ],
        "dashboardRoom": "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "dashboardSockets": [
          "FSHec3UpGnefOJKvAAAB"
        ],
        "projectionRoom": "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "projectionSockets": [
          "FSHec3UpGnefOJKvAAAB"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.049] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "isTestEnvironment": true
      } Fetching game control state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.050] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "gameInstanceId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "accessCode": "TEST123"
      } Found game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.053] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "templateId": "quiz-1",
        "questionCount": 14
      } Found game template

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.054] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "socketId": "FSHec3UpGnefOJKvAAAB"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:222:25)

    console.log
      [2025-06-09 20:46:28.056] [32mINFO [0m [DisconnectHandler] {
        "socketId": "FSHec3UpGnefOJKvAAAB",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.056] [33mWARN [0m [DisconnectHandler] {
        "socketId": "FSHec3UpGnefOJKvAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.059] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "GvNVYAoYd0Ng-r2ZAAAD",
        "user": {
          "id": "teacher-1",
          "userId": "teacher-1",
          "username": "testteacher",
          "role": "TEACHER"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.059] [32mINFO [0m [GameHandlers] {
        "socketId": "GvNVYAoYd0Ng-r2ZAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.059] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "GvNVYAoYd0Ng-r2ZAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.059] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "GvNVYAoYd0Ng-r2ZAAAD"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: GvNVYAoYd0Ng-r2ZAAAD

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:28.059] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "GvNVYAoYd0Ng-r2ZAAAD"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.059] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.059] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.059] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.060] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.060] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.060] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.060] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.060] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.060] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "GvNVYAoYd0Ng-r2ZAAAD"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.060] [32mINFO [0m [DisconnectHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "socketId": "FSHec3UpGnefOJKvAAAB"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.061] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "GvNVYAoYd0Ng-r2ZAAAD",
        "payload": {
          "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9"
        }
      } joinDashboardHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.061] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "GvNVYAoYd0Ng-r2ZAAAD",
        "socketData": {
          "user": {
            "id": "teacher-1",
            "userId": "teacher-1",
            "username": "testteacher",
            "role": "TEACHER"
          }
        },
        "auth": {},
        "headers": {
          "sec-websocket-version": "13",
          "sec-websocket-key": "RvSUYEd0BvsVR0Giv+l/cg==",
          "connection": "Upgrade",
          "upgrade": "websocket",
          "sec-websocket-extensions": "permessage-deflate; client_max_window_bits",
          "host": "localhost:31059"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.061] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "socketId": "GvNVYAoYd0Ng-r2ZAAAD"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.062] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "GvNVYAoYd0Ng-r2ZAAAD",
        "allRooms": [
          "GvNVYAoYd0Ng-r2ZAAAD",
          "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
          "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9"
        ],
        "dashboardRoom": "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "dashboardSockets": [
          "GvNVYAoYd0Ng-r2ZAAAD"
        ],
        "projectionRoom": "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "projectionSockets": [
          "GvNVYAoYd0Ng-r2ZAAAD"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.063] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "isTestEnvironment": true
      } Fetching game control state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.064] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "gameInstanceId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "accessCode": "TEST123"
      } Found game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.067] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "templateId": "quiz-1",
        "questionCount": 14
      } Found game template

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.068] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "socketId": "GvNVYAoYd0Ng-r2ZAAAD"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:222:25)

    console.log
      [2025-06-09 20:46:28.069] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "questionUid": "q-late-1"
      } Setting question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.073] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.073] [32mINFO [0m [SetQuestionHandler] {
        "liveRoom": "game_TEST123",
        "liveRoomSocketIds": [],
        "payload": {
          "question": {
            "uid": "q-late-1",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              false
            ],
            "questionType": "single_correct",
            "timeLimit": 2,
            "currentQuestionIndex": 0,
            "totalQuestions": 14
          },
          "timer": {
            "startedAt": 1749494788072,
            "duration": 2000,
            "isPaused": true
          }
        }
      } [DEBUG] Emitting game_question to live room

      at log (src/utils/logger.ts:102:21)

    console.log
      [setQuestion] Emitting game_question: {
        liveRoom: 'game_TEST123',
        liveRoomSocketIds: [],
        payload: {
          question: {
            uid: 'q-late-1',
            title: undefined,
            text: 'What is 10 + 5?',
            answerOptions: [Array],
            correctAnswers: [Array],
            questionType: 'single_correct',
            timeLimit: 2,
            currentQuestionIndex: 0,
            totalQuestions: 14
          },
          timer: { startedAt: 1749494788072, duration: 2000, isPaused: true }
        }
      }

      at Socket.log (src/sockets/handlers/teacherControl/setQuestion.ts:193:25)

    console.log
      [2025-06-09 20:46:28.074] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "questionUid": "q-late-1",
        "questionIndex": 0
      } Question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.076] [32mINFO [0m [DisconnectHandler] {
        "socketId": "GvNVYAoYd0Ng-r2ZAAAD",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.076] [33mWARN [0m [DisconnectHandler] {
        "socketId": "GvNVYAoYd0Ng-r2ZAAAD",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.077] [32mINFO [0m [DisconnectHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "socketId": "GvNVYAoYd0Ng-r2ZAAAD"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.078] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "DCnAr3ISS3mxmr_eAAAF",
        "user": {
          "id": "teacher-1",
          "userId": "teacher-1",
          "username": "testteacher",
          "role": "TEACHER"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.079] [32mINFO [0m [GameHandlers] {
        "socketId": "DCnAr3ISS3mxmr_eAAAF"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.079] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "DCnAr3ISS3mxmr_eAAAF"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.079] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "DCnAr3ISS3mxmr_eAAAF"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: DCnAr3ISS3mxmr_eAAAF

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:28.079] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "DCnAr3ISS3mxmr_eAAAF"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.079] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.079] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.079] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.079] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.079] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.080] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.080] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.080] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.080] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "DCnAr3ISS3mxmr_eAAAF"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.081] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "DCnAr3ISS3mxmr_eAAAF",
        "payload": {
          "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9"
        }
      } joinDashboardHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.081] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "DCnAr3ISS3mxmr_eAAAF",
        "socketData": {
          "user": {
            "id": "teacher-1",
            "userId": "teacher-1",
            "username": "testteacher",
            "role": "TEACHER"
          }
        },
        "auth": {},
        "headers": {
          "sec-websocket-version": "13",
          "sec-websocket-key": "aTG2ZjOZp5q/jm14OPGdyg==",
          "connection": "Upgrade",
          "upgrade": "websocket",
          "sec-websocket-extensions": "permessage-deflate; client_max_window_bits",
          "host": "localhost:31059"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.081] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "socketId": "DCnAr3ISS3mxmr_eAAAF"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.084] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "DCnAr3ISS3mxmr_eAAAF",
        "allRooms": [
          "DCnAr3ISS3mxmr_eAAAF",
          "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
          "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9"
        ],
        "dashboardRoom": "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "dashboardSockets": [
          "DCnAr3ISS3mxmr_eAAAF"
        ],
        "projectionRoom": "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "projectionSockets": [
          "DCnAr3ISS3mxmr_eAAAF"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.084] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "isTestEnvironment": true
      } Fetching game control state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.086] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "gameInstanceId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "accessCode": "TEST123"
      } Found game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.089] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "templateId": "quiz-1",
        "questionCount": 14
      } Found game template

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.091] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "socketId": "DCnAr3ISS3mxmr_eAAAF"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:222:25)

    console.log
      [2025-06-09 20:46:28.091] [32mINFO [0m [Test] [TEST] About to emit quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.092] [32mINFO [0m [Test] [TEST] quiz_timer_action event emitted

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.092] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
          "action": "start",
          "duration": 30
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.092] [32mINFO [0m [TimerActionHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "action": "start",
        "duration": 30
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.092] [32mINFO [0m [TimerActionHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "action": "start",
        "duration": 30
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.099] [32mINFO [0m [TimerActionHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "action": "start",
        "now": 1749494788099,
        "validDuration": 30,
        "timer": {
          "startedAt": 1749494788072,
          "duration": 2000,
          "isPaused": true
        }
      } [TIMER_ACTION] Processing start action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.099] [32mINFO [0m [TimerActionHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "action": "start",
        "timer": {
          "startedAt": 1749494788099,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Timer object after start processing

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.099] [32mINFO [0m [TimerActionHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "action": "start",
        "timer": {
          "startedAt": 1749494788099,
          "duration": 30000,
          "isPaused": false
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.104] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.104] [32mINFO [0m [TimerActionHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "action": "start",
        "dashboardRoom": "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "liveRoom": "game_TEST123",
        "projectionRoom": "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "timer": {
          "startedAt": 1749494788099,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.105] [32mINFO [0m [TimerActionHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "action": "start",
        "dashboardRoom": "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "timer": {
          "startedAt": 1749494788099,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.105] [32mINFO [0m [TimerActionHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "action": "start",
        "liveRoom": "game_TEST123",
        "timer": {
          "startedAt": 1749494788099,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.106] [32mINFO [0m [TimerActionHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "action": "start",
        "projectionRoom": "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "timer": {
          "startedAt": 1749494788099,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.106] [32mINFO [0m [TimerActionHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "action": "start"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.106] [32mINFO [0m [Test] [TEST] Received dashboard_timer_updated event {
        "timer": {
          "startedAt": 1749494788099,
          "duration": 30000,
          "isPaused": false
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.108] [32mINFO [0m [DisconnectHandler] {
        "socketId": "DCnAr3ISS3mxmr_eAAAF",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.109] [33mWARN [0m [DisconnectHandler] {
        "socketId": "DCnAr3ISS3mxmr_eAAAF",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.111] [32mINFO [0m [DisconnectHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "socketId": "DCnAr3ISS3mxmr_eAAAF"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.114] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "Xmg4DuvB72zkIG5JAAAH",
        "user": {
          "id": "teacher-1",
          "userId": "teacher-1",
          "username": "testteacher",
          "role": "TEACHER"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.115] [32mINFO [0m [GameHandlers] {
        "socketId": "Xmg4DuvB72zkIG5JAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.116] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "Xmg4DuvB72zkIG5JAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.116] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "Xmg4DuvB72zkIG5JAAAH"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: Xmg4DuvB72zkIG5JAAAH

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:28.116] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "Xmg4DuvB72zkIG5JAAAH"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.116] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.116] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.116] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.116] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.117] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.117] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.117] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.117] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.117] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "Xmg4DuvB72zkIG5JAAAH"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.118] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "Xmg4DuvB72zkIG5JAAAH",
        "payload": {
          "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9"
        }
      } joinDashboardHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.119] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "Xmg4DuvB72zkIG5JAAAH",
        "socketData": {
          "user": {
            "id": "teacher-1",
            "userId": "teacher-1",
            "username": "testteacher",
            "role": "TEACHER"
          }
        },
        "auth": {},
        "headers": {
          "sec-websocket-version": "13",
          "sec-websocket-key": "8/vhXRBB0okUKa6rse/4lQ==",
          "connection": "Upgrade",
          "upgrade": "websocket",
          "sec-websocket-extensions": "permessage-deflate; client_max_window_bits",
          "host": "localhost:31059"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.119] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "socketId": "Xmg4DuvB72zkIG5JAAAH"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.120] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "Xmg4DuvB72zkIG5JAAAH",
        "allRooms": [
          "Xmg4DuvB72zkIG5JAAAH",
          "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
          "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9"
        ],
        "dashboardRoom": "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "dashboardSockets": [
          "Xmg4DuvB72zkIG5JAAAH"
        ],
        "projectionRoom": "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "projectionSockets": [
          "Xmg4DuvB72zkIG5JAAAH"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.121] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "isTestEnvironment": true
      } Fetching game control state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.122] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "gameInstanceId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "accessCode": "TEST123"
      } Found game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.125] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "templateId": "quiz-1",
        "questionCount": 14
      } Found game template

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.126] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "socketId": "Xmg4DuvB72zkIG5JAAAH"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:222:25)

    console.log
      [2025-06-09 20:46:28.127] [32mINFO [0m [LockAnswersHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "lock": true
      } Answer lock requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [lockAnswers] Handler called with: {
        gameId: 'de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9',
        lock: true,
        userId: 'teacher-1'
      }

      at Socket.log (src/sockets/handlers/teacherControl/lockAnswers.ts:26:17)

    console.log
      [lockAnswers] Socket data: {
        user: {
          id: 'teacher-1',
          userId: 'teacher-1',
          username: 'testteacher',
          role: 'TEACHER'
        }
      }

      at Socket.log (src/sockets/handlers/teacherControl/lockAnswers.ts:27:17)

    console.log
      [2025-06-09 20:46:28.130] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.131] [32mINFO [0m [LockAnswersHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "lock": true
      } Answers lock status updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.133] [32mINFO [0m [DisconnectHandler] {
        "socketId": "Xmg4DuvB72zkIG5JAAAH",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.133] [33mWARN [0m [DisconnectHandler] {
        "socketId": "Xmg4DuvB72zkIG5JAAAH",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.135] [32mINFO [0m [DisconnectHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "socketId": "Xmg4DuvB72zkIG5JAAAH"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.136] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "1dANWQgMLGQfgEXnAAAJ",
        "user": {
          "id": "teacher-1",
          "userId": "teacher-1",
          "username": "testteacher",
          "role": "TEACHER"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.136] [32mINFO [0m [GameHandlers] {
        "socketId": "1dANWQgMLGQfgEXnAAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.136] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "1dANWQgMLGQfgEXnAAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.137] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "1dANWQgMLGQfgEXnAAAJ"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 1dANWQgMLGQfgEXnAAAJ

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:28.137] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "1dANWQgMLGQfgEXnAAAJ"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.137] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.137] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.137] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.137] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.137] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.137] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.137] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.138] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.138] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "1dANWQgMLGQfgEXnAAAJ"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.138] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "1dANWQgMLGQfgEXnAAAJ",
        "payload": {
          "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9"
        }
      } joinDashboardHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.138] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "1dANWQgMLGQfgEXnAAAJ",
        "socketData": {
          "user": {
            "id": "teacher-1",
            "userId": "teacher-1",
            "username": "testteacher",
            "role": "TEACHER"
          }
        },
        "auth": {},
        "headers": {
          "sec-websocket-version": "13",
          "sec-websocket-key": "t2zNnH187CPjuX7YGUEoJg==",
          "connection": "Upgrade",
          "upgrade": "websocket",
          "sec-websocket-extensions": "permessage-deflate; client_max_window_bits",
          "host": "localhost:31059"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.139] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "socketId": "1dANWQgMLGQfgEXnAAAJ"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.140] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "1dANWQgMLGQfgEXnAAAJ",
        "allRooms": [
          "1dANWQgMLGQfgEXnAAAJ",
          "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
          "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9"
        ],
        "dashboardRoom": "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "dashboardSockets": [
          "1dANWQgMLGQfgEXnAAAJ"
        ],
        "projectionRoom": "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "projectionSockets": [
          "1dANWQgMLGQfgEXnAAAJ"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.140] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "isTestEnvironment": true
      } Fetching game control state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.142] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "gameInstanceId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "accessCode": "TEST123"
      } Found game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.144] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "templateId": "quiz-1",
        "questionCount": 14
      } Found game template

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.146] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "socketId": "1dANWQgMLGQfgEXnAAAJ"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:222:25)

    console.log
      [2025-06-09 20:46:28.147] [32mINFO [0m [EndGameHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1"
      } Game end requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [endGame] Handler called with: { gameId: 'de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9', userId: 'teacher-1' }

      at Socket.log (src/sockets/handlers/teacherControl/endGame.ts:26:17)

    console.log
      [endGame] Socket data: {
        user: {
          id: 'teacher-1',
          userId: 'teacher-1',
          username: 'testteacher',
          role: 'TEACHER'
        }
      }

      at Socket.log (src/sockets/handlers/teacherControl/endGame.ts:27:17)

    console.log
      [2025-06-09 20:46:28.151] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.155] [32mINFO [0m [EndGameHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9"
      } Game ended successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.157] [32mINFO [0m [DisconnectHandler] {
        "socketId": "1dANWQgMLGQfgEXnAAAJ",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.157] [33mWARN [0m [DisconnectHandler] {
        "socketId": "1dANWQgMLGQfgEXnAAAJ",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.159] [32mINFO [0m [DisconnectHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "socketId": "1dANWQgMLGQfgEXnAAAJ"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.160] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "B0pG4FoaGH-39s7YAAAL",
        "user": {
          "id": "teacher-1",
          "userId": "teacher-1",
          "username": "testteacher",
          "role": "TEACHER"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.160] [32mINFO [0m [GameHandlers] {
        "socketId": "B0pG4FoaGH-39s7YAAAL"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.160] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "B0pG4FoaGH-39s7YAAAL"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.160] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "B0pG4FoaGH-39s7YAAAL"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: B0pG4FoaGH-39s7YAAAL

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:28.160] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "B0pG4FoaGH-39s7YAAAL"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.160] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.160] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.160] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.160] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.161] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.161] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.161] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.161] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.161] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "B0pG4FoaGH-39s7YAAAL"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.164] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "B0pG4FoaGH-39s7YAAAL",
        "payload": {
          "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9"
        }
      } joinDashboardHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.164] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "B0pG4FoaGH-39s7YAAAL",
        "socketData": {
          "user": {
            "id": "teacher-1",
            "userId": "teacher-1",
            "username": "testteacher",
            "role": "TEACHER"
          }
        },
        "auth": {},
        "headers": {
          "sec-websocket-version": "13",
          "sec-websocket-key": "DiVqqzjb0TiXpUKCip6W5Q==",
          "connection": "Upgrade",
          "upgrade": "websocket",
          "sec-websocket-extensions": "permessage-deflate; client_max_window_bits",
          "host": "localhost:31059"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.164] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "socketId": "B0pG4FoaGH-39s7YAAAL"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.166] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "B0pG4FoaGH-39s7YAAAL",
        "allRooms": [
          "B0pG4FoaGH-39s7YAAAL",
          "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
          "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9"
        ],
        "dashboardRoom": "dashboard_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "dashboardSockets": [
          "B0pG4FoaGH-39s7YAAAL"
        ],
        "projectionRoom": "projection_de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "projectionSockets": [
          "B0pG4FoaGH-39s7YAAAL"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.166] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "isTestEnvironment": true
      } Fetching game control state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.167] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "gameInstanceId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "accessCode": "TEST123"
      } Found game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.170] [32mINFO [0m [TeacherControlHelpers] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "templateId": "quiz-1",
        "questionCount": 14
      } Found game template

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.172] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "userId": "teacher-1",
        "socketId": "B0pG4FoaGH-39s7YAAAL"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:222:25)

    console.log
      [2025-06-09 20:46:28.175] [32mINFO [0m [DisconnectHandler] {
        "socketId": "B0pG4FoaGH-39s7YAAAL",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.175] [33mWARN [0m [DisconnectHandler] {
        "socketId": "B0pG4FoaGH-39s7YAAAL",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.177] [32mINFO [0m [DisconnectHandler] {
        "gameId": "de3657b7-4f79-4bf5-8493-b1a4a1a8c2a9",
        "socketId": "B0pG4FoaGH-39s7YAAAL"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/lobbyHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-09 20:46:28.747] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.851] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "PcxTvxaNmqU8TmKtAAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.853] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "PcxTvxaNmqU8TmKtAAAB",
        "user": {
          "id": "player-123",
          "userId": "player-123",
          "username": "Test Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.861] [32mINFO [0m [GameHandlers] {
        "socketId": "PcxTvxaNmqU8TmKtAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.861] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "PcxTvxaNmqU8TmKtAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.861] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "PcxTvxaNmqU8TmKtAAAB"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: PcxTvxaNmqU8TmKtAAAB

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:28.861] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "PcxTvxaNmqU8TmKtAAAB"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.861] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.861] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.862] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.862] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.862] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.862] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.862] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.862] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.862] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "PcxTvxaNmqU8TmKtAAAB"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.863] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-123",
        "username": "Test Player",
        "socketId": "PcxTvxaNmqU8TmKtAAAB"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.872] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.873] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.874] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "PcxTvxaNmqU8TmKtAAAB"
      } Player leaving lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.878] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "PcxTvxaNmqU8TmKtAAAB"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.878] [32mINFO [0m [DisconnectHandler] {
        "socketId": "PcxTvxaNmqU8TmKtAAAB",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.878] [33mWARN [0m [DisconnectHandler] {
        "socketId": "PcxTvxaNmqU8TmKtAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.882] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.883] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Stopped game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.885] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.887] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "1o0OEZNYdy2tgw84AAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.888] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "1o0OEZNYdy2tgw84AAAE",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.888] [32mINFO [0m [GameHandlers] {
        "socketId": "1o0OEZNYdy2tgw84AAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.888] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "1o0OEZNYdy2tgw84AAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.889] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "1o0OEZNYdy2tgw84AAAE"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 1o0OEZNYdy2tgw84AAAE

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:28.889] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "1o0OEZNYdy2tgw84AAAE"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.889] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.889] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.890] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.890] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.890] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.890] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.890] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.891] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.891] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "1o0OEZNYdy2tgw84AAAE"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.894] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "OhiLsDLR6XH8haNDAAAG"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.894] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "OhiLsDLR6XH8haNDAAAG",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.895] [32mINFO [0m [GameHandlers] {
        "socketId": "OhiLsDLR6XH8haNDAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.895] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "OhiLsDLR6XH8haNDAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.895] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "OhiLsDLR6XH8haNDAAAG"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: OhiLsDLR6XH8haNDAAAG

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:28.895] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "OhiLsDLR6XH8haNDAAAG"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.895] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.896] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.896] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.896] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.896] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.896] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.896] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.897] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.897] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "OhiLsDLR6XH8haNDAAAG"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.899] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "3PiYdnglt6Ve9WQeAAAH"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.899] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "3PiYdnglt6Ve9WQeAAAH",
        "user": {
          "id": "player-3",
          "userId": "player-3",
          "username": "Player 3",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.899] [32mINFO [0m [GameHandlers] {
        "socketId": "3PiYdnglt6Ve9WQeAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.899] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "3PiYdnglt6Ve9WQeAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.899] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "3PiYdnglt6Ve9WQeAAAH"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 3PiYdnglt6Ve9WQeAAAH

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:28.899] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "3PiYdnglt6Ve9WQeAAAH"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.900] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.900] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.900] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.900] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.900] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.900] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.900] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.900] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.900] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "3PiYdnglt6Ve9WQeAAAH"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.903] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-1",
        "username": "Player 1",
        "socketId": "1o0OEZNYdy2tgw84AAAE"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.908] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-2",
        "username": "Player 2",
        "socketId": "OhiLsDLR6XH8haNDAAAG"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.909] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.910] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.914] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695",
        "lobbyCount": 2,
        "gameCount": 0,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.914] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.915] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-3",
        "username": "Player 3",
        "socketId": "3PiYdnglt6Ve9WQeAAAH"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.918] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "1o0OEZNYdy2tgw84AAAE"
      } Player leaving lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.918] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695",
        "lobbyCount": 2,
        "gameCount": 0,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.919] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.924] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "3PiYdnglt6Ve9WQeAAAH"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.925] [32mINFO [0m [DisconnectHandler] {
        "socketId": "3PiYdnglt6Ve9WQeAAAH",
        "userId": "player-3",
        "accessCode": "TEST123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.926] [32mINFO [0m [DisconnectHandler] {
        "socketId": "1o0OEZNYdy2tgw84AAAE",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.927] [33mWARN [0m [DisconnectHandler] {
        "socketId": "1o0OEZNYdy2tgw84AAAE",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.927] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "OhiLsDLR6XH8haNDAAAG"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.928] [32mINFO [0m [DisconnectHandler] {
        "socketId": "OhiLsDLR6XH8haNDAAAG",
        "userId": "player-2",
        "accessCode": "TEST123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.928] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.929] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Stopped game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.932] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-3",
        "accessCode": "TEST123",
        "disconnectedSocketId": "3PiYdnglt6Ve9WQeAAAH",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.932] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TEST123",
        "disconnectedSocketId": "OhiLsDLR6XH8haNDAAAG",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.938] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.938] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.939] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "H4TPKzZOqw1XWunXAAAJ"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.939] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "H4TPKzZOqw1XWunXAAAJ",
        "user": {
          "id": "player-redirect-test",
          "userId": "player-redirect-test",
          "username": "Redirect Test",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.939] [32mINFO [0m [GameHandlers] {
        "socketId": "H4TPKzZOqw1XWunXAAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.940] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "H4TPKzZOqw1XWunXAAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.940] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "H4TPKzZOqw1XWunXAAAJ"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: H4TPKzZOqw1XWunXAAAJ

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:28.940] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "H4TPKzZOqw1XWunXAAAJ"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.940] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.940] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.940] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.940] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.940] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.940] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.940] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.940] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.941] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "H4TPKzZOqw1XWunXAAAJ"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.941] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-redirect-test",
        "username": "Redirect Test",
        "socketId": "H4TPKzZOqw1XWunXAAAJ"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.947] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:28.947] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.953] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695"
      } Game became active, notifying lobby participants

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.966] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "H4TPKzZOqw1XWunXAAAJ"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.967] [32mINFO [0m [DisconnectHandler] {
        "socketId": "H4TPKzZOqw1XWunXAAAJ",
        "userId": "player-redirect-test",
        "accessCode": "TEST123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.972] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-redirect-test",
        "accessCode": "TEST123",
        "disconnectedSocketId": "H4TPKzZOqw1XWunXAAAJ",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.975] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.977] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "Ts3giCkUBIrWDVp3AAAM"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.977] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "Ts3giCkUBIrWDVp3AAAM",
        "user": {
          "id": "player-d1",
          "userId": "player-d1",
          "username": "Disconnect Test 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.977] [32mINFO [0m [GameHandlers] {
        "socketId": "Ts3giCkUBIrWDVp3AAAM"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.978] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "Ts3giCkUBIrWDVp3AAAM"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.978] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "Ts3giCkUBIrWDVp3AAAM"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: Ts3giCkUBIrWDVp3AAAM

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:30.978] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "Ts3giCkUBIrWDVp3AAAM"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.978] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.978] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.978] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.978] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.978] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.979] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.979] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.979] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.979] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "Ts3giCkUBIrWDVp3AAAM"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.980] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "3tNsxxKNo0w9E1LhAAAN"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.980] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "3tNsxxKNo0w9E1LhAAAN",
        "user": {
          "id": "player-d2",
          "userId": "player-d2",
          "username": "Disconnect Test 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.981] [32mINFO [0m [GameHandlers] {
        "socketId": "3tNsxxKNo0w9E1LhAAAN"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.981] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "3tNsxxKNo0w9E1LhAAAN"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.981] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "3tNsxxKNo0w9E1LhAAAN"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 3tNsxxKNo0w9E1LhAAAN

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:30.981] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "3tNsxxKNo0w9E1LhAAAN"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.981] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.981] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.981] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.982] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.982] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.982] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.982] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.982] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.982] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "3tNsxxKNo0w9E1LhAAAN"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.983] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-d1",
        "username": "Disconnect Test 1",
        "socketId": "Ts3giCkUBIrWDVp3AAAM"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.983] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-d2",
        "username": "Disconnect Test 2",
        "socketId": "3tNsxxKNo0w9E1LhAAAN"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.987] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "Ts3giCkUBIrWDVp3AAAM"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.987] [32mINFO [0m [DisconnectHandler] {
        "socketId": "Ts3giCkUBIrWDVp3AAAM",
        "userId": "player-d1",
        "accessCode": "TEST123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.988] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.988] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.988] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.988] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.989] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-d1",
        "accessCode": "TEST123",
        "disconnectedSocketId": "Ts3giCkUBIrWDVp3AAAM",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.991] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:30.992] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "Ts3giCkUBIrWDVp3AAAM",
        "userId": "player-d1",
        "username": "Disconnect Test 1"
      } Participant disconnected from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.293] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "3tNsxxKNo0w9E1LhAAAN"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.294] [32mINFO [0m [DisconnectHandler] {
        "socketId": "3tNsxxKNo0w9E1LhAAAN",
        "userId": "player-d2",
        "accessCode": "TEST123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.298] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-d2",
        "accessCode": "TEST123",
        "disconnectedSocketId": "3tNsxxKNo0w9E1LhAAAN",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.301] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e90f88ba-dfbd-4da9-bf0f-385bd1218695",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/lobbyDeduplication.test.ts
  ‚óè Console

    console.log
      [2025-06-09 20:46:31.862] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.937] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "GpokAvn9qj24Gs8VAAAC"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.938] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "GpokAvn9qj24Gs8VAAAC",
        "user": {
          "id": "user-1",
          "userId": "user-1",
          "username": "Test User",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.943] [32mINFO [0m [GameHandlers] {
        "socketId": "GpokAvn9qj24Gs8VAAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.943] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "GpokAvn9qj24Gs8VAAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.943] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "GpokAvn9qj24Gs8VAAAC"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: GpokAvn9qj24Gs8VAAAC

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:31.943] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "GpokAvn9qj24Gs8VAAAC"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.944] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.944] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.944] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.944] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.944] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.944] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.944] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.944] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.944] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "GpokAvn9qj24Gs8VAAAC"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.947] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "NE4X6zZbGFGpzygSAAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.947] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "NE4X6zZbGFGpzygSAAAE",
        "user": {
          "id": "user-1",
          "userId": "user-1",
          "username": "Test User",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.948] [32mINFO [0m [GameHandlers] {
        "socketId": "NE4X6zZbGFGpzygSAAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.948] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "NE4X6zZbGFGpzygSAAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.948] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "NE4X6zZbGFGpzygSAAAE"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: NE4X6zZbGFGpzygSAAAE

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:31.949] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "NE4X6zZbGFGpzygSAAAE"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.949] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.949] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.949] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.949] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.950] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.950] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.950] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.950] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.950] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "NE4X6zZbGFGpzygSAAAE"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.952] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "Ze2MztpuNFmIOXYbAAAF"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.953] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "Ze2MztpuNFmIOXYbAAAF",
        "user": {
          "id": "user-1",
          "userId": "user-1",
          "username": "Test User",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.953] [32mINFO [0m [GameHandlers] {
        "socketId": "Ze2MztpuNFmIOXYbAAAF"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.953] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "Ze2MztpuNFmIOXYbAAAF"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.953] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "Ze2MztpuNFmIOXYbAAAF"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: Ze2MztpuNFmIOXYbAAAF

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:31.953] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "Ze2MztpuNFmIOXYbAAAF"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.953] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.954] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.954] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.954] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.954] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.954] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.954] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.954] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:31.954] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "Ze2MztpuNFmIOXYbAAAF"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.054] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-1",
        "username": "Test User",
        "socketId": "GpokAvn9qj24Gs8VAAAC"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.061] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.062] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.104] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-1",
        "username": "Test User",
        "socketId": "NE4X6zZbGFGpzygSAAAE"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.107] [32mINFO [0m [LobbyHandler] {
        "existingSocketIds": [
          "GpokAvn9qj24Gs8VAAAC"
        ],
        "newSocketId": "NE4X6zZbGFGpzygSAAAE",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "count": 1
      } Removing existing participant connections for user

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.110] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 2,
        "gameCount": 0,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.111] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.155] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-1",
        "username": "Test User",
        "socketId": "Ze2MztpuNFmIOXYbAAAF"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.157] [32mINFO [0m [LobbyHandler] {
        "existingSocketIds": [
          "NE4X6zZbGFGpzygSAAAE"
        ],
        "newSocketId": "Ze2MztpuNFmIOXYbAAAF",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "count": 1
      } Removing existing participant connections for user

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.161] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 3,
        "gameCount": 0,
        "totalCount": 3
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.161] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.364] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "GpokAvn9qj24Gs8VAAAC"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.364] [32mINFO [0m [DisconnectHandler] {
        "socketId": "GpokAvn9qj24Gs8VAAAC",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.365] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "NE4X6zZbGFGpzygSAAAE"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.365] [32mINFO [0m [DisconnectHandler] {
        "socketId": "NE4X6zZbGFGpzygSAAAE",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.365] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "Ze2MztpuNFmIOXYbAAAF"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.365] [32mINFO [0m [DisconnectHandler] {
        "socketId": "Ze2MztpuNFmIOXYbAAAF",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.367] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "GpokAvn9qj24Gs8VAAAC",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.367] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "NE4X6zZbGFGpzygSAAAE",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.367] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "Ze2MztpuNFmIOXYbAAAF",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.371] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.371] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.371] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.471] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "X4XA2QtwST-RB6a_AAAI"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.471] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "X4XA2QtwST-RB6a_AAAI",
        "user": {
          "id": "user-1",
          "userId": "user-1",
          "username": "User One",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.471] [32mINFO [0m [GameHandlers] {
        "socketId": "X4XA2QtwST-RB6a_AAAI"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.471] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "X4XA2QtwST-RB6a_AAAI"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.472] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "X4XA2QtwST-RB6a_AAAI"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: X4XA2QtwST-RB6a_AAAI

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:32.472] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "X4XA2QtwST-RB6a_AAAI"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.472] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.472] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.472] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.472] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.472] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.472] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.472] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.472] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.472] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "X4XA2QtwST-RB6a_AAAI"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.474] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "ez8vOZOwon8563zjAAAK"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.475] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "ez8vOZOwon8563zjAAAK",
        "user": {
          "id": "user-1",
          "userId": "user-1",
          "username": "User One",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.475] [32mINFO [0m [GameHandlers] {
        "socketId": "ez8vOZOwon8563zjAAAK"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.475] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "ez8vOZOwon8563zjAAAK"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.475] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ez8vOZOwon8563zjAAAK"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: ez8vOZOwon8563zjAAAK

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:32.475] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "ez8vOZOwon8563zjAAAK"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.475] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.475] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.476] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.476] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.476] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.476] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.476] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.476] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.476] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ez8vOZOwon8563zjAAAK"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.477] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "32yOdRFvm0TSwaUWAAAL"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.478] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "32yOdRFvm0TSwaUWAAAL",
        "user": {
          "id": "user-2",
          "userId": "user-2",
          "username": "User Two",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.478] [32mINFO [0m [GameHandlers] {
        "socketId": "32yOdRFvm0TSwaUWAAAL"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.478] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "32yOdRFvm0TSwaUWAAAL"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.478] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "32yOdRFvm0TSwaUWAAAL"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 32yOdRFvm0TSwaUWAAAL

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:32.478] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "32yOdRFvm0TSwaUWAAAL"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.478] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.478] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.478] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.478] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.479] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.479] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.479] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.479] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.479] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "32yOdRFvm0TSwaUWAAAL"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.580] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-1",
        "username": "User One",
        "socketId": "X4XA2QtwST-RB6a_AAAI"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.585] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.585] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.631] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-2",
        "username": "User Two",
        "socketId": "32yOdRFvm0TSwaUWAAAL"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.636] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 2,
        "gameCount": 0,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.636] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.682] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-1",
        "username": "User One",
        "socketId": "ez8vOZOwon8563zjAAAK"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.685] [32mINFO [0m [LobbyHandler] {
        "existingSocketIds": [
          "X4XA2QtwST-RB6a_AAAI"
        ],
        "newSocketId": "ez8vOZOwon8563zjAAAK",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "count": 1
      } Removing existing participant connections for user

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.688] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 3,
        "gameCount": 0,
        "totalCount": 3
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.688] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.891] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "X4XA2QtwST-RB6a_AAAI"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.892] [32mINFO [0m [DisconnectHandler] {
        "socketId": "X4XA2QtwST-RB6a_AAAI",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.893] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "ez8vOZOwon8563zjAAAK"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.893] [32mINFO [0m [DisconnectHandler] {
        "socketId": "ez8vOZOwon8563zjAAAK",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.894] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "32yOdRFvm0TSwaUWAAAL"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.894] [32mINFO [0m [DisconnectHandler] {
        "socketId": "32yOdRFvm0TSwaUWAAAL",
        "userId": "user-2",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.896] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "X4XA2QtwST-RB6a_AAAI",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.896] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "ez8vOZOwon8563zjAAAK",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.898] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-2",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "32yOdRFvm0TSwaUWAAAL",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.904] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.905] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:32.917] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.003] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "ek6kl4kVxsdH9CBgAAAO"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.004] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "ek6kl4kVxsdH9CBgAAAO",
        "user": {
          "id": "user-cleanup",
          "userId": "user-cleanup",
          "username": "Cleanup User",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.004] [32mINFO [0m [GameHandlers] {
        "socketId": "ek6kl4kVxsdH9CBgAAAO"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.004] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "ek6kl4kVxsdH9CBgAAAO"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.004] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ek6kl4kVxsdH9CBgAAAO"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: ek6kl4kVxsdH9CBgAAAO

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:33.004] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "ek6kl4kVxsdH9CBgAAAO"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.005] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.005] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.005] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.005] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.005] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.005] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.005] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.005] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.006] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ek6kl4kVxsdH9CBgAAAO"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.007] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "621N2und3ygQ7zaQAAAP"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.007] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "621N2und3ygQ7zaQAAAP",
        "user": {
          "id": "user-cleanup",
          "userId": "user-cleanup",
          "username": "Cleanup User",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.007] [32mINFO [0m [GameHandlers] {
        "socketId": "621N2und3ygQ7zaQAAAP"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.007] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "621N2und3ygQ7zaQAAAP"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.008] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "621N2und3ygQ7zaQAAAP"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 621N2und3ygQ7zaQAAAP

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:33.008] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "621N2und3ygQ7zaQAAAP"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.008] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.008] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.008] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.008] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.008] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.008] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.008] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.008] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.009] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "621N2und3ygQ7zaQAAAP"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.111] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-cleanup",
        "username": "Cleanup User",
        "socketId": "ek6kl4kVxsdH9CBgAAAO"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.120] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.120] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.160] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-cleanup",
        "username": "Cleanup User",
        "socketId": "621N2und3ygQ7zaQAAAP"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.163] [32mINFO [0m [LobbyHandler] {
        "existingSocketIds": [
          "ek6kl4kVxsdH9CBgAAAO"
        ],
        "newSocketId": "621N2und3ygQ7zaQAAAP",
        "userId": "user-cleanup",
        "accessCode": "DEDUP123",
        "count": 1
      } Removing existing participant connections for user

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.165] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 2,
        "gameCount": 0,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.165] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.366] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "621N2und3ygQ7zaQAAAP"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.367] [32mINFO [0m [DisconnectHandler] {
        "socketId": "621N2und3ygQ7zaQAAAP",
        "userId": "user-cleanup",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.370] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-cleanup",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "621N2und3ygQ7zaQAAAP",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.372] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.373] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "621N2und3ygQ7zaQAAAP",
        "userId": "user-cleanup",
        "username": "Cleanup User"
      } Participant disconnected from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.569] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "ek6kl4kVxsdH9CBgAAAO"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.569] [32mINFO [0m [DisconnectHandler] {
        "socketId": "ek6kl4kVxsdH9CBgAAAO",
        "userId": "user-cleanup",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.571] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-cleanup",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "ek6kl4kVxsdH9CBgAAAO",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:33.574] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/lobbyDebug.test.ts
  ‚óè Console

    console.log
      [2025-06-09 20:46:34.266] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      üîß Starting debug test...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:191:17)

    console.log
      üîå Connecting socket...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:227:21)

    console.log
      [2025-06-09 20:46:34.353] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "fEYoxEn2yfSW1IAXAAAB",
        "user": {
          "id": "player-123",
          "userId": "player-123",
          "username": "Test Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.365] [32mINFO [0m [GameHandlers] {
        "socketId": "fEYoxEn2yfSW1IAXAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.366] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "fEYoxEn2yfSW1IAXAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.367] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "fEYoxEn2yfSW1IAXAAAB"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: fEYoxEn2yfSW1IAXAAAB

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:34.367] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "fEYoxEn2yfSW1IAXAAAB"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.367] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.367] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.367] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.367] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.368] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.368] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.368] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.368] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.368] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "fEYoxEn2yfSW1IAXAAAB"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      ‚úÖ Socket connected

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:233:29)

    console.log
      üì° Received event: connection_established [
        {
          socketId: 'fEYoxEn2yfSW1IAXAAAB',
          timestamp: '2025-06-09T18:46:34.354Z',
          user: { role: 'STUDENT', userId: 'player-123', username: 'Test Player' }
        }
      ]

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:223:21)

    console.log
      üè† Joining lobby...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:250:21)

    console.log
      üì§ Sent join_lobby event with full payload

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:257:21)

    console.log
      [2025-06-09 20:46:34.376] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-123",
        "username": "Test Player",
        "socketId": "fEYoxEn2yfSW1IAXAAAB"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      üì° Received event: room_joined [ { room: 'lobby_TEST123', timestamp: '2025-06-09T18:46:34.379Z' } ]

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:223:21)

    console.log
      üì° Received event: participants_list [
        {
          participants: [ [Object] ],
          gameId: 'e09283f9-b6f7-4114-9853-1232bcbd21d1',
          gameName: 'Test Game Debug'
        }
      ]

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:223:21)

    console.log
      ‚úÖ Received event: participants_list {
        participants: [
          {
            id: 'fEYoxEn2yfSW1IAXAAAB',
            userId: 'player-123',
            username: 'Test Player',
            avatarEmoji: 'üòä',
            joinedAt: 1749494794379
          }
        ],
        gameId: 'e09283f9-b6f7-4114-9853-1232bcbd21d1',
        gameName: 'Test Game Debug'
      }

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:208:21)

    console.log
      [2025-06-09 20:46:34.383] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e09283f9-b6f7-4114-9853-1232bcbd21d1",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.384] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      ‚úÖ Got participants list: {
        participants: [
          {
            id: 'fEYoxEn2yfSW1IAXAAAB',
            userId: 'player-123',
            username: 'Test Player',
            avatarEmoji: 'üòä',
            joinedAt: 1749494794379
          }
        ],
        gameId: 'e09283f9-b6f7-4114-9853-1232bcbd21d1',
        gameName: 'Test Game Debug'
      }

      at Timeout.<anonymous> (tests/integration/lobbyDebug.test.ts:264:33)

    console.log
      üîç Checking participantsResponse is defined...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:275:21)

    console.log
      ‚úÖ participantsResponse is defined

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:277:21)

    console.log
      üîç Checking participantsResponse.participants is defined...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:278:21)

    console.log
      ‚úÖ participantsResponse.participants is defined

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:280:21)

    console.log
      üîç Checking participants length is 1...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:281:21)

    console.log
      Actual length: 1

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:282:21)

    console.log
      ‚úÖ participants length is correct

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:284:21)

    console.log
      üîç Checking first participant username...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:285:21)

    console.log
      Actual username: Test Player

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:286:21)

    console.log
      ‚úÖ username is correct

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:288:21)

    console.log
      üö™ Leaving lobby...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:290:21)

    console.log
      üì§ Sent leave_lobby event

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:292:21)

    console.log
      [2025-06-09 20:46:34.472] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "fEYoxEn2yfSW1IAXAAAB"
      } Player leaving lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      üì° Received event: room_left [ { room: 'lobby_TEST123', timestamp: '2025-06-09T18:46:34.473Z' } ]

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:223:21)

    console.log
      ‚úÖ Received event: room_left { room: 'lobby_TEST123', timestamp: '2025-06-09T18:46:34.473Z' }

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:217:21)

    console.log
      üì° Received event: room_left [ { accessCode: 'TEST123' } ]

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:223:21)

    console.log
      ‚úÖ Received event: room_left { accessCode: 'TEST123' }

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:217:21)

    console.log
      [2025-06-09 20:46:34.475] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e09283f9-b6f7-4114-9853-1232bcbd21d1",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.476] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Stopped game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      ‚úÖ Got room_left event

      at Timeout.<anonymous> (tests/integration/lobbyDebug.test.ts:299:33)

    console.log
      üìã Getting updated participants list...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:310:21)

    console.log
      üì§ Sent get_participants event

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:312:21)

    console.log
      üì° Received event: room_joined [ { room: 'lobby_TEST123', timestamp: '2025-06-09T18:46:34.574Z' } ]

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:223:21)

    console.log
      üì° Received event: participants_list [
        {
          participants: [],
          gameId: 'e09283f9-b6f7-4114-9853-1232bcbd21d1',
          gameName: 'Test Game Debug'
        }
      ]

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:223:21)

    console.log
      ‚úÖ Received event: participants_list {
        participants: [],
        gameId: 'e09283f9-b6f7-4114-9853-1232bcbd21d1',
        gameName: 'Test Game Debug'
      }

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:208:21)

    console.log
      ‚úÖ Got updated participants list: {
        participants: [],
        gameId: 'e09283f9-b6f7-4114-9853-1232bcbd21d1',
        gameName: 'Test Game Debug'
      }

      at Timeout.<anonymous> (tests/integration/lobbyDebug.test.ts:319:33)

    console.log
      üîç Checking updatedParticipantsResponse is defined...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:330:21)

    console.log
      ‚úÖ updatedParticipantsResponse is defined

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:332:21)

    console.log
      üîç Checking updatedParticipantsResponse.participants is defined...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:333:21)

    console.log
      ‚úÖ updatedParticipantsResponse.participants is defined

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:335:21)

    console.log
      üîç Checking updated participants length is 0...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:336:21)

    console.log
      Actual updated length: 0

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:337:21)

    console.log
      ‚úÖ updated participants length is correct

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:339:21)

    console.log
      üîß Debug test completed successfully!

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:341:21)

    console.log
      üßπ Disconnecting socket...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:344:21)

    console.log
      [2025-06-09 20:46:34.675] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "fEYoxEn2yfSW1IAXAAAB"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.675] [32mINFO [0m [DisconnectHandler] {
        "socketId": "fEYoxEn2yfSW1IAXAAAB",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.675] [33mWARN [0m [DisconnectHandler] {
        "socketId": "fEYoxEn2yfSW1IAXAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:34.678] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "e09283f9-b6f7-4114-9853-1232bcbd21d1",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      ‚úÖ Socket disconnected and cleanup waited

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:349:21)

    console.log
      üßπ [afterAll] Calling serverCleanup...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:148:21)

    console.log
      ‚úÖ [afterAll] serverCleanup completed.

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:150:21)

    console.log
      üßπ [afterAll] Closing Socket.IO Redis clients...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:164:21)

    console.log
      ‚úÖ [afterAll] Socket.IO Redis clients closed.

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:166:21)

    console.log
      üßπ [afterAll] Quitting Redis client...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:173:21)

    console.log
      ‚úÖ [afterAll] Redis client quit.

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:175:21)

    console.log
      üßπ [afterAll] Disconnecting Prisma client...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:180:21)

    console.log
      ‚úÖ [afterAll] Prisma client disconnected.

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:182:21)

    console.log
      üèÅ [afterAll] Cleanup finished.

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:185:17)

PASS tests/integration/mockedGameHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-09 20:46:36.541] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:36.758] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "4d428107-d946-4db6-9d69-52d9300b46be",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:36.773] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-007zo53ff81zn"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:36.773] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-007zo53ff81zn"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'socket-007zo53ff81zn',
        joinedRoomSocketIds: []
      }

      at log (src/sockets/handlers/game/joinGame.ts:112:25)

    console.log
      [2025-06-09 20:46:36.785] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "9517d331-e835-43cd-a518-7d08905bb60a",
            "userId": "player-1_mbpg14hfs1r6am",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-09T18:46:36.781Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:36.786] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "9517d331-e835-43cd-a518-7d08905bb60a",
            "userId": "player-1_mbpg14hfs1r6am",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:36.787] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "4d428107-d946-4db6-9d69-52d9300b46be",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:36.788] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 1,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:36.906] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-3fcbbj00m3u"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:36.906] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-3fcbbj00m3u"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:36.927] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-of5j8532dg"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:36.927] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-of5j8532dg"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        questionId: 'q-3',
        answer: { selectedOption: 'b' },
        timeSpent: 5000
      } Socket ID: socket-of5j8532dg Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-09 20:46:36.934] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-of5j8532dg",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "questionId": "q-3",
          "answer": {
            "selectedOption": "b"
          },
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:36.937] [33mWARN [0m [GameAnswerHandler] {
        "socketId": "socket-of5j8532dg",
        "error": "Invalid payload",
        "details": {
          "_errors": [],
          "userId": {
            "_errors": [
              "Required"
            ]
          },
          "answer": {
            "_errors": [
              "Expected string, received object",
              "Expected number, received object",
              "Expected array, received object",
              "Expected array, received object"
            ]
          }
        }
      } Invalid game answer payload

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        questionId: 'q-3',
        answer: { selectedOption: 'b' },
        timeSpent: 5000
      } Socket ID: socket-of5j8532dg Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-09 20:46:36.938] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-of5j8532dg",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "questionId": "q-3",
          "answer": {
            "selectedOption": "b"
          },
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:36.938] [33mWARN [0m [GameAnswerHandler] {
        "socketId": "socket-of5j8532dg",
        "error": "Invalid payload",
        "details": {
          "_errors": [],
          "userId": {
            "_errors": [
              "Required"
            ]
          },
          "answer": {
            "_errors": [
              "Expected string, received object",
              "Expected number, received object",
              "Expected array, received object",
              "Expected array, received object"
            ]
          }
        }
      } Invalid game answer payload

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:36.953] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-mdb3rxeisp"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:36.954] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-mdb3rxeisp"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.131] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-9vmk4c9zdng"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.132] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-9vmk4c9zdng"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.177] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-mdw1nawtq6m"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.177] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-mdw1nawtq6m"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.194] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "DIFF123",
          "participant": {
            "id": "54b33992-721c-4800-8fcb-56935744028e",
            "userId": "player-1_mbpg14hfs1r6am",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-09T18:46:37.188Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": true,
          "differedAvailableFrom": "2025-06-09T18:46:37.162Z",
          "differedAvailableTo": "2025-06-09T19:46:37.162Z"
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.196] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DIFF123",
        "gameId": "0016051b-a417-435b-9ffc-760a72abf587",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.197] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 1
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.213] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-tfdn4pi8pu"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.213] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-tfdn4pi8pu"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.216] [33mWARN [0m [JoinGameHandler] {
        "errorPayload": {
          "message": "Differed mode not available at this time."
        }
      } Emitting game_error: differed window not available

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.239] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-mnb5cjjv3sf"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.239] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-mnb5cjjv3sf"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.242] [32mINFO [0m [JoinGameHandler] {
        "gameAlreadyPlayedPayload": {
          "accessCode": "DIFF123"
        }
      } Emitting game_already_played

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.257] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-1d74eqaq3ew"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.257] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-1d74eqaq3ew"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.276] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "DIFF123",
          "participant": {
            "id": "722cb3b0-e144-4b03-98cc-d60fd50bbe4e",
            "userId": "player-3_mbpg14hfs1r6am",
            "username": "Player 3",
            "avatar": "https://example.com/avatar3.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar3.jpg",
            "joinedAt": "2025-06-09T18:46:37.269Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": true,
          "differedAvailableFrom": "2025-06-09T18:46:37.218Z",
          "differedAvailableTo": "2025-06-09T19:46:37.218Z"
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.277] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DIFF123",
        "gameId": "0016051b-a417-435b-9ffc-760a72abf587",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.279] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 2
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'DIFF123',
        userId: 'player-3_mbpg14hfs1r6am',
        questionId: '31c653c9-1fa4-415d-80d2-2897289fb67a',
        answer: 'b',
        timeSpent: 2000
      } Socket ID: socket-1d74eqaq3ew Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-09 20:46:37.280] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-1d74eqaq3ew",
        "event": "game_answer",
        "payload": {
          "accessCode": "DIFF123",
          "userId": "player-3_mbpg14hfs1r6am",
          "questionId": "31c653c9-1fa4-415d-80d2-2897289fb67a",
          "answer": "b",
          "timeSpent": 2000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.302] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbpg14hfs1r6am",
        "questionId": "31c653c9-1fa4-415d-80d2-2897289fb67a"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at log (src/sockets/handlers/game/gameAnswer.ts:181:25)

    console.log
      [GAME_ANSWER] Adding current questionId 31c653c9-1fa4-415d-80d2-2897289fb67a to answered questions

      at log (src/sockets/handlers/game/gameAnswer.ts:193:29)

    console.log
      [GAME_ANSWER] Found 1/1 answered questions: [ '31c653c9-1fa4-415d-80d2-2897289fb67a' ]

      at log (src/sockets/handlers/game/gameAnswer.ts:200:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=1

      at log (src/sockets/handlers/game/gameAnswer.ts:209:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at log (src/sockets/handlers/game/gameAnswer.ts:219:29)

    console.log
      [2025-06-09 20:46:37.303] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbpg14hfs1r6am",
        "questionId": "31c653c9-1fa4-415d-80d2-2897289fb67a"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'DIFF123',
        userId: 'player-3_mbpg14hfs1r6am',
        questionId: '31c653c9-1fa4-415d-80d2-2897289fb67a',
        answer: 'b',
        timeSpent: 2000
      } Socket ID: socket-1d74eqaq3ew Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-09 20:46:37.303] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-1d74eqaq3ew",
        "event": "game_answer",
        "payload": {
          "accessCode": "DIFF123",
          "userId": "player-3_mbpg14hfs1r6am",
          "questionId": "31c653c9-1fa4-415d-80d2-2897289fb67a",
          "answer": "b",
          "timeSpent": 2000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.324] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbpg14hfs1r6am",
        "questionId": "31c653c9-1fa4-415d-80d2-2897289fb67a"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":"b","timestamp":"2025-06-09T18:46:37.286Z","questionUid":"31c653c9-1fa4-415d-80d2-2897289fb67a","timeTakenMs":2000}]

      at log (src/sockets/handlers/game/gameAnswer.ts:181:25)

    console.log
      [GAME_ANSWER] Found 1/1 answered questions: [ '31c653c9-1fa4-415d-80d2-2897289fb67a' ]

      at log (src/sockets/handlers/game/gameAnswer.ts:200:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=1

      at log (src/sockets/handlers/game/gameAnswer.ts:209:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at log (src/sockets/handlers/game/gameAnswer.ts:219:29)

    console.log
      [2025-06-09 20:46:37.325] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbpg14hfs1r6am",
        "questionId": "31c653c9-1fa4-415d-80d2-2897289fb67a"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.354] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-p8t2nfwp9z"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.354] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-p8t2nfwp9z"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'socket-p8t2nfwp9z',
        joinedRoomSocketIds: []
      }

      at log (src/sockets/handlers/game/joinGame.ts:112:25)

    console.log
      [2025-06-09 20:46:37.369] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "9517d331-e835-43cd-a518-7d08905bb60a",
            "userId": "player-1_mbpg14hfs1r6am",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-09T18:46:37.361Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.370] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "9517d331-e835-43cd-a518-7d08905bb60a",
            "userId": "player-1_mbpg14hfs1r6am",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.371] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "4d428107-d946-4db6-9d69-52d9300b46be",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.373] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 1,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.381] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.389] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789",
        "questionIndex": 0
      } Current question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        userId: 'player-1_mbpg14hfs1r6am',
        questionId: '8031e2a0-1eaf-495e-ba45-bad6fda4daa0',
        answer: 1,
        timeSpent: 5000
      } Socket ID: socket-p8t2nfwp9z Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-09 20:46:37.389] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-p8t2nfwp9z",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "userId": "player-1_mbpg14hfs1r6am",
          "questionId": "8031e2a0-1eaf-495e-ba45-bad6fda4daa0",
          "answer": 1,
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.408] [32mINFO [0m [GameAnswerHandler] {
        "leaderboard": [
          {
            "userId": "player-1_mbpg14hfs1r6am",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0
          }
        ],
        "roomName": "teacher_8d24e7bf-cb34-4630-91d2-1fde488b33b9_TST789"
      } Emitting leaderboard_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.408] [32mINFO [0m [GameAnswerHandler] {
        "questionId": "8031e2a0-1eaf-495e-ba45-bad6fda4daa0",
        "timeSpent": 5000
      } Emitting answer_received for non-differed mode

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Successfully emitted answer_received for question 8031e2a0-1eaf-495e-ba45-bad6fda4daa0 to socket socket-p8t2nfwp9z

      at log (src/sockets/handlers/game/gameAnswer.ts:245:29)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        userId: 'player-1_mbpg14hfs1r6am',
        questionId: '8031e2a0-1eaf-495e-ba45-bad6fda4daa0',
        answer: 1,
        timeSpent: 5000
      } Socket ID: socket-p8t2nfwp9z Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-09 20:46:37.409] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-p8t2nfwp9z",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "userId": "player-1_mbpg14hfs1r6am",
          "questionId": "8031e2a0-1eaf-495e-ba45-bad6fda4daa0",
          "answer": 1,
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.425] [32mINFO [0m [GameAnswerHandler] {
        "leaderboard": [
          {
            "userId": "player-1_mbpg14hfs1r6am",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0
          }
        ],
        "roomName": "teacher_8d24e7bf-cb34-4630-91d2-1fde488b33b9_TST789"
      } Emitting leaderboard_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:37.425] [32mINFO [0m [GameAnswerHandler] {
        "questionId": "8031e2a0-1eaf-495e-ba45-bad6fda4daa0",
        "timeSpent": 5000
      } Emitting answer_received for non-differed mode

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Successfully emitted answer_received for question 8031e2a0-1eaf-495e-ba45-bad6fda4daa0 to socket socket-p8t2nfwp9z

      at log (src/sockets/handlers/game/gameAnswer.ts:245:29)

    console.log
      [DEBUG before scoring] Redis key: mathquest:game:answers:TST789:8031e2a0-1eaf-495e-ba45-bad6fda4daa0 value: {
        'player-1_mbpg14hfs1r6am': '{"userId":"player-1_mbpg14hfs1r6am","answer":1,"timeSpent":5000,"submittedAt":1749494797420}'
      }

      at Object.<anonymous> (tests/integration/mockedGameHandler.test.ts:920:21)

    console.log
      [2025-06-09 20:46:37.432] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789",
        "questionId": "8031e2a0-1eaf-495e-ba45-bad6fda4daa0"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG after scoring] Redis key: mathquest:game:answers:TST789:8031e2a0-1eaf-495e-ba45-bad6fda4daa0 value: {
        'player-1_mbpg14hfs1r6am': '{"userId":"player-1_mbpg14hfs1r6am","answer":1,"timeSpent":5000,"submittedAt":1749494797420}'
      }

      at Object.<anonymous> (tests/integration/mockedGameHandler.test.ts:927:21)

FAIL tests/integration/gameHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-09 20:46:37.995] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.083] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.090] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "MiemV965Ay4J9YfcAAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.090] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "MiemV965Ay4J9YfcAAAB",
        "user": {
          "id": "player-123",
          "userId": "player-123",
          "username": "Test Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.095] [32mINFO [0m [GameHandlers] {
        "socketId": "MiemV965Ay4J9YfcAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.095] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "MiemV965Ay4J9YfcAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.095] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "MiemV965Ay4J9YfcAAAB"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: MiemV965Ay4J9YfcAAAB

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:38.095] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "MiemV965Ay4J9YfcAAAB"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.096] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.096] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.096] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.096] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.096] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.096] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.096] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.096] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.096] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "MiemV965Ay4J9YfcAAAB"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.100] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'MiemV965Ay4J9YfcAAAB',
        joinedRoomSocketIds: [ 'MiemV965Ay4J9YfcAAAB' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:112:25)

    console.log
      [2025-06-09 20:46:38.110] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.111] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Test Player",
        "avatarEmoji": "https://example.com/avatar.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.111] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.111] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Test Player",
        "avatarEmoji": "https://example.com/avatar.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.111] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.111] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.113] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.113] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.115] [32mINFO [0m [DisconnectHandler] {
        "socketId": "MiemV965Ay4J9YfcAAAB",
        "userId": "player-123",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.116] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.116] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.116] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-123",
        "accessCode": "TST789",
        "socketId": "MiemV965Ay4J9YfcAAAB"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.119] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "f88a7c41-16af-45cc-b13f-16bb2c4744a9",
            "userId": "player-123",
            "username": "Test Player",
            "avatar": "https://example.com/avatar.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar.jpg",
            "joinedAt": "2025-06-09T18:46:38.108Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.119] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "f88a7c41-16af-45cc-b13f-16bb2c4744a9",
            "userId": "player-123",
            "username": "Test Player",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.120] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "player-123",
          "socketId": "MiemV965Ay4J9YfcAAAB"
        },
        "room": "game_TST789"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.122] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.122] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.124] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "g5nisqQdB-Lgr1tqAAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.124] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "g5nisqQdB-Lgr1tqAAAE",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.124] [32mINFO [0m [GameHandlers] {
        "socketId": "g5nisqQdB-Lgr1tqAAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.124] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "g5nisqQdB-Lgr1tqAAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.124] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "g5nisqQdB-Lgr1tqAAAE"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: g5nisqQdB-Lgr1tqAAAE

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:38.124] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "g5nisqQdB-Lgr1tqAAAE"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.125] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.125] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.125] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.125] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.125] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.125] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.125] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.125] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.125] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "g5nisqQdB-Lgr1tqAAAE"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.126] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 1,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.128] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "a3vHY6_iy7jumwTwAAAF"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.128] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "a3vHY6_iy7jumwTwAAAF",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.129] [32mINFO [0m [GameHandlers] {
        "socketId": "a3vHY6_iy7jumwTwAAAF"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.129] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "a3vHY6_iy7jumwTwAAAF"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.129] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "a3vHY6_iy7jumwTwAAAF"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: a3vHY6_iy7jumwTwAAAF

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:38.129] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "a3vHY6_iy7jumwTwAAAF"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.130] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.130] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.130] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.130] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.130] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.130] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.130] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.130] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.130] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "a3vHY6_iy7jumwTwAAAF"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.140] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.142] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.142] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.142] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.142] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.142] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.143] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'g5nisqQdB-Lgr1tqAAAE',
        joinedRoomSocketIds: [ 'g5nisqQdB-Lgr1tqAAAE' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:112:25)

    console.log
      [2025-06-09 20:46:38.145] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.145] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.147] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'a3vHY6_iy7jumwTwAAAF',
        joinedRoomSocketIds: [ 'g5nisqQdB-Lgr1tqAAAE', 'a3vHY6_iy7jumwTwAAAF' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:112:25)

    console.log
      [2025-06-09 20:46:38.149] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.159] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.159] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.159] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.159] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.159] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.159] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.160] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "7a998dcf-1d82-423d-b827-8f88a141eb4f",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-09T18:46:38.153Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.160] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "7a998dcf-1d82-423d-b827-8f88a141eb4f",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.161] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.162] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.163] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "bfc9b2ea-efa2-4598-a00d-0cc86fa5da3a",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "https://example.com/avatar2.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar2.jpg",
            "joinedAt": "2025-06-09T18:46:38.155Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.163] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "bfc9b2ea-efa2-4598-a00d-0cc86fa5da3a",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.164] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
        "lobbyCount": 0,
        "gameCount": 2,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.165] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.166] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.166] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 3,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.167] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
        "lobbyCount": 0,
        "gameCount": 2,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.169] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 3,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: Redis participants: {
        'player-1': '{"id":"7a998dcf-1d82-423d-b827-8f88a141eb4f","userId":"player-1","username":"Player 1","avatar":"https://example.com/avatar1.jpg","score":0,"avatarEmoji":"https://example.com/avatar1.jpg","joinedAt":"2025-06-09T18:46:38.153Z","online":true,"socketId":"g5nisqQdB-Lgr1tqAAAE"}',
        'player-2': '{"userId":"player-2","username":"Player 2","avatarEmoji":"https://example.com/avatar2.jpg","score":0,"answers":[],"online":true,"lastSocketId":"a3vHY6_iy7jumwTwAAAF","joinedAt":"2025-06-09T18:46:38.165Z"}'
      }

      at Object.<anonymous> (tests/integration/gameHandler.test.ts:527:17)

    console.log
      [2025-06-09 20:46:38.266] [32mINFO [0m [DisconnectHandler] {
        "socketId": "g5nisqQdB-Lgr1tqAAAE",
        "userId": "player-1",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.266] [32mINFO [0m [DisconnectHandler] {
        "socketId": "a3vHY6_iy7jumwTwAAAF",
        "userId": "player-2",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.267] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-1",
        "accessCode": "TST789",
        "disconnectedSocketId": "g5nisqQdB-Lgr1tqAAAE",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.267] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TST789",
        "disconnectedSocketId": "a3vHY6_iy7jumwTwAAAF",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.272] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "RErMbnDjc-PDbDbsAAAI"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.272] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "RErMbnDjc-PDbDbsAAAI",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.273] [32mINFO [0m [GameHandlers] {
        "socketId": "RErMbnDjc-PDbDbsAAAI"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.273] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "RErMbnDjc-PDbDbsAAAI"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.273] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "RErMbnDjc-PDbDbsAAAI"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: RErMbnDjc-PDbDbsAAAI

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:38.273] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "RErMbnDjc-PDbDbsAAAI"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.273] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.273] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.273] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.273] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.273] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.274] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.274] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.274] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.274] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "RErMbnDjc-PDbDbsAAAI"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.275] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "RratG6kax-XxfF5uAAAJ"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.275] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "RratG6kax-XxfF5uAAAJ",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.275] [32mINFO [0m [GameHandlers] {
        "socketId": "RratG6kax-XxfF5uAAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.275] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "RratG6kax-XxfF5uAAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.276] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "RratG6kax-XxfF5uAAAJ"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: RratG6kax-XxfF5uAAAJ

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:38.276] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "RratG6kax-XxfF5uAAAJ"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.276] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.276] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.276] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.276] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.276] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.276] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.277] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.277] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.277] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "RratG6kax-XxfF5uAAAJ"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.283] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'RErMbnDjc-PDbDbsAAAI',
        joinedRoomSocketIds: [ 'RErMbnDjc-PDbDbsAAAI' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:112:25)

    console.log
      [2025-06-09 20:46:38.286] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.286] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.286] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.286] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.286] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.287] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'RratG6kax-XxfF5uAAAJ',
        joinedRoomSocketIds: [ 'RErMbnDjc-PDbDbsAAAI', 'RratG6kax-XxfF5uAAAJ' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:112:25)

    console.log
      [2025-06-09 20:46:38.287] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.287] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.287] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.287] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.287] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.287] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.292] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.294] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.294] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.295] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.297] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.297] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.297] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.298] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.301] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "bfc9b2ea-efa2-4598-a00d-0cc86fa5da3a",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "https://example.com/avatar2.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar2.jpg",
            "joinedAt": "2025-06-09T18:46:38.296Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.302] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "bfc9b2ea-efa2-4598-a00d-0cc86fa5da3a",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.303] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "7a998dcf-1d82-423d-b827-8f88a141eb4f",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-09T18:46:38.296Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.303] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "7a998dcf-1d82-423d-b827-8f88a141eb4f",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.304] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
        "lobbyCount": 0,
        "gameCount": 2,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.305] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "0c0460ad-8bf5-40ca-8906-00fe8ddd3c09",
        "lobbyCount": 0,
        "gameCount": 2,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.305] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 3,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.306] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 3,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: Redis participants: {
        'player-1': '{"id":"7a998dcf-1d82-423d-b827-8f88a141eb4f","userId":"player-1","username":"Player 1","avatar":"https://example.com/avatar1.jpg","score":0,"avatarEmoji":"https://example.com/avatar1.jpg","joinedAt":"2025-06-09T18:46:38.296Z","online":true,"socketId":"RErMbnDjc-PDbDbsAAAI"}',
        'player-2': '{"id":"bfc9b2ea-efa2-4598-a00d-0cc86fa5da3a","userId":"player-2","username":"Player 2","avatar":"https://example.com/avatar2.jpg","score":0,"avatarEmoji":"https://example.com/avatar2.jpg","joinedAt":"2025-06-09T18:46:38.296Z","online":true,"socketId":"RratG6kax-XxfF5uAAAJ"}'
      }

      at Object.<anonymous> (tests/integration/gameHandler.test.ts:623:17)

    console.log
      [2025-06-09 20:46:38.799] [32mINFO [0m [DisconnectHandler] {
        "socketId": "RErMbnDjc-PDbDbsAAAI",
        "userId": "player-1",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.800] [32mINFO [0m [DisconnectHandler] {
        "socketId": "RratG6kax-XxfF5uAAAJ",
        "userId": "player-2",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.803] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-1",
        "accessCode": "TST789",
        "disconnectedSocketId": "RErMbnDjc-PDbDbsAAAI",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:38.803] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TST789",
        "disconnectedSocketId": "RratG6kax-XxfF5uAAAJ",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)



  ‚óè Test suite failed to run

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/aflesch/mathquest/app/backend/tests/integration/gameHandler.test.ts:270:27

      267     }
      268 });
      269 
    ‚Üí 270 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `game_templates_creator_id_fkey`

      122 |
      123 | More Information: https://pris.ly/d/execute-raw
    > 124 | `)}var Co=({clientMethod:e,activeProvider:r})=>t=>{let n="",i;if(Nn(t))n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};else if(Array.isArray(t)){let[o,...s]=t;n=o,i={values:Gr(s||[]),__prismaRawParameters__:!0}}else switch(r){case"sqlite":case"mysql":{n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"cockroachdb":case"postgresql":case"postgres":{n=t.text,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"sqlserver":{n=$l(t),i={values:Gr(t.values),__prismaRawParameters__:!0};break}default:throw new Error(`The ${r} provider does not support ${e}`)}return i?.values?Ul(`prisma.${e}(${n}, ${i.values})`):Ul(`prisma.${e}(${n})`),{query:n,parameters:i}},Ql={requestArgsToMiddlewareArgs(e){return[e.strings,...e.values]},middlewareArgsToRequestArgs(e){let[r,...t]=e;return new oe(r,t)}},Gl={requestArgsToMiddlewareArgs(e){return[e]},middlewareArgsToRequestArgs(e){return e[0]}};function Ao(e){return function(t,n){let i,o=(s=e)=>{try{return s===void 0||s?.kind==="itx"?i??=Wl(t(s)):Wl(t(s))}catch(a){return Promise.reject(a)}};return{get spec(){return n},then(s,a){return o().then(s,a)},catch(s){return o().catch(s)},finally(s){return o().finally(s)},requestTransaction(s){let a=o(s);return a.requestTransaction?a.requestTransaction(s):a},[Symbol.toStringTag]:"PrismaPromise"}}}function Wl(e){return typeof e.then=="function"?e:Promise.resolve(e)}var Pf=bi.split(".")[0],Tf={isEnabled(){return!1},getTraceParent(){return"00-10-10-00"},dispatchEngineSpans(){},getActiveContext(){},runInChildSpan(e,r){return r()}},Io=class{isEnabled(){return this.getGlobalTracingHelper().isEnabled()}getTraceParent(r){return this.getGlobalTracingHelper().getTraceParent(r)}dispatchEngineSpans(r){return this.getGlobalTracingHelper().dispatchEngineSpans(r)}getActiveContext(){return this.getGlobalTracingHelper().getActiveContext()}runInChildSpan(r,t){return this.getGlobalTracingHelper().runInChildSpan(r,t)}getGlobalTracingHelper(){let r=globalThis[`V${Pf}_PRISMA_INSTRUMENTATION`],t=globalThis.PRISMA_INSTRUMENTATION;return r?.helper??t?.helper??Tf}};function Jl(){return new Io}function Hl(e,r=()=>{}){let t,n=new Promise(i=>t=i);return{then(i){return--e===0&&t(r()),i?.(n)}}}function Kl(e){return typeof e=="string"?e:e.reduce((r,t)=>{let n=typeof t=="string"?t:t.level;return n==="query"?r:r&&(t==="info"||r==="info")?"info":n},void 0)}var Jn=class{_middlewares=[];use(r){this._middlewares.push(r)}get(r){return this._middlewares[r]}has(r){return!!this._middlewares[r]}length(){return this._middlewares.length}};var zl=k(ki());function Hn(e){return typeof e.batchRequestIdx=="number"}function Yl(e){if(e.action!=="findUnique"&&e.action!=="findUniqueOrThrow")return;let r=[];return e.modelName&&r.push(e.modelName),e.query.arguments&&r.push(ko(e.query.arguments)),r.push(ko(e.query.selection)),r.join("")}function ko(e){return`(${Object.keys(e).sort().map(t=>{let n=e[t];return typeof n=="object"&&n!==null?`(${t} ${ko(n)})`:t}).join(" ")})`}var Sf={aggregate:!1,aggregateRaw:!1,createMany:!0,createManyAndReturn:!0,createOne:!0,deleteMany:!0,deleteOne:!0,executeRaw:!0,findFirst:!1,findFirstOrThrow:!1,findMany:!1,findRaw:!1,findUnique:!1,findUniqueOrThrow:!1,groupBy:!1,queryRaw:!1,runCommandRaw:!0,updateMany:!0,updateManyAndReturn:!0,updateOne:!0,upsertOne:!0};function Oo(e){return Sf[e]}var Kn=class{constructor(r){this.options=r;this.batches={}}batches;tickActive=!1;request(r){let t=this.options.batchBy(r);return t?(this.batches[t]||(this.batches[t]=[],this.tickActive||(this.tickActive=!0,process.nextTick(()=>{this.dispatchBatches(),this.tickActive=!1}))),new Promise((n,i)=>{this.batches[t].push({request:r,resolve:n,reject:i})})):this.options.singleLoader(r)}dispatchBatches(){for(let r in this.batches){let t=this.batches[r];delete this.batches[r],t.length===1?this.options.singleLoader(t[0].request).then(n=>{n instanceof Error?t[0].reject(n):t[0].resolve(n)}).catch(n=>{t[0].reject(n)}):(t.sort((n,i)=>this.options.batchOrder(n.request,i.request)),this.options.batchLoader(t.map(n=>n.request)).then(n=>{if(n instanceof Error)for(let i=0;i<t.length;i++)t[i].reject(n);else for(let i=0;i<t.length;i++){let o=n[i];o instanceof Error?t[i].reject(o):t[i].resolve(o)}}).catch(n=>{for(let i=0;i<t.length;i++)t[i].reject(n)}))}}get[Symbol.toStringTag](){return"DataLoader"}};function mr(e,r){if(r===null)return r;switch(e){case"bigint":return BigInt(r);case"bytes":{let{buffer:t,byteOffset:n,byteLength:i}=Buffer.from(r,"base64");return new Uint8Array(t,n,i)}case"decimal":return new ve(r);case"datetime":case"date":return new Date(r);case"time":return new Date(`1970-01-01T${r}Z`);case"bigint-array":return r.map(t=>mr("bigint",t));case"bytes-array":return r.map(t=>mr("bytes",t));case"decimal-array":return r.map(t=>mr("decimal",t));case"datetime-array":return r.map(t=>mr("datetime",t));case"date-array":return r.map(t=>mr("date",t));case"time-array":return r.map(t=>mr("time",t));default:return r}}function Yn(e){let r=[],t=Rf(e);for(let n=0;n<e.rows.length;n++){let i=e.rows[n],o={...t};for(let s=0;s<i.length;s++)o[e.columns[s]]=mr(e.types[s],i[s]);r.push(o)}return r}function Rf(e){let r={};for(let t=0;t<e.columns.length;t++)r[e.columns[t]]=null;return r}var Cf=N("prisma:client:request_handler"),zn=class{client;dataloader;logEmitter;constructor(r,t){this.logEmitter=t,this.client=r,this.dataloader=new Kn({batchLoader:il(async({requests:n,customDataProxyFetch:i})=>{let{transaction:o,otelParentCtx:s}=n[0],a=n.map(p=>p.protocolQuery),l=this.client._tracingHelper.getTraceParent(s),u=n.some(p=>Oo(p.protocolQuery.action));return(await this.client._engine.requestBatch(a,{traceparent:l,transaction:Af(o),containsWrite:u,customDataProxyFetch:i})).map((p,d)=>{if(p instanceof Error)return p;try{return this.mapQueryEngineResult(n[d],p)}catch(f){return f}})}),singleLoader:async n=>{let i=n.transaction?.kind==="itx"?Zl(n.transaction):void 0,o=await this.client._engine.request(n.protocolQuery,{traceparent:this.client._tracingHelper.getTraceParent(),interactiveTransaction:i,isWrite:Oo(n.protocolQuery.action),customDataProxyFetch:n.customDataProxyFetch});return this.mapQueryEngineResult(n,o)},batchBy:n=>n.transaction?.id?`transaction-${n.transaction.id}`:Yl(n.protocolQuery),batchOrder(n,i){return n.transaction?.kind==="batch"&&i.transaction?.kind==="batch"?n.transaction.index-i.transaction.index:0}})}async request(r){try{return await this.dataloader.request(r)}catch(t){let{clientMethod:n,callsite:i,transaction:o,args:s,modelName:a}=r;this.handleAndLogRequestError({error:t,clientMethod:n,callsite:i,transaction:o,args:s,modelName:a,globalOmit:r.globalOmit})}}mapQueryEngineResult({dataPath:r,unpacker:t},n){let i=n?.data,o=this.unpack(i,r,t);return process.env.PRISMA_CLIENT_GET_TIME?{data:o}:o}handleAndLogRequestError(r){try{this.handleRequestError(r)}catch(t){throw this.logEmitter&&this.logEmitter.emit("error",{message:t.message,target:r.clientMethod,timestamp:new Date}),t}}handleRequestError({error:r,clientMethod:t,callsite:n,transaction:i,args:o,modelName:s,globalOmit:a}){if(Cf(r),If(r,i))throw r;if(r instanceof z&&kf(r)){let u=Xl(r.meta);An({args:o,errors:[u],callsite:n,errorFormat:this.client._errorFormat,originalMethod:t,clientVersion:this.client._clientVersion,globalOmit:a})}let l=r.message;if(n&&(l=bn({callsite:n,originalMethod:t,isPanic:r.isPanic,showColors:this.client._errorFormat==="pretty",message:l})),l=this.sanitizeMessage(l),r.code){let u=s?{modelName:s,...r.meta}:r.meta;throw new z(l,{code:r.code,clientVersion:this.client._clientVersion,meta:u,batchRequestIdx:r.batchRequestIdx})}else{if(r.isPanic)throw new le(l,this.client._clientVersion);if(r instanceof j)throw new j(l,{clientVersion:this.client._clientVersion,batchRequestIdx:r.batchRequestIdx});if(r instanceof T)throw new T(l,this.client._clientVersion);if(r instanceof le)throw new le(l,this.client._clientVersion)}throw r.clientVersion=this.client._clientVersion,r}sanitizeMessage(r){return this.client._errorFormat&&this.client._errorFormat!=="pretty"?(0,zl.default)(r):r}unpack(r,t,n){if(!r||(r.data&&(r=r.data),!r))return r;let i=Object.keys(r)[0],o=Object.values(r)[0],s=t.filter(u=>u!=="select"&&u!=="include"),a=io(o,s),l=i==="queryRaw"?Yn(a):Tr(a);return n?n(l):l}get[Symbol.toStringTag](){return"RequestHandler"}};function Af(e){if(e){if(e.kind==="batch")return{kind:"batch",options:{isolationLevel:e.isolationLevel}};if(e.kind==="itx")return{kind:"itx",options:Zl(e)};_e(e,"Unknown transaction kind")}}function Zl(e){return{id:e.id,payload:e.payload}}function If(e,r){return Hn(e)&&r?.kind==="batch"&&e.batchRequestIdx!==r.index}function kf(e){return e.code==="P2009"||e.code==="P2012"}function Xl(e){if(e.kind==="Union")return{kind:"Union",errors:e.errors.map(Xl)};if(Array.isArray(e.selectionPath)){let[,...r]=e.selectionPath;return{...e,selectionPath:r}}return e}var eu="6.7.0";var ru=eu;var su=k(Gi());var D=class extends Error{constructor(r){super(r+`
          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ^
      125 | Read more at https://pris.ly/d/client-constructor`),this.name="PrismaClientConstructorValidationError"}get[Symbol.toStringTag](){return"PrismaClientConstructorValidationError"}};x(D,"PrismaClientConstructorValidationError");var tu=["datasources","datasourceUrl","errorFormat","adapter","log","transactionOptions","omit","__internal"],nu=["pretty","colorless","minimal"],iu=["info","query","warn","error"],Df={datasources:(e,{datasourceNames:r})=>{if(e){if(typeof e!="object"||Array.isArray(e))throw new D(`Invalid value ${JSON.stringify(e)} for "datasources" provided to PrismaClient constructor`);for(let[t,n]of Object.entries(e)){if(!r.includes(t)){let i=Wr(t,r)||` Available datasources: ${r.join(", ")}`;throw new D(`Unknown datasource ${t} provided to PrismaClient constructor.${i}`)}if(typeof n!="object"||Array.isArray(n))throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      126 | It should have this form: { url: "CONNECTION_STRING" }`);if(n&&typeof n=="object")for(let[i,o]of Object.entries(n)){if(i!=="url")throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      127 | It should have this form: { url: "CONNECTION_STRING" }`);if(typeof o!="string")throw new D(`Invalid value ${JSON.stringify(o)} for datasource "${t}" provided to PrismaClient constructor.

      at zn.handleRequestError (src/db/generated/client/runtime/library.js:124:7459)
      at zn.handleRequestError [as handleAndLogRequestError] (src/db/generated/client/runtime/library.js:124:6784)
      at zn.handleAndLogRequestError [as request] (src/db/generated/client/runtime/library.js:124:6491)
      at l (src/db/generated/client/runtime/library.js:133:9778)
      at Object.<anonymous> (tests/integration/gameHandler.test.ts:270:9)

PASS tests/integration/socketConnection.test.ts
  ‚óè Console

    console.log
      Connecting to server...

      at Object.<anonymous> (tests/integration/socketConnection.test.ts:80:17)

    console.log
      [2025-06-09 20:46:39.721] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.725] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "YmlmFtIt1wHC8T8ZAAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.725] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "YmlmFtIt1wHC8T8ZAAAB",
        "user": {
          "id": "test-player-123",
          "userId": "test-player-123",
          "username": "test-player-123",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.731] [32mINFO [0m [GameHandlers] {
        "socketId": "YmlmFtIt1wHC8T8ZAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.732] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "YmlmFtIt1wHC8T8ZAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.732] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "YmlmFtIt1wHC8T8ZAAAB"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: YmlmFtIt1wHC8T8ZAAAB

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:39.732] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "YmlmFtIt1wHC8T8ZAAAB"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.732] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.732] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.732] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.732] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.733] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.733] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.733] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.733] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.733] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "YmlmFtIt1wHC8T8ZAAAB"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket connected successfully

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:60:21)

    console.log
      Received connection_established event: {
        socketId: 'YmlmFtIt1wHC8T8ZAAAB',
        timestamp: '2025-06-09T18:46:39.725Z',
        user: {
          role: 'STUDENT',
          userId: 'test-player-123',
          username: 'test-player-123'
        }
      }

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:71:21)

    console.log
      Authentication test connecting to server...

      at Object.<anonymous> (tests/integration/socketConnection.test.ts:122:17)

    console.log
      [2025-06-09 20:46:39.745] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "rAxmh4UgLBr1n6DYAAAD"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.745] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "rAxmh4UgLBr1n6DYAAAD",
        "user": {
          "id": "test-player-123",
          "userId": "test-player-123",
          "username": "test-player-123",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.745] [32mINFO [0m [GameHandlers] {
        "socketId": "rAxmh4UgLBr1n6DYAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.745] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "rAxmh4UgLBr1n6DYAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.745] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "rAxmh4UgLBr1n6DYAAAD"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: rAxmh4UgLBr1n6DYAAAD

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:39.745] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "rAxmh4UgLBr1n6DYAAAD"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.746] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.746] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.746] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.746] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.746] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.746] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.746] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.746] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.746] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "rAxmh4UgLBr1n6DYAAAD"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      Authentication test socket connected successfully

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:103:21)

    console.log
      Authentication test received connection_established event: {
        socketId: 'rAxmh4UgLBr1n6DYAAAD',
        timestamp: '2025-06-09T18:46:39.745Z',
        user: {
          role: 'STUDENT',
          userId: 'test-player-123',
          username: 'test-player-123'
        }
      }

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:113:21)

    console.log
      [2025-06-09 20:46:39.748] [32mINFO [0m [DisconnectHandler] {
        "socketId": "rAxmh4UgLBr1n6DYAAAD",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.748] [33mWARN [0m [DisconnectHandler] {
        "socketId": "rAxmh4UgLBr1n6DYAAAD",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.748] [32mINFO [0m [DisconnectHandler] {
        "socketId": "YmlmFtIt1wHC8T8ZAAAB",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:39.748] [33mWARN [0m [DisconnectHandler] {
        "socketId": "YmlmFtIt1wHC8T8ZAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/practiceMode.test.ts
  ‚óè Console

    console.log
      [2025-06-09 20:46:40.830] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.940] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "6151b583-f8c3-40a7-8031-f9f46ca5d042",
        "accessCode": "PRACTICE1"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket query params: {
        token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJwcmFjdGljZS1wbGF5ZXItMSIsInVzZXJuYW1lIjoiUHJhY3RpY2UgUGxheWVyIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk0OTQ4MDAsImV4cCI6MTc0OTQ5ODQwMH0.AW-wPJAHgokL-kqUnuPP2m6gPFSGetTWOIz529hXTxg',
        role: 'STUDENT'
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:134:17)

    console.log
      [2025-06-09 20:46:40.945] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB",
        "user": {
          "id": "practice-player-1",
          "userId": "practice-player-1",
          "username": "Practice Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.953] [32mINFO [0m [GameHandlers] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.954] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.954] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: OXlBj-MLhhTwd1PHAAAB

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-09 20:46:40.954] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.954] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.955] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.955] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.955] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.955] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.955] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.956] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.956] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.956] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] connection_established [
        {
          socketId: 'OXlBj-MLhhTwd1PHAAAB',
          timestamp: '2025-06-09T18:46:40.946Z',
          user: {
            role: 'STUDENT',
            userId: 'practice-player-1',
            username: 'Practice Player'
          }
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      Socket connected and ready to emit events, ID: OXlBj-MLhhTwd1PHAAAB

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:162:17)

    console.log
      Waiting for event: game_joined with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-06-09 20:46:40.984] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.985] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "username": "Practice Player"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.985] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.985] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "username": "Practice Player"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.985] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.985] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.987] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "gameJoinPayload": {
          "gameId": "6151b583-f8c3-40a7-8031-f9f46ca5d042",
          "accessCode": "PRACTICE1",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.988] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "gameJoinPayload": {
          "gameId": "6151b583-f8c3-40a7-8031-f9f46ca5d042",
          "accessCode": "PRACTICE1",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.988] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "PRACTICE1",
          "participant": {
            "id": "d30093fe-e94e-4e68-8a84-1e5a02104409",
            "userId": "practice-player-1",
            "username": "Practice Player",
            "avatar": "üòÄ",
            "score": 0,
            "joinedAt": "2025-06-09T18:46:40.979Z",
            "online": true
          },
          "gameStatus": "waiting",
          "isDiffered": true
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          gameId: '6151b583-f8c3-40a7-8031-f9f46ca5d042',
          accessCode: 'PRACTICE1',
          status: 'pending',
          currentQuestionIndex: -1,
          totalQuestions: 2,
          timer: { startedAt: 0, duration: 0, isPaused: true },
          question: null
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      ‚úÖ Event received: game_joined {
        gameId: '6151b583-f8c3-40a7-8031-f9f46ca5d042',
        accessCode: 'PRACTICE1',
        status: 'pending',
        currentQuestionIndex: -1,
        totalQuestions: 2,
        timer: { startedAt: 0, duration: 0, isPaused: true },
        question: null
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      [SOCKET EVENT] participant_joined [
        {
          userId: 'practice-player-1',
          username: 'Practice Player',
          playMode: 'practice'
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          gameId: '6151b583-f8c3-40a7-8031-f9f46ca5d042',
          accessCode: 'PRACTICE1',
          status: 'pending',
          currentQuestionIndex: -1,
          totalQuestions: 2,
          timer: { startedAt: 0, duration: 0, isPaused: true },
          question: null
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [SOCKET EVENT] participant_joined [
        {
          userId: 'practice-player-1',
          username: 'Practice Player',
          playMode: 'practice'
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          accessCode: 'PRACTICE1',
          participant: {
            id: 'd30093fe-e94e-4e68-8a84-1e5a02104409',
            userId: 'practice-player-1',
            username: 'Practice Player',
            avatar: 'üòÄ',
            score: 0,
            joinedAt: '2025-06-09T18:46:40.979Z',
            online: true
          },
          gameStatus: 'waiting',
          isDiffered: true
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      Successfully received game_joined event, now starting game...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:171:17)

    console.log
      Emitted start_game again to ensure it gets processed

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:187:17)

    console.log
      [2025-06-09 20:46:40.991] [32mINFO [0m [GameHandlers] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1"
        }
      } Start game event received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.991] [32mINFO [0m [GameHandlers] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1"
        }
      } Start game event received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.992] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "PRACTICE1",
        "gameId": "6151b583-f8c3-40a7-8031-f9f46ca5d042",
        "lobbyCount": 0,
        "gameCount": 1,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.992] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.993] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.994] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 1,
        "room": "game_PRACTICE1"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:40.999] [32mINFO [0m [GameHandlers] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB",
        "questionId": "d4366d00-e7d2-4328-8721-21c9008e3cee"
      } Sending first question

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_question [
        {
          uid: 'd4366d00-e7d2-4328-8721-21c9008e3cee',
          text: 'What is 1+1?',
          answerOptions: [ '1', '2', '3' ],
          correctAnswers: [ false, true, false ],
          timeLimit: 20,
          questionType: 'multiple_choice_single_answer',
          themes: [ 'arithmetic' ],
          difficulty: 1,
          discipline: 'math',
          title: 'Practice Q1',
          currentQuestionIndex: 0,
          totalQuestions: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        uid: 'd4366d00-e7d2-4328-8721-21c9008e3cee',
        text: 'What is 1+1?',
        answerOptions: [ '1', '2', '3' ],
        correctAnswers: [ false, true, false ],
        timeLimit: 20,
        questionType: 'multiple_choice_single_answer',
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q1',
        currentQuestionIndex: 0,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:156:21)

    console.log
      ‚úÖ Direct handler for game_question event received: {
        uid: 'd4366d00-e7d2-4328-8721-21c9008e3cee',
        text: 'What is 1+1?',
        answerOptions: [ '1', '2', '3' ],
        correctAnswers: [ false, true, false ],
        timeLimit: 20,
        questionType: 'multiple_choice_single_answer',
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q1',
        currentQuestionIndex: 0,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:180:25)

    console.log
      Promise resolved with game_question data

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:191:17)

    console.log
      Waiting for event: answer_received with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-06-09 20:46:41.001] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "d4366d00-e7d2-4328-8721-21c9008e3cee",
        "answer": 1,
        "timeSpent": 1000,
        "socketId": "OXlBj-MLhhTwd1PHAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: 'd4366d00-e7d2-4328-8721-21c9008e3cee',
        answer: 1,
        timeSpent: 1000
      } Socket ID: OXlBj-MLhhTwd1PHAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-09 20:46:41.002] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "d4366d00-e7d2-4328-8721-21c9008e3cee",
          "answer": 1,
          "timeSpent": 1000
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: 'd4366d00-e7d2-4328-8721-21c9008e3cee',
        answer: 1,
        timeSpent: 1000
      } Socket ID: OXlBj-MLhhTwd1PHAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-09 20:46:41.003] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "d4366d00-e7d2-4328-8721-21c9008e3cee",
          "answer": 1,
          "timeSpent": 1000
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.003] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "d4366d00-e7d2-4328-8721-21c9008e3cee",
        "answer": 1,
        "timeSpent": 1000,
        "socketId": "OXlBj-MLhhTwd1PHAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.007] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.008] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.008] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.008] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.015] [32mINFO [0m [GameHandlers] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB",
        "questionId": "d4366d00-e7d2-4328-8721-21c9008e3cee"
      } Sending first question

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_question [
        {
          uid: 'd4366d00-e7d2-4328-8721-21c9008e3cee',
          text: 'What is 1+1?',
          answerOptions: [ '1', '2', '3' ],
          correctAnswers: [ false, true, false ],
          timeLimit: 20,
          questionType: 'multiple_choice_single_answer',
          themes: [ 'arithmetic' ],
          difficulty: 1,
          discipline: 'math',
          title: 'Practice Q1',
          currentQuestionIndex: 0,
          totalQuestions: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        uid: 'd4366d00-e7d2-4328-8721-21c9008e3cee',
        text: 'What is 1+1?',
        answerOptions: [ '1', '2', '3' ],
        correctAnswers: [ false, true, false ],
        timeLimit: 20,
        questionType: 'multiple_choice_single_answer',
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q1',
        currentQuestionIndex: 0,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:156:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: 'd4366d00-e7d2-4328-8721-21c9008e3cee',
          timeSpent: 1000,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      ‚úÖ Event received: answer_received {
        questionId: 'd4366d00-e7d2-4328-8721-21c9008e3cee',
        timeSpent: 1000,
        correct: true,
        correctAnswers: [ false, true, false ]
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: 'd4366d00-e7d2-4328-8721-21c9008e3cee',
          timeSpent: 1000,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      Waiting for event: game_question with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-06-09 20:46:41.030] [32mINFO [0m [RequestNextQuestionHandler] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB",
        "event": "request_next_question",
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "currentQuestionId": "d4366d00-e7d2-4328-8721-21c9008e3cee"
      } Player requested next question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.031] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "d4366d00-e7d2-4328-8721-21c9008e3cee"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:181:25)

    console.log
      [GAME_ANSWER] Adding current questionId d4366d00-e7d2-4328-8721-21c9008e3cee to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:193:29)

    console.log
      [GAME_ANSWER] Found 1/2 answered questions: [ 'd4366d00-e7d2-4328-8721-21c9008e3cee' ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:200:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:209:25)

    console.log
      [GAME_ANSWER] Not all questions answered yet. Waiting for client to request next question.

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:226:29)

    console.log
      [2025-06-09 20:46:41.031] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "d4366d00-e7d2-4328-8721-21c9008e3cee"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:181:25)

    console.log
      [GAME_ANSWER] Adding current questionId d4366d00-e7d2-4328-8721-21c9008e3cee to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:193:29)

    console.log
      [GAME_ANSWER] Found 1/2 answered questions: [ 'd4366d00-e7d2-4328-8721-21c9008e3cee' ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:200:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:209:25)

    console.log
      [GAME_ANSWER] Not all questions answered yet. Waiting for client to request next question.

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:226:29)

    console.log
      [2025-06-09 20:46:41.037] [32mINFO [0m [RequestNextQuestionHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "nextQuestionId": "aedc4210-d2dd-4ed6-9ae9-8f92955cc94a"
      } Sending next question

      at log (src/utils/logger.ts:102:21)

    console.log
      [REQUEST_NEXT_QUESTION] About to send question: {
        uid: 'aedc4210-d2dd-4ed6-9ae9-8f92955cc94a',
        text: 'What is 2+2?',
        index: 1
      }

      at Socket.log (src/sockets/handlers/game/requestNextQuestion.ts:84:25)

    console.log
      [SOCKET EVENT] game_question [
        {
          question: {
            uid: 'aedc4210-d2dd-4ed6-9ae9-8f92955cc94a',
            text: 'What is 2+2?',
            type: 'multiple_choice_single_answer',
            answers: [Array]
          },
          timer: 20,
          questionIndex: 1,
          totalQuestions: 2,
          questionState: 'active'
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        question: {
          uid: 'aedc4210-d2dd-4ed6-9ae9-8f92955cc94a',
          text: 'What is 2+2?',
          type: 'multiple_choice_single_answer',
          answers: [ '3', '4', '5' ]
        },
        timer: 20,
        questionIndex: 1,
        totalQuestions: 2,
        questionState: 'active'
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:156:21)

    console.log
      ‚úÖ Event received: game_question {
        question: {
          uid: 'aedc4210-d2dd-4ed6-9ae9-8f92955cc94a',
          text: 'What is 2+2?',
          type: 'multiple_choice_single_answer',
          answers: [ '3', '4', '5' ]
        },
        timer: 20,
        questionIndex: 1,
        totalQuestions: 2,
        questionState: 'active'
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      Answering second question: {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: 'aedc4210-d2dd-4ed6-9ae9-8f92955cc94a',
        answer: 1,
        timeSpent: 1200
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:207:17)

    console.log
      Waiting for event: answer_received with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-06-09 20:46:41.040] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "aedc4210-d2dd-4ed6-9ae9-8f92955cc94a",
        "answer": 1,
        "timeSpent": 1200,
        "socketId": "OXlBj-MLhhTwd1PHAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: 'aedc4210-d2dd-4ed6-9ae9-8f92955cc94a',
        answer: 1,
        timeSpent: 1200
      } Socket ID: OXlBj-MLhhTwd1PHAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-09 20:46:41.040] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "aedc4210-d2dd-4ed6-9ae9-8f92955cc94a",
          "answer": 1,
          "timeSpent": 1200
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: 'aedc4210-d2dd-4ed6-9ae9-8f92955cc94a',
        answer: 1,
        timeSpent: 1200
      } Socket ID: OXlBj-MLhhTwd1PHAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-09 20:46:41.041] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "aedc4210-d2dd-4ed6-9ae9-8f92955cc94a",
          "answer": 1,
          "timeSpent": 1200
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.041] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "aedc4210-d2dd-4ed6-9ae9-8f92955cc94a",
        "answer": 1,
        "timeSpent": 1200,
        "socketId": "OXlBj-MLhhTwd1PHAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.044] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.044] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.044] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.044] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: 'aedc4210-d2dd-4ed6-9ae9-8f92955cc94a',
          timeSpent: 1200,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      ‚úÖ Event received: answer_received {
        questionId: 'aedc4210-d2dd-4ed6-9ae9-8f92955cc94a',
        timeSpent: 1200,
        correct: true,
        correctAnswers: [ false, true, false ]
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: 'aedc4210-d2dd-4ed6-9ae9-8f92955cc94a',
          timeSpent: 1200,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      Received feedback for second question: {
        questionId: 'aedc4210-d2dd-4ed6-9ae9-8f92955cc94a',
        timeSpent: 1200,
        correct: true,
        correctAnswers: [ false, true, false ]
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:210:17)

    console.log
      Requesting to proceed after last question...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:221:17)

    console.log
      Waiting for game_ended event after requesting next question...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:225:17)

    console.log
      Waiting for event: game_ended with timeout 15000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-06-09 20:46:41.061] [32mINFO [0m [RequestNextQuestionHandler] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB",
        "event": "request_next_question",
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1"
      } Player requested next question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.062] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "aedc4210-d2dd-4ed6-9ae9-8f92955cc94a"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":1,"timestamp":"2025-06-09T18:46:41.012Z","questionUid":"d4366d00-e7d2-4328-8721-21c9008e3cee","timeTakenMs":1000}]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:181:25)

    console.log
      [GAME_ANSWER] Adding current questionId aedc4210-d2dd-4ed6-9ae9-8f92955cc94a to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:193:29)

    console.log
      [GAME_ANSWER] Found 2/2 answered questions: [
        'd4366d00-e7d2-4328-8721-21c9008e3cee',
        'aedc4210-d2dd-4ed6-9ae9-8f92955cc94a'
      ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:200:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=2, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:209:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:219:29)

    console.log
      [2025-06-09 20:46:41.062] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "aedc4210-d2dd-4ed6-9ae9-8f92955cc94a"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.062] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "aedc4210-d2dd-4ed6-9ae9-8f92955cc94a"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":1,"timestamp":"2025-06-09T18:46:41.012Z","questionUid":"d4366d00-e7d2-4328-8721-21c9008e3cee","timeTakenMs":1000}]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:181:25)

    console.log
      [GAME_ANSWER] Adding current questionId aedc4210-d2dd-4ed6-9ae9-8f92955cc94a to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:193:29)

    console.log
      [GAME_ANSWER] Found 2/2 answered questions: [
        'd4366d00-e7d2-4328-8721-21c9008e3cee',
        'aedc4210-d2dd-4ed6-9ae9-8f92955cc94a'
      ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:200:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=2, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:209:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:219:29)

    console.log
      [2025-06-09 20:46:41.063] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "aedc4210-d2dd-4ed6-9ae9-8f92955cc94a"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.070] [32mINFO [0m [RequestNextQuestionHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "correctCount": 2,
        "total": 2
      } Practice mode completed, sending final score

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_ended [
        {
          accessCode: 'PRACTICE1',
          score: 2,
          totalQuestions: 2,
          correct: 2,
          total: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      üëÄ DIRECT LISTENER: game_ended event received: {
        accessCode: 'PRACTICE1',
        score: 2,
        totalQuestions: 2,
        correct: 2,
        total: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:216:21)

    console.log
      ‚úÖ Event received: game_ended {
        accessCode: 'PRACTICE1',
        score: 2,
        totalQuestions: 2,
        correct: 2,
        total: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      ‚úÖ Successfully received game_ended event: {
        accessCode: 'PRACTICE1',
        score: 2,
        totalQuestions: 2,
        correct: 2,
        total: 2
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:227:17)

    console.log
      Test completed successfully, disconnecting socket

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:232:17)

    console.log
      [2025-06-09 20:46:41.073] [32mINFO [0m [DisconnectHandler] {
        "socketId": "OXlBj-MLhhTwd1PHAAAB",
        "userId": "practice-player-1",
        "accessCode": "PRACTICE1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.074] [32mINFO [0m [DisconnectHandler] {
        "userId": "practice-player-1",
        "accessCode": "PRACTICE1",
        "socketId": "OXlBj-MLhhTwd1PHAAAB"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.079] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "practice-player-1",
          "socketId": "OXlBj-MLhhTwd1PHAAAB"
        },
        "room": "game_PRACTICE1"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.081] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "PRACTICE1",
        "gameId": "6151b583-f8c3-40a7-8031-f9f46ca5d042",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/projectorHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-09 20:46:41.731] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.822] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "eb50286f-fe6e-4fcb-97f7-2c8d65660851",
        "accessCode": "PROJ123"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.824] [31mERROR[0m [GameStateService] {
        "gameInstanceId": "PROJ123"
      } Game instance not found

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.881] [32mINFO [0m [ProjectorHandler] Projector joined room: projector_eb50286f-fe6e-4fcb-97f7-2c8d65660851

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:41.891] [32mINFO [0m [ProjectorHandler] Projector left room: projector_eb50286f-fe6e-4fcb-97f7-2c8d65660851

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/teacherAuth.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-09 20:46:42.523] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:42.527] [32mINFO [0m [TeachersAPI] Teacher registered successfully via deprecated endpoint {
        "userId": "teacher-uuid",
        "username": "testteacher",
        "email": "test@example.com"
      }

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/updated-gameHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-09 20:46:43.015] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/gamesApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-09 20:46:43.483] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:43.491] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:43.494] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Game",
          "gameTemplateId": "quiz-123",
          "playMode": "quiz"
        },
        "keys": [
          "name",
          "gameTemplateId",
          "playMode"
        ],
        "user": {
          "userId": "teacher-123",
          "username": "testteacher",
          "role": "TEACHER"
        },
        "headers": {
          "host": "127.0.0.1:45359",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "content-length": "66",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:43.494] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Game",
        "finalgameTemplateId": "quiz-123",
        "playMode": "quiz",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:43.553] [31mERROR[0m [GameStateService] {
        "gameInstanceId": "game-123"
      } Game instance not found

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:43.558] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Missing Fields",
          "playMode": "quiz"
        },
        "keys": [
          "name",
          "playMode"
        ],
        "user": {
          "userId": "teacher-123",
          "username": "testteacher",
          "role": "TEACHER"
        },
        "headers": {
          "host": "127.0.0.1:46093",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "content-length": "43",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:43.559] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Missing Fields",
        "playMode": "quiz",
        "nameCheck": true,
        "templateIdCheck": false,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:43.561] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Game",
          "gameTemplateId": "quiz-123",
          "playMode": "invalid-mode"
        },
        "keys": [
          "name",
          "gameTemplateId",
          "playMode"
        ],
        "user": {
          "userId": "teacher-123",
          "username": "testteacher",
          "role": "TEACHER"
        },
        "headers": {
          "host": "127.0.0.1:37571",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "content-length": "74",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG response: 200 application/json; charset=utf-8 {"games":[{"id":"game-1","status":"pending","name":"Game 1"},{"id":"game-2","status":"active","name":"Game 2"}]}

      at Object.<anonymous> (tests/integration/gamesApi.test.ts:376:21)

PASS tests/integration/playerApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-09 20:46:44.110] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:44.114] [32mINFO [0m [PlayersAPI] Student registered successfully via deprecated endpoint {
        "userId": "user-uuid",
        "username": "testuser",
        "hasEmail": false,
        "hasCookieId": false
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:44.119] [32mINFO [0m [PlayersAPI] Student registered successfully via deprecated endpoint {
        "userId": "user-uuid",
        "username": "testuser",
        "hasEmail": true,
        "hasCookieId": false
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:44.131] [32mINFO [0m [PlayersAPI] Student registered successfully via deprecated endpoint {
        "userId": "user-uuid",
        "username": "existinguser",
        "hasEmail": false,
        "hasCookieId": false
      }

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/participantCount.test.ts
  ‚óè Console

    console.log
      Socket JOMHBh_IMUvsWQnZAAAD joined room: lobby_TEST456

      at Socket.<anonymous> (tests/integration/participantCount.test.ts:58:25)

    console.log
      Socket nF4TAIwt6x39uikzAAAE joined room: lobby_TEST456

      at Socket.<anonymous> (tests/integration/participantCount.test.ts:58:25)

    console.log
      Socket TSSW8OWWkBQKCJa8AAAF joined room: game_TEST456

      at Socket.<anonymous> (tests/integration/participantCount.test.ts:58:25)

    console.log
      Participant count: 3

      at Timeout._onTimeout (tests/integration/participantCount.test.ts:111:29)

    console.log
      Lobby room size: 2

      at Timeout._onTimeout (tests/integration/participantCount.test.ts:112:29)

    console.log
      Game room size: 1

      at Timeout._onTimeout (tests/integration/participantCount.test.ts:113:29)

PASS tests/unit/quizTemplateService.test.ts
PASS tests/integration/lobbyBasic.test.ts
  ‚óè Console

    console.log
      Server listening on port 39709

      at Server.<anonymous> (tests/integration/lobbyBasic.test.ts:72:25)

    console.log
      Socket connected: mjTEo29-cl7PfuiZAAAB

      at Namespace.<anonymous> (tests/integration/lobbyBasic.test.ts:41:21)

    console.log
      Client connected

      at Socket.<anonymous> (tests/integration/lobbyBasic.test.ts:171:21)

    console.log
      Player Test Player 1 joining lobby TEST123

      at Socket.<anonymous> (tests/integration/lobbyBasic.test.ts:46:25)

    console.log
      Received participants list: {
        participants: [
          {
            id: 'mjTEo29-cl7PfuiZAAAB',
            username: 'Test Player 1',
            userId: 'test-player-1'
          }
        ],
        gameId: 'test-game-id',
        gameName: 'Test Game'
      }

      at Socket.<anonymous> (tests/integration/lobbyBasic.test.ts:181:21)

PASS tests/unit/questionService.test.ts
PASS tests/unit/gameInstanceService.test.ts
PASS tests/integration/basic-check.test.ts
PASS tests/unit/gameParticipantService.test.ts
FAIL tests/integration/quizTemplateApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.891] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.895] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.896] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.903] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.904] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.916] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.918] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.925] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.925] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.929] [32mINFO [0m [Auth] {
        "authHeader": "Bearer invalid-token"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.929] [31mERROR[0m [Auth] {
        "error": {
          "name": "JsonWebTokenError",
          "message": "jwt malformed"
        }
      } Authentication error

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.933] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.935] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.940] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.940] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.951] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.953] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.956] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.958] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.960] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.961] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.963] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.966] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.970] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.971] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.974] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.975] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.976] [31mERROR[0m [gameTemplatesAPI] {
        "error": {}
      } Error updating quiz template

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.980] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.980] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.983] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.984] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.993] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.994] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.995] [31mERROR[0m [gameTemplatesAPI] {
        "error": {}
      } Error deleting quiz template

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5NDk0ODA2LCJleHAiOjE3NDk0OTg0MDZ9.bKUsZWPprxaQnyvlHI8pkGlxm2JR532okMD0IwveJRU

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-09 20:46:46.997] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:46.998] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

  ‚óè /api/v1/quiz-templates ‚Ä∫ POST /api/v1/quiz-templates ‚Ä∫ should create a quiz template successfully

    Test timed out waiting for projector_state

      126 |         clientSocket.on('projector_state', (state) => {
      127 |             expect(state).toBeDefined();
    > 128 |             expect(state.accessCode).toBe(gameAccessCode);
          |                  ^
      129 |             done();
      130 |         });
      131 |

      at Timeout._onTimeout (tests/integration/projectorHandler.test.ts:128:18)

PASS tests/unit/accessCodeGeneration.test.ts
PASS tests/integration/questionApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-09 20:46:47.582] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:47.600] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:47.630] [32mINFO [0m [QuestionsAPI] Returning 2 questions for API request

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:47.634] [32mINFO [0m [QuestionsAPI] First question sample: {
        "uid": "question-1",
        "title": "Question 1",
        "createdAt": "2025-06-09T18:46:47.626Z",
        "updatedAt": "2025-06-09T18:46:47.626Z",
        "text": "What is 1+1?",
        "answerOptions": [],
        "correctAnswers": [],
        "questionType": "multiple_choice_single_answer",
        "discipline": "math",
        "themes": [
          "arithmetic"
        ],
        "gradeLevel": "6th Grade",
        "difficulty": 1,
        "author": "Test Author",
        "sourceName": "Test Source",
        "sourceUrl": null,
        "associatedImageUrl": null,
        "isHidden": false,
        "explanation": "This is an explanation",
        "tags": [],
        "timeLimit": 60
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:47.641] [31mERROR[0m [QuestionsAPI] {
        "error": {}
      } Error updating question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-09 20:46:47.648] [31mERROR[0m [QuestionsAPI] {
        "error": {}
      } Error deleting question

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/server.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-09 20:46:47.990] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

PASS src/tests/unit/participantCount.test.ts
  ‚óè Console

    console.log
      [2025-06-09 20:46:48.258] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "mock-game-id",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

PASS tests/unit/roomUtils.test.ts
PASS tests/unit/utils/testPathAliases.test.ts
PASS tests/setupTests.test.ts
-------------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
File                                 | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                                                                             
-------------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
All files                            |   45.11 |    27.12 |   36.92 |   57.78 |                                                                                                                                                                               
 src                                 |   84.09 |    33.33 |      60 |   84.09 |                                                                                                                                                                               
  server.ts                          |   84.09 |    33.33 |      60 |   84.09 | 24,51,59-61,68,74-75                                                                                                                                                          
 src/api                             |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  index.ts                           |     100 |      100 |     100 |     100 |                                                                                                                                                                               
 src/api/v1                          |   34.26 |    19.42 |   41.57 |    34.5 |                                                                                                                                                                               
  auth.ts                            |   14.51 |     5.26 |   30.76 |   14.17 | 18,38-39,46-53,65-66,99-297,307-445,458-588,600,608-633,644-679,689-762,772-817                                                                                               
  gameControl.ts                     |   12.03 |        0 |       0 |   12.03 | 19-53,63-133,143-214,224-272                                                                                                                                                  
  gameTemplates.ts                   |   23.56 |    15.94 |   28.57 |   24.34 | 23-55,65-105,125,131-132,142,146-147,150-159,164-169,175-177,195-226,236-278,289-334                                                                                          
  games.ts                           |   33.71 |    20.74 |      50 |   33.33 | 86-88,91-92,98-110,147-148,158-210,239-240,250-276,308-309,323-324,357-358,366-407,417-428,441-442,453-454,465-549,557-558,563-564,574-662,672-698,708-746,756-775,785-818    
  index.ts                           |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  players.ts                         |   76.08 |    55.55 |     100 |   75.55 | 16,66-76,89-90,102-103                                                                                                                                                        
  questions.ts                       |   53.89 |    40.29 |   31.81 |   59.85 | 17,35-36,54-55,65-76,87-116,143-144,176,185-187,196-199,205-208,213-215,223-228,250-251,263-264,271-272,290,302-303,317                                                       
  quizTemplates.ts                   |   46.71 |    31.94 |      70 |   46.97 | 16,34-35,69-70,82-83,104-105,117-118,135,155-156,168-169,192-197,209-210,226-231,241-276,286-314,324-358                                                                      
  student.ts                         |    28.2 |        0 |       0 |    28.2 | 16-19,27-98                                                                                                                                                                   
  teachers.ts                        |      50 |    14.28 |      75 |   49.12 | 17,38-39,43-44,48-49,55-56,62-64,86-96,108-122                                                                                                                                
  users.ts                           |   37.03 |        0 |       0 |   37.03 | 13-16,21-50                                                                                                                                                                   
 src/config                          |   83.33 |        0 |     100 |   83.33 |                                                                                                                                                                               
  redis.ts                           |   83.33 |        0 |     100 |   83.33 | 7-8                                                                                                                                                                           
 src/core                            |   67.12 |    50.98 |   69.56 |   67.31 |                                                                                                                                                                               
  gameStateService.ts                |   67.12 |    50.98 |   69.56 |   67.31 | 74-95,106,116-117,158-159,201-202,218-219,226-228,238-239,288-289,309-310,331,367-368,379-407,425-426,435-436,447-458,462,471-472,492-494,498,501-502,529-535,543-544,568-569 
 src/core/services                   |    50.2 |    52.65 |      45 |   50.72 |                                                                                                                                                                               
  gameInstanceService.ts             |   59.79 |    72.41 |   53.84 |   60.86 | 107-108,197-217,267-317,393-465                                                                                                                                               
  gameParticipantService.ts          |   92.64 |    88.88 |     100 |   92.53 | 92,98,117,170-171                                                                                                                                                             
  gameTemplateService.ts             |    17.3 |     6.25 |   16.66 |   17.64 | 45-84,92,121-256                                                                                                                                                              
  questionService.ts                 |   70.23 |    89.47 |      50 |   71.08 | 145,249-321                                                                                                                                                                   
  quizTemplateService.ts             |   63.29 |    46.42 |   66.66 |   63.29 | 54,95-96,125,131,162-163,188,256,265,288-367                                                                                                                                  
  userService.ts                     |    8.62 |     2.22 |       0 |    8.84 | 50-415                                                                                                                                                                        
 src/db                              |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  prisma.ts                          |     100 |      100 |     100 |     100 |                                                                                                                                                                               
 src/db/generated/client             |   92.06 |       50 |       0 |   92.06 |                                                                                                                                                                               
  index.js                           |   92.06 |       50 |       0 |   92.06 | 295-305                                                                                                                                                                       
 src/db/generated/client/runtime     |    33.2 |    19.78 |   28.66 |      62 |                                                                                                                                                                               
  library.js                         |    33.2 |    19.78 |   28.66 |      62 | 14,18-22,26,38-60,68,72-104,126-129                                                                                                                                           
 src/middleware                      |    90.9 |    55.17 |     100 |   90.47 |                                                                                                                                                                               
  auth.ts                            |    90.9 |    55.17 |     100 |   90.47 | 99-102,112,131                                                                                                                                                                
 src/sockets                         |   80.48 |    22.22 |   71.42 |   80.48 |                                                                                                                                                                               
  index.ts                           |   80.48 |    22.22 |   71.42 |   80.48 | 24-25,72,83,93-98                                                                                                                                                             
 src/sockets/handlers                |   79.51 |    60.35 |    93.5 |   79.21 |                                                                                                                                                                               
  connectionHandlers.ts              |     100 |       70 |     100 |     100 | 38                                                                                                                                                                            
  disconnectHandler.ts               |   90.47 |    70.58 |     100 |   90.47 | 36-37,75,91                                                                                                                                                                   
  gameHandler.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  lobbyHandler.ts                    |   81.77 |    56.25 |   95.45 |   81.18 | 64-66,89,124-129,145-150,155-160,165-176,253-254,285-286,330,350,374-378,400-401,415-416,431-432,472,494-501                                                                  
  projectorHandler.ts                |      60 |        0 |      80 |      60 | 32-34,40-41,62-78                                                                                                                                                             
  sharedAnswers.ts                   |   44.44 |        0 |       0 |   57.14 | 16-18                                                                                                                                                                         
  sharedGameFlow.ts                  |   97.95 |    76.92 |     100 |   97.82 | 80                                                                                                                                                                            
  sharedLeaderboard.ts               |   86.66 |    66.66 |      80 |    92.3 | 38                                                                                                                                                                            
  sharedLiveHandler.ts               |   74.72 |    58.33 |     100 |   73.54 | 47-52,134,180,208,220-226,235-246,254-265,277-279,294-296,323-328,339-345,351-357,361-367,389-395,405-406,425-431,440,444-445,466-467,474-475,488-489                         
  sharedScore.ts                     |      60 |       50 |     100 |    62.5 | 18-20                                                                                                                                                                         
  teacherControlHandler.ts           |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  tournamentHandler.ts               |   77.64 |     62.5 |     100 |   76.82 | 39-41,65-67,86-88,96-98,107-108,132-134,165-167                                                                                                                               
 src/sockets/handlers/game           |   77.55 |    70.76 |   95.45 |   77.32 |                                                                                                                                                                               
  disconnect.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  gameAnswer.ts                      |   68.46 |    77.19 |     100 |   68.46 | 70-74,83-87,99-101,105-109,112-116,141-146,166-167,232-233,247-264                                                                                                            
  index.ts                           |   74.41 |    42.85 |      75 |   73.17 | 45-47,51-53,64-66,92-93                                                                                                                                                       
  joinGame.ts                        |   83.49 |    70.37 |     100 |   83.33 | 48-54,73-76,104-105,121-124,244-246                                                                                                                                           
  requestNextQuestion.ts             |   83.63 |    69.38 |     100 |   82.69 | 30-31,35-37,46-47,155-156                                                                                                                                                     
  requestParticipants.ts             |   92.85 |        0 |     100 |     100 | 16                                                                                                                                                                            
 src/sockets/handlers/teacherControl |   51.66 |    30.71 |   86.95 |   51.58 |                                                                                                                                                                               
  disconnect.ts                      |   85.71 |       75 |     100 |   85.71 | 14-15,38                                                                                                                                                                      
  endGame.ts                         |    72.5 |    30.76 |     100 |    72.5 | 17-21,39-43,49-53,97-106,116                                                                                                                                                  
  helpers.ts                         |   68.57 |       55 |      80 |   68.57 | 20,43-44,62-63,77-78,99-100,108-109,161-162,177,182-190,196-197                                                                                                               
  index.ts                           |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  joinDashboard.ts                   |   49.39 |    21.05 |     100 |   49.39 | 31-55,69-79,92-114,152-191,204-219,225-234                                                                                                                                    
  lockAnswers.ts                     |   71.79 |    30.76 |     100 |   71.79 | 17-21,39-43,49-53,86-95,105                                                                                                                                                   
  pauseTimer.ts                      |    8.97 |        0 |      50 |    8.97 | 14-208                                                                                                                                                                        
  setQuestion.ts                     |   54.25 |    35.59 |     100 |   53.76 | 19-23,27-38,53-71,77-81,84-95,102,108-120,215-229                                                                                                                             
  startTimer.ts                      |    8.97 |        0 |      50 |    8.97 | 14-203                                                                                                                                                                        
  timerAction.ts                     |      75 |    56.75 |     100 |      75 | 21-26,30-35,50-55,61-66,127-133,163-164                                                                                                                                       
 src/sockets/handlers/tournament     |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  index.ts                           |     100 |      100 |     100 |     100 |                                                                                                                                                                               
 src/sockets/middleware              |    82.6 |    64.15 |     100 |   82.22 |                                                                                                                                                                               
  socketAuth.ts                      |    82.6 |    64.15 |     100 |   82.22 | 35-38,93,147,156-157                                                                                                                                                          
 src/sockets/utils                   |   80.23 |    69.56 |     100 |   79.76 |                                                                                                                                                                               
  participantCountUtils.ts           |   74.28 |    72.72 |     100 |   74.28 | 20-21,32-33,70,90-91,117-121                                                                                                                                                  
  roomUtils.ts                       |   84.31 |    66.66 |     100 |   83.67 | 91-99,118-123,137-142,176-182                                                                                                                                                 
 src/utils                           |    83.6 |    48.14 |   85.71 |   83.33 |                                                                                                                                                                               
  avatarUtils.ts                     |   58.33 |        0 |   33.33 |   58.33 | 67,76-81                                                                                                                                                                      
  logger.ts                          |   89.79 |       52 |     100 |   89.58 | 39,90,96,108,112                                                                                                                                                              
 tests                               |   87.77 |    73.91 |   93.75 |    87.2 |                                                                                                                                                                               
  testSetup.ts                       |   87.77 |    73.91 |   93.75 |    87.2 | 51,92-93,112-128                                                                                                                                                              
 tests/helpers                       |   80.95 |     37.5 |      50 |   78.94 |                                                                                                                                                                               
  generateTeacherToken.ts            |     100 |       25 |     100 |     100 | 3-5                                                                                                                                                                           
  jwt.ts                             |     100 |       50 |     100 |     100 | 3-5                                                                                                                                                                           
  serviceMocks.ts                    |      60 |      100 |      25 |      50 | 22-25                                                                                                                                                                         
 tests/support                       |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  testQuestions.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                               
-------------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Summary of all failing tests
FAIL tests/integration/teacherQuiz.test.ts


  ‚óè Test suite failed to run

    Connection is closed.

      at close (node_modules/ioredis/built/redis/event_handler.js:189:25)
      at Socket.<anonymous> (node_modules/ioredis/built/redis/event_handler.js:156:20)

  ‚óè Test suite failed to run

    Connection is closed.

      at close (node_modules/ioredis/built/redis/event_handler.js:189:25)
      at Socket.<anonymous> (node_modules/ioredis/built/redis/event_handler.js:156:20)

FAIL tests/integration/gameHandler.test.ts


  ‚óè Test suite failed to run

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/aflesch/mathquest/app/backend/tests/integration/gameHandler.test.ts:270:27

      267     }
      268 });
      269 
    ‚Üí 270 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `game_templates_creator_id_fkey`

      122 |
      123 | More Information: https://pris.ly/d/execute-raw
    > 124 | `)}var Co=({clientMethod:e,activeProvider:r})=>t=>{let n="",i;if(Nn(t))n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};else if(Array.isArray(t)){let[o,...s]=t;n=o,i={values:Gr(s||[]),__prismaRawParameters__:!0}}else switch(r){case"sqlite":case"mysql":{n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"cockroachdb":case"postgresql":case"postgres":{n=t.text,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"sqlserver":{n=$l(t),i={values:Gr(t.values),__prismaRawParameters__:!0};break}default:throw new Error(`The ${r} provider does not support ${e}`)}return i?.values?Ul(`prisma.${e}(${n}, ${i.values})`):Ul(`prisma.${e}(${n})`),{query:n,parameters:i}},Ql={requestArgsToMiddlewareArgs(e){return[e.strings,...e.values]},middlewareArgsToRequestArgs(e){let[r,...t]=e;return new oe(r,t)}},Gl={requestArgsToMiddlewareArgs(e){return[e]},middlewareArgsToRequestArgs(e){return e[0]}};function Ao(e){return function(t,n){let i,o=(s=e)=>{try{return s===void 0||s?.kind==="itx"?i??=Wl(t(s)):Wl(t(s))}catch(a){return Promise.reject(a)}};return{get spec(){return n},then(s,a){return o().then(s,a)},catch(s){return o().catch(s)},finally(s){return o().finally(s)},requestTransaction(s){let a=o(s);return a.requestTransaction?a.requestTransaction(s):a},[Symbol.toStringTag]:"PrismaPromise"}}}function Wl(e){return typeof e.then=="function"?e:Promise.resolve(e)}var Pf=bi.split(".")[0],Tf={isEnabled(){return!1},getTraceParent(){return"00-10-10-00"},dispatchEngineSpans(){},getActiveContext(){},runInChildSpan(e,r){return r()}},Io=class{isEnabled(){return this.getGlobalTracingHelper().isEnabled()}getTraceParent(r){return this.getGlobalTracingHelper().getTraceParent(r)}dispatchEngineSpans(r){return this.getGlobalTracingHelper().dispatchEngineSpans(r)}getActiveContext(){return this.getGlobalTracingHelper().getActiveContext()}runInChildSpan(r,t){return this.getGlobalTracingHelper().runInChildSpan(r,t)}getGlobalTracingHelper(){let r=globalThis[`V${Pf}_PRISMA_INSTRUMENTATION`],t=globalThis.PRISMA_INSTRUMENTATION;return r?.helper??t?.helper??Tf}};function Jl(){return new Io}function Hl(e,r=()=>{}){let t,n=new Promise(i=>t=i);return{then(i){return--e===0&&t(r()),i?.(n)}}}function Kl(e){return typeof e=="string"?e:e.reduce((r,t)=>{let n=typeof t=="string"?t:t.level;return n==="query"?r:r&&(t==="info"||r==="info")?"info":n},void 0)}var Jn=class{_middlewares=[];use(r){this._middlewares.push(r)}get(r){return this._middlewares[r]}has(r){return!!this._middlewares[r]}length(){return this._middlewares.length}};var zl=k(ki());function Hn(e){return typeof e.batchRequestIdx=="number"}function Yl(e){if(e.action!=="findUnique"&&e.action!=="findUniqueOrThrow")return;let r=[];return e.modelName&&r.push(e.modelName),e.query.arguments&&r.push(ko(e.query.arguments)),r.push(ko(e.query.selection)),r.join("")}function ko(e){return`(${Object.keys(e).sort().map(t=>{let n=e[t];return typeof n=="object"&&n!==null?`(${t} ${ko(n)})`:t}).join(" ")})`}var Sf={aggregate:!1,aggregateRaw:!1,createMany:!0,createManyAndReturn:!0,createOne:!0,deleteMany:!0,deleteOne:!0,executeRaw:!0,findFirst:!1,findFirstOrThrow:!1,findMany:!1,findRaw:!1,findUnique:!1,findUniqueOrThrow:!1,groupBy:!1,queryRaw:!1,runCommandRaw:!0,updateMany:!0,updateManyAndReturn:!0,updateOne:!0,upsertOne:!0};function Oo(e){return Sf[e]}var Kn=class{constructor(r){this.options=r;this.batches={}}batches;tickActive=!1;request(r){let t=this.options.batchBy(r);return t?(this.batches[t]||(this.batches[t]=[],this.tickActive||(this.tickActive=!0,process.nextTick(()=>{this.dispatchBatches(),this.tickActive=!1}))),new Promise((n,i)=>{this.batches[t].push({request:r,resolve:n,reject:i})})):this.options.singleLoader(r)}dispatchBatches(){for(let r in this.batches){let t=this.batches[r];delete this.batches[r],t.length===1?this.options.singleLoader(t[0].request).then(n=>{n instanceof Error?t[0].reject(n):t[0].resolve(n)}).catch(n=>{t[0].reject(n)}):(t.sort((n,i)=>this.options.batchOrder(n.request,i.request)),this.options.batchLoader(t.map(n=>n.request)).then(n=>{if(n instanceof Error)for(let i=0;i<t.length;i++)t[i].reject(n);else for(let i=0;i<t.length;i++){let o=n[i];o instanceof Error?t[i].reject(o):t[i].resolve(o)}}).catch(n=>{for(let i=0;i<t.length;i++)t[i].reject(n)}))}}get[Symbol.toStringTag](){return"DataLoader"}};function mr(e,r){if(r===null)return r;switch(e){case"bigint":return BigInt(r);case"bytes":{let{buffer:t,byteOffset:n,byteLength:i}=Buffer.from(r,"base64");return new Uint8Array(t,n,i)}case"decimal":return new ve(r);case"datetime":case"date":return new Date(r);case"time":return new Date(`1970-01-01T${r}Z`);case"bigint-array":return r.map(t=>mr("bigint",t));case"bytes-array":return r.map(t=>mr("bytes",t));case"decimal-array":return r.map(t=>mr("decimal",t));case"datetime-array":return r.map(t=>mr("datetime",t));case"date-array":return r.map(t=>mr("date",t));case"time-array":return r.map(t=>mr("time",t));default:return r}}function Yn(e){let r=[],t=Rf(e);for(let n=0;n<e.rows.length;n++){let i=e.rows[n],o={...t};for(let s=0;s<i.length;s++)o[e.columns[s]]=mr(e.types[s],i[s]);r.push(o)}return r}function Rf(e){let r={};for(let t=0;t<e.columns.length;t++)r[e.columns[t]]=null;return r}var Cf=N("prisma:client:request_handler"),zn=class{client;dataloader;logEmitter;constructor(r,t){this.logEmitter=t,this.client=r,this.dataloader=new Kn({batchLoader:il(async({requests:n,customDataProxyFetch:i})=>{let{transaction:o,otelParentCtx:s}=n[0],a=n.map(p=>p.protocolQuery),l=this.client._tracingHelper.getTraceParent(s),u=n.some(p=>Oo(p.protocolQuery.action));return(await this.client._engine.requestBatch(a,{traceparent:l,transaction:Af(o),containsWrite:u,customDataProxyFetch:i})).map((p,d)=>{if(p instanceof Error)return p;try{return this.mapQueryEngineResult(n[d],p)}catch(f){return f}})}),singleLoader:async n=>{let i=n.transaction?.kind==="itx"?Zl(n.transaction):void 0,o=await this.client._engine.request(n.protocolQuery,{traceparent:this.client._tracingHelper.getTraceParent(),interactiveTransaction:i,isWrite:Oo(n.protocolQuery.action),customDataProxyFetch:n.customDataProxyFetch});return this.mapQueryEngineResult(n,o)},batchBy:n=>n.transaction?.id?`transaction-${n.transaction.id}`:Yl(n.protocolQuery),batchOrder(n,i){return n.transaction?.kind==="batch"&&i.transaction?.kind==="batch"?n.transaction.index-i.transaction.index:0}})}async request(r){try{return await this.dataloader.request(r)}catch(t){let{clientMethod:n,callsite:i,transaction:o,args:s,modelName:a}=r;this.handleAndLogRequestError({error:t,clientMethod:n,callsite:i,transaction:o,args:s,modelName:a,globalOmit:r.globalOmit})}}mapQueryEngineResult({dataPath:r,unpacker:t},n){let i=n?.data,o=this.unpack(i,r,t);return process.env.PRISMA_CLIENT_GET_TIME?{data:o}:o}handleAndLogRequestError(r){try{this.handleRequestError(r)}catch(t){throw this.logEmitter&&this.logEmitter.emit("error",{message:t.message,target:r.clientMethod,timestamp:new Date}),t}}handleRequestError({error:r,clientMethod:t,callsite:n,transaction:i,args:o,modelName:s,globalOmit:a}){if(Cf(r),If(r,i))throw r;if(r instanceof z&&kf(r)){let u=Xl(r.meta);An({args:o,errors:[u],callsite:n,errorFormat:this.client._errorFormat,originalMethod:t,clientVersion:this.client._clientVersion,globalOmit:a})}let l=r.message;if(n&&(l=bn({callsite:n,originalMethod:t,isPanic:r.isPanic,showColors:this.client._errorFormat==="pretty",message:l})),l=this.sanitizeMessage(l),r.code){let u=s?{modelName:s,...r.meta}:r.meta;throw new z(l,{code:r.code,clientVersion:this.client._clientVersion,meta:u,batchRequestIdx:r.batchRequestIdx})}else{if(r.isPanic)throw new le(l,this.client._clientVersion);if(r instanceof j)throw new j(l,{clientVersion:this.client._clientVersion,batchRequestIdx:r.batchRequestIdx});if(r instanceof T)throw new T(l,this.client._clientVersion);if(r instanceof le)throw new le(l,this.client._clientVersion)}throw r.clientVersion=this.client._clientVersion,r}sanitizeMessage(r){return this.client._errorFormat&&this.client._errorFormat!=="pretty"?(0,zl.default)(r):r}unpack(r,t,n){if(!r||(r.data&&(r=r.data),!r))return r;let i=Object.keys(r)[0],o=Object.values(r)[0],s=t.filter(u=>u!=="select"&&u!=="include"),a=io(o,s),l=i==="queryRaw"?Yn(a):Tr(a);return n?n(l):l}get[Symbol.toStringTag](){return"RequestHandler"}};function Af(e){if(e){if(e.kind==="batch")return{kind:"batch",options:{isolationLevel:e.isolationLevel}};if(e.kind==="itx")return{kind:"itx",options:Zl(e)};_e(e,"Unknown transaction kind")}}function Zl(e){return{id:e.id,payload:e.payload}}function If(e,r){return Hn(e)&&r?.kind==="batch"&&e.batchRequestIdx!==r.index}function kf(e){return e.code==="P2009"||e.code==="P2012"}function Xl(e){if(e.kind==="Union")return{kind:"Union",errors:e.errors.map(Xl)};if(Array.isArray(e.selectionPath)){let[,...r]=e.selectionPath;return{...e,selectionPath:r}}return e}var eu="6.7.0";var ru=eu;var su=k(Gi());var D=class extends Error{constructor(r){super(r+`
          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ^
      125 | Read more at https://pris.ly/d/client-constructor`),this.name="PrismaClientConstructorValidationError"}get[Symbol.toStringTag](){return"PrismaClientConstructorValidationError"}};x(D,"PrismaClientConstructorValidationError");var tu=["datasources","datasourceUrl","errorFormat","adapter","log","transactionOptions","omit","__internal"],nu=["pretty","colorless","minimal"],iu=["info","query","warn","error"],Df={datasources:(e,{datasourceNames:r})=>{if(e){if(typeof e!="object"||Array.isArray(e))throw new D(`Invalid value ${JSON.stringify(e)} for "datasources" provided to PrismaClient constructor`);for(let[t,n]of Object.entries(e)){if(!r.includes(t)){let i=Wr(t,r)||` Available datasources: ${r.join(", ")}`;throw new D(`Unknown datasource ${t} provided to PrismaClient constructor.${i}`)}if(typeof n!="object"||Array.isArray(n))throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      126 | It should have this form: { url: "CONNECTION_STRING" }`);if(n&&typeof n=="object")for(let[i,o]of Object.entries(n)){if(i!=="url")throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      127 | It should have this form: { url: "CONNECTION_STRING" }`);if(typeof o!="string")throw new D(`Invalid value ${JSON.stringify(o)} for datasource "${t}" provided to PrismaClient constructor.

      at zn.handleRequestError (src/db/generated/client/runtime/library.js:124:7459)
      at zn.handleRequestError [as handleAndLogRequestError] (src/db/generated/client/runtime/library.js:124:6784)
      at zn.handleAndLogRequestError [as request] (src/db/generated/client/runtime/library.js:124:6491)
      at l (src/db/generated/client/runtime/library.js:133:9778)
      at Object.<anonymous> (tests/integration/gameHandler.test.ts:270:9)

FAIL tests/integration/quizTemplateApi.test.ts
  ‚óè /api/v1/quiz-templates ‚Ä∫ POST /api/v1/quiz-templates ‚Ä∫ should create a quiz template successfully

    Test timed out waiting for projector_state

      126 |         clientSocket.on('projector_state', (state) => {
      127 |             expect(state).toBeDefined();
    > 128 |             expect(state.accessCode).toBe(gameAccessCode);
          |                  ^
      129 |             done();
      130 |         });
      131 |

      at Timeout._onTimeout (tests/integration/projectorHandler.test.ts:128:18)


Test Suites: 3 failed, 29 passed, 32 total
Tests:       1 failed, 178 passed, 179 total
Snapshots:   0 total
Time:        93.316 s, estimated 96 s
Ran all test suites.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
