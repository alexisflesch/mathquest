
> backend@1.0.0 test
> jest

Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma

‚úî Generated Prisma Client (v6.7.0) to ./src/db/generated/client in 316ms

Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)

Tip: Interested in query caching in just a few lines of code? Try Accelerate today! https://pris.ly/tip-3-accelerate

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Update available 6.7.0 -> 6.9.0                        ‚îÇ
‚îÇ  Run the following to update                            ‚îÇ
‚îÇ    npm i --save-dev prisma@latest                       ‚îÇ
‚îÇ    npm i @prisma/client@latest                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
Test setup complete, using port 5565
Database URL: postgresql://postgre:Phuf0pohooFee8auohFahk7vChae4Iv0wiem5voT@localhost:5432/mathquest_test
Redis URL: redis://localhost:6379
Cleaning test database...
Database cleaned successfully
Inserted default test questions.
Seeded integration teacher, template, questions, and game instance.
PASS tests/integration/tournament2.test.ts (56.332 s)
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-04 13:34:51.827] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:51.884] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:52.536] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "b8a3b2a4-2858-487d-bfb8-d35f47a5a8ef",
        "accessCode": "RRXBD8"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:52.881] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "XHkslNTQ8LB09R2qAAAC",
        "user": {
          "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.352] [32mINFO [0m [GameHandlers] {
        "socketId": "XHkslNTQ8LB09R2qAAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.358] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "XHkslNTQ8LB09R2qAAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.382] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "YBFBBbRZovlTyNR4AAAD",
        "user": {
          "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.384] [32mINFO [0m [GameHandlers] {
        "socketId": "YBFBBbRZovlTyNR4AAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.385] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "YBFBBbRZovlTyNR4AAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.396] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_RRXBD8",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.413] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_RRXBD8",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.414] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_RRXBD8",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.416] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_RRXBD8",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.423] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_RRXBD8",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.424] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_RRXBD8",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.425] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_RRXBD8",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.426] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_RRXBD8",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.459] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_RRXBD8",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "b8a3b2a4-2858-487d-bfb8-d35f47a5a8ef",
          "accessCode": "RRXBD8",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.465] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_RRXBD8",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "b8a3b2a4-2858-487d-bfb8-d35f47a5a8ef",
          "accessCode": "RRXBD8",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.467] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_RRXBD8",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "b8a3b2a4-2858-487d-bfb8-d35f47a5a8ef",
          "accessCode": "RRXBD8",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.472] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_RRXBD8",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "b8a3b2a4-2858-487d-bfb8-d35f47a5a8ef",
          "accessCode": "RRXBD8",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.487] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.488] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.489] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.490] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.553] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "b8a3b2a4-2858-487d-bfb8-d35f47a5a8ef",
        "templateId": "315e31bc-95b4-4608-853f-a5b79bb6f5e3",
        "initiator": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "RRXBD8",
        "socketId": "XHkslNTQ8LB09R2qAAAC"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.762] [32mINFO [0m [GameStateService] {
        "accessCode": "RRXBD8"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:54.770] [32mINFO [0m [TournamentHandler] {
        "room": "game_RRXBD8",
        "duration": 5,
        "accessCode": "RRXBD8",
        "socketId": "XHkslNTQ8LB09R2qAAAC"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.778] [32mINFO [0m [GameStateService] {
        "accessCode": "RRXBD8"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.814] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "RRXBD8"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.819] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "RRXBD8",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.820] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "RRXBD8"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.823] [32mINFO [0m [GameStateService] {
        "accessCode": "RRXBD8"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.823] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "RRXBD8",
        "room": "game_RRXBD8",
        "socketIds": [
          "XHkslNTQ8LB09R2qAAAC",
          "YBFBBbRZovlTyNR4AAAD"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.823] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "RRXBD8",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.824] [32mINFO [0m [SharedGameFlow] {
        "room": "game_RRXBD8",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-04T11:34:41.963Z",
            "updatedAt": "2025-06-04T11:34:52.152Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.826] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "RRXBD8",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.830] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "XHkslNTQ8LB09R2qAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.830] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "XHkslNTQ8LB09R2qAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.831] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "XHkslNTQ8LB09R2qAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.831] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "XHkslNTQ8LB09R2qAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.832] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "YBFBBbRZovlTyNR4AAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.832] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "YBFBBbRZovlTyNR4AAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.833] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "YBFBBbRZovlTyNR4AAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.833] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "YBFBBbRZovlTyNR4AAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.844] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.871] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.872] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:34:59.873] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "RRXBD8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:01.828] [32mINFO [0m [SharedGameFlow] {
        "room": "game_RRXBD8",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:01.829] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "RRXBD8",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:01.830] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "RRXBD8",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:01.841] [32mINFO [0m [GameStateService] {
        "accessCode": "RRXBD8",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:01.842] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "RRXBD8",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:01.852] [32mINFO [0m [GameStateService] {
        "accessCode": "RRXBD8",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
          "username": "p1-extended",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
          "username": "p2-extended",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament2.test.ts:327:17)

    console.log
      [2025-06-04 13:35:01.929] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "6a8a8182-f858-43a6-8b06-107e5f1c58c5",
        "accessCode": "ZFTDC4"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.118] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "Ejdccr4pG38G6YtTAAAG",
        "user": {
          "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.119] [32mINFO [0m [GameHandlers] {
        "socketId": "Ejdccr4pG38G6YtTAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.119] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "Ejdccr4pG38G6YtTAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.123] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "Q8663L6oqG5lplsLAAAH",
        "user": {
          "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.123] [32mINFO [0m [GameHandlers] {
        "socketId": "Q8663L6oqG5lplsLAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.124] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "Q8663L6oqG5lplsLAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.126] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_ZFTDC4",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.127] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_ZFTDC4",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.127] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_ZFTDC4",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.127] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_ZFTDC4",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.128] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_ZFTDC4",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.129] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_ZFTDC4",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.130] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_ZFTDC4",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.131] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_ZFTDC4",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.134] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_ZFTDC4",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "6a8a8182-f858-43a6-8b06-107e5f1c58c5",
          "accessCode": "ZFTDC4",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.136] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_ZFTDC4",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "6a8a8182-f858-43a6-8b06-107e5f1c58c5",
          "accessCode": "ZFTDC4",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.137] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_ZFTDC4",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "6a8a8182-f858-43a6-8b06-107e5f1c58c5",
          "accessCode": "ZFTDC4",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.138] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_ZFTDC4",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "6a8a8182-f858-43a6-8b06-107e5f1c58c5",
          "accessCode": "ZFTDC4",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.149] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.150] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.150] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.150] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.195] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "6a8a8182-f858-43a6-8b06-107e5f1c58c5",
        "templateId": "6472d036-f426-47bc-8a64-fc6169df3914",
        "initiator": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "ZFTDC4",
        "socketId": "Ejdccr4pG38G6YtTAAAG"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.401] [32mINFO [0m [GameStateService] {
        "accessCode": "ZFTDC4"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:02.414] [32mINFO [0m [TournamentHandler] {
        "room": "game_ZFTDC4",
        "duration": 5,
        "accessCode": "ZFTDC4",
        "socketId": "Ejdccr4pG38G6YtTAAAG"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:03.843] [32mINFO [0m [SharedGameFlow] {
        "room": "game_RRXBD8",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:03.844] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "RRXBD8",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:03.845] [32mINFO [0m [SharedGameFlow] {
        "room": "game_RRXBD8",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:03.846] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "RRXBD8",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.424] [32mINFO [0m [GameStateService] {
        "accessCode": "ZFTDC4"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.464] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "ZFTDC4"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.465] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "ZFTDC4",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.465] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "ZFTDC4"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.474] [32mINFO [0m [GameStateService] {
        "accessCode": "ZFTDC4"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.475] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "ZFTDC4",
        "room": "game_ZFTDC4",
        "socketIds": [
          "Ejdccr4pG38G6YtTAAAG",
          "Q8663L6oqG5lplsLAAAH"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.475] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "ZFTDC4",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.475] [32mINFO [0m [SharedGameFlow] {
        "room": "game_ZFTDC4",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-04T11:34:41.963Z",
            "updatedAt": "2025-06-04T11:34:52.152Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.477] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "ZFTDC4",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.482] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "Ejdccr4pG38G6YtTAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.483] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "Ejdccr4pG38G6YtTAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.484] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "Ejdccr4pG38G6YtTAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.485] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "Ejdccr4pG38G6YtTAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.487] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "Q8663L6oqG5lplsLAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.488] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "Q8663L6oqG5lplsLAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.489] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "Q8663L6oqG5lplsLAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.490] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "Q8663L6oqG5lplsLAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.503] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.504] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.508] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:07.538] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "ZFTDC4",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.478] [32mINFO [0m [SharedGameFlow] {
        "room": "game_ZFTDC4",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.480] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "ZFTDC4",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.480] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "ZFTDC4",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.491] [32mINFO [0m [GameStateService] {
        "accessCode": "ZFTDC4",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.492] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "ZFTDC4",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.504] [32mINFO [0m [GameStateService] {
        "accessCode": "ZFTDC4",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
          "username": "p1-extended",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
          "username": "p2-extended",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament2.test.ts:442:17)

    console.log
      [2025-06-04 13:35:09.588] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "f355c889-c0b0-429d-b995-b58f8f114c26",
        "accessCode": "N8C8MN"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.832] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "JxBFeyVmGP8tT29aAAAK",
        "user": {
          "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.834] [32mINFO [0m [GameHandlers] {
        "socketId": "JxBFeyVmGP8tT29aAAAK"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.834] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "JxBFeyVmGP8tT29aAAAK"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.840] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "jLKvOxwsk7uT9rxwAAAL",
        "user": {
          "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.842] [32mINFO [0m [GameHandlers] {
        "socketId": "jLKvOxwsk7uT9rxwAAAL"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.843] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "jLKvOxwsk7uT9rxwAAAL"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.846] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_N8C8MN",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.846] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_N8C8MN",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.846] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_N8C8MN",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.847] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_N8C8MN",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.847] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_N8C8MN",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.848] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_N8C8MN",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.848] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_N8C8MN",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.848] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_N8C8MN",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.851] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_N8C8MN",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "f355c889-c0b0-429d-b995-b58f8f114c26",
          "accessCode": "N8C8MN",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.853] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_N8C8MN",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "f355c889-c0b0-429d-b995-b58f8f114c26",
          "accessCode": "N8C8MN",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.854] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_N8C8MN",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "f355c889-c0b0-429d-b995-b58f8f114c26",
          "accessCode": "N8C8MN",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.856] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_N8C8MN",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "f355c889-c0b0-429d-b995-b58f8f114c26",
          "accessCode": "N8C8MN",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.866] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.867] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.867] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.868] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:09.899] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "f355c889-c0b0-429d-b995-b58f8f114c26",
        "templateId": "267142a9-66c7-40bc-9d7b-27662436f830",
        "initiator": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 2,
        "nbParticipants": 2,
        "accessCode": "N8C8MN",
        "socketId": "JxBFeyVmGP8tT29aAAAK"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:10.102] [32mINFO [0m [GameStateService] {
        "accessCode": "N8C8MN"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:10.144] [32mINFO [0m [TournamentHandler] {
        "room": "game_N8C8MN",
        "duration": 5,
        "accessCode": "N8C8MN",
        "socketId": "JxBFeyVmGP8tT29aAAAK"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:11.494] [32mINFO [0m [SharedGameFlow] {
        "room": "game_ZFTDC4",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:11.496] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "ZFTDC4",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:11.497] [32mINFO [0m [SharedGameFlow] {
        "room": "game_ZFTDC4",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:11.500] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "ZFTDC4",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.153] [32mINFO [0m [GameStateService] {
        "accessCode": "N8C8MN"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.168] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.168] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN",
        "playMode": "tournament",
        "questionCount": 2
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.169] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.173] [32mINFO [0m [GameStateService] {
        "accessCode": "N8C8MN"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.174] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN",
        "room": "game_N8C8MN",
        "socketIds": [
          "JxBFeyVmGP8tT29aAAAK",
          "jLKvOxwsk7uT9rxwAAAL"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.174] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.174] [32mINFO [0m [SharedGameFlow] {
        "room": "game_N8C8MN",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-04T11:34:41.963Z",
            "updatedAt": "2025-06-04T11:34:52.152Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.177] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.183] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "JxBFeyVmGP8tT29aAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.184] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "JxBFeyVmGP8tT29aAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.185] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "JxBFeyVmGP8tT29aAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.186] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "JxBFeyVmGP8tT29aAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.187] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "jLKvOxwsk7uT9rxwAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.187] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "jLKvOxwsk7uT9rxwAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.187] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "jLKvOxwsk7uT9rxwAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.188] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "jLKvOxwsk7uT9rxwAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.205] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1"
      } Participant already answered this question. Updating answer.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.217] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.222] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.225] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:15.226] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:17.178] [32mINFO [0m [SharedGameFlow] {
        "room": "game_N8C8MN",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:17.180] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:17.180] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:17.191] [32mINFO [0m [GameStateService] {
        "accessCode": "N8C8MN",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:17.192] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.194] [32mINFO [0m [SharedGameFlow] {
        "room": "game_N8C8MN",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.196] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.201] [32mINFO [0m [GameStateService] {
        "accessCode": "N8C8MN"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.202] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN",
        "questionIndex": 1,
        "questionUid": "q-late-2"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.202] [32mINFO [0m [SharedGameFlow] {
        "room": "game_N8C8MN",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-2",
            "title": null,
            "text": "What is 7 x 3?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "multiplication"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "multiplication",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-04T11:34:41.963Z",
            "updatedAt": "2025-06-04T11:34:52.161Z",
            "answerOptions": [
              "20",
              "21",
              "24",
              "27"
            ],
            "correctAnswers": [
              false,
              true,
              false,
              false
            ],
            "feedbackWaitTime": 0
          },
          "index": 1,
          "feedbackWaitTime": 1.5
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.203] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN",
        "event": "game_question",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.205] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "JxBFeyVmGP8tT29aAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.206] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "JxBFeyVmGP8tT29aAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.207] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "JxBFeyVmGP8tT29aAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.207] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "JxBFeyVmGP8tT29aAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.208] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "jLKvOxwsk7uT9rxwAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.209] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "jLKvOxwsk7uT9rxwAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.210] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "jLKvOxwsk7uT9rxwAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.211] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "jLKvOxwsk7uT9rxwAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.232] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.234] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.239] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:19.240] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "N8C8MN",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.205] [32mINFO [0m [SharedGameFlow] {
        "room": "game_N8C8MN",
        "event": "correct_answers",
        "questionId": "q-late-2"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.208] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN",
        "event": "correct_answers",
        "questionUid": "q-late-2"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.209] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN",
        "questionId": "q-late-2"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.225] [32mINFO [0m [GameStateService] {
        "accessCode": "N8C8MN",
        "questionId": "q-late-2"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.227] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN",
        "questionId": "q-late-2"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.271] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "4925d36f-6259-45c0-86ed-1d5dde177021",
        "accessCode": "LWUDN8"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.504] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "a_M78TIRFbDW6XzZAAAO",
        "user": {
          "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.505] [32mINFO [0m [GameHandlers] {
        "socketId": "a_M78TIRFbDW6XzZAAAO"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.505] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "a_M78TIRFbDW6XzZAAAO"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.509] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "HdOvi1AUlgeQul9ZAAAP",
        "user": {
          "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.509] [32mINFO [0m [GameHandlers] {
        "socketId": "HdOvi1AUlgeQul9ZAAAP"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.510] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "HdOvi1AUlgeQul9ZAAAP"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.512] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_LWUDN8",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.513] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_LWUDN8",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.513] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_LWUDN8",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.514] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_LWUDN8",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.515] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_LWUDN8",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.515] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_LWUDN8",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.516] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_LWUDN8",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.516] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_LWUDN8",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.518] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_LWUDN8",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4925d36f-6259-45c0-86ed-1d5dde177021",
          "accessCode": "LWUDN8",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.519] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "room": "game_LWUDN8",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4925d36f-6259-45c0-86ed-1d5dde177021",
          "accessCode": "LWUDN8",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.520] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_LWUDN8",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4925d36f-6259-45c0-86ed-1d5dde177021",
          "accessCode": "LWUDN8",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.521] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "room": "game_LWUDN8",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4925d36f-6259-45c0-86ed-1d5dde177021",
          "accessCode": "LWUDN8",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.525] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.526] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.526] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.527] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.570] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "4925d36f-6259-45c0-86ed-1d5dde177021",
        "templateId": "410f56e4-9611-4283-854d-0b334a54eb43",
        "initiator": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 2,
        "nbParticipants": 2,
        "accessCode": "LWUDN8",
        "socketId": "a_M78TIRFbDW6XzZAAAO"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.774] [32mINFO [0m [GameStateService] {
        "accessCode": "LWUDN8"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:21.815] [32mINFO [0m [TournamentHandler] {
        "room": "game_LWUDN8",
        "duration": 5,
        "accessCode": "LWUDN8",
        "socketId": "a_M78TIRFbDW6XzZAAAO"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:22.729] [32mINFO [0m [SharedGameFlow] {
        "room": "game_N8C8MN",
        "event": "feedback",
        "questionId": "q-late-2"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:22.732] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN",
        "event": "feedback",
        "questionUid": "q-late-2"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:22.733] [32mINFO [0m [SharedGameFlow] {
        "room": "game_N8C8MN",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:22.734] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "N8C8MN",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.823] [32mINFO [0m [GameStateService] {
        "accessCode": "LWUDN8"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.865] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.865] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8",
        "playMode": "tournament",
        "questionCount": 2
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.866] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.872] [32mINFO [0m [GameStateService] {
        "accessCode": "LWUDN8"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.874] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8",
        "room": "game_LWUDN8",
        "socketIds": [
          "a_M78TIRFbDW6XzZAAAO",
          "HdOvi1AUlgeQul9ZAAAP"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.876] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.877] [32mINFO [0m [SharedGameFlow] {
        "room": "game_LWUDN8",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-04T11:34:41.963Z",
            "updatedAt": "2025-06-04T11:34:52.152Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.880] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.891] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "a_M78TIRFbDW6XzZAAAO"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.892] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "a_M78TIRFbDW6XzZAAAO"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.893] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "a_M78TIRFbDW6XzZAAAO"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.895] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "a_M78TIRFbDW6XzZAAAO"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.900] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "HdOvi1AUlgeQul9ZAAAP"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.906] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "HdOvi1AUlgeQul9ZAAAP"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.909] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "HdOvi1AUlgeQul9ZAAAP"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.910] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "HdOvi1AUlgeQul9ZAAAP"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.944] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.945] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.947] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:26.948] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:28.883] [32mINFO [0m [SharedGameFlow] {
        "room": "game_LWUDN8",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:28.886] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:28.887] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:28.914] [32mINFO [0m [GameStateService] {
        "accessCode": "LWUDN8",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:28.915] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.223] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "ZwoVq7ANTvBrzorbAAAR",
        "user": {
          "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
          "username": "p3",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.226] [32mINFO [0m [GameHandlers] {
        "socketId": "ZwoVq7ANTvBrzorbAAAR"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.227] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "ZwoVq7ANTvBrzorbAAAR"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.233] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "room": "game_LWUDN8",
        "playMode": "tournament",
        "username": "p3"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.235] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "room": "game_LWUDN8",
        "playMode": "tournament",
        "username": "p3"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.236] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "room": "game_LWUDN8",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.237] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "room": "game_LWUDN8",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.319] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "room": "game_LWUDN8",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4925d36f-6259-45c0-86ed-1d5dde177021",
          "accessCode": "LWUDN8",
          "status": "active",
          "currentQuestionIndex": 0,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 1749036926866,
            "duration": 2000,
            "isPaused": false
          },
          "question": {
            "uid": "q-late-1",
            "type": "single_correct",
            "text": "What is 10 + 5?",
            "answers": [
              "12",
              "13",
              "14",
              "15"
            ]
          }
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.323] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "room": "game_LWUDN8",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4925d36f-6259-45c0-86ed-1d5dde177021",
          "accessCode": "LWUDN8",
          "status": "active",
          "currentQuestionIndex": 0,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 1749036926866,
            "duration": 2000,
            "isPaused": false
          },
          "question": {
            "uid": "q-late-1",
            "type": "single_correct",
            "text": "What is 10 + 5?",
            "answers": [
              "12",
              "13",
              "14",
              "15"
            ]
          }
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.335] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.336] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.346] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "socketId": "ZwoVq7ANTvBrzorbAAAR",
        "liveRoom": "game_LWUDN8",
        "socketIds": [
          "a_M78TIRFbDW6XzZAAAO",
          "HdOvi1AUlgeQul9ZAAAP",
          "ZwoVq7ANTvBrzorbAAAR"
        ]
      } [DEBUG] Late joiner socket and current live room members before emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.347] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "currentIndex": 0,
        "questionId": "q-late-1",
        "questionState": "stopped",
        "timer": 0,
        "playMode": "tournament",
        "phase": "show_answers",
        "feedbackRemaining": 0
      } [DEBUG] Emitted game_question to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.348] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "questionId": "q-late-1",
        "playMode": "tournament",
        "questionState": "stopped",
        "phase": "show_answers"
      } [DEBUG] Emitted correct_answers to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.348] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "socketId": "ZwoVq7ANTvBrzorbAAAR",
        "liveRoom": "game_LWUDN8",
        "socketIds": [
          "a_M78TIRFbDW6XzZAAAO",
          "HdOvi1AUlgeQul9ZAAAP",
          "ZwoVq7ANTvBrzorbAAAR"
        ]
      } [DEBUG] Late joiner socket and current live room members before emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.349] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "currentIndex": 0,
        "questionId": "q-late-1",
        "questionState": "stopped",
        "timer": 0,
        "playMode": "tournament",
        "phase": "show_answers",
        "feedbackRemaining": 0
      } [DEBUG] Emitted game_question to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:29.350] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "questionId": "q-late-1",
        "playMode": "tournament",
        "questionState": "stopped",
        "phase": "show_answers"
      } [DEBUG] Emitted correct_answers to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:30.917] [32mINFO [0m [SharedGameFlow] {
        "room": "game_LWUDN8",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:30.918] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:30.922] [32mINFO [0m [GameStateService] {
        "accessCode": "LWUDN8"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:30.923] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8",
        "questionIndex": 1,
        "questionUid": "q-late-2"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:30.924] [32mINFO [0m [SharedGameFlow] {
        "room": "game_LWUDN8",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-2",
            "title": null,
            "text": "What is 7 x 3?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "multiplication"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "multiplication",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-04T11:34:41.963Z",
            "updatedAt": "2025-06-04T11:34:52.161Z",
            "answerOptions": [
              "20",
              "21",
              "24",
              "27"
            ],
            "correctAnswers": [
              false,
              true,
              false,
              false
            ],
            "feedbackWaitTime": 0
          },
          "index": 1,
          "feedbackWaitTime": 1.5
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:30.925] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8",
        "event": "game_question",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:32.925] [32mINFO [0m [SharedGameFlow] {
        "room": "game_LWUDN8",
        "event": "correct_answers",
        "questionId": "q-late-2"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:32.926] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8",
        "event": "correct_answers",
        "questionUid": "q-late-2"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:32.927] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8",
        "questionId": "q-late-2"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:32.930] [32mINFO [0m [GameStateService] {
        "accessCode": "LWUDN8",
        "questionId": "q-late-2"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:32.931] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8",
        "questionId": "q-late-2"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.431] [32mINFO [0m [SharedGameFlow] {
        "room": "game_LWUDN8",
        "event": "feedback",
        "questionId": "q-late-2"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.433] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8",
        "event": "feedback",
        "questionUid": "q-late-2"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.434] [32mINFO [0m [SharedGameFlow] {
        "room": "game_LWUDN8",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.435] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "LWUDN8",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.437] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "receivedPlayMode": "tournament",
        "socketId": "ZwoVq7ANTvBrzorbAAAR"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.438] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "finalPlayMode": "tournament",
        "socketId": "ZwoVq7ANTvBrzorbAAAR"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.438] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "receivedPlayMode": "tournament",
        "socketId": "ZwoVq7ANTvBrzorbAAAR"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.439] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "finalPlayMode": "tournament",
        "socketId": "ZwoVq7ANTvBrzorbAAAR"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.441] [33mWARN [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "questionId": "q-late-1"
      } Answer submitted after timer expired (tournament mode).

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.442] [33mWARN [0m [SharedLiveHandler] {
        "accessCode": "LWUDN8",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "questionId": "q-late-1"
      } Answer submitted after timer expired (tournament mode).

      at log (src/utils/logger.ts:102:21)

    console.log
      socket3 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:790:33)

    console.log
      Starting afterAll cleanup...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:74:17)

    console.log
      Processing socket1...

      at disconnectSocket (tests/integration/tournament2.test.ts:82:21)

    console.log
      socket1 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament2.test.ts:87:25)

    console.log
      socket1 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:97:37)

    console.log
      socket1 processing complete.

      at disconnectSocket (tests/integration/tournament2.test.ts:113:21)

    console.log
      Processing socket2...

      at disconnectSocket (tests/integration/tournament2.test.ts:82:21)

    console.log
      socket2 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament2.test.ts:87:25)

    console.log
      socket2 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:97:37)

    console.log
      socket2 processing complete.

      at disconnectSocket (tests/integration/tournament2.test.ts:113:21)

    console.log
      [2025-06-04 13:35:34.458] [32mINFO [0m [DisconnectHandler] {
        "socketId": "ZwoVq7ANTvBrzorbAAAR",
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "accessCode": "LWUDN8",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.468] [32mINFO [0m [DisconnectHandler] {
        "socketId": "a_M78TIRFbDW6XzZAAAO",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "accessCode": "LWUDN8",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.470] [32mINFO [0m [DisconnectHandler] {
        "socketId": "HdOvi1AUlgeQul9ZAAAP",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "accessCode": "LWUDN8",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.482] [32mINFO [0m [DisconnectHandler] {
        "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
        "accessCode": "LWUDN8",
        "socketId": "ZwoVq7ANTvBrzorbAAAR"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.484] [32mINFO [0m [DisconnectHandler] {
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "accessCode": "LWUDN8",
        "socketId": "a_M78TIRFbDW6XzZAAAO"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.485] [32mINFO [0m [DisconnectHandler] {
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "accessCode": "LWUDN8",
        "socketId": "HdOvi1AUlgeQul9ZAAAP"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.488] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "07009e79-2d83-4fa4-bad6-df886b6d6dfa",
          "socketId": "ZwoVq7ANTvBrzorbAAAR"
        },
        "room": "game_LWUDN8"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.489] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
          "socketId": "a_M78TIRFbDW6XzZAAAO"
        },
        "room": "game_LWUDN8"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.490] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
          "socketId": "HdOvi1AUlgeQul9ZAAAP"
        },
        "room": "game_LWUDN8"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing Socket.IO server...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:124:21)

    console.log
      [2025-06-04 13:35:34.957] [32mINFO [0m [DisconnectHandler] {
        "socketId": "XHkslNTQ8LB09R2qAAAC",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "accessCode": "RRXBD8",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-04 13:35:34.962] [32mINFO [0m [DisconnectHandler] {
        "socketId": "YBFBBbRZovlTyNR4AAAD",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "accessCode": "RRXBD8",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-04 13:35:34.964] [32mINFO [0m [DisconnectHandler] {
        "socketId": "Ejdccr4pG38G6YtTAAAG",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "accessCode": "ZFTDC4",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-04 13:35:34.965] [32mINFO [0m [DisconnectHandler] {
        "socketId": "Q8663L6oqG5lplsLAAAH",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "accessCode": "ZFTDC4",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-04 13:35:34.966] [32mINFO [0m [DisconnectHandler] {
        "socketId": "JxBFeyVmGP8tT29aAAAK",
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "accessCode": "N8C8MN",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-04 13:35:34.967] [32mINFO [0m [DisconnectHandler] {
        "socketId": "jLKvOxwsk7uT9rxwAAAL",
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "accessCode": "N8C8MN",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-04 13:35:34.986] [32mINFO [0m [DisconnectHandler] {
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "accessCode": "RRXBD8",
        "socketId": "XHkslNTQ8LB09R2qAAAC"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.987] [32mINFO [0m [DisconnectHandler] {
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "accessCode": "RRXBD8",
        "socketId": "YBFBBbRZovlTyNR4AAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.988] [32mINFO [0m [DisconnectHandler] {
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "accessCode": "ZFTDC4",
        "socketId": "Ejdccr4pG38G6YtTAAAG"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.989] [32mINFO [0m [DisconnectHandler] {
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "accessCode": "ZFTDC4",
        "socketId": "Q8663L6oqG5lplsLAAAH"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.993] [32mINFO [0m [DisconnectHandler] {
        "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
        "accessCode": "N8C8MN",
        "socketId": "JxBFeyVmGP8tT29aAAAK"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:34.994] [32mINFO [0m [DisconnectHandler] {
        "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
        "accessCode": "N8C8MN",
        "socketId": "jLKvOxwsk7uT9rxwAAAL"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket.IO server closed successfully.

      at Server.<anonymous> (tests/integration/tournament2.test.ts:136:33)

    console.log
      Attempting to close HTTP server...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:144:17)

    console.log
      HTTP server was not listening. Assuming already closed or handled by Socket.IO close.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:164:25)

    console.log
      Waiting longer for server resources to release before closing Redis...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:170:17)

    console.log
      [2025-06-04 13:35:35.004] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
          "socketId": "XHkslNTQ8LB09R2qAAAC"
        },
        "room": "game_RRXBD8"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:35.005] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
          "socketId": "YBFBBbRZovlTyNR4AAAD"
        },
        "room": "game_RRXBD8"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:35.007] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
          "socketId": "Ejdccr4pG38G6YtTAAAG"
        },
        "room": "game_ZFTDC4"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:35.007] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
          "socketId": "Q8663L6oqG5lplsLAAAH"
        },
        "room": "game_ZFTDC4"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:35.010] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "1ec5c58e-de24-4e31-bef2-a25fb8c7eee7",
          "socketId": "JxBFeyVmGP8tT29aAAAK"
        },
        "room": "game_N8C8MN"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:35.012] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "d0ec2ad6-0f3d-471c-b3ef-9edc79faa2f8",
          "socketId": "jLKvOxwsk7uT9rxwAAAL"
        },
        "room": "game_N8C8MN"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing SocketIO Redis clients (subClient)...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:174:17)

    console.log
      SocketIO Redis clients closed.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:177:21)

    console.log
      Closing main Redis client...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:185:17)

    console.log
      Main Redis client quit successfully.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:189:25)

    console.log
      Cleaning up database...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:200:17)

    console.log
      Database cleanup successful.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:212:21)

    console.warn
      Error cleaning up Redis keys: Connection is closed.

      222 |             }
      223 |         } catch (e: any) {
    > 224 |             console.warn('Error cleaning up Redis keys:', e.message || e);
          |                     ^
      225 |         }
      226 |
      227 |         await new Promise(resolve => setTimeout(resolve, 300));

      at Object.<anonymous> (tests/integration/tournament2.test.ts:224:21)

    console.log
      afterAll cleanup complete.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:228:17)

PASS tests/integration/mockedGameHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-04 13:35:41.269] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:41.921] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "ee8de138-fff5-4044-88fc-08c990a1698a",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:41.986] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-1hqqctbj4pfh"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:41.989] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-1hqqctbj4pfh"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'socket-1hqqctbj4pfh',
        joinedRoomSocketIds: []
      }

      at log (src/sockets/handlers/game/joinGame.ts:109:25)

    console.log
      [2025-06-04 13:35:42.088] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "c5965730-66a3-4391-ba27-2b9d04e9de34",
            "userId": "player-1_mbhvfp38bjdxar",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0,
            "joinedAt": "2025-06-04T11:35:42.070Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:42.089] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "c5965730-66a3-4391-ba27-2b9d04e9de34",
            "userId": "player-1_mbhvfp38bjdxar",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:42.227] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-98a3z88urnn"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:42.228] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-98a3z88urnn"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:42.268] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-bircoqi4jva"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:42.269] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-bircoqi4jva"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        questionId: 'q-late-1',
        answer: { selectedOption: 'b' },
        timeSpent: 5000
      } Socket ID: socket-bircoqi4jva Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-04 13:35:42.289] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-bircoqi4jva",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "questionId": "q-late-1",
          "answer": {
            "selectedOption": "b"
          },
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:42.297] [33mWARN [0m [GameAnswerHandler] {
        "socketId": "socket-bircoqi4jva",
        "error": "Invalid payload",
        "details": {
          "_errors": [],
          "userId": {
            "_errors": [
              "Required"
            ]
          },
          "answer": {
            "_errors": [
              "Expected string, received object",
              "Expected number, received object",
              "Expected array, received object",
              "Expected array, received object"
            ]
          }
        }
      } Invalid game answer payload

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        questionId: 'q-late-1',
        answer: { selectedOption: 'b' },
        timeSpent: 5000
      } Socket ID: socket-bircoqi4jva Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-04 13:35:42.305] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-bircoqi4jva",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "questionId": "q-late-1",
          "answer": {
            "selectedOption": "b"
          },
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:42.309] [33mWARN [0m [GameAnswerHandler] {
        "socketId": "socket-bircoqi4jva",
        "error": "Invalid payload",
        "details": {
          "_errors": [],
          "userId": {
            "_errors": [
              "Required"
            ]
          },
          "answer": {
            "_errors": [
              "Expected string, received object",
              "Expected number, received object",
              "Expected array, received object",
              "Expected array, received object"
            ]
          }
        }
      } Invalid game answer payload

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:42.362] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-33bgbkgvkfu"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:42.362] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-33bgbkgvkfu"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:42.786] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-104inozxu3nl"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:42.788] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-104inozxu3nl"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:42.924] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-6n9ckwrvden"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:42.925] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-6n9ckwrvden"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:42.964] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "DIFF123",
          "participant": {
            "id": "c8692bee-f40d-4581-86ac-7ed2ab2620db",
            "userId": "player-1_mbhvfp38bjdxar",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0,
            "joinedAt": "2025-06-04T11:35:42.950Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": true,
          "differedAvailableFrom": "2025-06-04T11:35:42.889Z",
          "differedAvailableTo": "2025-06-04T12:35:42.889Z"
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.008] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-sngywq3qma9"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.009] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-sngywq3qma9"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.013] [33mWARN [0m [JoinGameHandler] {
        "errorPayload": {
          "message": "Differed mode not available at this time."
        }
      } Emitting game_error: differed window not available

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.070] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-8t9sc3a9w4t"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.071] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-8t9sc3a9w4t"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.077] [32mINFO [0m [JoinGameHandler] {
        "gameAlreadyPlayedPayload": {
          "accessCode": "DIFF123"
        }
      } Emitting game_already_played

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.106] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-ohxyfkqn98q"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.107] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-ohxyfkqn98q"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.147] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "DIFF123",
          "participant": {
            "id": "f0c97adf-4224-45a1-8c12-5243fce9423a",
            "userId": "player-3_mbhvfp38bjdxar",
            "username": "Player 3",
            "avatarEmoji": "https://example.com/avatar3.jpg",
            "score": 0,
            "joinedAt": "2025-06-04T11:35:43.134Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": true,
          "differedAvailableFrom": "2025-06-04T11:35:43.014Z",
          "differedAvailableTo": "2025-06-04T12:35:43.014Z"
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'DIFF123',
        userId: 'player-3_mbhvfp38bjdxar',
        questionId: '75e42e80-1e85-4462-9e19-4caaca82092f',
        answer: 'b',
        timeSpent: 2000
      } Socket ID: socket-ohxyfkqn98q Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-04 13:35:43.149] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-ohxyfkqn98q",
        "event": "game_answer",
        "payload": {
          "accessCode": "DIFF123",
          "userId": "player-3_mbhvfp38bjdxar",
          "questionId": "75e42e80-1e85-4462-9e19-4caaca82092f",
          "answer": "b",
          "timeSpent": 2000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.222] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbhvfp38bjdxar",
        "questionId": "75e42e80-1e85-4462-9e19-4caaca82092f"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at log (src/sockets/handlers/game/gameAnswer.ts:179:25)

    console.log
      [GAME_ANSWER] Adding current questionId 75e42e80-1e85-4462-9e19-4caaca82092f to answered questions

      at log (src/sockets/handlers/game/gameAnswer.ts:191:29)

    console.log
      [GAME_ANSWER] Found 1/1 answered questions: [ '75e42e80-1e85-4462-9e19-4caaca82092f' ]

      at log (src/sockets/handlers/game/gameAnswer.ts:198:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=1

      at log (src/sockets/handlers/game/gameAnswer.ts:207:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at log (src/sockets/handlers/game/gameAnswer.ts:217:29)

    console.log
      [2025-06-04 13:35:43.227] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbhvfp38bjdxar",
        "questionId": "75e42e80-1e85-4462-9e19-4caaca82092f"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'DIFF123',
        userId: 'player-3_mbhvfp38bjdxar',
        questionId: '75e42e80-1e85-4462-9e19-4caaca82092f',
        answer: 'b',
        timeSpent: 2000
      } Socket ID: socket-ohxyfkqn98q Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-04 13:35:43.228] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-ohxyfkqn98q",
        "event": "game_answer",
        "payload": {
          "accessCode": "DIFF123",
          "userId": "player-3_mbhvfp38bjdxar",
          "questionId": "75e42e80-1e85-4462-9e19-4caaca82092f",
          "answer": "b",
          "timeSpent": 2000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.278] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbhvfp38bjdxar",
        "questionId": "75e42e80-1e85-4462-9e19-4caaca82092f"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":"b","timestamp":"2025-06-04T11:35:43.168Z","questionUid":"75e42e80-1e85-4462-9e19-4caaca82092f","timeTakenMs":2000}]

      at log (src/sockets/handlers/game/gameAnswer.ts:179:25)

    console.log
      [GAME_ANSWER] Found 1/1 answered questions: [ '75e42e80-1e85-4462-9e19-4caaca82092f' ]

      at log (src/sockets/handlers/game/gameAnswer.ts:198:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=1

      at log (src/sockets/handlers/game/gameAnswer.ts:207:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at log (src/sockets/handlers/game/gameAnswer.ts:217:29)

    console.log
      [2025-06-04 13:35:43.279] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbhvfp38bjdxar",
        "questionId": "75e42e80-1e85-4462-9e19-4caaca82092f"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.330] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-m9tsv6mgbe"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.330] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-m9tsv6mgbe"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'socket-m9tsv6mgbe',
        joinedRoomSocketIds: []
      }

      at log (src/sockets/handlers/game/joinGame.ts:109:25)

    console.log
      [2025-06-04 13:35:43.361] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "c5965730-66a3-4391-ba27-2b9d04e9de34",
            "userId": "player-1_mbhvfp38bjdxar",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0,
            "joinedAt": "2025-06-04T11:35:43.348Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.362] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "c5965730-66a3-4391-ba27-2b9d04e9de34",
            "userId": "player-1_mbhvfp38bjdxar",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.377] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.391] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789",
        "questionIndex": 0
      } Current question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        userId: 'player-1_mbhvfp38bjdxar',
        questionId: 'b29e31ca-09e0-4f91-910a-1aa891a9b271',
        answer: 1,
        timeSpent: 5000
      } Socket ID: socket-m9tsv6mgbe Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-04 13:35:43.392] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-m9tsv6mgbe",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "userId": "player-1_mbhvfp38bjdxar",
          "questionId": "b29e31ca-09e0-4f91-910a-1aa891a9b271",
          "answer": 1,
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.426] [32mINFO [0m [GameAnswerHandler] {
        "leaderboard": [
          {
            "userId": "player-1_mbhvfp38bjdxar",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0
          }
        ],
        "roomName": "teacher_5af6ebbb-2d73-46a8-9ec7-84ebef3b3cff_TST789"
      } Emitting leaderboard_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.427] [32mINFO [0m [GameAnswerHandler] {
        "questionId": "b29e31ca-09e0-4f91-910a-1aa891a9b271",
        "timeSpent": 5000
      } Emitting answer_received for non-differed mode

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Successfully emitted answer_received for question b29e31ca-09e0-4f91-910a-1aa891a9b271 to socket socket-m9tsv6mgbe

      at log (src/sockets/handlers/game/gameAnswer.ts:243:29)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        userId: 'player-1_mbhvfp38bjdxar',
        questionId: 'b29e31ca-09e0-4f91-910a-1aa891a9b271',
        answer: 1,
        timeSpent: 5000
      } Socket ID: socket-m9tsv6mgbe Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-04 13:35:43.427] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-m9tsv6mgbe",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "userId": "player-1_mbhvfp38bjdxar",
          "questionId": "b29e31ca-09e0-4f91-910a-1aa891a9b271",
          "answer": 1,
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.461] [32mINFO [0m [GameAnswerHandler] {
        "leaderboard": [
          {
            "userId": "player-1_mbhvfp38bjdxar",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0
          }
        ],
        "roomName": "teacher_5af6ebbb-2d73-46a8-9ec7-84ebef3b3cff_TST789"
      } Emitting leaderboard_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:43.462] [32mINFO [0m [GameAnswerHandler] {
        "questionId": "b29e31ca-09e0-4f91-910a-1aa891a9b271",
        "timeSpent": 5000
      } Emitting answer_received for non-differed mode

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Successfully emitted answer_received for question b29e31ca-09e0-4f91-910a-1aa891a9b271 to socket socket-m9tsv6mgbe

      at log (src/sockets/handlers/game/gameAnswer.ts:243:29)

    console.log
      [DEBUG before scoring] Redis key: mathquest:game:answers:TST789:b29e31ca-09e0-4f91-910a-1aa891a9b271 value: {
        'player-1_mbhvfp38bjdxar': '{"userId":"player-1_mbhvfp38bjdxar","answer":1,"timeSpent":5000,"submittedAt":1749036943454}'
      }

      at Object.<anonymous> (tests/integration/mockedGameHandler.test.ts:920:21)

    console.log
      [2025-06-04 13:35:43.489] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789",
        "questionId": "b29e31ca-09e0-4f91-910a-1aa891a9b271"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG after scoring] Redis key: mathquest:game:answers:TST789:b29e31ca-09e0-4f91-910a-1aa891a9b271 value: {
        'player-1_mbhvfp38bjdxar': '{"userId":"player-1_mbhvfp38bjdxar","answer":1,"timeSpent":5000,"submittedAt":1749036943454}'
      }

      at Object.<anonymous> (tests/integration/mockedGameHandler.test.ts:927:21)

PASS tests/integration/gameHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-04 13:35:46.190] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.447] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "8d189183-8c68-477d-bd36-312c7713416c",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.472] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "iTO-LEufnErmp06YAAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.475] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "iTO-LEufnErmp06YAAAB",
        "user": {
          "id": "player-123",
          "userId": "player-123",
          "username": "Test Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.507] [32mINFO [0m [GameHandlers] {
        "socketId": "iTO-LEufnErmp06YAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.508] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "iTO-LEufnErmp06YAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.526] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "8d189183-8c68-477d-bd36-312c7713416c",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'iTO-LEufnErmp06YAAAB',
        joinedRoomSocketIds: [ 'iTO-LEufnErmp06YAAAB' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:109:25)

    console.log
      [2025-06-04 13:35:46.567] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.568] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Test Player",
        "avatarEmoji": "https://example.com/avatar.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.568] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.569] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Test Player",
        "avatarEmoji": "https://example.com/avatar.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.569] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.570] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.573] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "8d189183-8c68-477d-bd36-312c7713416c",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.576] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "8d189183-8c68-477d-bd36-312c7713416c",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.589] [32mINFO [0m [DisconnectHandler] {
        "socketId": "iTO-LEufnErmp06YAAAB",
        "userId": "player-123",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.610] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.611] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.612] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-123",
        "accessCode": "TST789",
        "disconnectedSocketId": "iTO-LEufnErmp06YAAAB",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.627] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "ip5T9jruEWHxSsvuAAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.628] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "ip5T9jruEWHxSsvuAAAE",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.629] [32mINFO [0m [GameHandlers] {
        "socketId": "ip5T9jruEWHxSsvuAAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.630] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "ip5T9jruEWHxSsvuAAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.642] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "R1TrRI4lLzGO9JfxAAAF"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.644] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "R1TrRI4lLzGO9JfxAAAF",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.644] [32mINFO [0m [GameHandlers] {
        "socketId": "R1TrRI4lLzGO9JfxAAAF"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.645] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "R1TrRI4lLzGO9JfxAAAF"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.649] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "8823b88f-299b-4adf-9401-509c22c5f37e",
            "userId": "player-123",
            "username": "Test Player",
            "avatarEmoji": "https://example.com/avatar.jpg",
            "score": 0,
            "joinedAt": "2025-06-04T11:35:46.608Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.652] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "8823b88f-299b-4adf-9401-509c22c5f37e",
            "userId": "player-123",
            "username": "Test Player",
            "avatarEmoji": "https://example.com/avatar.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.670] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "8d189183-8c68-477d-bd36-312c7713416c",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'ip5T9jruEWHxSsvuAAAE',
        joinedRoomSocketIds: [ 'ip5T9jruEWHxSsvuAAAE' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:109:25)

    console.log
      [2025-06-04 13:35:46.682] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.683] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.685] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.686] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.686] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.689] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.694] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "8d189183-8c68-477d-bd36-312c7713416c",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.695] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "8d189183-8c68-477d-bd36-312c7713416c",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.712] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.716] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'R1TrRI4lLzGO9JfxAAAF',
        joinedRoomSocketIds: [ 'ip5T9jruEWHxSsvuAAAE', 'R1TrRI4lLzGO9JfxAAAF' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:109:25)

    console.log
      [2025-06-04 13:35:46.750] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "6e9ebc42-6211-4de0-bbfa-3aacdedbaa8b",
            "userId": "player-1",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0,
            "joinedAt": "2025-06-04T11:35:46.723Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.751] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "6e9ebc42-6211-4de0-bbfa-3aacdedbaa8b",
            "userId": "player-1",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.759] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.760] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.761] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.761] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.762] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.762] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.772] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "8d189183-8c68-477d-bd36-312c7713416c",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.774] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "8d189183-8c68-477d-bd36-312c7713416c",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.792] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.793] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.794] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "767f8b4b-8d89-425f-b729-37ee0a048e14",
            "userId": "player-2",
            "username": "Player 2",
            "avatarEmoji": "https://example.com/avatar2.jpg",
            "score": 0,
            "joinedAt": "2025-06-04T11:35:46.755Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.794] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "767f8b4b-8d89-425f-b729-37ee0a048e14",
            "userId": "player-2",
            "username": "Player 2",
            "avatarEmoji": "https://example.com/avatar2.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: Redis participants: {
        'player-2': '{"userId":"player-2","username":"Player 2","avatarEmoji":"https://example.com/avatar2.jpg","score":0,"answers":[],"online":true,"lastSocketId":"R1TrRI4lLzGO9JfxAAAF","joinedAt":"2025-06-04T11:35:46.791Z"}',
        'player-1': '{"userId":"player-1","username":"Player 1","avatarEmoji":"https://example.com/avatar1.jpg","joinedAt":"2025-06-04T11:35:46.723Z","score":0,"online":true,"lastSocketId":"ip5T9jruEWHxSsvuAAAE"}'
      }

      at Object.<anonymous> (tests/integration/gameHandler.test.ts:527:17)

    console.log
      [2025-06-04 13:35:46.895] [32mINFO [0m [DisconnectHandler] {
        "socketId": "ip5T9jruEWHxSsvuAAAE",
        "userId": "player-1",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.897] [32mINFO [0m [DisconnectHandler] {
        "socketId": "R1TrRI4lLzGO9JfxAAAF",
        "userId": "player-2",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.907] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-1",
        "accessCode": "TST789",
        "disconnectedSocketId": "ip5T9jruEWHxSsvuAAAE",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.908] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TST789",
        "disconnectedSocketId": "R1TrRI4lLzGO9JfxAAAF",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.925] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "rCBf_pWPiyuM4oPhAAAI"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.926] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "rCBf_pWPiyuM4oPhAAAI",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.926] [32mINFO [0m [GameHandlers] {
        "socketId": "rCBf_pWPiyuM4oPhAAAI"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.926] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "rCBf_pWPiyuM4oPhAAAI"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.930] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "5GAfS4C5LaR016umAAAJ"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.931] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "5GAfS4C5LaR016umAAAJ",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.932] [32mINFO [0m [GameHandlers] {
        "socketId": "5GAfS4C5LaR016umAAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.932] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "5GAfS4C5LaR016umAAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.958] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "8d189183-8c68-477d-bd36-312c7713416c",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'rCBf_pWPiyuM4oPhAAAI',
        joinedRoomSocketIds: [ 'rCBf_pWPiyuM4oPhAAAI' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:109:25)

    console.log
      [2025-06-04 13:35:46.974] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.975] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.975] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.975] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.975] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.976] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: '5GAfS4C5LaR016umAAAJ',
        joinedRoomSocketIds: [ 'rCBf_pWPiyuM4oPhAAAI', '5GAfS4C5LaR016umAAAJ' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:109:25)

    console.log
      [2025-06-04 13:35:46.978] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.980] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.982] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.983] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.984] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.987] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.994] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "8d189183-8c68-477d-bd36-312c7713416c",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.995] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "8d189183-8c68-477d-bd36-312c7713416c",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.998] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "8d189183-8c68-477d-bd36-312c7713416c",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:46.999] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "8d189183-8c68-477d-bd36-312c7713416c",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:47.005] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:47.006] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:47.006] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:47.006] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:47.045] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "6e9ebc42-6211-4de0-bbfa-3aacdedbaa8b",
            "userId": "player-1",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0,
            "joinedAt": "2025-06-04T11:35:47.002Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:47.047] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "6e9ebc42-6211-4de0-bbfa-3aacdedbaa8b",
            "userId": "player-1",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:47.056] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "767f8b4b-8d89-425f-b729-37ee0a048e14",
            "userId": "player-2",
            "username": "Player 2",
            "avatarEmoji": "https://example.com/avatar2.jpg",
            "score": 0,
            "joinedAt": "2025-06-04T11:35:47.004Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:47.057] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "767f8b4b-8d89-425f-b729-37ee0a048e14",
            "userId": "player-2",
            "username": "Player 2",
            "avatarEmoji": "https://example.com/avatar2.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: Redis participants: {
        'player-2': '{"userId":"player-2","username":"Player 2","avatarEmoji":"https://example.com/avatar2.jpg","joinedAt":"2025-06-04T11:35:47.004Z","score":0,"online":true,"lastSocketId":"5GAfS4C5LaR016umAAAJ"}',
        'player-1': '{"userId":"player-1","username":"Player 1","avatarEmoji":"https://example.com/avatar1.jpg","joinedAt":"2025-06-04T11:35:47.002Z","score":0,"online":true,"lastSocketId":"rCBf_pWPiyuM4oPhAAAI"}'
      }

      at Object.<anonymous> (tests/integration/gameHandler.test.ts:623:17)

    console.log
      [2025-06-04 13:35:47.507] [32mINFO [0m [DisconnectHandler] {
        "socketId": "rCBf_pWPiyuM4oPhAAAI",
        "userId": "player-1",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:47.508] [32mINFO [0m [DisconnectHandler] {
        "socketId": "5GAfS4C5LaR016umAAAJ",
        "userId": "player-2",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:47.515] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-1",
        "accessCode": "TST789",
        "disconnectedSocketId": "rCBf_pWPiyuM4oPhAAAI",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:47.517] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TST789",
        "disconnectedSocketId": "5GAfS4C5LaR016umAAAJ",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/tournament.test.ts (22.098 s)
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-04 13:35:50.663] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.092] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.238] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "ddb5b2ee-b459-4ab1-b133-79ebee77335a",
        "accessCode": "PEMSCZ"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.533] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "qGSWJC1VAg1073jGAAAC",
        "user": {
          "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
          "username": "p1-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.566] [32mINFO [0m [GameHandlers] {
        "socketId": "qGSWJC1VAg1073jGAAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.567] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "qGSWJC1VAg1073jGAAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.573] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "G8Dt1w783R22iVCdAAAD",
        "user": {
          "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
          "username": "p2-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.577] [32mINFO [0m [GameHandlers] {
        "socketId": "G8Dt1w783R22iVCdAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.578] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "G8Dt1w783R22iVCdAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.581] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "room": "game_PEMSCZ",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.581] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "room": "game_PEMSCZ",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.582] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "room": "game_PEMSCZ",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.582] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "room": "game_PEMSCZ",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.583] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "room": "game_PEMSCZ",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.583] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "room": "game_PEMSCZ",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.583] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "room": "game_PEMSCZ",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.583] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "room": "game_PEMSCZ",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.585] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "room": "game_PEMSCZ",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "ddb5b2ee-b459-4ab1-b133-79ebee77335a",
          "accessCode": "PEMSCZ",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.586] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "room": "game_PEMSCZ",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "ddb5b2ee-b459-4ab1-b133-79ebee77335a",
          "accessCode": "PEMSCZ",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.587] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "room": "game_PEMSCZ",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "ddb5b2ee-b459-4ab1-b133-79ebee77335a",
          "accessCode": "PEMSCZ",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.589] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "room": "game_PEMSCZ",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "ddb5b2ee-b459-4ab1-b133-79ebee77335a",
          "accessCode": "PEMSCZ",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.597] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.598] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.599] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.599] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.644] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "ddb5b2ee-b459-4ab1-b133-79ebee77335a",
        "templateId": "af967841-1611-4968-81ad-d3057aeb8435",
        "initiator": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "PEMSCZ",
        "socketId": "qGSWJC1VAg1073jGAAAC"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.847] [32mINFO [0m [GameStateService] {
        "accessCode": "PEMSCZ"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:51.882] [32mINFO [0m [TournamentHandler] {
        "room": "game_PEMSCZ",
        "duration": 5,
        "accessCode": "PEMSCZ",
        "socketId": "qGSWJC1VAg1073jGAAAC"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.888] [32mINFO [0m [GameStateService] {
        "accessCode": "PEMSCZ"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.935] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PEMSCZ"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.935] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PEMSCZ",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.935] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PEMSCZ"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.939] [32mINFO [0m [GameStateService] {
        "accessCode": "PEMSCZ"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.939] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PEMSCZ",
        "room": "game_PEMSCZ",
        "socketIds": [
          "qGSWJC1VAg1073jGAAAC",
          "G8Dt1w783R22iVCdAAAD"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.939] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PEMSCZ",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.939] [32mINFO [0m [SharedGameFlow] {
        "room": "game_PEMSCZ",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-04T11:35:51.070Z",
            "updatedAt": "2025-06-04T11:35:51.135Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.940] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PEMSCZ",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.942] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "qGSWJC1VAg1073jGAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.942] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "qGSWJC1VAg1073jGAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.943] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "qGSWJC1VAg1073jGAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.943] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "qGSWJC1VAg1073jGAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.943] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "G8Dt1w783R22iVCdAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.943] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "G8Dt1w783R22iVCdAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.944] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "G8Dt1w783R22iVCdAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.945] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "G8Dt1w783R22iVCdAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.963] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.964] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.965] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:56.966] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PEMSCZ",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:58.941] [32mINFO [0m [SharedGameFlow] {
        "room": "game_PEMSCZ",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:58.942] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PEMSCZ",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:58.943] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PEMSCZ",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:58.955] [32mINFO [0m [GameStateService] {
        "accessCode": "PEMSCZ",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:58.955] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PEMSCZ",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:58.957] [32mINFO [0m [GameStateService] {
        "accessCode": "PEMSCZ",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
          "username": "p1-basic",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
          "username": "p2-basic",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament.test.ts:331:17)

    console.log
      [2025-06-04 13:35:59.011] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "5091d306-5935-4e8a-8ade-6c75fc065d0e",
        "accessCode": "D5E7DK"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.199] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "xYbsi8THkmmaVVA9AAAG",
        "user": {
          "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
          "username": "p1-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.200] [32mINFO [0m [GameHandlers] {
        "socketId": "xYbsi8THkmmaVVA9AAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.202] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "xYbsi8THkmmaVVA9AAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.206] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "uZ0m_z10BcqNZ0iEAAAH",
        "user": {
          "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
          "username": "p2-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.206] [32mINFO [0m [GameHandlers] {
        "socketId": "uZ0m_z10BcqNZ0iEAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.207] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "uZ0m_z10BcqNZ0iEAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.208] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "room": "game_D5E7DK",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.209] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "room": "game_D5E7DK",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.209] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "room": "game_D5E7DK",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.209] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "room": "game_D5E7DK",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.210] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "room": "game_D5E7DK",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.210] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "room": "game_D5E7DK",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.211] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "room": "game_D5E7DK",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.211] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "room": "game_D5E7DK",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.213] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "room": "game_D5E7DK",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "5091d306-5935-4e8a-8ade-6c75fc065d0e",
          "accessCode": "D5E7DK",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.217] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "room": "game_D5E7DK",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "5091d306-5935-4e8a-8ade-6c75fc065d0e",
          "accessCode": "D5E7DK",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.220] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "room": "game_D5E7DK",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "5091d306-5935-4e8a-8ade-6c75fc065d0e",
          "accessCode": "D5E7DK",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.229] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "room": "game_D5E7DK",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "5091d306-5935-4e8a-8ade-6c75fc065d0e",
          "accessCode": "D5E7DK",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.236] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.237] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.238] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.240] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.264] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "5091d306-5935-4e8a-8ade-6c75fc065d0e",
        "templateId": "50a81a12-0bfd-4158-a4b8-a2171353f63f",
        "initiator": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "D5E7DK",
        "socketId": "xYbsi8THkmmaVVA9AAAG"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.466] [32mINFO [0m [GameStateService] {
        "accessCode": "D5E7DK"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:35:59.480] [32mINFO [0m [TournamentHandler] {
        "room": "game_D5E7DK",
        "duration": 5,
        "accessCode": "D5E7DK",
        "socketId": "xYbsi8THkmmaVVA9AAAG"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:00.956] [32mINFO [0m [SharedGameFlow] {
        "room": "game_PEMSCZ",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:00.957] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PEMSCZ",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:00.958] [32mINFO [0m [SharedGameFlow] {
        "room": "game_PEMSCZ",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:00.959] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "PEMSCZ",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.485] [32mINFO [0m [GameStateService] {
        "accessCode": "D5E7DK"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.523] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "D5E7DK"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.524] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "D5E7DK",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.524] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "D5E7DK"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.528] [32mINFO [0m [GameStateService] {
        "accessCode": "D5E7DK"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.529] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "D5E7DK",
        "room": "game_D5E7DK",
        "socketIds": [
          "xYbsi8THkmmaVVA9AAAG",
          "uZ0m_z10BcqNZ0iEAAAH"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.529] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "D5E7DK",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.529] [32mINFO [0m [SharedGameFlow] {
        "room": "game_D5E7DK",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-04T11:35:51.070Z",
            "updatedAt": "2025-06-04T11:35:51.135Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.530] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "D5E7DK",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.532] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "xYbsi8THkmmaVVA9AAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.533] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "xYbsi8THkmmaVVA9AAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.533] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "xYbsi8THkmmaVVA9AAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.533] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "xYbsi8THkmmaVVA9AAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.534] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "uZ0m_z10BcqNZ0iEAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.534] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "uZ0m_z10BcqNZ0iEAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.534] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "uZ0m_z10BcqNZ0iEAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.535] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "uZ0m_z10BcqNZ0iEAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.546] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.546] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.547] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:04.547] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "D5E7DK",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:06.531] [32mINFO [0m [SharedGameFlow] {
        "room": "game_D5E7DK",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:06.533] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "D5E7DK",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:06.533] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "D5E7DK",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:06.542] [32mINFO [0m [GameStateService] {
        "accessCode": "D5E7DK",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:06.542] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "D5E7DK",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:06.546] [32mINFO [0m [GameStateService] {
        "accessCode": "D5E7DK",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
          "username": "p1-basic",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
          "username": "p2-basic",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament.test.ts:446:17)

    console.log
      Starting afterAll cleanup...

      at Object.<anonymous> (tests/integration/tournament.test.ts:78:17)

    console.log
      Processing socket1...

      at disconnectSocket (tests/integration/tournament.test.ts:86:21)

    console.log
      socket1 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament.test.ts:91:25)

    console.log
      socket1 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament.test.ts:101:37)

    console.log
      socket1 processing complete.

      at disconnectSocket (tests/integration/tournament.test.ts:117:21)

    console.log
      Processing socket2...

      at disconnectSocket (tests/integration/tournament.test.ts:86:21)

    console.log
      socket2 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament.test.ts:91:25)

    console.log
      socket2 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament.test.ts:101:37)

    console.log
      socket2 processing complete.

      at disconnectSocket (tests/integration/tournament.test.ts:117:21)

    console.log
      [2025-06-04 13:36:06.556] [32mINFO [0m [DisconnectHandler] {
        "socketId": "xYbsi8THkmmaVVA9AAAG",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "accessCode": "D5E7DK",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:06.558] [32mINFO [0m [DisconnectHandler] {
        "socketId": "uZ0m_z10BcqNZ0iEAAAH",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "accessCode": "D5E7DK",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:06.567] [32mINFO [0m [DisconnectHandler] {
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "accessCode": "D5E7DK",
        "socketId": "xYbsi8THkmmaVVA9AAAG"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:06.569] [32mINFO [0m [DisconnectHandler] {
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "accessCode": "D5E7DK",
        "socketId": "uZ0m_z10BcqNZ0iEAAAH"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:06.570] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
          "socketId": "xYbsi8THkmmaVVA9AAAG"
        },
        "room": "game_D5E7DK"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:06.571] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
          "socketId": "uZ0m_z10BcqNZ0iEAAAH"
        },
        "room": "game_D5E7DK"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing Socket.IO server...

      at Object.<anonymous> (tests/integration/tournament.test.ts:128:21)

    console.log
      [2025-06-04 13:36:07.056] [32mINFO [0m [DisconnectHandler] {
        "socketId": "qGSWJC1VAg1073jGAAAC",
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "accessCode": "PEMSCZ",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-04 13:36:07.057] [32mINFO [0m [DisconnectHandler] {
        "socketId": "G8Dt1w783R22iVCdAAAD",
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "accessCode": "PEMSCZ",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-04 13:36:07.062] [32mINFO [0m [DisconnectHandler] {
        "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
        "accessCode": "PEMSCZ",
        "socketId": "qGSWJC1VAg1073jGAAAC"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:07.062] [32mINFO [0m [DisconnectHandler] {
        "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
        "accessCode": "PEMSCZ",
        "socketId": "G8Dt1w783R22iVCdAAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket.IO server closed successfully.

      at Server.<anonymous> (tests/integration/tournament.test.ts:140:33)

    console.log
      Attempting to close HTTP server...

      at Object.<anonymous> (tests/integration/tournament.test.ts:148:17)

    console.log
      HTTP server was not listening. Assuming already closed or handled by Socket.IO close.

      at Object.<anonymous> (tests/integration/tournament.test.ts:168:25)

    console.log
      Waiting longer for server resources to release before closing Redis...

      at Object.<anonymous> (tests/integration/tournament.test.ts:174:17)

    console.log
      [2025-06-04 13:36:07.067] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "c5043fe0-4a3d-42b7-bf8b-bae00843b6d0",
          "socketId": "qGSWJC1VAg1073jGAAAC"
        },
        "room": "game_PEMSCZ"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:07.068] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "30b26a8e-69f2-4c82-877f-d432635f4aae",
          "socketId": "G8Dt1w783R22iVCdAAAD"
        },
        "room": "game_PEMSCZ"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:08.542] [32mINFO [0m [SharedGameFlow] {
        "room": "game_D5E7DK",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:08.543] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "D5E7DK",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:08.544] [32mINFO [0m [SharedGameFlow] {
        "room": "game_D5E7DK",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:08.544] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "D5E7DK",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing SocketIO Redis clients (subClient)...

      at Object.<anonymous> (tests/integration/tournament.test.ts:178:17)

    console.log
      SocketIO Redis clients closed.

      at Object.<anonymous> (tests/integration/tournament.test.ts:181:21)

    console.log
      Closing main Redis client...

      at Object.<anonymous> (tests/integration/tournament.test.ts:189:17)

    console.log
      Main Redis client quit successfully.

      at Object.<anonymous> (tests/integration/tournament.test.ts:193:25)

    console.log
      Cleaning up database...

      at Object.<anonymous> (tests/integration/tournament.test.ts:204:17)

    console.log
      Database cleanup successful.

      at Object.<anonymous> (tests/integration/tournament.test.ts:216:21)

    console.warn
      Error cleaning up Redis keys: Connection is closed.

      226 |             }
      227 |         } catch (e: any) {
    > 228 |             console.warn('Error cleaning up Redis keys:', e.message || e);
          |                     ^
      229 |         }
      230 |
      231 |         await new Promise(resolve => setTimeout(resolve, 300));

      at Object.<anonymous> (tests/integration/tournament.test.ts:228:21)

    console.log
      afterAll cleanup complete.

      at Object.<anonymous> (tests/integration/tournament.test.ts:232:17)

PASS tests/unit/gameParticipantService.test.ts
PASS tests/integration/teacherQuiz.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-04 13:36:13.136] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.149] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      Creating game template with payload: {
        name: 'My First Quiz Template',
        discipline: 'math',
        gradeLevel: 'middle',
        themes: [ 'arithmetic' ],
        questions: [ { questionUid: 'test-q-quiz-1', sequence: 1 } ]
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:94:17)

    console.log
      [2025-06-04 13:36:13.385] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJlNDY1Yzc2Ny0yNTMxLTQxYWYtYmIyYy0zMjRiNzllYjMyMjUiLCJ1c2VybmFtZSI6InF1aXpUZWFjaGVyIiwicm9sZSI6IlRFQUNIRVIiLCJpYXQiOjE3NDkwMzY5NzMsImV4cCI6MTc0OTA0MDU3M30.Ay6-f9Pdz9XrUjNNHvf_CElgeTrEsOh9SerECGL5ZHs"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.390] [32mINFO [0m [GameTemplatesAPI] {
        "body": {
          "name": "My First Quiz Template",
          "discipline": "math",
          "gradeLevel": "middle",
          "themes": [
            "arithmetic"
          ],
          "questions": [
            {
              "questionUid": "test-q-quiz-1",
              "sequence": 1
            }
          ]
        },
        "user": {
          "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
          "username": "quizTeacher",
          "role": "TEACHER",
          "iat": 1749036973,
          "exp": 1749040573
        }
      } Received request for game template creation

      at log (src/utils/logger.ts:102:21)

    console.log
      Game template response status: 201

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:111:17)

    console.log
      Game template response body: {
        gameTemplate: {
          id: '292773d3-a31a-45a9-8aa5-e0947cd05157',
          name: 'My First Quiz Template',
          gradeLevel: 'middle',
          themes: [ 'arithmetic' ],
          discipline: 'math',
          description: null,
          defaultMode: null,
          createdAt: '2025-06-04T11:36:13.398Z',
          updatedAt: '2025-06-04T11:36:13.398Z',
          creatorId: 'e465c767-2531-41af-bb2c-324b79eb3225',
          questions: [ [Object] ]
        }
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:112:17)

    console.log
      Creating game instance with payload: {
        name: 'Live Quiz Session 1',
        playMode: 'quiz',
        gameTemplateId: '292773d3-a31a-45a9-8aa5-e0947cd05157'
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:118:17)

    console.log
      [2025-06-04 13:36:13.465] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "accessCode": "KHMEG9"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      Game instance response status: 201

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:131:17)

    console.log
      Game instance response body: {
        gameInstance: {
          id: 'e31c50f9-d1a9-4351-8ce3-e690796c7263',
          name: 'Live Quiz Session 1',
          accessCode: 'KHMEG9',
          status: 'pending',
          playMode: 'quiz',
          leaderboard: null,
          currentQuestionIndex: null,
          settings: {},
          createdAt: '2025-06-04T11:36:13.435Z',
          startedAt: null,
          endedAt: null,
          differedAvailableFrom: null,
          differedAvailableTo: null,
          isDiffered: false,
          gameTemplateId: '292773d3-a31a-45a9-8aa5-e0947cd05157',
          initiatorUserId: 'e465c767-2531-41af-bb2c-324b79eb3225',
          gameTemplate: {
            name: 'My First Quiz Template',
            themes: [Array],
            discipline: 'math',
            gradeLevel: 'middle'
          }
        }
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:132:17)

    console.log
      [2025-06-04 13:36:13.474] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "BTYN5uPUwUuxhgP7AAAB",
        "user": {
          "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
          "role": "TEACHER"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.486] [32mINFO [0m [GameHandlers] {
        "socketId": "BTYN5uPUwUuxhgP7AAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.487] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "BTYN5uPUwUuxhgP7AAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.489] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "BTYN5uPUwUuxhgP7AAAB",
        "socketData": {
          "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
          "user": {
            "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
            "role": "TEACHER"
          },
          "connectionInfo": {
            "id": "BTYN5uPUwUuxhgP7AAAB",
            "address": "::ffff:127.0.0.1",
            "time": "2025-06-04T11:36:13.473Z"
          }
        },
        "auth": {
          "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJlNDY1Yzc2Ny0yNTMxLTQxYWYtYmIyYy0zMjRiNzllYjMyMjUiLCJ1c2VybmFtZSI6InF1aXpUZWFjaGVyIiwicm9sZSI6IlRFQUNIRVIiLCJpYXQiOjE3NDkwMzY5NzMsImV4cCI6MTc0OTA0MDU3M30.Ay6-f9Pdz9XrUjNNHvf_CElgeTrEsOh9SerECGL5ZHs",
          "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
          "userType": "teacher"
        },
        "headers": {
          "sec-websocket-version": "13",
          "sec-websocket-key": "5Ggd+wXja4jTRUsAoZ8qCg==",
          "connection": "Upgrade",
          "upgrade": "websocket",
          "sec-websocket-extensions": "permessage-deflate; client_max_window_bits",
          "host": "localhost:42747"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.494] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
        "socketId": "BTYN5uPUwUuxhgP7AAAB"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.499] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "BTYN5uPUwUuxhgP7AAAB",
        "allRooms": [
          "BTYN5uPUwUuxhgP7AAAB",
          "dashboard_e31c50f9-d1a9-4351-8ce3-e690796c7263",
          "projection_e31c50f9-d1a9-4351-8ce3-e690796c7263"
        ],
        "dashboardRoom": "dashboard_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "dashboardSockets": [
          "BTYN5uPUwUuxhgP7AAAB"
        ],
        "projectionRoom": "projection_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "projectionSockets": [
          "BTYN5uPUwUuxhgP7AAAB"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.519] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
        "socketId": "BTYN5uPUwUuxhgP7AAAB"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:215:25)

    console.log
      [2025-06-04 13:36:13.524] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "WBVfNStBpP0-DWDmAAAD",
        "user": {
          "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
          "username": "quizPlayer1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.525] [32mINFO [0m [GameHandlers] {
        "socketId": "WBVfNStBpP0-DWDmAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.525] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "WBVfNStBpP0-DWDmAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_KHMEG9',
        socketId: 'WBVfNStBpP0-DWDmAAAD',
        joinedRoomSocketIds: [ 'WBVfNStBpP0-DWDmAAAD' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:109:25)

    console.log
      [2025-06-04 13:36:13.569] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "KHMEG9",
        "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.570] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "KHMEG9",
        "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
        "room": "game_KHMEG9",
        "playMode": "quiz",
        "username": "quizPlayer1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.570] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "KHMEG9",
        "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.570] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "KHMEG9",
        "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
        "room": "game_KHMEG9",
        "playMode": "quiz",
        "username": "quizPlayer1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.570] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "KHMEG9",
        "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
        "room": "game_KHMEG9",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.571] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "KHMEG9",
        "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
        "room": "game_KHMEG9",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.573] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "KHMEG9",
        "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
        "room": "game_KHMEG9",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
          "accessCode": "KHMEG9",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.575] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "KHMEG9",
        "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
        "room": "game_KHMEG9",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
          "accessCode": "KHMEG9",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.585] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
        "questionUid": "test-q-quiz-1"
      } Setting question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.592] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "KHMEG9",
        "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.596] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "KHMEG9",
        "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.606] [32mINFO [0m [GameStateService] {
        "accessCode": "KHMEG9"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.607] [32mINFO [0m [SetQuestionHandler] {
        "liveRoom": "game_KHMEG9",
        "liveRoomSocketIds": [
          "WBVfNStBpP0-DWDmAAAD"
        ],
        "payload": {
          "question": {
            "uid": "test-q-quiz-1",
            "text": "What is 2+2 for quiz?",
            "answerOptions": [
              "3",
              "4",
              "5"
            ],
            "correctAnswers": [
              false,
              false,
              false
            ],
            "questionType": "multiple_choice_single_answer",
            "timeLimit": 30,
            "currentQuestionIndex": 0,
            "totalQuestions": 1
          },
          "timer": {
            "startedAt": 1749036973605,
            "duration": 30000,
            "isPaused": true
          }
        }
      } [DEBUG] Emitting game_question to live room

      at log (src/utils/logger.ts:102:21)

    console.log
      [setQuestion] Emitting game_question: {
        liveRoom: 'game_KHMEG9',
        liveRoomSocketIds: [ 'WBVfNStBpP0-DWDmAAAD' ],
        payload: {
          question: {
            uid: 'test-q-quiz-1',
            title: undefined,
            text: 'What is 2+2 for quiz?',
            answerOptions: [Array],
            correctAnswers: [Array],
            questionType: 'multiple_choice_single_answer',
            timeLimit: 30,
            currentQuestionIndex: 0,
            totalQuestions: 1
          },
          timer: { startedAt: 1749036973605, duration: 30000, isPaused: true }
        }
      }

      at Socket.log (src/sockets/handlers/teacherControl/setQuestion.ts:193:25)

    console.log
      [2025-06-04 13:36:13.609] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "questionUid": "test-q-quiz-1",
        "questionIndex": 0
      } Question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.610] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "KHMEG9",
          "participant": {
            "id": "55ae5995-ea19-496d-958d-dd22d26c3360",
            "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
            "username": "quizPlayer1",
            "score": 0,
            "joinedAt": "2025-06-04T11:36:13.582Z",
            "online": true
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.611] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "55ae5995-ea19-496d-958d-dd22d26c3360",
            "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
            "username": "quizPlayer1",
            "score": 0,
            "online": true
          }
        },
        "room": "game_KHMEG9"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.615] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
          "action": "resume"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.618] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
        "action": "resume"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.618] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
        "action": "resume"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.627] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "resume",
        "timer": {
          "startedAt": 1749036973626,
          "duration": 30000,
          "isPaused": false
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.630] [32mINFO [0m [GameStateService] {
        "accessCode": "KHMEG9"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.632] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "resume",
        "dashboardRoom": "dashboard_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "liveRoom": "game_KHMEG9",
        "projectionRoom": "projection_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "timer": {
          "startedAt": 1749036973626,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.634] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "resume",
        "dashboardRoom": "dashboard_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "timer": {
          "startedAt": 1749036973626,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.635] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "resume",
        "liveRoom": "game_KHMEG9",
        "timer": {
          "startedAt": 1749036973626,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.636] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "resume",
        "projectionRoom": "projection_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "timer": {
          "startedAt": 1749036973626,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.637] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "resume"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.640] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
          "action": "pause"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.641] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
        "action": "pause"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.642] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
        "action": "pause"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.655] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "pause",
        "timer": {
          "startedAt": 1749036973626,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1749036973654,
          "timeRemaining": 29972
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.656] [32mINFO [0m [GameStateService] {
        "accessCode": "KHMEG9"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.657] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "pause",
        "dashboardRoom": "dashboard_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "liveRoom": "game_KHMEG9",
        "projectionRoom": "projection_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "timer": {
          "startedAt": 1749036973626,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1749036973654,
          "timeRemaining": 29972
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.659] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "pause",
        "dashboardRoom": "dashboard_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "timer": {
          "startedAt": 1749036973626,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1749036973654,
          "timeRemaining": 29972
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.662] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "pause",
        "liveRoom": "game_KHMEG9",
        "timer": {
          "startedAt": 1749036973626,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1749036973654,
          "timeRemaining": 29972
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.664] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "pause",
        "projectionRoom": "projection_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "timer": {
          "startedAt": 1749036973626,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1749036973654,
          "timeRemaining": 29972
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:13.664] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "pause"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.671] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
          "action": "resume"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.672] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
        "action": "resume"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.673] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
        "action": "resume"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.681] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "resume",
        "timer": {
          "startedAt": 1749036974680,
          "duration": 29972,
          "isPaused": false
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.683] [32mINFO [0m [GameStateService] {
        "accessCode": "KHMEG9"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.684] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "resume",
        "dashboardRoom": "dashboard_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "liveRoom": "game_KHMEG9",
        "projectionRoom": "projection_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "timer": {
          "startedAt": 1749036974680,
          "duration": 29972,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.687] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "resume",
        "dashboardRoom": "dashboard_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "timer": {
          "startedAt": 1749036974680,
          "duration": 29972,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.690] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "resume",
        "liveRoom": "game_KHMEG9",
        "timer": {
          "startedAt": 1749036974680,
          "duration": 29972,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.692] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "resume",
        "projectionRoom": "projection_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "timer": {
          "startedAt": 1749036974680,
          "duration": 29972,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.693] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "resume"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.713] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
          "action": "stop"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.715] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
        "action": "stop"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.715] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
        "action": "stop"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.728] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "stop",
        "timer": {
          "startedAt": 0,
          "duration": 29972,
          "isPaused": true,
          "timeRemaining": 0
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.730] [32mINFO [0m [GameStateService] {
        "accessCode": "KHMEG9"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.730] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "stop",
        "dashboardRoom": "dashboard_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "liveRoom": "game_KHMEG9",
        "projectionRoom": "projection_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "timer": {
          "startedAt": 0,
          "duration": 29972,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.732] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "stop",
        "dashboardRoom": "dashboard_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "timer": {
          "startedAt": 0,
          "duration": 29972,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.733] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "stop",
        "liveRoom": "game_KHMEG9",
        "timer": {
          "startedAt": 0,
          "duration": 29972,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.733] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "stop",
        "projectionRoom": "projection_e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "timer": {
          "startedAt": 0,
          "duration": 29972,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.734] [32mINFO [0m [TimerActionHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "action": "stop"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.739] [32mINFO [0m [DisconnectHandler] {
        "socketId": "BTYN5uPUwUuxhgP7AAAB",
        "userId": "e465c767-2531-41af-bb2c-324b79eb3225",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.740] [33mWARN [0m [DisconnectHandler] {
        "socketId": "BTYN5uPUwUuxhgP7AAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.742] [32mINFO [0m [DisconnectHandler] {
        "socketId": "WBVfNStBpP0-DWDmAAAD",
        "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
        "accessCode": "KHMEG9",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.750] [32mINFO [0m [DisconnectHandler] {
        "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
        "accessCode": "KHMEG9",
        "socketId": "WBVfNStBpP0-DWDmAAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.751] [32mINFO [0m [DisconnectHandler] {
        "gameId": "e31c50f9-d1a9-4351-8ce3-e690796c7263",
        "socketId": "BTYN5uPUwUuxhgP7AAAB"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:14.757] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "90f4d02d-43a6-4c86-9f9d-c454b2f3e867",
          "socketId": "WBVfNStBpP0-DWDmAAAD"
        },
        "room": "game_KHMEG9"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/gamesApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-04 13:36:16.470] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:16.504] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:16.764] [31mERROR[0m [GameStateService] {
        "gameInstanceId": "game-123"
      } Game instance not found

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG response: 200 application/json; charset=utf-8 {"games":[{"id":"game-1","status":"pending","name":"Game 1"},{"id":"game-2","status":"active","name":"Game 2"}]}

      at Object.<anonymous> (tests/integration/gamesApi.test.ts:370:21)

PASS tests/integration/lobbyHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-04 13:36:17.848] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:17.981] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "sB2LHcFshHl2gu4xAAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:17.981] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "sB2LHcFshHl2gu4xAAAB",
        "user": {
          "id": "player-123",
          "userId": "player-123",
          "username": "Test Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:17.998] [32mINFO [0m [GameHandlers] {
        "socketId": "sB2LHcFshHl2gu4xAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:17.999] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "sB2LHcFshHl2gu4xAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.002] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-123",
        "username": "Test Player",
        "socketId": "sB2LHcFshHl2gu4xAAAB"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.015] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "sB2LHcFshHl2gu4xAAAB"
      } Player leaving lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.028] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "sB2LHcFshHl2gu4xAAAB"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.029] [32mINFO [0m [DisconnectHandler] {
        "socketId": "sB2LHcFshHl2gu4xAAAB",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.029] [33mWARN [0m [DisconnectHandler] {
        "socketId": "sB2LHcFshHl2gu4xAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.052] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "wFmAyyz_9iRyRz-aAAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.053] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "wFmAyyz_9iRyRz-aAAAE",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.054] [32mINFO [0m [GameHandlers] {
        "socketId": "wFmAyyz_9iRyRz-aAAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.054] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "wFmAyyz_9iRyRz-aAAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.058] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "qVCjR-zl8ibhZ74lAAAG"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.058] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "qVCjR-zl8ibhZ74lAAAG",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.058] [32mINFO [0m [GameHandlers] {
        "socketId": "qVCjR-zl8ibhZ74lAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.059] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "qVCjR-zl8ibhZ74lAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.061] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "D5qZAKZbl_IeLUzzAAAH"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.061] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "D5qZAKZbl_IeLUzzAAAH",
        "user": {
          "id": "player-3",
          "userId": "player-3",
          "username": "Player 3",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.061] [32mINFO [0m [GameHandlers] {
        "socketId": "D5qZAKZbl_IeLUzzAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.062] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "D5qZAKZbl_IeLUzzAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.062] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-1",
        "username": "Player 1",
        "socketId": "wFmAyyz_9iRyRz-aAAAE"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.068] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-2",
        "username": "Player 2",
        "socketId": "qVCjR-zl8ibhZ74lAAAG"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.074] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-3",
        "username": "Player 3",
        "socketId": "D5qZAKZbl_IeLUzzAAAH"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.080] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "wFmAyyz_9iRyRz-aAAAE"
      } Player leaving lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.083] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "D5qZAKZbl_IeLUzzAAAH"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.084] [32mINFO [0m [DisconnectHandler] {
        "socketId": "D5qZAKZbl_IeLUzzAAAH",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.085] [33mWARN [0m [DisconnectHandler] {
        "socketId": "D5qZAKZbl_IeLUzzAAAH",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.086] [32mINFO [0m [DisconnectHandler] {
        "socketId": "wFmAyyz_9iRyRz-aAAAE",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.086] [33mWARN [0m [DisconnectHandler] {
        "socketId": "wFmAyyz_9iRyRz-aAAAE",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.087] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "qVCjR-zl8ibhZ74lAAAG"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.088] [32mINFO [0m [DisconnectHandler] {
        "socketId": "qVCjR-zl8ibhZ74lAAAG",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.088] [33mWARN [0m [DisconnectHandler] {
        "socketId": "qVCjR-zl8ibhZ74lAAAG",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.107] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "1CkC3OYFQL3ekeE2AAAJ"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.107] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "1CkC3OYFQL3ekeE2AAAJ",
        "user": {
          "id": "player-redirect-test",
          "userId": "player-redirect-test",
          "username": "Redirect Test",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.108] [32mINFO [0m [GameHandlers] {
        "socketId": "1CkC3OYFQL3ekeE2AAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.108] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "1CkC3OYFQL3ekeE2AAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:18.109] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-redirect-test",
        "username": "Redirect Test",
        "socketId": "1CkC3OYFQL3ekeE2AAAJ"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.120] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "gameId": "e544c490-f92c-44c9-8c3e-3e5922d5f204",
        "socketId": "1CkC3OYFQL3ekeE2AAAJ"
      } Game is now active, sending redirect

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.159] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "1CkC3OYFQL3ekeE2AAAJ"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.160] [32mINFO [0m [DisconnectHandler] {
        "socketId": "1CkC3OYFQL3ekeE2AAAJ",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.161] [33mWARN [0m [DisconnectHandler] {
        "socketId": "1CkC3OYFQL3ekeE2AAAJ",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.173] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "1qDgBO2rC2FDaFUuAAAM"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.174] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "1qDgBO2rC2FDaFUuAAAM",
        "user": {
          "id": "player-d1",
          "userId": "player-d1",
          "username": "Disconnect Test 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.175] [32mINFO [0m [GameHandlers] {
        "socketId": "1qDgBO2rC2FDaFUuAAAM"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.175] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "1qDgBO2rC2FDaFUuAAAM"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.179] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "kjGP69gBlgmKUm_NAAAN"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.179] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "kjGP69gBlgmKUm_NAAAN",
        "user": {
          "id": "player-d2",
          "userId": "player-d2",
          "username": "Disconnect Test 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.179] [32mINFO [0m [GameHandlers] {
        "socketId": "kjGP69gBlgmKUm_NAAAN"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.180] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "kjGP69gBlgmKUm_NAAAN"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.181] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-d1",
        "username": "Disconnect Test 1",
        "socketId": "1qDgBO2rC2FDaFUuAAAM"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.182] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-d2",
        "username": "Disconnect Test 2",
        "socketId": "kjGP69gBlgmKUm_NAAAN"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.220] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "1qDgBO2rC2FDaFUuAAAM"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.220] [32mINFO [0m [DisconnectHandler] {
        "socketId": "1qDgBO2rC2FDaFUuAAAM",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.221] [33mWARN [0m [DisconnectHandler] {
        "socketId": "1qDgBO2rC2FDaFUuAAAM",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.530] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "kjGP69gBlgmKUm_NAAAN"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.531] [32mINFO [0m [DisconnectHandler] {
        "socketId": "kjGP69gBlgmKUm_NAAAN",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:20.531] [33mWARN [0m [DisconnectHandler] {
        "socketId": "kjGP69gBlgmKUm_NAAAN",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/questionApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-04 13:36:22.356] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:22.403] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:22.530] [31mERROR[0m [QuestionsAPI] {
        "error": {}
      } Error updating question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:22.552] [31mERROR[0m [QuestionsAPI] {
        "error": {}
      } Error deleting question

      at log (src/utils/logger.ts:102:21)

PASS tests/unit/questionService.test.ts
PASS tests/unit/quizTemplateService.test.ts
PASS tests/integration/quizTemplateApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.007] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.011] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.013] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.028] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.030] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.042] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.044] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.053] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.053] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.058] [32mINFO [0m [Auth] {
        "authHeader": "Bearer invalid-token"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.059] [31mERROR[0m [Auth] {
        "error": {
          "name": "JsonWebTokenError",
          "message": "jwt malformed"
        }
      } Authentication error

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.076] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.079] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.091] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.092] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.097] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.100] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.108] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.110] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.118] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.119] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.124] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.126] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.134] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.138] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.152] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.155] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.159] [31mERROR[0m [gameTemplatesAPI] {
        "error": {}
      } Error updating quiz template

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.185] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.186] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.192] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.194] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.207] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.210] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.213] [31mERROR[0m [gameTemplatesAPI] {
        "error": {}
      } Error deleting quiz template

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MDM2OTg0LCJleHAiOjE3NDkwNDA1ODR9.Ju7OoK2_pVw_Ye0sVtbLSEoVSQ6H2IbZmpep4kzBk4c

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-04 13:36:25.223] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:25.224] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

PASS tests/unit/gameInstanceService.test.ts
PASS tests/integration/practiceMode.test.ts
  ‚óè Console

    console.log
      [2025-06-04 13:36:26.857] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.066] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "58219d46-04bf-4d33-a2d2-8e540565646c",
        "accessCode": "PRACTICE1"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket query params: {
        token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJwcmFjdGljZS1wbGF5ZXItMSIsInVzZXJuYW1lIjoiUHJhY3RpY2UgUGxheWVyIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDkwMzY5ODcsImV4cCI6MTc0OTA0MDU4N30.Hc26j4tkOADUUpApF4PSkE9cIaRQKCKZ5uHyAeHi-NE',
        role: 'STUDENT'
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:134:17)

    console.log
      [2025-06-04 13:36:27.077] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "diS5_hDMUGjGPzR0AAAB",
        "user": {
          "id": "practice-player-1",
          "userId": "practice-player-1",
          "username": "Practice Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.088] [32mINFO [0m [GameHandlers] {
        "socketId": "diS5_hDMUGjGPzR0AAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.089] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "diS5_hDMUGjGPzR0AAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] connection_established [
        {
          socketId: 'diS5_hDMUGjGPzR0AAAB',
          timestamp: '2025-06-04T11:36:27.077Z',
          user: {
            role: 'STUDENT',
            userId: 'practice-player-1',
            username: 'Practice Player'
          }
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      Socket connected and ready to emit events, ID: diS5_hDMUGjGPzR0AAAB

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:162:17)

    console.log
      Waiting for event: game_joined with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-06-04 13:36:27.116] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.116] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "username": "Practice Player"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.117] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.117] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "username": "Practice Player"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.117] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.117] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.119] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "gameJoinPayload": {
          "gameId": "58219d46-04bf-4d33-a2d2-8e540565646c",
          "accessCode": "PRACTICE1",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.120] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "gameJoinPayload": {
          "gameId": "58219d46-04bf-4d33-a2d2-8e540565646c",
          "accessCode": "PRACTICE1",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          gameId: '58219d46-04bf-4d33-a2d2-8e540565646c',
          accessCode: 'PRACTICE1',
          status: 'pending',
          currentQuestionIndex: -1,
          totalQuestions: 2,
          timer: { startedAt: 0, duration: 0, isPaused: true },
          question: null
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      ‚úÖ Event received: game_joined {
        gameId: '58219d46-04bf-4d33-a2d2-8e540565646c',
        accessCode: 'PRACTICE1',
        status: 'pending',
        currentQuestionIndex: -1,
        totalQuestions: 2,
        timer: { startedAt: 0, duration: 0, isPaused: true },
        question: null
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      [SOCKET EVENT] participant_joined [
        {
          userId: 'practice-player-1',
          username: 'Practice Player',
          playMode: 'practice'
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          gameId: '58219d46-04bf-4d33-a2d2-8e540565646c',
          accessCode: 'PRACTICE1',
          status: 'pending',
          currentQuestionIndex: -1,
          totalQuestions: 2,
          timer: { startedAt: 0, duration: 0, isPaused: true },
          question: null
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [SOCKET EVENT] participant_joined [
        {
          userId: 'practice-player-1',
          username: 'Practice Player',
          playMode: 'practice'
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      Successfully received game_joined event, now starting game...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:171:17)

    console.log
      Emitted start_game again to ensure it gets processed

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:187:17)

    console.log
      [2025-06-04 13:36:27.127] [32mINFO [0m [GameHandlers] {
        "socketId": "diS5_hDMUGjGPzR0AAAB",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1"
        }
      } Start game event received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.127] [32mINFO [0m [GameHandlers] {
        "socketId": "diS5_hDMUGjGPzR0AAAB",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1"
        }
      } Start game event received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.128] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.128] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.130] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "PRACTICE1",
          "participant": {
            "id": "82a908ad-b711-4090-9c6d-567410142c56",
            "userId": "practice-player-1",
            "username": "Practice Player",
            "score": 0,
            "joinedAt": "2025-06-04T11:36:27.113Z",
            "online": true
          },
          "gameStatus": "waiting",
          "isDiffered": true
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          accessCode: 'PRACTICE1',
          participant: {
            id: '82a908ad-b711-4090-9c6d-567410142c56',
            userId: 'practice-player-1',
            username: 'Practice Player',
            score: 0,
            joinedAt: '2025-06-04T11:36:27.113Z',
            online: true
          },
          gameStatus: 'waiting',
          isDiffered: true
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [2025-06-04 13:36:27.138] [32mINFO [0m [GameHandlers] {
        "socketId": "diS5_hDMUGjGPzR0AAAB",
        "questionId": "49f16fc6-6c51-4e5f-89c3-edee18320dcd"
      } Sending first question

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_question [
        {
          uid: '49f16fc6-6c51-4e5f-89c3-edee18320dcd',
          text: 'What is 1+1?',
          answerOptions: [ '1', '2', '3' ],
          correctAnswers: [ false, true, false ],
          timeLimit: 20,
          questionType: 'multiple_choice_single_answer',
          themes: [ 'arithmetic' ],
          difficulty: 1,
          discipline: 'math',
          title: 'Practice Q1',
          currentQuestionIndex: 0,
          totalQuestions: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        uid: '49f16fc6-6c51-4e5f-89c3-edee18320dcd',
        text: 'What is 1+1?',
        answerOptions: [ '1', '2', '3' ],
        correctAnswers: [ false, true, false ],
        timeLimit: 20,
        questionType: 'multiple_choice_single_answer',
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q1',
        currentQuestionIndex: 0,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:156:21)

    console.log
      ‚úÖ Direct handler for game_question event received: {
        uid: '49f16fc6-6c51-4e5f-89c3-edee18320dcd',
        text: 'What is 1+1?',
        answerOptions: [ '1', '2', '3' ],
        correctAnswers: [ false, true, false ],
        timeLimit: 20,
        questionType: 'multiple_choice_single_answer',
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q1',
        currentQuestionIndex: 0,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:180:25)

    console.log
      Promise resolved with game_question data

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:191:17)

    console.log
      Waiting for event: answer_received with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-06-04 13:36:27.142] [32mINFO [0m [GameHandlers] {
        "socketId": "diS5_hDMUGjGPzR0AAAB",
        "questionId": "49f16fc6-6c51-4e5f-89c3-edee18320dcd"
      } Sending first question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.142] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "49f16fc6-6c51-4e5f-89c3-edee18320dcd",
        "answer": 1,
        "timeSpent": 1000,
        "socketId": "diS5_hDMUGjGPzR0AAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: '49f16fc6-6c51-4e5f-89c3-edee18320dcd',
        answer: 1,
        timeSpent: 1000
      } Socket ID: diS5_hDMUGjGPzR0AAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-04 13:36:27.143] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "diS5_hDMUGjGPzR0AAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "49f16fc6-6c51-4e5f-89c3-edee18320dcd",
          "answer": 1,
          "timeSpent": 1000
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: '49f16fc6-6c51-4e5f-89c3-edee18320dcd',
        answer: 1,
        timeSpent: 1000
      } Socket ID: diS5_hDMUGjGPzR0AAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-04 13:36:27.143] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "diS5_hDMUGjGPzR0AAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "49f16fc6-6c51-4e5f-89c3-edee18320dcd",
          "answer": 1,
          "timeSpent": 1000
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.144] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "49f16fc6-6c51-4e5f-89c3-edee18320dcd",
        "answer": 1,
        "timeSpent": 1000,
        "socketId": "diS5_hDMUGjGPzR0AAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_question [
        {
          uid: '49f16fc6-6c51-4e5f-89c3-edee18320dcd',
          text: 'What is 1+1?',
          answerOptions: [ '1', '2', '3' ],
          correctAnswers: [ false, true, false ],
          timeLimit: 20,
          questionType: 'multiple_choice_single_answer',
          themes: [ 'arithmetic' ],
          difficulty: 1,
          discipline: 'math',
          title: 'Practice Q1',
          currentQuestionIndex: 0,
          totalQuestions: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        uid: '49f16fc6-6c51-4e5f-89c3-edee18320dcd',
        text: 'What is 1+1?',
        answerOptions: [ '1', '2', '3' ],
        correctAnswers: [ false, true, false ],
        timeLimit: 20,
        questionType: 'multiple_choice_single_answer',
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q1',
        currentQuestionIndex: 0,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:156:21)

    console.log
      [2025-06-04 13:36:27.148] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.148] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.149] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.149] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: '49f16fc6-6c51-4e5f-89c3-edee18320dcd',
          timeSpent: 1000,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      ‚úÖ Event received: answer_received {
        questionId: '49f16fc6-6c51-4e5f-89c3-edee18320dcd',
        timeSpent: 1000,
        correct: true,
        correctAnswers: [ false, true, false ]
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: '49f16fc6-6c51-4e5f-89c3-edee18320dcd',
          timeSpent: 1000,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      Waiting for event: game_question with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-06-04 13:36:27.180] [32mINFO [0m [RequestNextQuestionHandler] {
        "socketId": "diS5_hDMUGjGPzR0AAAB",
        "event": "request_next_question",
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "currentQuestionId": "49f16fc6-6c51-4e5f-89c3-edee18320dcd"
      } Player requested next question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.195] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "49f16fc6-6c51-4e5f-89c3-edee18320dcd"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:179:25)

    console.log
      [GAME_ANSWER] Adding current questionId 49f16fc6-6c51-4e5f-89c3-edee18320dcd to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:191:29)

    console.log
      [GAME_ANSWER] Found 1/2 answered questions: [ '49f16fc6-6c51-4e5f-89c3-edee18320dcd' ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:198:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:207:25)

    console.log
      [GAME_ANSWER] Not all questions answered yet. Waiting for client to request next question.

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:224:29)

    console.log
      [2025-06-04 13:36:27.196] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "49f16fc6-6c51-4e5f-89c3-edee18320dcd"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:179:25)

    console.log
      [GAME_ANSWER] Adding current questionId 49f16fc6-6c51-4e5f-89c3-edee18320dcd to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:191:29)

    console.log
      [GAME_ANSWER] Found 1/2 answered questions: [ '49f16fc6-6c51-4e5f-89c3-edee18320dcd' ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:198:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:207:25)

    console.log
      [GAME_ANSWER] Not all questions answered yet. Waiting for client to request next question.

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:224:29)

    console.log
      [2025-06-04 13:36:27.205] [32mINFO [0m [RequestNextQuestionHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "nextQuestionId": "8a273bd3-2681-4557-babe-bef413c62d1a"
      } Sending next question

      at log (src/utils/logger.ts:102:21)

    console.log
      [REQUEST_NEXT_QUESTION] About to send question: {
        uid: '8a273bd3-2681-4557-babe-bef413c62d1a',
        text: 'What is 2+2?',
        index: 1
      }

      at Socket.log (src/sockets/handlers/game/requestNextQuestion.ts:84:25)

    console.log
      [SOCKET EVENT] game_question [
        {
          uid: '8a273bd3-2681-4557-babe-bef413c62d1a',
          text: 'What is 2+2?',
          answerOptions: [ '3', '4', '5' ],
          correctAnswers: [ false, true, false ],
          questionType: 'multiple_choice_single_answer',
          timeLimit: 20,
          themes: [ 'arithmetic' ],
          difficulty: 1,
          discipline: 'math',
          title: 'Practice Q2',
          currentQuestionIndex: 1,
          totalQuestions: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        uid: '8a273bd3-2681-4557-babe-bef413c62d1a',
        text: 'What is 2+2?',
        answerOptions: [ '3', '4', '5' ],
        correctAnswers: [ false, true, false ],
        questionType: 'multiple_choice_single_answer',
        timeLimit: 20,
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q2',
        currentQuestionIndex: 1,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:156:21)

    console.log
      ‚úÖ Event received: game_question {
        uid: '8a273bd3-2681-4557-babe-bef413c62d1a',
        text: 'What is 2+2?',
        answerOptions: [ '3', '4', '5' ],
        correctAnswers: [ false, true, false ],
        questionType: 'multiple_choice_single_answer',
        timeLimit: 20,
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q2',
        currentQuestionIndex: 1,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      Answering second question: {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: '8a273bd3-2681-4557-babe-bef413c62d1a',
        answer: 1,
        timeSpent: 1200
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:207:17)

    console.log
      Waiting for event: answer_received with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-06-04 13:36:27.209] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "8a273bd3-2681-4557-babe-bef413c62d1a",
        "answer": 1,
        "timeSpent": 1200,
        "socketId": "diS5_hDMUGjGPzR0AAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: '8a273bd3-2681-4557-babe-bef413c62d1a',
        answer: 1,
        timeSpent: 1200
      } Socket ID: diS5_hDMUGjGPzR0AAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-04 13:36:27.210] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "diS5_hDMUGjGPzR0AAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "8a273bd3-2681-4557-babe-bef413c62d1a",
          "answer": 1,
          "timeSpent": 1200
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: '8a273bd3-2681-4557-babe-bef413c62d1a',
        answer: 1,
        timeSpent: 1200
      } Socket ID: diS5_hDMUGjGPzR0AAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-04 13:36:27.210] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "diS5_hDMUGjGPzR0AAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "8a273bd3-2681-4557-babe-bef413c62d1a",
          "answer": 1,
          "timeSpent": 1200
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.210] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "8a273bd3-2681-4557-babe-bef413c62d1a",
        "answer": 1,
        "timeSpent": 1200,
        "socketId": "diS5_hDMUGjGPzR0AAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.213] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.214] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.214] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.214] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: '8a273bd3-2681-4557-babe-bef413c62d1a',
          timeSpent: 1200,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      ‚úÖ Event received: answer_received {
        questionId: '8a273bd3-2681-4557-babe-bef413c62d1a',
        timeSpent: 1200,
        correct: true,
        correctAnswers: [ false, true, false ]
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      Received feedback for second question: {
        questionId: '8a273bd3-2681-4557-babe-bef413c62d1a',
        timeSpent: 1200,
        correct: true,
        correctAnswers: [ false, true, false ]
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:210:17)

    console.log
      Requesting to proceed after last question...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:221:17)

    console.log
      Waiting for game_ended event after requesting next question...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:225:17)

    console.log
      Waiting for event: game_ended with timeout 15000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-06-04 13:36:27.242] [32mINFO [0m [RequestNextQuestionHandler] {
        "socketId": "diS5_hDMUGjGPzR0AAAB",
        "event": "request_next_question",
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "currentQuestionId": "8a273bd3-2681-4557-babe-bef413c62d1a"
      } Player requested next question

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: '8a273bd3-2681-4557-babe-bef413c62d1a',
          timeSpent: 1200,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [2025-06-04 13:36:27.244] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "8a273bd3-2681-4557-babe-bef413c62d1a"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":1,"timestamp":"2025-06-04T11:36:27.156Z","questionUid":"49f16fc6-6c51-4e5f-89c3-edee18320dcd","timeTakenMs":1000}]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:179:25)

    console.log
      [GAME_ANSWER] Adding current questionId 8a273bd3-2681-4557-babe-bef413c62d1a to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:191:29)

    console.log
      [GAME_ANSWER] Found 2/2 answered questions: [
        '49f16fc6-6c51-4e5f-89c3-edee18320dcd',
        '8a273bd3-2681-4557-babe-bef413c62d1a'
      ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:198:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=2, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:207:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:217:29)

    console.log
      [2025-06-04 13:36:27.244] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "8a273bd3-2681-4557-babe-bef413c62d1a"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.247] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "8a273bd3-2681-4557-babe-bef413c62d1a"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":1,"timestamp":"2025-06-04T11:36:27.156Z","questionUid":"49f16fc6-6c51-4e5f-89c3-edee18320dcd","timeTakenMs":1000}]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:179:25)

    console.log
      [GAME_ANSWER] Adding current questionId 8a273bd3-2681-4557-babe-bef413c62d1a to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:191:29)

    console.log
      [GAME_ANSWER] Found 2/2 answered questions: [
        '49f16fc6-6c51-4e5f-89c3-edee18320dcd',
        '8a273bd3-2681-4557-babe-bef413c62d1a'
      ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:198:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=2, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:207:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:217:29)

    console.log
      [2025-06-04 13:36:27.248] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "8a273bd3-2681-4557-babe-bef413c62d1a"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.274] [32mINFO [0m [RequestNextQuestionHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "correctCount": 2,
        "total": 2
      } Practice mode completed, sending final score

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_ended [
        {
          accessCode: 'PRACTICE1',
          score: 2,
          totalQuestions: 2,
          correct: 2,
          total: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      üëÄ DIRECT LISTENER: game_ended event received: {
        accessCode: 'PRACTICE1',
        score: 2,
        totalQuestions: 2,
        correct: 2,
        total: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:216:21)

    console.log
      ‚úÖ Event received: game_ended {
        accessCode: 'PRACTICE1',
        score: 2,
        totalQuestions: 2,
        correct: 2,
        total: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      ‚úÖ Successfully received game_ended event: {
        accessCode: 'PRACTICE1',
        score: 2,
        totalQuestions: 2,
        correct: 2,
        total: 2
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:227:17)

    console.log
      Test completed successfully, disconnecting socket

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:232:17)

    console.log
      [2025-06-04 13:36:27.279] [32mINFO [0m [DisconnectHandler] {
        "socketId": "diS5_hDMUGjGPzR0AAAB",
        "userId": "practice-player-1",
        "accessCode": "PRACTICE1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.282] [32mINFO [0m [DisconnectHandler] {
        "userId": "practice-player-1",
        "accessCode": "PRACTICE1",
        "socketId": "diS5_hDMUGjGPzR0AAAB"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-04 13:36:27.283] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "practice-player-1",
          "socketId": "diS5_hDMUGjGPzR0AAAB"
        },
        "room": "game_PRACTICE1"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

/home/aflesch/mathquest/app/backend/node_modules/ioredis/built/redis/event_handler.js:189
        self.flushQueue(new Error(utils_1.CONNECTION_CLOSED_ERROR_MSG));
                        ^

Error: Connection is closed.
    at close (/home/aflesch/mathquest/app/backend/node_modules/ioredis/built/redis/event_handler.js:189:25)
    at Socket.<anonymous> (/home/aflesch/mathquest/app/backend/node_modules/ioredis/built/redis/event_handler.js:156:20)
    at Object.onceWrapper (node:events:639:26)
    at Socket.emit (node:events:524:28)
    at TCP.<anonymous> (node:net:350:12)

Node.js v22.12.0
