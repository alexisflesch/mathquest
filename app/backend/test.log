
> backend@1.0.0 test
> jest

Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma

‚úî Generated Prisma Client (v6.7.0) to ./src/db/generated/client in 81ms

Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)

Tip: Easily identify and fix slow SQL queries in your app. Optimize helps you enhance your visibility: https://pris.ly/--optimize

Test setup complete, using port 6605
Database URL: postgresql://postgre:Phuf0pohooFee8auohFahk7vChae4Iv0wiem5voT@localhost:5432/mathquest_test
Redis URL: redis://localhost:6379
Cleaning test database...
Database cleaned successfully
Inserted default test questions.
Seeded integration teacher, template, questions, and game instance.
FAIL tests/integration/tournament2.test.ts (53.633 s)
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:83:13)

    console.log
      [2025-06-14 17:05:18.434] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:18.459] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:18.638] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "gameTemplateId": "fc89ff6d-1215-4a1f-aeb3-9aeba9721dd2",
          "playMode": "tournament",
          "discipline": "math",
          "nbOfQuestions": 1
        },
        "keys": [
          "name",
          "gameTemplateId",
          "playMode",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
          "username": "p1-extended",
          "role": "STUDENT",
          "iat": 1749913518,
          "exp": 1749917118
        },
        "headers": {
          "host": "localhost:33663",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJiODhhNmQxZC0yMjQ3LTQ1MGUtYWU0NC0yZmRjZDUzNTg1M2MiLCJ1c2VybmFtZSI6InAxLWV4dGVuZGVkIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk5MTM1MTgsImV4cCI6MTc0OTkxNzExOH0.TuFZAlpG2GQZtyIsjaDXPRz6IX4uZiz_22Y3M_eKPug",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:18.645] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "fc89ff6d-1215-4a1f-aeb3-9aeba9721dd2",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:18.665] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "ff2a63e2-77ca-4c53-9035-b9b9218b9bf8",
        "accessCode": "3141"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:18.812] [32mINFO [0m [GameParticipantService] {
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "accessCode": "3141",
        "participantId": "7fee5530-d505-46b1-81bb-37cba236f252"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:18.829] [32mINFO [0m [GameParticipantService] {
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "accessCode": "3141",
        "participantId": "80e45a15-a27d-413f-9790-865a978d9b55"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: '7JYeFv2lYg8apDaoAAAC',
        finalUserId: 'b88a6d1d-2247-450e-ae44-2fdcd535853c',
        setUserId: 'b88a6d1d-2247-450e-ae44-2fdcd535853c',
        setUserData: {
          userId: 'b88a6d1d-2247-450e-ae44-2fdcd535853c',
          username: 'p1-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-14 17:05:18.861] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "7JYeFv2lYg8apDaoAAAC",
        "user": {
          "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.255] [32mINFO [0m [GameHandlers] {
        "socketId": "7JYeFv2lYg8apDaoAAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.258] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "7JYeFv2lYg8apDaoAAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.261] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "7JYeFv2lYg8apDaoAAAC"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 7JYeFv2lYg8apDaoAAAC

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:05:19.263] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "7JYeFv2lYg8apDaoAAAC"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.263] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.264] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.264] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.265] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.265] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.265] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.266] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.266] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.266] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "7JYeFv2lYg8apDaoAAAC"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'Mb9fxdG0NjHPFVj8AAAD',
        finalUserId: '751db1a3-dd29-42b1-a0a0-fa15db974285',
        setUserId: '751db1a3-dd29-42b1-a0a0-fa15db974285',
        setUserData: {
          userId: '751db1a3-dd29-42b1-a0a0-fa15db974285',
          username: 'p2-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-14 17:05:19.269] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "Mb9fxdG0NjHPFVj8AAAD",
        "user": {
          "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.270] [32mINFO [0m [GameHandlers] {
        "socketId": "Mb9fxdG0NjHPFVj8AAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.270] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "Mb9fxdG0NjHPFVj8AAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.270] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "Mb9fxdG0NjHPFVj8AAAD"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: Mb9fxdG0NjHPFVj8AAAD

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:05:19.271] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "Mb9fxdG0NjHPFVj8AAAD"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.271] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.271] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.272] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.272] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.272] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.272] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.272] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.272] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.272] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "Mb9fxdG0NjHPFVj8AAAD"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.274] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3141",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.277] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3141",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.278] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3141",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.278] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3141",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.278] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3141",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.279] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3141",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.279] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3141",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.279] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3141",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.282] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3141",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3141",
          "participant": {
            "id": "7JYeFv2lYg8apDaoAAAC",
            "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
            "username": "p1-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "7JYeFv2lYg8apDaoAAAC",
            "online": true,
            "joinedAt": "2025-06-14T15:05:19.281Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.285] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3141",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3141",
          "participant": {
            "id": "7JYeFv2lYg8apDaoAAAC",
            "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
            "username": "p1-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "7JYeFv2lYg8apDaoAAAC",
            "online": true,
            "joinedAt": "2025-06-14T15:05:19.285Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.287] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3141",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3141",
          "participant": {
            "id": "Mb9fxdG0NjHPFVj8AAAD",
            "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
            "username": "p2-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "Mb9fxdG0NjHPFVj8AAAD",
            "online": true,
            "joinedAt": "2025-06-14T15:05:19.287Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.288] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3141",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3141",
          "participant": {
            "id": "Mb9fxdG0NjHPFVj8AAAD",
            "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
            "username": "p2-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "Mb9fxdG0NjHPFVj8AAAD",
            "online": true,
            "joinedAt": "2025-06-14T15:05:19.288Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.294] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.294] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.294] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.294] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.326] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "ff2a63e2-77ca-4c53-9035-b9b9218b9bf8",
        "templateId": "fc89ff6d-1215-4a1f-aeb3-9aeba9721dd2",
        "initiator": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "3141",
        "socketId": "7JYeFv2lYg8apDaoAAAC"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.531] [32mINFO [0m [GameStateService] {
        "accessCode": "3141"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:19.543] [32mINFO [0m [TournamentHandler] {
        "room": "game_3141",
        "duration": 5,
        "accessCode": "3141",
        "socketId": "7JYeFv2lYg8apDaoAAAC"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.551] [32mINFO [0m [GameStateService] {
        "accessCode": "3141"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.561] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.564] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.564] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.565] [32mINFO [0m [GameStateService] {
        "accessCode": "3141"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.566] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "room": "game_3141",
        "socketIds": [
          "7JYeFv2lYg8apDaoAAAC",
          "Mb9fxdG0NjHPFVj8AAAD"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.566] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.566] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3141",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "questionType": "single_correct",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "arithmetic"
            ]
          },
          "index": 0,
          "feedbackWaitTime": 2,
          "timer": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.566] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.567] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3141",
        "event": "game_timer_updated",
        "payload": {
          "questionUid": "q-late-1",
          "timer": {
            "status": "play",
            "timeLeftMs": 2000,
            "durationMs": 2000,
            "questionUid": "q-late-1",
            "timestamp": 1749913524564,
            "localTimeLeftMs": null
          }
        }
      } [DEBUG] Emitting game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.567] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "event": "game_timer_updated",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.569] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "7JYeFv2lYg8apDaoAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.569] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "7JYeFv2lYg8apDaoAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.569] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "7JYeFv2lYg8apDaoAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.569] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "7JYeFv2lYg8apDaoAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.569] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "Mb9fxdG0NjHPFVj8AAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.570] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "Mb9fxdG0NjHPFVj8AAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.570] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "Mb9fxdG0NjHPFVj8AAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.570] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "Mb9fxdG0NjHPFVj8AAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.571] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1"
      } Participant already answered this question. Updating answer.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.576] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.577] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.578] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:24.584] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.567] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3141",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.567] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "event": "correct_answers",
        "questionUid": "q-late-1",
        "correctAnswers": [
          false,
          false,
          false,
          true
        ]
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.567] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.572] [32mINFO [0m [GameStateService] {
        "accessCode": "3141",
        "questionUid": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.572] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.575] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "ea5ae838-e6f4-4f6a-9d26-f99206fada08"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.575] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "6aa06e66-42c9-4ab0-9aa2-1b17a2c91f2c"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.575] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "51956183-d5a2-4640-8b19-e93970d76f71"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.576] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.576] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "d5dbf81c-3848-4ed7-89bc-91e3e3d4ed50"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.576] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "c45e2394-7c21-4ad7-bbbb-164438bfc897"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.576] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.576] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "2c962360-ae7b-4827-8ab1-8c6c453d6119"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.578] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "ea5ae838-e6f4-4f6a-9d26-f99206fada08"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 0)

    console.log
      [2025-06-14 17:05:26.579] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "6aa06e66-42c9-4ab0-9aa2-1b17a2c91f2c"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 2)

    console.log
      [2025-06-14 17:05:26.579] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "51956183-d5a2-4640-8b19-e93970d76f71"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 3)

    console.log
      [2025-06-14 17:05:26.579] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 4)

    console.log
      [2025-06-14 17:05:26.579] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "d5dbf81c-3848-4ed7-89bc-91e3e3d4ed50"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 5)

    console.log
      [2025-06-14 17:05:26.579] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "c45e2394-7c21-4ad7-bbbb-164438bfc897"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 6)

    console.log
      [2025-06-14 17:05:26.579] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 7)

    console.log
      [2025-06-14 17:05:26.579] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "2c962360-ae7b-4827-8ab1-8c6c453d6119"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 9)

    console.log
      [2025-06-14 17:05:26.585] [32mINFO [0m [GameStateService] {
        "accessCode": "3141",
        "count": 10
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: {
        "leaderboard": [
          {
            "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
            "username": "p1-extended",
            "score": 980,
            "rank": 1
          },
          {
            "userId": "ea5ae838-e6f4-4f6a-9d26-f99206fada08",
            "username": "Unknown Player",
            "score": 980,
            "rank": 2
          },
          {
            "userId": "6aa06e66-42c9-4ab0-9aa2-1b17a2c91f2c",
            "username": "Unknown Player",
            "score": 980,
            "rank": 3
          },
          {
            "userId": "51956183-d5a2-4640-8b19-e93970d76f71",
            "username": "Unknown Player",
            "score": 980,
            "rank": 4
          },
          {
            "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
            "username": "Unknown Player",
            "score": 980,
            "rank": 5
          },
          {
            "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
            "username": "p2-extended",
            "score": 0,
            "rank": 6
          },
          {
            "userId": "d5dbf81c-3848-4ed7-89bc-91e3e3d4ed50",
            "username": "Unknown Player",
            "score": 0,
            "rank": 7
          },
          {
            "userId": "c45e2394-7c21-4ad7-bbbb-164438bfc897",
            "username": "Unknown Player",
            "score": 0,
            "rank": 8
          },
          {
            "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
            "username": "Unknown Player",
            "score": 0,
            "rank": 9
          },
          {
            "userId": "2c962360-ae7b-4827-8ab1-8c6c453d6119",
            "username": "Unknown Player",
            "score": 0,
            "rank": 10
          }
        ]
      }

      at Object.<anonymous> (tests/integration/tournament2.test.ts:327:17)

    console.log
      [2025-06-14 17:05:26.596] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "gameTemplateId": "d138da71-1bbb-4d9b-9ff5-4257113136e0",
          "playMode": "tournament",
          "discipline": "math",
          "nbOfQuestions": 1
        },
        "keys": [
          "name",
          "gameTemplateId",
          "playMode",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
          "username": "p1-extended",
          "role": "STUDENT",
          "iat": 1749913518,
          "exp": 1749917118
        },
        "headers": {
          "host": "localhost:33663",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJiODhhNmQxZC0yMjQ3LTQ1MGUtYWU0NC0yZmRjZDUzNTg1M2MiLCJ1c2VybmFtZSI6InAxLWV4dGVuZGVkIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk5MTM1MTgsImV4cCI6MTc0OTkxNzExOH0.TuFZAlpG2GQZtyIsjaDXPRz6IX4uZiz_22Y3M_eKPug",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.596] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "d138da71-1bbb-4d9b-9ff5-4257113136e0",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.605] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "bdd1751f-317c-4481-b543-6be5d6b29fec",
        "accessCode": "3142"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.720] [32mINFO [0m [GameParticipantService] {
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "accessCode": "3142",
        "participantId": "6080b8fa-4268-43a7-9cca-ca352c70e143"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.731] [32mINFO [0m [GameParticipantService] {
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "accessCode": "3142",
        "participantId": "7a87f0ab-52d9-4f00-8eb2-f4f09c2ae3dc"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'mSGEmlCfg-HTIt3YAAAG',
        finalUserId: 'b88a6d1d-2247-450e-ae44-2fdcd535853c',
        setUserId: 'b88a6d1d-2247-450e-ae44-2fdcd535853c',
        setUserData: {
          userId: 'b88a6d1d-2247-450e-ae44-2fdcd535853c',
          username: 'p1-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-14 17:05:26.741] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "mSGEmlCfg-HTIt3YAAAG",
        "user": {
          "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.741] [32mINFO [0m [GameHandlers] {
        "socketId": "mSGEmlCfg-HTIt3YAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.742] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "mSGEmlCfg-HTIt3YAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.742] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "mSGEmlCfg-HTIt3YAAAG"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: mSGEmlCfg-HTIt3YAAAG

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:05:26.742] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "mSGEmlCfg-HTIt3YAAAG"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.742] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.742] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.743] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.743] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.743] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.744] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.744] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.744] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.744] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "mSGEmlCfg-HTIt3YAAAG"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'd0ixmg3qG6X-z041AAAH',
        finalUserId: '751db1a3-dd29-42b1-a0a0-fa15db974285',
        setUserId: '751db1a3-dd29-42b1-a0a0-fa15db974285',
        setUserData: {
          userId: '751db1a3-dd29-42b1-a0a0-fa15db974285',
          username: 'p2-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-14 17:05:26.746] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "d0ixmg3qG6X-z041AAAH",
        "user": {
          "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.747] [32mINFO [0m [GameHandlers] {
        "socketId": "d0ixmg3qG6X-z041AAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.747] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "d0ixmg3qG6X-z041AAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.747] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "d0ixmg3qG6X-z041AAAH"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: d0ixmg3qG6X-z041AAAH

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:05:26.747] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "d0ixmg3qG6X-z041AAAH"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.747] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.747] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.747] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.747] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.747] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.748] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.748] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.748] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.748] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "d0ixmg3qG6X-z041AAAH"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.749] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3142",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.749] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3142",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.749] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3142",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.749] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3142",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.749] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3142",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.749] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3142",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.749] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3142",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.750] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3142",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.750] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3142",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3142",
          "participant": {
            "id": "mSGEmlCfg-HTIt3YAAAG",
            "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
            "username": "p1-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "mSGEmlCfg-HTIt3YAAAG",
            "online": true,
            "joinedAt": "2025-06-14T15:05:26.750Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.751] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3142",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3142",
          "participant": {
            "id": "mSGEmlCfg-HTIt3YAAAG",
            "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
            "username": "p1-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "mSGEmlCfg-HTIt3YAAAG",
            "online": true,
            "joinedAt": "2025-06-14T15:05:26.751Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.751] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3142",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3142",
          "participant": {
            "id": "d0ixmg3qG6X-z041AAAH",
            "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
            "username": "p2-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "d0ixmg3qG6X-z041AAAH",
            "online": true,
            "joinedAt": "2025-06-14T15:05:26.751Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.751] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3142",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3142",
          "participant": {
            "id": "d0ixmg3qG6X-z041AAAH",
            "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
            "username": "p2-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "d0ixmg3qG6X-z041AAAH",
            "online": true,
            "joinedAt": "2025-06-14T15:05:26.751Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.753] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.753] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.753] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.753] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.764] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "bdd1751f-317c-4481-b543-6be5d6b29fec",
        "templateId": "d138da71-1bbb-4d9b-9ff5-4257113136e0",
        "initiator": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "3142",
        "socketId": "mSGEmlCfg-HTIt3YAAAG"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.966] [32mINFO [0m [GameStateService] {
        "accessCode": "3142"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:26.971] [32mINFO [0m [TournamentHandler] {
        "room": "game_3142",
        "duration": 5,
        "accessCode": "3142",
        "socketId": "mSGEmlCfg-HTIt3YAAAG"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:28.072] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3141",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:28.072] [32mINFO [0m [SharedGameFlow] === BACKEND FEEDBACK PAYLOAD DEBUG === {
        "accessCode": "3141",
        "questionIndex": 0,
        "questionUid": "q-late-1",
        "questionExplanation": null,
        "explanationLength": 0,
        "explanationExists": false,
        "fullPayload": "{\"questionUid\":\"q-late-1\",\"feedbackRemaining\":2}"
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:28.073] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2,
        "hasExplanation": false
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:30.073] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3141",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:30.073] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:30.073] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141"
      } [SharedGameFlow] Game flow completed and cleaned up

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.978] [32mINFO [0m [GameStateService] {
        "accessCode": "3142"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.984] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.984] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.984] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.986] [32mINFO [0m [GameStateService] {
        "accessCode": "3142"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.986] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "room": "game_3142",
        "socketIds": [
          "mSGEmlCfg-HTIt3YAAAG",
          "d0ixmg3qG6X-z041AAAH"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.986] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.986] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3142",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "questionType": "single_correct",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "arithmetic"
            ]
          },
          "index": 0,
          "feedbackWaitTime": 2,
          "timer": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.986] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.986] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3142",
        "event": "game_timer_updated",
        "payload": {
          "questionUid": "q-late-1",
          "timer": {
            "status": "play",
            "timeLeftMs": 2000,
            "durationMs": 2000,
            "questionUid": "q-late-1",
            "timestamp": 1749913531985,
            "localTimeLeftMs": null
          }
        }
      } [DEBUG] Emitting game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.986] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "event": "game_timer_updated",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.988] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "mSGEmlCfg-HTIt3YAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.988] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "mSGEmlCfg-HTIt3YAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.988] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "mSGEmlCfg-HTIt3YAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.988] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "mSGEmlCfg-HTIt3YAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.988] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "d0ixmg3qG6X-z041AAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.988] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "d0ixmg3qG6X-z041AAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.989] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "d0ixmg3qG6X-z041AAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.989] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "d0ixmg3qG6X-z041AAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.992] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.993] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:31.993] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:32.002] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:33.987] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3142",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:33.987] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "event": "correct_answers",
        "questionUid": "q-late-1",
        "correctAnswers": [
          false,
          false,
          false,
          true
        ]
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:33.987] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:33.992] [32mINFO [0m [GameStateService] {
        "accessCode": "3142",
        "questionUid": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:33.992] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:33.998] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "ea5ae838-e6f4-4f6a-9d26-f99206fada08"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:33.999] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "6aa06e66-42c9-4ab0-9aa2-1b17a2c91f2c"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:33.999] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "51956183-d5a2-4640-8b19-e93970d76f71"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.000] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.000] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "d5dbf81c-3848-4ed7-89bc-91e3e3d4ed50"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.000] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "c45e2394-7c21-4ad7-bbbb-164438bfc897"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.000] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.000] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "2c962360-ae7b-4827-8ab1-8c6c453d6119"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.008] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "ea5ae838-e6f4-4f6a-9d26-f99206fada08"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 0)

    console.log
      [2025-06-14 17:05:34.009] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "6aa06e66-42c9-4ab0-9aa2-1b17a2c91f2c"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 2)

    console.log
      [2025-06-14 17:05:34.009] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "51956183-d5a2-4640-8b19-e93970d76f71"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 3)

    console.log
      [2025-06-14 17:05:34.010] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 4)

    console.log
      [2025-06-14 17:05:34.010] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "d5dbf81c-3848-4ed7-89bc-91e3e3d4ed50"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 5)

    console.log
      [2025-06-14 17:05:34.010] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "c45e2394-7c21-4ad7-bbbb-164438bfc897"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 6)

    console.log
      [2025-06-14 17:05:34.010] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 7)

    console.log
      [2025-06-14 17:05:34.010] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "2c962360-ae7b-4827-8ab1-8c6c453d6119"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 9)

    console.log
      [2025-06-14 17:05:34.010] [32mINFO [0m [GameStateService] {
        "accessCode": "3142",
        "count": 10
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: {
        "leaderboard": [
          {
            "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
            "username": "p1-extended",
            "score": 980,
            "rank": 1
          },
          {
            "userId": "ea5ae838-e6f4-4f6a-9d26-f99206fada08",
            "username": "Unknown Player",
            "score": 980,
            "rank": 2
          },
          {
            "userId": "6aa06e66-42c9-4ab0-9aa2-1b17a2c91f2c",
            "username": "Unknown Player",
            "score": 980,
            "rank": 3
          },
          {
            "userId": "51956183-d5a2-4640-8b19-e93970d76f71",
            "username": "Unknown Player",
            "score": 980,
            "rank": 4
          },
          {
            "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
            "username": "Unknown Player",
            "score": 980,
            "rank": 5
          },
          {
            "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
            "username": "p2-extended",
            "score": 0,
            "rank": 6
          },
          {
            "userId": "d5dbf81c-3848-4ed7-89bc-91e3e3d4ed50",
            "username": "Unknown Player",
            "score": 0,
            "rank": 7
          },
          {
            "userId": "c45e2394-7c21-4ad7-bbbb-164438bfc897",
            "username": "Unknown Player",
            "score": 0,
            "rank": 8
          },
          {
            "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
            "username": "Unknown Player",
            "score": 0,
            "rank": 9
          },
          {
            "userId": "2c962360-ae7b-4827-8ab1-8c6c453d6119",
            "username": "Unknown Player",
            "score": 0,
            "rank": 10
          }
        ]
      }

      at Object.<anonymous> (tests/integration/tournament2.test.ts:442:17)

    console.log
      [2025-06-14 17:05:34.027] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "gameTemplateId": "9f5cd46d-691e-4f29-89b6-d2f9bd43c78b",
          "playMode": "tournament",
          "discipline": "math",
          "nbOfQuestions": 2
        },
        "keys": [
          "name",
          "gameTemplateId",
          "playMode",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
          "username": "p1-extended",
          "role": "STUDENT",
          "iat": 1749913518,
          "exp": 1749917118
        },
        "headers": {
          "host": "localhost:33663",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJiODhhNmQxZC0yMjQ3LTQ1MGUtYWU0NC0yZmRjZDUzNTg1M2MiLCJ1c2VybmFtZSI6InAxLWV4dGVuZGVkIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk5MTM1MTgsImV4cCI6MTc0OTkxNzExOH0.TuFZAlpG2GQZtyIsjaDXPRz6IX4uZiz_22Y3M_eKPug",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.027] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "9f5cd46d-691e-4f29-89b6-d2f9bd43c78b",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.037] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "904acb24-3471-4a15-b57e-7dcdb17f868d",
        "accessCode": "3143"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.152] [32mINFO [0m [GameParticipantService] {
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "accessCode": "3143",
        "participantId": "55ff3a9e-d9d6-4a81-a968-2dd1f8c6dfcb"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.163] [32mINFO [0m [GameParticipantService] {
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "accessCode": "3143",
        "participantId": "2cbef164-b738-4b0c-912e-2c48765b46ce"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'pkppygbLTkCwo3mxAAAK',
        finalUserId: 'b88a6d1d-2247-450e-ae44-2fdcd535853c',
        setUserId: 'b88a6d1d-2247-450e-ae44-2fdcd535853c',
        setUserData: {
          userId: 'b88a6d1d-2247-450e-ae44-2fdcd535853c',
          username: 'p1-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-14 17:05:34.167] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "pkppygbLTkCwo3mxAAAK",
        "user": {
          "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.168] [32mINFO [0m [GameHandlers] {
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.168] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.168] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: pkppygbLTkCwo3mxAAAK

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:05:34.169] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.169] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.169] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.169] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.169] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.169] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.169] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.169] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.169] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.169] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'ParMgZ0fOww2tXSaAAAL',
        finalUserId: '751db1a3-dd29-42b1-a0a0-fa15db974285',
        setUserId: '751db1a3-dd29-42b1-a0a0-fa15db974285',
        setUserData: {
          userId: '751db1a3-dd29-42b1-a0a0-fa15db974285',
          username: 'p2-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-14 17:05:34.171] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "ParMgZ0fOww2tXSaAAAL",
        "user": {
          "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.172] [32mINFO [0m [GameHandlers] {
        "socketId": "ParMgZ0fOww2tXSaAAAL"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.172] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "ParMgZ0fOww2tXSaAAAL"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.172] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ParMgZ0fOww2tXSaAAAL"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: ParMgZ0fOww2tXSaAAAL

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:05:34.172] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "ParMgZ0fOww2tXSaAAAL"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.173] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.173] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.173] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.173] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.173] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.173] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.173] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.173] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.173] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ParMgZ0fOww2tXSaAAAL"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.174] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3143",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.174] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3143",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.174] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3143",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.175] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3143",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.175] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3143",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.175] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3143",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.175] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3143",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.175] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3143",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.176] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3143",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3143",
          "participant": {
            "id": "pkppygbLTkCwo3mxAAAK",
            "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
            "username": "p1-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "pkppygbLTkCwo3mxAAAK",
            "online": true,
            "joinedAt": "2025-06-14T15:05:34.176Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.176] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3143",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3143",
          "participant": {
            "id": "pkppygbLTkCwo3mxAAAK",
            "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
            "username": "p1-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "pkppygbLTkCwo3mxAAAK",
            "online": true,
            "joinedAt": "2025-06-14T15:05:34.176Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.177] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3143",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3143",
          "participant": {
            "id": "ParMgZ0fOww2tXSaAAAL",
            "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
            "username": "p2-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "ParMgZ0fOww2tXSaAAAL",
            "online": true,
            "joinedAt": "2025-06-14T15:05:34.177Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.177] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3143",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3143",
          "participant": {
            "id": "ParMgZ0fOww2tXSaAAAL",
            "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
            "username": "p2-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "ParMgZ0fOww2tXSaAAAL",
            "online": true,
            "joinedAt": "2025-06-14T15:05:34.177Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.179] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.180] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.180] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.180] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.194] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "904acb24-3471-4a15-b57e-7dcdb17f868d",
        "templateId": "9f5cd46d-691e-4f29-89b6-d2f9bd43c78b",
        "initiator": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 2,
        "nbParticipants": 2,
        "accessCode": "3143",
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.396] [32mINFO [0m [GameStateService] {
        "accessCode": "3143"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:34.405] [32mINFO [0m [TournamentHandler] {
        "room": "game_3143",
        "duration": 5,
        "accessCode": "3143",
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:35.492] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3142",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:35.493] [32mINFO [0m [SharedGameFlow] === BACKEND FEEDBACK PAYLOAD DEBUG === {
        "accessCode": "3142",
        "questionIndex": 0,
        "questionUid": "q-late-1",
        "questionExplanation": null,
        "explanationLength": 0,
        "explanationExists": false,
        "fullPayload": "{\"questionUid\":\"q-late-1\",\"feedbackRemaining\":2}"
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:35.493] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2,
        "hasExplanation": false
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:37.494] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3142",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:37.495] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:37.495] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142"
      } [SharedGameFlow] Game flow completed and cleaned up

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.415] [32mINFO [0m [GameStateService] {
        "accessCode": "3143"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.431] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.431] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "playMode": "tournament",
        "questionCount": 2
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.431] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.433] [32mINFO [0m [GameStateService] {
        "accessCode": "3143"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.433] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "room": "game_3143",
        "socketIds": [
          "pkppygbLTkCwo3mxAAAK",
          "ParMgZ0fOww2tXSaAAAL"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.433] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.433] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "questionType": "single_correct",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "arithmetic"
            ]
          },
          "index": 0,
          "feedbackWaitTime": 2,
          "timer": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.433] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.433] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "game_timer_updated",
        "payload": {
          "questionUid": "q-late-1",
          "timer": {
            "status": "play",
            "timeLeftMs": 2000,
            "durationMs": 2000,
            "questionUid": "q-late-1",
            "timestamp": 1749913539431,
            "localTimeLeftMs": null
          }
        }
      } [DEBUG] Emitting game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.434] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "game_timer_updated",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.434] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.435] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.435] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.435] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.435] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "ParMgZ0fOww2tXSaAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.435] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "ParMgZ0fOww2tXSaAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.436] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "ParMgZ0fOww2tXSaAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.436] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "ParMgZ0fOww2tXSaAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.440] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.441] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.441] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:39.441] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:41.435] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:41.435] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "correct_answers",
        "questionUid": "q-late-1",
        "correctAnswers": [
          false,
          false,
          false,
          true
        ]
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:41.435] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:41.438] [32mINFO [0m [GameStateService] {
        "accessCode": "3143",
        "questionUid": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:41.438] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:42.944] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:42.945] [32mINFO [0m [SharedGameFlow] === BACKEND FEEDBACK PAYLOAD DEBUG === {
        "accessCode": "3143",
        "questionIndex": 0,
        "questionUid": "q-late-1",
        "questionExplanation": null,
        "explanationLength": 0,
        "explanationExists": false,
        "fullPayload": "{\"questionUid\":\"q-late-1\",\"feedbackRemaining\":2}"
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:42.946] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2,
        "hasExplanation": false
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.949] [32mINFO [0m [GameStateService] {
        "accessCode": "3143"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.949] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "questionIndex": 1,
        "questionUid": "q-late-2"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.950] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-2",
            "questionType": "single_correct",
            "text": "What is 7 x 3?",
            "answerOptions": [
              "20",
              "21",
              "24",
              "27"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              true,
              false,
              false
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "multiplication"
            ]
          },
          "index": 1,
          "feedbackWaitTime": 1.5,
          "timer": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.950] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "game_question",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.950] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "game_timer_updated",
        "payload": {
          "questionUid": "q-late-2",
          "timer": {
            "status": "play",
            "timeLeftMs": 2000,
            "durationMs": 2000,
            "questionUid": "q-late-2",
            "timestamp": 1749913544947,
            "localTimeLeftMs": null
          }
        }
      } [DEBUG] Emitting game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.954] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "game_timer_updated",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.958] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.958] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.958] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.959] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.959] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "ParMgZ0fOww2tXSaAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.959] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "ParMgZ0fOww2tXSaAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.960] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "ParMgZ0fOww2tXSaAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.960] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "ParMgZ0fOww2tXSaAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.968] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.968] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.974] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:44.974] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:46.955] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "correct_answers",
        "questionUid": "q-late-2"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:46.956] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "correct_answers",
        "questionUid": "q-late-2",
        "correctAnswers": [
          false,
          true,
          false,
          false
        ]
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:46.956] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "questionUid": "q-late-2"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:46.959] [32mINFO [0m [GameStateService] {
        "accessCode": "3143",
        "questionUid": "q-late-2"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:46.960] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "questionUid": "q-late-2"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:46.969] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "gameTemplateId": "500aa127-b563-40d9-bceb-c6f32b82bfa7",
          "playMode": "tournament",
          "discipline": "math",
          "nbOfQuestions": 2
        },
        "keys": [
          "name",
          "gameTemplateId",
          "playMode",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
          "username": "p1-extended",
          "role": "STUDENT",
          "iat": 1749913518,
          "exp": 1749917118
        },
        "headers": {
          "host": "localhost:33663",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJiODhhNmQxZC0yMjQ3LTQ1MGUtYWU0NC0yZmRjZDUzNTg1M2MiLCJ1c2VybmFtZSI6InAxLWV4dGVuZGVkIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk5MTM1MTgsImV4cCI6MTc0OTkxNzExOH0.TuFZAlpG2GQZtyIsjaDXPRz6IX4uZiz_22Y3M_eKPug",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:46.973] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "500aa127-b563-40d9-bceb-c6f32b82bfa7",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:46.983] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "563b430d-1e7d-49a1-a185-1b75534277df",
        "accessCode": "3144"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.098] [32mINFO [0m [GameParticipantService] {
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "accessCode": "3144",
        "participantId": "1a529ebc-70fb-478a-a741-974a4c3aefe0"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.114] [32mINFO [0m [GameParticipantService] {
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "accessCode": "3144",
        "participantId": "2ee84538-1e4b-45bf-9104-353947d3f929"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'A67pFpW7mFp1q-gpAAAO',
        finalUserId: 'b88a6d1d-2247-450e-ae44-2fdcd535853c',
        setUserId: 'b88a6d1d-2247-450e-ae44-2fdcd535853c',
        setUserData: {
          userId: 'b88a6d1d-2247-450e-ae44-2fdcd535853c',
          username: 'p1-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-14 17:05:47.120] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "A67pFpW7mFp1q-gpAAAO",
        "user": {
          "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.120] [32mINFO [0m [GameHandlers] {
        "socketId": "A67pFpW7mFp1q-gpAAAO"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.120] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "A67pFpW7mFp1q-gpAAAO"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.121] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "A67pFpW7mFp1q-gpAAAO"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: A67pFpW7mFp1q-gpAAAO

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:05:47.121] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "A67pFpW7mFp1q-gpAAAO"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.122] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.122] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.122] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.125] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.125] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.126] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.126] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.126] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.126] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "A67pFpW7mFp1q-gpAAAO"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'kBE8dwSX0ZyJ4C5eAAAP',
        finalUserId: '751db1a3-dd29-42b1-a0a0-fa15db974285',
        setUserId: '751db1a3-dd29-42b1-a0a0-fa15db974285',
        setUserData: {
          userId: '751db1a3-dd29-42b1-a0a0-fa15db974285',
          username: 'p2-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-14 17:05:47.128] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "kBE8dwSX0ZyJ4C5eAAAP",
        "user": {
          "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.128] [32mINFO [0m [GameHandlers] {
        "socketId": "kBE8dwSX0ZyJ4C5eAAAP"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.129] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "kBE8dwSX0ZyJ4C5eAAAP"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.129] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "kBE8dwSX0ZyJ4C5eAAAP"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: kBE8dwSX0ZyJ4C5eAAAP

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:05:47.129] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "kBE8dwSX0ZyJ4C5eAAAP"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.130] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.130] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.131] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.132] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.132] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.133] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.133] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.134] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.135] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "kBE8dwSX0ZyJ4C5eAAAP"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.136] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3144",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.137] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3144",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.137] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3144",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.137] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3144",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.138] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3144",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.138] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3144",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.138] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3144",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.138] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3144",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.142] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3144",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3144",
          "participant": {
            "id": "A67pFpW7mFp1q-gpAAAO",
            "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
            "username": "p1-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "A67pFpW7mFp1q-gpAAAO",
            "online": true,
            "joinedAt": "2025-06-14T15:05:47.142Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.143] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "room": "game_3144",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3144",
          "participant": {
            "id": "A67pFpW7mFp1q-gpAAAO",
            "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
            "username": "p1-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "A67pFpW7mFp1q-gpAAAO",
            "online": true,
            "joinedAt": "2025-06-14T15:05:47.143Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.143] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3144",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3144",
          "participant": {
            "id": "kBE8dwSX0ZyJ4C5eAAAP",
            "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
            "username": "p2-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "kBE8dwSX0ZyJ4C5eAAAP",
            "online": true,
            "joinedAt": "2025-06-14T15:05:47.143Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.144] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "room": "game_3144",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3144",
          "participant": {
            "id": "kBE8dwSX0ZyJ4C5eAAAP",
            "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
            "username": "p2-extended",
            "avatar": "üë§",
            "score": 0,
            "socketId": "kBE8dwSX0ZyJ4C5eAAAP",
            "online": true,
            "joinedAt": "2025-06-14T15:05:47.144Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.146] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.147] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.147] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.147] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.159] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "563b430d-1e7d-49a1-a185-1b75534277df",
        "templateId": "500aa127-b563-40d9-bceb-c6f32b82bfa7",
        "initiator": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 2,
        "nbParticipants": 2,
        "accessCode": "3144",
        "socketId": "A67pFpW7mFp1q-gpAAAO"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.361] [32mINFO [0m [GameStateService] {
        "accessCode": "3144"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:47.371] [32mINFO [0m [TournamentHandler] {
        "room": "game_3144",
        "duration": 5,
        "accessCode": "3144",
        "socketId": "A67pFpW7mFp1q-gpAAAO"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:48.460] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "feedback",
        "questionUid": "q-late-2",
        "feedbackDisplayDuration": 5
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:48.460] [32mINFO [0m [SharedGameFlow] === BACKEND FEEDBACK PAYLOAD DEBUG === {
        "accessCode": "3143",
        "questionIndex": 1,
        "questionUid": "q-late-2",
        "questionExplanation": null,
        "explanationLength": 0,
        "explanationExists": false,
        "fullPayload": "{\"questionUid\":\"q-late-2\",\"feedbackRemaining\":5}"
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:48.461] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "feedback",
        "questionUid": "q-late-2",
        "feedbackDisplayDuration": 5,
        "hasExplanation": false
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.383] [32mINFO [0m [GameStateService] {
        "accessCode": "3144"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.395] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.395] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "playMode": "tournament",
        "questionCount": 2
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.395] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.396] [32mINFO [0m [GameStateService] {
        "accessCode": "3144"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.396] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "room": "game_3144",
        "socketIds": [
          "A67pFpW7mFp1q-gpAAAO",
          "kBE8dwSX0ZyJ4C5eAAAP"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.396] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.396] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3144",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "questionType": "single_correct",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "arithmetic"
            ]
          },
          "index": 0,
          "feedbackWaitTime": 2,
          "timer": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.397] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.398] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3144",
        "event": "game_timer_updated",
        "payload": {
          "questionUid": "q-late-1",
          "timer": {
            "status": "play",
            "timeLeftMs": 2000,
            "durationMs": 2000,
            "questionUid": "q-late-1",
            "timestamp": 1749913552395,
            "localTimeLeftMs": null
          }
        }
      } [DEBUG] Emitting game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.399] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "event": "game_timer_updated",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.400] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "A67pFpW7mFp1q-gpAAAO"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.400] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "A67pFpW7mFp1q-gpAAAO"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.400] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "A67pFpW7mFp1q-gpAAAO"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.400] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "A67pFpW7mFp1q-gpAAAO"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.400] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "kBE8dwSX0ZyJ4C5eAAAP"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.401] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "kBE8dwSX0ZyJ4C5eAAAP"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.402] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "kBE8dwSX0ZyJ4C5eAAAP"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.402] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "kBE8dwSX0ZyJ4C5eAAAP"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.405] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.405] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.406] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:52.407] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:53.462] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:53.462] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:53.462] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143"
      } [SharedGameFlow] Game flow completed and cleaned up

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.400] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3144",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.401] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "event": "correct_answers",
        "questionUid": "q-late-1",
        "correctAnswers": [
          false,
          false,
          false,
          true
        ]
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.401] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.405] [32mINFO [0m [GameStateService] {
        "accessCode": "3144",
        "questionUid": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.406] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.680] [32mINFO [0m [GameParticipantService] {
        "userId": "7dd9a059-fef0-47d6-a575-d881c3f644e0",
        "accessCode": "3144",
        "participantId": "46a37d67-cb31-4319-aa3b-7d8badd4ca4d"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'Z4THkgzHFbpcI6zkAAAR',
        finalUserId: '7dd9a059-fef0-47d6-a575-d881c3f644e0',
        setUserId: '7dd9a059-fef0-47d6-a575-d881c3f644e0',
        setUserData: {
          userId: '7dd9a059-fef0-47d6-a575-d881c3f644e0',
          username: 'p3',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-14 17:05:54.685] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "Z4THkgzHFbpcI6zkAAAR",
        "user": {
          "userId": "7dd9a059-fef0-47d6-a575-d881c3f644e0",
          "username": "p3",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.686] [32mINFO [0m [GameHandlers] {
        "socketId": "Z4THkgzHFbpcI6zkAAAR"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.686] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "Z4THkgzHFbpcI6zkAAAR"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.686] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "Z4THkgzHFbpcI6zkAAAR"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: Z4THkgzHFbpcI6zkAAAR

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:05:54.688] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "Z4THkgzHFbpcI6zkAAAR"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.688] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.688] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.688] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.688] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.688] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.689] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.690] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.690] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.690] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "Z4THkgzHFbpcI6zkAAAR"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.691] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "7dd9a059-fef0-47d6-a575-d881c3f644e0",
        "room": "game_3144",
        "playMode": "tournament",
        "username": "p3"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.691] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "7dd9a059-fef0-47d6-a575-d881c3f644e0",
        "room": "game_3144",
        "playMode": "tournament",
        "username": "p3"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.691] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "7dd9a059-fef0-47d6-a575-d881c3f644e0",
        "room": "game_3144",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.691] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "7dd9a059-fef0-47d6-a575-d881c3f644e0",
        "room": "game_3144",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.696] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "7dd9a059-fef0-47d6-a575-d881c3f644e0",
        "room": "game_3144",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3144",
          "participant": {
            "id": "Z4THkgzHFbpcI6zkAAAR",
            "userId": "7dd9a059-fef0-47d6-a575-d881c3f644e0",
            "username": "p3",
            "avatar": "üë§",
            "score": 0,
            "socketId": "Z4THkgzHFbpcI6zkAAAR",
            "online": true,
            "joinedAt": "2025-06-14T15:05:54.693Z",
            "isDeferred": false
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.696] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "7dd9a059-fef0-47d6-a575-d881c3f644e0",
        "room": "game_3144",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3144",
          "participant": {
            "id": "Z4THkgzHFbpcI6zkAAAR",
            "userId": "7dd9a059-fef0-47d6-a575-d881c3f644e0",
            "username": "p3",
            "avatar": "üë§",
            "score": 0,
            "socketId": "Z4THkgzHFbpcI6zkAAAR",
            "online": true,
            "joinedAt": "2025-06-14T15:05:54.693Z",
            "isDeferred": false
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.698] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "7dd9a059-fef0-47d6-a575-d881c3f644e0",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:54.698] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "7dd9a059-fef0-47d6-a575-d881c3f644e0",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:55.906] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3144",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:55.906] [32mINFO [0m [SharedGameFlow] === BACKEND FEEDBACK PAYLOAD DEBUG === {
        "accessCode": "3144",
        "questionIndex": 0,
        "questionUid": "q-late-1",
        "questionExplanation": null,
        "explanationLength": 0,
        "explanationExists": false,
        "fullPayload": "{\"questionUid\":\"q-late-1\",\"feedbackRemaining\":2}"
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:55.907] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2,
        "hasExplanation": false
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:57.910] [32mINFO [0m [GameStateService] {
        "accessCode": "3144"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:57.910] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "questionIndex": 1,
        "questionUid": "q-late-2"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:57.910] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3144",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-2",
            "questionType": "single_correct",
            "text": "What is 7 x 3?",
            "answerOptions": [
              "20",
              "21",
              "24",
              "27"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              true,
              false,
              false
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "multiplication"
            ]
          },
          "index": 1,
          "feedbackWaitTime": 1.5,
          "timer": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:57.911] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "event": "game_question",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:57.911] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3144",
        "event": "game_timer_updated",
        "payload": {
          "questionUid": "q-late-2",
          "timer": {
            "status": "play",
            "timeLeftMs": 2000,
            "durationMs": 2000,
            "questionUid": "q-late-2",
            "timestamp": 1749913557907,
            "localTimeLeftMs": null
          }
        }
      } [DEBUG] Emitting game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:57.912] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "event": "game_timer_updated",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      Starting afterAll cleanup...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:74:17)

    console.log
      Processing socket1...

      at disconnectSocket (tests/integration/tournament2.test.ts:82:21)

    console.log
      socket1 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament2.test.ts:87:25)

    console.log
      socket1 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:97:37)

    console.log
      socket1 processing complete.

      at disconnectSocket (tests/integration/tournament2.test.ts:113:21)

    console.log
      Processing socket2...

      at disconnectSocket (tests/integration/tournament2.test.ts:82:21)

    console.log
      socket2 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament2.test.ts:87:25)

    console.log
      socket2 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:97:37)

    console.log
      socket2 processing complete.

      at disconnectSocket (tests/integration/tournament2.test.ts:113:21)

    console.log
      [2025-06-14 17:05:59.713] [32mINFO [0m [DisconnectHandler] {
        "socketId": "A67pFpW7mFp1q-gpAAAO",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "accessCode": "3144",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:59.718] [32mINFO [0m [DisconnectHandler] {
        "socketId": "kBE8dwSX0ZyJ4C5eAAAP",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "accessCode": "3144",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:59.723] [32mINFO [0m [DisconnectHandler] {
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "accessCode": "3144",
        "socketId": "A67pFpW7mFp1q-gpAAAO"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:59.725] [32mINFO [0m [DisconnectHandler] {
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "accessCode": "3144",
        "socketId": "kBE8dwSX0ZyJ4C5eAAAP"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:59.727] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
          "socketId": "A67pFpW7mFp1q-gpAAAO"
        },
        "room": "game_3144"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:59.728] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
          "socketId": "kBE8dwSX0ZyJ4C5eAAAP"
        },
        "room": "game_3144"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:59.730] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3144",
        "gameId": "563b430d-1e7d-49a1-a185-1b75534277df",
        "lobbyCount": 0,
        "gameCount": 1,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:59.732] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3144",
        "gameId": "563b430d-1e7d-49a1-a185-1b75534277df",
        "lobbyCount": 0,
        "gameCount": 1,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:59.912] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3144",
        "event": "correct_answers",
        "questionUid": "q-late-2"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:59.913] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "event": "correct_answers",
        "questionUid": "q-late-2",
        "correctAnswers": [
          false,
          true,
          false,
          false
        ]
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:59.913] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "questionUid": "q-late-2"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:59.917] [32mINFO [0m [GameStateService] {
        "accessCode": "3144",
        "questionUid": "q-late-2"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:05:59.918] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "questionUid": "q-late-2"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing Socket.IO server...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:124:21)

    console.log
      [2025-06-14 17:06:00.214] [32mINFO [0m [DisconnectHandler] {
        "socketId": "7JYeFv2lYg8apDaoAAAC",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "accessCode": "3141",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-14 17:06:00.216] [32mINFO [0m [DisconnectHandler] {
        "socketId": "Mb9fxdG0NjHPFVj8AAAD",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "accessCode": "3141",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-14 17:06:00.217] [32mINFO [0m [DisconnectHandler] {
        "socketId": "mSGEmlCfg-HTIt3YAAAG",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "accessCode": "3142",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-14 17:06:00.221] [32mINFO [0m [DisconnectHandler] {
        "socketId": "d0ixmg3qG6X-z041AAAH",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "accessCode": "3142",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-14 17:06:00.222] [32mINFO [0m [DisconnectHandler] {
        "socketId": "pkppygbLTkCwo3mxAAAK",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "accessCode": "3143",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-14 17:06:00.223] [32mINFO [0m [DisconnectHandler] {
        "socketId": "ParMgZ0fOww2tXSaAAAL",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "accessCode": "3143",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-14 17:06:00.223] [32mINFO [0m [DisconnectHandler] {
        "socketId": "Z4THkgzHFbpcI6zkAAAR",
        "userId": "7dd9a059-fef0-47d6-a575-d881c3f644e0",
        "accessCode": "3144",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-14 17:06:00.231] [32mINFO [0m [DisconnectHandler] {
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "accessCode": "3141",
        "socketId": "7JYeFv2lYg8apDaoAAAC"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.231] [32mINFO [0m [DisconnectHandler] {
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "accessCode": "3141",
        "socketId": "Mb9fxdG0NjHPFVj8AAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.231] [32mINFO [0m [DisconnectHandler] {
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "accessCode": "3142",
        "socketId": "mSGEmlCfg-HTIt3YAAAG"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.232] [32mINFO [0m [DisconnectHandler] {
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "accessCode": "3142",
        "socketId": "d0ixmg3qG6X-z041AAAH"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.232] [32mINFO [0m [DisconnectHandler] {
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
        "accessCode": "3143",
        "socketId": "pkppygbLTkCwo3mxAAAK"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.233] [32mINFO [0m [DisconnectHandler] {
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
        "accessCode": "3143",
        "socketId": "ParMgZ0fOww2tXSaAAAL"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.233] [32mINFO [0m [DisconnectHandler] {
        "userId": "7dd9a059-fef0-47d6-a575-d881c3f644e0",
        "accessCode": "3144",
        "socketId": "Z4THkgzHFbpcI6zkAAAR"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket.IO server closed successfully.

      at Server.<anonymous> (tests/integration/tournament2.test.ts:136:33)

    console.log
      Attempting to close HTTP server...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:144:17)

    console.log
      HTTP server was not listening. Assuming already closed or handled by Socket.IO close.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:164:25)

    console.log
      Waiting longer for server resources to release before closing Redis...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:170:17)

    console.log
      [2025-06-14 17:06:00.240] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
          "socketId": "7JYeFv2lYg8apDaoAAAC"
        },
        "room": "game_3141"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.241] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
          "socketId": "Mb9fxdG0NjHPFVj8AAAD"
        },
        "room": "game_3141"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.241] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
          "socketId": "mSGEmlCfg-HTIt3YAAAG"
        },
        "room": "game_3142"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.241] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
          "socketId": "d0ixmg3qG6X-z041AAAH"
        },
        "room": "game_3142"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.242] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
          "socketId": "pkppygbLTkCwo3mxAAAK"
        },
        "room": "game_3143"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.242] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
          "socketId": "ParMgZ0fOww2tXSaAAAL"
        },
        "room": "game_3143"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.243] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "7dd9a059-fef0-47d6-a575-d881c3f644e0",
          "socketId": "Z4THkgzHFbpcI6zkAAAR"
        },
        "room": "game_3144"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.246] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3141",
        "gameId": "ff2a63e2-77ca-4c53-9035-b9b9218b9bf8",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.246] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3141",
        "gameId": "ff2a63e2-77ca-4c53-9035-b9b9218b9bf8",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.246] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3142",
        "gameId": "bdd1751f-317c-4481-b543-6be5d6b29fec",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.246] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3142",
        "gameId": "bdd1751f-317c-4481-b543-6be5d6b29fec",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.247] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3143",
        "gameId": "904acb24-3471-4a15-b57e-7dcdb17f868d",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.247] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3143",
        "gameId": "904acb24-3471-4a15-b57e-7dcdb17f868d",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:00.247] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3144",
        "gameId": "563b430d-1e7d-49a1-a185-1b75534277df",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:01.418] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3144",
        "event": "feedback",
        "questionUid": "q-late-2",
        "feedbackDisplayDuration": 5
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:01.419] [32mINFO [0m [SharedGameFlow] === BACKEND FEEDBACK PAYLOAD DEBUG === {
        "accessCode": "3144",
        "questionIndex": 1,
        "questionUid": "q-late-2",
        "questionExplanation": null,
        "explanationLength": 0,
        "explanationExists": false,
        "fullPayload": "{\"questionUid\":\"q-late-2\",\"feedbackRemaining\":5}"
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:01.419] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "event": "feedback",
        "questionUid": "q-late-2",
        "feedbackDisplayDuration": 5,
        "hasExplanation": false
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing SocketIO Redis clients (subClient)...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:174:17)

    console.log
      SocketIO Redis clients closed.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:177:21)

    console.log
      Closing main Redis client...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:185:17)

    console.log
      Main Redis client quit successfully.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:189:25)

    console.log
      Cleaning up database...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:200:17)

    console.log
      Database cleanup successful.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:212:21)

    console.warn
      Error cleaning up Redis keys: Connection is closed.

      222 |             }
      223 |         } catch (e: any) {
    > 224 |             console.warn('Error cleaning up Redis keys:', e.message || e);
          |                     ^
      225 |         }
      226 |
      227 |         await new Promise(resolve => setTimeout(resolve, 300));

      at Object.<anonymous> (tests/integration/tournament2.test.ts:224:21)

    console.log
      afterAll cleanup complete.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:228:17)

  ‚óè Tournament Flow - Extended Tests ‚Ä∫ P3 joins after Q1 answers: receives Q1 with timer and correct_answers payload, cannot answer Q1

    P3 did not receive all 3 payloads in time

      720 |         // Wait for all 3 payloads (with timeout)
      721 |         await new Promise<void>((resolve, reject) => {
    > 722 |             const timeout = setTimeout(() => reject(new Error('P3 did not receive all 3 payloads in time')), 5000);
          |                                                     ^
      723 |             const check = () => {
      724 |                 if (
      725 |                     receivedPayloads.find(p => p.event === 'game_question') &&

      at Timeout._onTimeout (tests/integration/tournament2.test.ts:722:53)

PASS tests/integration/mockedGameHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-14 17:06:04.385] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.567] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "8a208558-169c-4ead-9811-a58b7fecc6c3",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.586] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-a5x1j26pkf"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.587] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-a5x1j26pkf"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'socket-a5x1j26pkf',
        joinedRoomSocketIds: []
      }

      at log (src/sockets/handlers/game/joinGame.ts:113:25)

    console.log
      [2025-06-14 17:06:04.605] [32mINFO [0m [GameParticipantService] {
        "userId": "player-1_mbwdcrtm2gj6pd",
        "accessCode": "TST789",
        "participantId": "9905bff0-6b9d-407f-96ae-56ed3a7b813b"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.606] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "9905bff0-6b9d-407f-96ae-56ed3a7b813b",
            "userId": "player-1_mbwdcrtm2gj6pd",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-14T15:06:04.602Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.606] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "9905bff0-6b9d-407f-96ae-56ed3a7b813b",
            "userId": "player-1_mbwdcrtm2gj6pd",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.607] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "8a208558-169c-4ead-9811-a58b7fecc6c3",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.610] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 1,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.738] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-zn8dr2xjqam"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.739] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-zn8dr2xjqam"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.751] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-uz6tdwnx4mf"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.751] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-uz6tdwnx4mf"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        questionUid: 'q-late-1',
        answer: { selectedOption: 'b' },
        timeSpent: 5000
      } Socket ID: socket-uz6tdwnx4mf Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:33:17)

    console.log
      [2025-06-14 17:06:04.756] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-uz6tdwnx4mf",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "questionUid": "q-late-1",
          "answer": {
            "selectedOption": "b"
          },
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.757] [33mWARN [0m [GameAnswerHandler] {
        "socketId": "socket-uz6tdwnx4mf",
        "error": "Invalid payload",
        "details": {
          "_errors": [],
          "userId": {
            "_errors": [
              "Required"
            ]
          },
          "answer": {
            "_errors": [
              "Expected string, received object",
              "Expected number, received object",
              "Expected array, received object",
              "Expected array, received object"
            ]
          }
        }
      } Invalid game answer payload

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        questionUid: 'q-late-1',
        answer: { selectedOption: 'b' },
        timeSpent: 5000
      } Socket ID: socket-uz6tdwnx4mf Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:33:17)

    console.log
      [2025-06-14 17:06:04.757] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-uz6tdwnx4mf",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "questionUid": "q-late-1",
          "answer": {
            "selectedOption": "b"
          },
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.757] [33mWARN [0m [GameAnswerHandler] {
        "socketId": "socket-uz6tdwnx4mf",
        "error": "Invalid payload",
        "details": {
          "_errors": [],
          "userId": {
            "_errors": [
              "Required"
            ]
          },
          "answer": {
            "_errors": [
              "Expected string, received object",
              "Expected number, received object",
              "Expected array, received object",
              "Expected array, received object"
            ]
          }
        }
      } Invalid game answer payload

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.766] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-f1qe4hjjfhj"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.766] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-f1qe4hjjfhj"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.932] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-if954yun0a"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.933] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-if954yun0a"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.962] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-hqtvigz6xu"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.962] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-hqtvigz6xu"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.970] [32mINFO [0m [GameParticipantService] {
        "userId": "player-1_mbwdcrtm2gj6pd",
        "accessCode": "DIFF123",
        "participantId": "13b354a5-882f-4d3d-9df9-504cb0475f89"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.971] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "DIFF123",
          "participant": {
            "id": "13b354a5-882f-4d3d-9df9-504cb0475f89",
            "userId": "player-1_mbwdcrtm2gj6pd",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-14T15:06:04.968Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": true,
          "differedAvailableFrom": "2025-06-14T15:06:04.954Z",
          "differedAvailableTo": "2025-06-14T16:06:04.954Z"
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.971] [32mINFO [0m [JoinGameHandler] {
        "accessCode": "DIFF123",
        "userId": "player-1_mbwdcrtm2gj6pd"
      } Starting deferred tournament game flow for individual player

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.973] [32mINFO [0m [JoinGameHandler] {
        "accessCode": "DIFF123",
        "userId": "player-1_mbwdcrtm2gj6pd",
        "questionCount": 1
      } Starting individual deferred tournament game flow

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.974] [33mWARN [0m [GameStateService] {
        "accessCode": "DIFF123"
      } Game state not found in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.974] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "DIFF123"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.974] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "DIFF123",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.974] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "DIFF123"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.974] [33mWARN [0m [GameStateService] {
        "accessCode": "DIFF123"
      } Game state not found in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.975] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "DIFF123",
        "room": "game_DIFF123",
        "socketIds": []
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.975] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "DIFF123",
        "questionIndex": 0,
        "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.975] [32mINFO [0m [SharedGameFlow] {
        "room": "game_DIFF123",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "2e57738e-9a3e-4221-88bc-47f7aad85f73",
            "questionType": "multiple_choice_single_answer",
            "text": "What is 1+1?",
            "answerOptions": [
              "1",
              "2"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              true
            ],
            "timeLimit": 20,
            "gradeLevel": null,
            "difficulty": 1,
            "themes": [
              "arithmetic"
            ]
          },
          "index": 0,
          "feedbackWaitTime": 1.5,
          "timer": 20
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.975] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "DIFF123",
        "event": "game_question",
        "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.975] [32mINFO [0m [SharedGameFlow] {
        "room": "game_DIFF123",
        "event": "game_timer_updated",
        "payload": {
          "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73",
          "timer": {
            "status": "play",
            "timeLeftMs": 20000,
            "durationMs": 20000,
            "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73",
            "timestamp": 1749913564974,
            "localTimeLeftMs": null
          }
        }
      } [DEBUG] Emitting game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.975] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "DIFF123",
        "event": "game_timer_updated",
        "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73"
      } [TRACE] Emitted game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.975] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DIFF123",
        "gameId": "6fb636b3-b340-4b04-857d-1132300feee8",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.976] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 1
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.985] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-wicud3w2i4a"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.985] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-wicud3w2i4a"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.986] [33mWARN [0m [JoinGameHandler] {
        "errorPayload": {
          "message": "Differed mode not available at this time."
        }
      } Emitting game_error: differed window not available

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.997] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-cx88l9ctbkv"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.997] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-cx88l9ctbkv"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:04.999] [32mINFO [0m [JoinGameHandler] {
        "gameAlreadyPlayedPayload": {
          "accessCode": "DIFF123"
        }
      } Emitting game_already_played

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.005] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-pkm43f9bcnd"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.005] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-pkm43f9bcnd"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.014] [32mINFO [0m [GameParticipantService] {
        "userId": "player-3_mbwdcrtm2gj6pd",
        "accessCode": "DIFF123",
        "participantId": "d38ddcae-ea7e-4ddb-b6ec-38adf1d0c4f5"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.015] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "DIFF123",
          "participant": {
            "id": "d38ddcae-ea7e-4ddb-b6ec-38adf1d0c4f5",
            "userId": "player-3_mbwdcrtm2gj6pd",
            "username": "Player 3",
            "avatar": "https://example.com/avatar3.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar3.jpg",
            "joinedAt": "2025-06-14T15:06:05.011Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": true,
          "differedAvailableFrom": "2025-06-14T15:06:04.986Z",
          "differedAvailableTo": "2025-06-14T16:06:04.986Z"
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.015] [32mINFO [0m [JoinGameHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbwdcrtm2gj6pd"
      } Starting deferred tournament game flow for individual player

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.016] [32mINFO [0m [JoinGameHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbwdcrtm2gj6pd",
        "questionCount": 1
      } Starting individual deferred tournament game flow

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.017] [33mWARN [0m [GameStateService] {
        "accessCode": "DIFF123"
      } Game state not found in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.017] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "DIFF123"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.017] [33mWARN [0m [SharedGameFlow] {
        "accessCode": "DIFF123"
      } [SharedGameFlow] Game flow already running for this access code. Skipping duplicate.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.018] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DIFF123",
        "gameId": "6fb636b3-b340-4b04-857d-1132300feee8",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.019] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 2
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'DIFF123',
        userId: 'player-3_mbwdcrtm2gj6pd',
        questionUid: '2e57738e-9a3e-4221-88bc-47f7aad85f73',
        answer: 'b',
        timeSpent: 2000
      } Socket ID: socket-pkm43f9bcnd Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:33:17)

    console.log
      [2025-06-14 17:06:05.019] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-pkm43f9bcnd",
        "event": "game_answer",
        "payload": {
          "accessCode": "DIFF123",
          "userId": "player-3_mbwdcrtm2gj6pd",
          "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73",
          "answer": "b",
          "timeSpent": 2000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.031] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbwdcrtm2gj6pd",
        "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at log (src/sockets/handlers/game/gameAnswer.ts:184:25)

    console.log
      [GAME_ANSWER] Adding current questionUid 2e57738e-9a3e-4221-88bc-47f7aad85f73 to answered questions

      at log (src/sockets/handlers/game/gameAnswer.ts:196:29)

    console.log
      [GAME_ANSWER] Found 1/1 answered questions: [ '2e57738e-9a3e-4221-88bc-47f7aad85f73' ]

      at log (src/sockets/handlers/game/gameAnswer.ts:203:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=1

      at log (src/sockets/handlers/game/gameAnswer.ts:212:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at log (src/sockets/handlers/game/gameAnswer.ts:222:29)

    console.log
      [2025-06-14 17:06:05.032] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbwdcrtm2gj6pd",
        "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'DIFF123',
        userId: 'player-3_mbwdcrtm2gj6pd',
        questionUid: '2e57738e-9a3e-4221-88bc-47f7aad85f73',
        answer: 'b',
        timeSpent: 2000
      } Socket ID: socket-pkm43f9bcnd Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:33:17)

    console.log
      [2025-06-14 17:06:05.032] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-pkm43f9bcnd",
        "event": "game_answer",
        "payload": {
          "accessCode": "DIFF123",
          "userId": "player-3_mbwdcrtm2gj6pd",
          "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73",
          "answer": "b",
          "timeSpent": 2000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.046] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbwdcrtm2gj6pd",
        "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":"b","timestamp":"2025-06-14T15:06:05.022Z","questionUid":"2e57738e-9a3e-4221-88bc-47f7aad85f73","timeTakenMs":2000}]

      at log (src/sockets/handlers/game/gameAnswer.ts:184:25)

    console.log
      [GAME_ANSWER] Found 1/1 answered questions: [ '2e57738e-9a3e-4221-88bc-47f7aad85f73' ]

      at log (src/sockets/handlers/game/gameAnswer.ts:203:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=1

      at log (src/sockets/handlers/game/gameAnswer.ts:212:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at log (src/sockets/handlers/game/gameAnswer.ts:222:29)

    console.log
      [2025-06-14 17:06:05.047] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbwdcrtm2gj6pd",
        "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.070] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-bguuu1tr1bt"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.070] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-bguuu1tr1bt"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'socket-bguuu1tr1bt',
        joinedRoomSocketIds: []
      }

      at log (src/sockets/handlers/game/joinGame.ts:113:25)

    console.log
      [2025-06-14 17:06:05.080] [32mINFO [0m [GameParticipantService] {
        "userId": "player-1_mbwdcrtm2gj6pd",
        "accessCode": "TST789",
        "participantId": "9905bff0-6b9d-407f-96ae-56ed3a7b813b"
      } Updated existing participant join time

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.082] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "9905bff0-6b9d-407f-96ae-56ed3a7b813b",
            "userId": "player-1_mbwdcrtm2gj6pd",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-14T15:06:05.076Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.082] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "9905bff0-6b9d-407f-96ae-56ed3a7b813b",
            "userId": "player-1_mbwdcrtm2gj6pd",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.084] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "8a208558-169c-4ead-9811-a58b7fecc6c3",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.086] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 1,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.095] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.101] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789",
        "questionIndex": 0
      } Current question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        userId: 'player-1_mbwdcrtm2gj6pd',
        questionUid: '18dfd980-bae4-406e-bc6b-cb96b2c46db9',
        answer: 1,
        timeSpent: 5000
      } Socket ID: socket-bguuu1tr1bt Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:33:17)

    console.log
      [2025-06-14 17:06:05.103] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-bguuu1tr1bt",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "userId": "player-1_mbwdcrtm2gj6pd",
          "questionUid": "18dfd980-bae4-406e-bc6b-cb96b2c46db9",
          "answer": 1,
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.114] [32mINFO [0m [GameAnswerHandler] {
        "leaderboard": [
          {
            "userId": "player-1_mbwdcrtm2gj6pd",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0
          }
        ],
        "roomName": "teacher_8a65aef1-c26a-4c13-86f5-7b9c88fb7bfa_TST789"
      } Emitting leaderboard_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.115] [32mINFO [0m [GameAnswerHandler] {
        "questionUid": "18dfd980-bae4-406e-bc6b-cb96b2c46db9",
        "timeSpent": 5000
      } Emitting answer_received for non-differed mode (without correct field)

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Successfully emitted answer_received for question 18dfd980-bae4-406e-bc6b-cb96b2c46db9 to socket socket-bguuu1tr1bt

      at log (src/sockets/handlers/game/gameAnswer.ts:246:29)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        userId: 'player-1_mbwdcrtm2gj6pd',
        questionUid: '18dfd980-bae4-406e-bc6b-cb96b2c46db9',
        answer: 1,
        timeSpent: 5000
      } Socket ID: socket-bguuu1tr1bt Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:33:17)

    console.log
      [2025-06-14 17:06:05.115] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-bguuu1tr1bt",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "userId": "player-1_mbwdcrtm2gj6pd",
          "questionUid": "18dfd980-bae4-406e-bc6b-cb96b2c46db9",
          "answer": 1,
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.125] [32mINFO [0m [GameAnswerHandler] {
        "leaderboard": [
          {
            "userId": "player-1_mbwdcrtm2gj6pd",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0
          }
        ],
        "roomName": "teacher_8a65aef1-c26a-4c13-86f5-7b9c88fb7bfa_TST789"
      } Emitting leaderboard_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:05.125] [32mINFO [0m [GameAnswerHandler] {
        "questionUid": "18dfd980-bae4-406e-bc6b-cb96b2c46db9",
        "timeSpent": 5000
      } Emitting answer_received for non-differed mode (without correct field)

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Successfully emitted answer_received for question 18dfd980-bae4-406e-bc6b-cb96b2c46db9 to socket socket-bguuu1tr1bt

      at log (src/sockets/handlers/game/gameAnswer.ts:246:29)

    console.log
      [DEBUG before scoring] Redis key: mathquest:game:answers:TST789:18dfd980-bae4-406e-bc6b-cb96b2c46db9 value: {
        'player-1_mbwdcrtm2gj6pd': '{"userId":"player-1_mbwdcrtm2gj6pd","answer":1,"timeSpent":5000,"submittedAt":1749913565122}'
      }

      at Object.<anonymous> (tests/integration/mockedGameHandler.test.ts:924:21)

    console.log
      [2025-06-14 17:06:05.134] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789",
        "questionUid": "18dfd980-bae4-406e-bc6b-cb96b2c46db9"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG after scoring] Redis key: mathquest:game:answers:TST789:18dfd980-bae4-406e-bc6b-cb96b2c46db9 value: {
        'player-1_mbwdcrtm2gj6pd': '{"userId":"player-1_mbwdcrtm2gj6pd","answer":1,"timeSpent":5000,"submittedAt":1749913565122}'
      }

      at Object.<anonymous> (tests/integration/mockedGameHandler.test.ts:931:21)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-14 17:06:06.422] [32mINFO [0m [SharedGameFlow] {
      "room": "game_3144",
      "event": "game_end"
    } [DEBUG] Emitting game_end".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:169:16)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-14 17:06:06.429] [32mINFO [0m [SharedGameFlow] {
      "accessCode": "3144",
      "event": "game_end"
    } [TRACE] Emitted game_end".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:171:16)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-14 17:06:06.431] [32mINFO [0m [SharedGameFlow] {
      "accessCode": "3144"
    } [SharedGameFlow] Game flow completed and cleaned up".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:179:16)

FAIL tests/integration/gameHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-14 17:06:05.951] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.029] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "998bf30d-5f25-445d-af5c-9153b4612dd8",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.036] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "bUqgx2NK0PTGzl9PAAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.038] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "bUqgx2NK0PTGzl9PAAAB",
        "user": {
          "id": "player-123",
          "userId": "player-123",
          "username": "Test Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.042] [32mINFO [0m [GameHandlers] {
        "socketId": "bUqgx2NK0PTGzl9PAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.042] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "bUqgx2NK0PTGzl9PAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.042] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "bUqgx2NK0PTGzl9PAAAB"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: bUqgx2NK0PTGzl9PAAAB

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:06:06.042] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "bUqgx2NK0PTGzl9PAAAB"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.042] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.042] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.042] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.043] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.043] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.043] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.043] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.043] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.043] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "bUqgx2NK0PTGzl9PAAAB"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.047] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "998bf30d-5f25-445d-af5c-9153b4612dd8",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'bUqgx2NK0PTGzl9PAAAB',
        joinedRoomSocketIds: [ 'bUqgx2NK0PTGzl9PAAAB' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:113:25)

    console.log
      [2025-06-14 17:06:06.059] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.059] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Test Player",
        "avatarEmoji": "https://example.com/avatar.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.059] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.059] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Test Player",
        "avatarEmoji": "https://example.com/avatar.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.059] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.059] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.060] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "bUqgx2NK0PTGzl9PAAAB",
            "userId": "player-123",
            "username": "Test Player",
            "avatar": "https://example.com/avatar.jpg",
            "score": 0,
            "socketId": "bUqgx2NK0PTGzl9PAAAB",
            "online": true,
            "joinedAt": "2025-06-14T15:06:06.060Z",
            "isDeferred": false,
            "avatarEmoji": "https://example.com/avatar.jpg"
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.061] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "bUqgx2NK0PTGzl9PAAAB",
            "userId": "player-123",
            "username": "Test Player",
            "avatar": "https://example.com/avatar.jpg",
            "score": 0,
            "socketId": "bUqgx2NK0PTGzl9PAAAB",
            "online": true,
            "joinedAt": "2025-06-14T15:06:06.061Z",
            "isDeferred": false,
            "avatarEmoji": "https://example.com/avatar.jpg"
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.067] [32mINFO [0m [GameParticipantService] {
        "userId": "player-123",
        "accessCode": "TST789",
        "participantId": "752e25aa-88d7-49a7-9626-5c9186c6fd77"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.067] [32mINFO [0m [DisconnectHandler] {
        "socketId": "bUqgx2NK0PTGzl9PAAAB",
        "userId": "player-123",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.068] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.068] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.072] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-123",
        "accessCode": "TST789",
        "socketId": "bUqgx2NK0PTGzl9PAAAB"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.073] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "752e25aa-88d7-49a7-9626-5c9186c6fd77",
            "userId": "player-123",
            "username": "Test Player",
            "avatar": "https://example.com/avatar.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar.jpg",
            "joinedAt": "2025-06-14T15:06:06.058Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.073] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "752e25aa-88d7-49a7-9626-5c9186c6fd77",
            "userId": "player-123",
            "username": "Test Player",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.075] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "player-123",
          "socketId": "bUqgx2NK0PTGzl9PAAAB"
        },
        "room": "game_TST789"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.076] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "998bf30d-5f25-445d-af5c-9153b4612dd8",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.077] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "998bf30d-5f25-445d-af5c-9153b4612dd8",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.078] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "bMzyqtsuj1c7HJ3NAAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.078] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "bMzyqtsuj1c7HJ3NAAAE",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.079] [32mINFO [0m [GameHandlers] {
        "socketId": "bMzyqtsuj1c7HJ3NAAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.079] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "bMzyqtsuj1c7HJ3NAAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.079] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "bMzyqtsuj1c7HJ3NAAAE"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: bMzyqtsuj1c7HJ3NAAAE

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:06:06.079] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "bMzyqtsuj1c7HJ3NAAAE"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.079] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.079] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.080] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.080] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.080] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.080] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.080] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.080] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.080] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "bMzyqtsuj1c7HJ3NAAAE"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.081] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 1,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.082] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "ugEYwetqBiuvUUN2AAAF"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.082] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "ugEYwetqBiuvUUN2AAAF",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.082] [32mINFO [0m [GameHandlers] {
        "socketId": "ugEYwetqBiuvUUN2AAAF"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.082] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "ugEYwetqBiuvUUN2AAAF"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.083] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ugEYwetqBiuvUUN2AAAF"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: ugEYwetqBiuvUUN2AAAF

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:06:06.083] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "ugEYwetqBiuvUUN2AAAF"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.083] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.083] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.083] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.083] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.083] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.083] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.083] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.083] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.083] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ugEYwetqBiuvUUN2AAAF"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.087] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "998bf30d-5f25-445d-af5c-9153b4612dd8",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'bMzyqtsuj1c7HJ3NAAAE',
        joinedRoomSocketIds: [ 'bMzyqtsuj1c7HJ3NAAAE' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:113:25)

    console.log
      [2025-06-14 17:06:06.091] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.091] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.091] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.091] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.091] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.091] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.092] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "bMzyqtsuj1c7HJ3NAAAE",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "socketId": "bMzyqtsuj1c7HJ3NAAAE",
            "online": true,
            "joinedAt": "2025-06-14T15:06:06.092Z",
            "isDeferred": false,
            "avatarEmoji": "https://example.com/avatar1.jpg"
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.093] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "bMzyqtsuj1c7HJ3NAAAE",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "socketId": "bMzyqtsuj1c7HJ3NAAAE",
            "online": true,
            "joinedAt": "2025-06-14T15:06:06.093Z",
            "isDeferred": false,
            "avatarEmoji": "https://example.com/avatar1.jpg"
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.094] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.095] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'ugEYwetqBiuvUUN2AAAF',
        joinedRoomSocketIds: [ 'bMzyqtsuj1c7HJ3NAAAE', 'ugEYwetqBiuvUUN2AAAF' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:113:25)

    console.log
      [2025-06-14 17:06:06.101] [32mINFO [0m [GameParticipantService] {
        "userId": "player-1",
        "accessCode": "TST789",
        "participantId": "6feeaf91-5aaf-46a2-a0c7-6aedb727a037"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.102] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "6feeaf91-5aaf-46a2-a0c7-6aedb727a037",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-14T15:06:06.096Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.102] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "6feeaf91-5aaf-46a2-a0c7-6aedb727a037",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.103] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "998bf30d-5f25-445d-af5c-9153b4612dd8",
        "lobbyCount": 0,
        "gameCount": 2,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.105] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.105] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.106] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.106] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.106] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.106] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.106] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 2,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.109] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "ugEYwetqBiuvUUN2AAAF",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "https://example.com/avatar2.jpg",
            "score": 0,
            "socketId": "ugEYwetqBiuvUUN2AAAF",
            "online": true,
            "joinedAt": "2025-06-14T15:06:06.108Z",
            "isDeferred": false,
            "avatarEmoji": "https://example.com/avatar2.jpg"
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.109] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "ugEYwetqBiuvUUN2AAAF",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "https://example.com/avatar2.jpg",
            "score": 0,
            "socketId": "ugEYwetqBiuvUUN2AAAF",
            "online": true,
            "joinedAt": "2025-06-14T15:06:06.109Z",
            "isDeferred": false,
            "avatarEmoji": "https://example.com/avatar2.jpg"
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.116] [32mINFO [0m [GameParticipantService] {
        "userId": "player-2",
        "accessCode": "TST789",
        "participantId": "62772f0f-3f8f-42b6-a2e6-f665b04b22bd"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.116] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.116] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.116] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "62772f0f-3f8f-42b6-a2e6-f665b04b22bd",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "https://example.com/avatar2.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar2.jpg",
            "joinedAt": "2025-06-14T15:06:06.107Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.116] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "62772f0f-3f8f-42b6-a2e6-f665b04b22bd",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.118] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "998bf30d-5f25-445d-af5c-9153b4612dd8",
        "lobbyCount": 0,
        "gameCount": 2,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.119] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 3,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: Redis participants: {
        'player-2': '{"id":"62772f0f-3f8f-42b6-a2e6-f665b04b22bd","userId":"player-2","username":"Player 2","avatar":"https://example.com/avatar2.jpg","score":0,"avatarEmoji":"https://example.com/avatar2.jpg","joinedAt":"2025-06-14T15:06:06.107Z","online":true,"socketId":"ugEYwetqBiuvUUN2AAAF"}',
        'player-1': '{"id":"6feeaf91-5aaf-46a2-a0c7-6aedb727a037","userId":"player-1","username":"Player 1","avatar":"https://example.com/avatar1.jpg","score":0,"avatarEmoji":"https://example.com/avatar1.jpg","joinedAt":"2025-06-14T15:06:06.096Z","online":true,"socketId":"bMzyqtsuj1c7HJ3NAAAE"}'
      }

      at Object.<anonymous> (tests/integration/gameHandler.test.ts:528:17)

    console.log
      [2025-06-14 17:06:06.221] [32mINFO [0m [DisconnectHandler] {
        "socketId": "bMzyqtsuj1c7HJ3NAAAE",
        "userId": "player-1",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.222] [32mINFO [0m [DisconnectHandler] {
        "socketId": "ugEYwetqBiuvUUN2AAAF",
        "userId": "player-2",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.224] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-1",
        "accessCode": "TST789",
        "disconnectedSocketId": "bMzyqtsuj1c7HJ3NAAAE",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.228] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TST789",
        "disconnectedSocketId": "ugEYwetqBiuvUUN2AAAF",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.233] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "AnVKEm7gLe33phvwAAAI"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.233] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "AnVKEm7gLe33phvwAAAI",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.234] [32mINFO [0m [GameHandlers] {
        "socketId": "AnVKEm7gLe33phvwAAAI"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.234] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "AnVKEm7gLe33phvwAAAI"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.234] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "AnVKEm7gLe33phvwAAAI"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: AnVKEm7gLe33phvwAAAI

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:06:06.234] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "AnVKEm7gLe33phvwAAAI"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.234] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.234] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.234] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.234] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.234] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.234] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.235] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.235] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.235] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "AnVKEm7gLe33phvwAAAI"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.236] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "1tk9BFqHBy6mKbIIAAAJ"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.236] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "1tk9BFqHBy6mKbIIAAAJ",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.236] [32mINFO [0m [GameHandlers] {
        "socketId": "1tk9BFqHBy6mKbIIAAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.236] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "1tk9BFqHBy6mKbIIAAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.236] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "1tk9BFqHBy6mKbIIAAAJ"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 1tk9BFqHBy6mKbIIAAAJ

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:06:06.236] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "1tk9BFqHBy6mKbIIAAAJ"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.237] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.237] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.237] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.237] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.237] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.237] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.237] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.237] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.238] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "1tk9BFqHBy6mKbIIAAAJ"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.244] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "998bf30d-5f25-445d-af5c-9153b4612dd8",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'AnVKEm7gLe33phvwAAAI',
        joinedRoomSocketIds: [ 'AnVKEm7gLe33phvwAAAI' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:113:25)

    console.log
      [2025-06-14 17:06:06.247] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.247] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.247] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.247] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.247] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.247] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: '1tk9BFqHBy6mKbIIAAAJ',
        joinedRoomSocketIds: [ 'AnVKEm7gLe33phvwAAAI', '1tk9BFqHBy6mKbIIAAAJ' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:113:25)

    console.log
      [2025-06-14 17:06:06.248] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.248] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.248] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.248] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.248] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.248] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.250] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "AnVKEm7gLe33phvwAAAI",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "socketId": "AnVKEm7gLe33phvwAAAI",
            "online": true,
            "joinedAt": "2025-06-14T15:06:06.250Z",
            "isDeferred": false,
            "avatarEmoji": "https://example.com/avatar1.jpg"
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.251] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "AnVKEm7gLe33phvwAAAI",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "socketId": "AnVKEm7gLe33phvwAAAI",
            "online": true,
            "joinedAt": "2025-06-14T15:06:06.251Z",
            "isDeferred": false,
            "avatarEmoji": "https://example.com/avatar1.jpg"
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.251] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "1tk9BFqHBy6mKbIIAAAJ",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "https://example.com/avatar2.jpg",
            "score": 0,
            "socketId": "1tk9BFqHBy6mKbIIAAAJ",
            "online": true,
            "joinedAt": "2025-06-14T15:06:06.251Z",
            "isDeferred": false,
            "avatarEmoji": "https://example.com/avatar2.jpg"
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.252] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "1tk9BFqHBy6mKbIIAAAJ",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "https://example.com/avatar2.jpg",
            "score": 0,
            "socketId": "1tk9BFqHBy6mKbIIAAAJ",
            "online": true,
            "joinedAt": "2025-06-14T15:06:06.252Z",
            "isDeferred": false,
            "avatarEmoji": "https://example.com/avatar2.jpg"
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.253] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.253] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.253] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.254] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.258] [32mINFO [0m [GameParticipantService] {
        "userId": "player-2",
        "accessCode": "TST789",
        "participantId": "62772f0f-3f8f-42b6-a2e6-f665b04b22bd"
      } Updated existing participant join time

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.259] [32mINFO [0m [GameParticipantService] {
        "userId": "player-1",
        "accessCode": "TST789",
        "participantId": "6feeaf91-5aaf-46a2-a0c7-6aedb727a037"
      } Updated existing participant join time

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.259] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "62772f0f-3f8f-42b6-a2e6-f665b04b22bd",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "https://example.com/avatar2.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar2.jpg",
            "joinedAt": "2025-06-14T15:06:06.252Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.259] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "62772f0f-3f8f-42b6-a2e6-f665b04b22bd",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.260] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "6feeaf91-5aaf-46a2-a0c7-6aedb727a037",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-14T15:06:06.252Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.261] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "6feeaf91-5aaf-46a2-a0c7-6aedb727a037",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.261] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "998bf30d-5f25-445d-af5c-9153b4612dd8",
        "lobbyCount": 0,
        "gameCount": 2,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.262] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "998bf30d-5f25-445d-af5c-9153b4612dd8",
        "lobbyCount": 0,
        "gameCount": 2,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.262] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 3,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.263] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 3,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: Redis participants: {
        'player-2': '{"id":"62772f0f-3f8f-42b6-a2e6-f665b04b22bd","userId":"player-2","username":"Player 2","avatar":"https://example.com/avatar2.jpg","score":0,"avatarEmoji":"https://example.com/avatar2.jpg","joinedAt":"2025-06-14T15:06:06.252Z","online":true,"socketId":"1tk9BFqHBy6mKbIIAAAJ"}',
        'player-1': '{"id":"6feeaf91-5aaf-46a2-a0c7-6aedb727a037","userId":"player-1","username":"Player 1","avatar":"https://example.com/avatar1.jpg","score":0,"avatarEmoji":"https://example.com/avatar1.jpg","joinedAt":"2025-06-14T15:06:06.252Z","online":true,"socketId":"AnVKEm7gLe33phvwAAAI"}'
      }

      at Object.<anonymous> (tests/integration/gameHandler.test.ts:624:17)

    console.log
      [2025-06-14 17:06:06.759] [32mINFO [0m [DisconnectHandler] {
        "socketId": "AnVKEm7gLe33phvwAAAI",
        "userId": "player-1",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.760] [32mINFO [0m [DisconnectHandler] {
        "socketId": "1tk9BFqHBy6mKbIIAAAJ",
        "userId": "player-2",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.763] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-1",
        "accessCode": "TST789",
        "disconnectedSocketId": "AnVKEm7gLe33phvwAAAI",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:06.767] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TST789",
        "disconnectedSocketId": "1tk9BFqHBy6mKbIIAAAJ",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

  ‚óè Game Handler ‚Ä∫ Simplified test: Multiple players can join a game

    Connection is closed.



      at EventEmitter.sendCommand (node_modules/ioredis/built/Redis.js:332:28)
      at EventEmitter.publish (node_modules/ioredis/built/utils/Commander.js:90:25)
      at RedisAdapter.broadcast (node_modules/@socket.io/redis-adapter/dist/index.js:473:28)
      at BroadcastOperator.emit (node_modules/socket.io/dist/broadcast-operator.js:169:26)
      at runGameFlow (src/sockets/handlers/sharedGameFlow.ts:2086:33)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-14 17:06:24.977] [32mINFO [0m [SharedGameFlow] {
      "room": "game_DIFF123",
      "event": "correct_answers",
      "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73"
    } [DEBUG] Emitting correct_answers".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:113:20)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-14 17:06:24.980] [32mINFO [0m [SharedGameFlow] {
      "accessCode": "DIFF123",
      "event": "correct_answers",
      "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73",
      "correctAnswers": [
        false,
        true
      ]
    } [TRACE] Emitted correct_answers".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:120:20)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-14 17:06:24.981] [32mINFO [0m [SharedGameFlow] {
      "accessCode": "DIFF123",
      "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73"
    } [SharedGameFlow] Calculating scores for question".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:123:24)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-14 17:06:24.986] [33mWARN [0m [GameStateService] {
      "accessCode": "DIFF123",
      "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73"
    } Question not found for scoring".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as warn] (src/utils/logger.ts:119:35)
      at Object.warn [as calculateScores] (src/core/gameStateService.ts:426:20)
      at runGameFlow (src/sockets/handlers/sharedGameFlow.ts:124:17)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-14 17:06:24.988] [32mINFO [0m [SharedGameFlow] {
      "accessCode": "DIFF123",
      "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73"
    } [SharedGameFlow] Scores calculated".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:125:24)

PASS tests/integration/tournament.test.ts (19.308 s)
  ‚óè Console

    console.log
      [2025-06-14 17:06:07.436] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.557] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "gameTemplateId": "0f9ce6c2-4a20-42a6-8611-7764f92cbec8",
          "playMode": "tournament",
          "discipline": "math",
          "nbOfQuestions": 1
        },
        "keys": [
          "name",
          "gameTemplateId",
          "playMode",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
          "username": "p1-basic",
          "role": "STUDENT",
          "iat": 1749913567,
          "exp": 1749917167
        },
        "headers": {
          "host": "localhost:30863",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJmMGUyMjlhNy1lYjIwLTRiNGItYWIxOS02N2FiNjUzMzhkNzUiLCJ1c2VybmFtZSI6InAxLWJhc2ljIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk5MTM1NjcsImV4cCI6MTc0OTkxNzE2N30.ncYExYDcmC7nvntaNhgpUVFLdd7JL1o31tw7Lxwig8A",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.557] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "0f9ce6c2-4a20-42a6-8611-7764f92cbec8",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.570] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "3f02d212-445c-4702-a541-d591bea304bc",
        "accessCode": "3141"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.697] [32mINFO [0m [GameParticipantService] {
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "accessCode": "3141",
        "participantId": "9096c17e-170e-4afb-83a6-944563668dc4"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.707] [32mINFO [0m [GameParticipantService] {
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "accessCode": "3141",
        "participantId": "7762e96e-f5a5-4db8-b64e-200ee265b269"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.713] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "w5m-Ahx9VMm72Qg1AAAC",
        "user": {
          "id": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
          "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
          "username": "p1-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.716] [32mINFO [0m [GameHandlers] {
        "socketId": "w5m-Ahx9VMm72Qg1AAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.716] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "w5m-Ahx9VMm72Qg1AAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.716] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "w5m-Ahx9VMm72Qg1AAAC"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: w5m-Ahx9VMm72Qg1AAAC

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:06:07.716] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "w5m-Ahx9VMm72Qg1AAAC"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.717] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.717] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.717] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.717] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.717] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.717] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.717] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.717] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.717] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "w5m-Ahx9VMm72Qg1AAAC"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.719] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "wMwUivs-Oqg_WGqIAAAD",
        "user": {
          "id": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
          "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
          "username": "p2-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.719] [32mINFO [0m [GameHandlers] {
        "socketId": "wMwUivs-Oqg_WGqIAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.719] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "wMwUivs-Oqg_WGqIAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.719] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "wMwUivs-Oqg_WGqIAAAD"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: wMwUivs-Oqg_WGqIAAAD

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:06:07.719] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "wMwUivs-Oqg_WGqIAAAD"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.719] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.719] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.719] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.720] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.720] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.720] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.720] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.720] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.720] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "wMwUivs-Oqg_WGqIAAAD"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.720] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "room": "game_3141",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.721] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "room": "game_3141",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.721] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "room": "game_3141",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.721] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "room": "game_3141",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.721] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "room": "game_3141",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.721] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "room": "game_3141",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.721] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "room": "game_3141",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.721] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "room": "game_3141",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.722] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "room": "game_3141",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3141",
          "participant": {
            "id": "w5m-Ahx9VMm72Qg1AAAC",
            "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
            "username": "p1-basic",
            "avatar": "üë§",
            "score": 0,
            "socketId": "w5m-Ahx9VMm72Qg1AAAC",
            "online": true,
            "joinedAt": "2025-06-14T15:06:07.722Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.722] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "room": "game_3141",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3141",
          "participant": {
            "id": "w5m-Ahx9VMm72Qg1AAAC",
            "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
            "username": "p1-basic",
            "avatar": "üë§",
            "score": 0,
            "socketId": "w5m-Ahx9VMm72Qg1AAAC",
            "online": true,
            "joinedAt": "2025-06-14T15:06:07.722Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.723] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "room": "game_3141",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3141",
          "participant": {
            "id": "wMwUivs-Oqg_WGqIAAAD",
            "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
            "username": "p2-basic",
            "avatar": "üë§",
            "score": 0,
            "socketId": "wMwUivs-Oqg_WGqIAAAD",
            "online": true,
            "joinedAt": "2025-06-14T15:06:07.723Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.723] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "room": "game_3141",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3141",
          "participant": {
            "id": "wMwUivs-Oqg_WGqIAAAD",
            "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
            "username": "p2-basic",
            "avatar": "üë§",
            "score": 0,
            "socketId": "wMwUivs-Oqg_WGqIAAAD",
            "online": true,
            "joinedAt": "2025-06-14T15:06:07.723Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.725] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.725] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.725] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.725] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.735] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "3f02d212-445c-4702-a541-d591bea304bc",
        "templateId": "0f9ce6c2-4a20-42a6-8611-7764f92cbec8",
        "initiator": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "3141",
        "socketId": "w5m-Ahx9VMm72Qg1AAAC"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.938] [32mINFO [0m [GameStateService] {
        "accessCode": "3141"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:07.953] [32mINFO [0m [TournamentHandler] {
        "room": "game_3141",
        "duration": 5,
        "accessCode": "3141",
        "socketId": "w5m-Ahx9VMm72Qg1AAAC"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.969] [32mINFO [0m [GameStateService] {
        "accessCode": "3141"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.987] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.988] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.988] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.991] [32mINFO [0m [GameStateService] {
        "accessCode": "3141"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.991] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "room": "game_3141",
        "socketIds": [
          "w5m-Ahx9VMm72Qg1AAAC",
          "wMwUivs-Oqg_WGqIAAAD"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.992] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.992] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3141",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "questionType": "single_correct",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "arithmetic"
            ]
          },
          "index": 0,
          "feedbackWaitTime": 2,
          "timer": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.992] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.992] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3141",
        "event": "game_timer_updated",
        "payload": {
          "questionUid": "q-late-1",
          "timer": {
            "status": "play",
            "timeLeftMs": 2000,
            "durationMs": 2000,
            "questionUid": "q-late-1",
            "timestamp": 1749913572988,
            "localTimeLeftMs": null
          }
        }
      } [DEBUG] Emitting game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.993] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "event": "game_timer_updated",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.997] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "w5m-Ahx9VMm72Qg1AAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.997] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "w5m-Ahx9VMm72Qg1AAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.998] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "w5m-Ahx9VMm72Qg1AAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.998] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "w5m-Ahx9VMm72Qg1AAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.998] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "wMwUivs-Oqg_WGqIAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.998] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "wMwUivs-Oqg_WGqIAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.998] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "wMwUivs-Oqg_WGqIAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:12.998] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "wMwUivs-Oqg_WGqIAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:13.000] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "questionUid": "q-late-1"
      } Participant already answered this question. Updating answer.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:13.003] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:13.004] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:13.006] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:13.011] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:14.994] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3141",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:14.995] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "event": "correct_answers",
        "questionUid": "q-late-1",
        "correctAnswers": [
          false,
          false,
          false,
          true
        ]
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:14.996] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.002] [32mINFO [0m [GameStateService] {
        "accessCode": "3141",
        "questionUid": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.002] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.007] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "ea5ae838-e6f4-4f6a-9d26-f99206fada08"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.008] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.008] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "6aa06e66-42c9-4ab0-9aa2-1b17a2c91f2c"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.008] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "51956183-d5a2-4640-8b19-e93970d76f71"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.008] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.009] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "d5dbf81c-3848-4ed7-89bc-91e3e3d4ed50"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.009] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "c45e2394-7c21-4ad7-bbbb-164438bfc897"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.009] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.009] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.010] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "2c962360-ae7b-4827-8ab1-8c6c453d6119"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.018] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "ea5ae838-e6f4-4f6a-9d26-f99206fada08"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 1)

    console.log
      [2025-06-14 17:06:15.019] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 2)

    console.log
      [2025-06-14 17:06:15.019] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "6aa06e66-42c9-4ab0-9aa2-1b17a2c91f2c"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 3)

    console.log
      [2025-06-14 17:06:15.019] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "51956183-d5a2-4640-8b19-e93970d76f71"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 4)

    console.log
      [2025-06-14 17:06:15.019] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 5)

    console.log
      [2025-06-14 17:06:15.019] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "d5dbf81c-3848-4ed7-89bc-91e3e3d4ed50"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 6)

    console.log
      [2025-06-14 17:06:15.019] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "c45e2394-7c21-4ad7-bbbb-164438bfc897"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 7)

    console.log
      [2025-06-14 17:06:15.019] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 8)

    console.log
      [2025-06-14 17:06:15.019] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 9)

    console.log
      [2025-06-14 17:06:15.019] [33mWARN [0m [GameStateService] {
        "accessCode": "3141",
        "userId": "2c962360-ae7b-4827-8ab1-8c6c453d6119"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 10)

    console.log
      [2025-06-14 17:06:15.019] [32mINFO [0m [GameStateService] {
        "accessCode": "3141",
        "count": 12
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: {
        "leaderboard": [
          {
            "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
            "username": "p1-basic",
            "score": 980,
            "rank": 1
          },
          {
            "userId": "ea5ae838-e6f4-4f6a-9d26-f99206fada08",
            "username": "Unknown Player",
            "score": 980,
            "rank": 2
          },
          {
            "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
            "username": "Unknown Player",
            "score": 980,
            "rank": 3
          },
          {
            "userId": "6aa06e66-42c9-4ab0-9aa2-1b17a2c91f2c",
            "username": "Unknown Player",
            "score": 980,
            "rank": 4
          },
          {
            "userId": "51956183-d5a2-4640-8b19-e93970d76f71",
            "username": "Unknown Player",
            "score": 980,
            "rank": 5
          },
          {
            "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
            "username": "Unknown Player",
            "score": 980,
            "rank": 6
          },
          {
            "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
            "username": "p2-basic",
            "score": 0,
            "rank": 7
          },
          {
            "userId": "d5dbf81c-3848-4ed7-89bc-91e3e3d4ed50",
            "username": "Unknown Player",
            "score": 0,
            "rank": 8
          },
          {
            "userId": "c45e2394-7c21-4ad7-bbbb-164438bfc897",
            "username": "Unknown Player",
            "score": 0,
            "rank": 9
          },
          {
            "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
            "username": "Unknown Player",
            "score": 0,
            "rank": 10
          },
          {
            "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
            "username": "Unknown Player",
            "score": 0,
            "rank": 11
          },
          {
            "userId": "2c962360-ae7b-4827-8ab1-8c6c453d6119",
            "username": "Unknown Player",
            "score": 0,
            "rank": 12
          }
        ]
      }

      at Object.<anonymous> (tests/integration/tournament.test.ts:342:17)

    console.log
      [2025-06-14 17:06:15.032] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "gameTemplateId": "87263150-2a99-4f3d-9455-5b1e41604942",
          "playMode": "tournament",
          "discipline": "math",
          "nbOfQuestions": 1
        },
        "keys": [
          "name",
          "gameTemplateId",
          "playMode",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
          "username": "p1-basic",
          "role": "STUDENT",
          "iat": 1749913567,
          "exp": 1749917167
        },
        "headers": {
          "host": "localhost:30863",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJmMGUyMjlhNy1lYjIwLTRiNGItYWIxOS02N2FiNjUzMzhkNzUiLCJ1c2VybmFtZSI6InAxLWJhc2ljIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk5MTM1NjcsImV4cCI6MTc0OTkxNzE2N30.ncYExYDcmC7nvntaNhgpUVFLdd7JL1o31tw7Lxwig8A",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.033] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "87263150-2a99-4f3d-9455-5b1e41604942",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.040] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "2f54be8f-7508-4917-9579-ed573697e0de",
        "accessCode": "3142"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.160] [32mINFO [0m [GameParticipantService] {
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "accessCode": "3142",
        "participantId": "6bfa6f68-2f98-4817-ade1-2661fc0af621"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.169] [32mINFO [0m [GameParticipantService] {
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "accessCode": "3142",
        "participantId": "96143382-69df-4a92-8d72-21740b962c0f"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.172] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "3V6AJ6t8iKdYnty7AAAG",
        "user": {
          "id": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
          "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
          "username": "p1-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.172] [32mINFO [0m [GameHandlers] {
        "socketId": "3V6AJ6t8iKdYnty7AAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.173] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "3V6AJ6t8iKdYnty7AAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.173] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "3V6AJ6t8iKdYnty7AAAG"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 3V6AJ6t8iKdYnty7AAAG

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:06:15.173] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "3V6AJ6t8iKdYnty7AAAG"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.173] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.173] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.173] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.173] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.173] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.173] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.174] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.174] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.175] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "3V6AJ6t8iKdYnty7AAAG"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.176] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "lV7xiIul7m0d2XilAAAH",
        "user": {
          "id": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
          "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
          "username": "p2-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.176] [32mINFO [0m [GameHandlers] {
        "socketId": "lV7xiIul7m0d2XilAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.177] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "lV7xiIul7m0d2XilAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.177] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "lV7xiIul7m0d2XilAAAH"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: lV7xiIul7m0d2XilAAAH

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:06:15.177] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "lV7xiIul7m0d2XilAAAH"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.177] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.177] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.177] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.178] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.178] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.178] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.178] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.178] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.178] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "lV7xiIul7m0d2XilAAAH"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.178] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "room": "game_3142",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.179] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "room": "game_3142",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.179] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "room": "game_3142",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.179] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "room": "game_3142",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.179] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "room": "game_3142",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.179] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "room": "game_3142",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.179] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "room": "game_3142",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.179] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "room": "game_3142",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.185] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "room": "game_3142",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3142",
          "participant": {
            "id": "3V6AJ6t8iKdYnty7AAAG",
            "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
            "username": "p1-basic",
            "avatar": "üë§",
            "score": 0,
            "socketId": "3V6AJ6t8iKdYnty7AAAG",
            "online": true,
            "joinedAt": "2025-06-14T15:06:15.185Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.185] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "room": "game_3142",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3142",
          "participant": {
            "id": "3V6AJ6t8iKdYnty7AAAG",
            "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
            "username": "p1-basic",
            "avatar": "üë§",
            "score": 0,
            "socketId": "3V6AJ6t8iKdYnty7AAAG",
            "online": true,
            "joinedAt": "2025-06-14T15:06:15.185Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.186] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "room": "game_3142",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3142",
          "participant": {
            "id": "lV7xiIul7m0d2XilAAAH",
            "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
            "username": "p2-basic",
            "avatar": "üë§",
            "score": 0,
            "socketId": "lV7xiIul7m0d2XilAAAH",
            "online": true,
            "joinedAt": "2025-06-14T15:06:15.186Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.186] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "room": "game_3142",
        "playMode": "tournament",
        "gameJoinedPayload": {
          "accessCode": "3142",
          "participant": {
            "id": "lV7xiIul7m0d2XilAAAH",
            "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
            "username": "p2-basic",
            "avatar": "üë§",
            "score": 0,
            "socketId": "lV7xiIul7m0d2XilAAAH",
            "online": true,
            "joinedAt": "2025-06-14T15:06:15.186Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.187] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.187] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.188] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.188] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.201] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "2f54be8f-7508-4917-9579-ed573697e0de",
        "templateId": "87263150-2a99-4f3d-9455-5b1e41604942",
        "initiator": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "3142",
        "socketId": "3V6AJ6t8iKdYnty7AAAG"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.403] [32mINFO [0m [GameStateService] {
        "accessCode": "3142"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:15.411] [32mINFO [0m [TournamentHandler] {
        "room": "game_3142",
        "duration": 5,
        "accessCode": "3142",
        "socketId": "3V6AJ6t8iKdYnty7AAAG"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:16.503] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3141",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:16.504] [32mINFO [0m [SharedGameFlow] === BACKEND FEEDBACK PAYLOAD DEBUG === {
        "accessCode": "3141",
        "questionIndex": 0,
        "questionUid": "q-late-1",
        "questionExplanation": null,
        "explanationLength": 0,
        "explanationExists": false,
        "fullPayload": "{\"questionUid\":\"q-late-1\",\"feedbackRemaining\":2}"
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:16.505] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2,
        "hasExplanation": false
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:18.506] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3141",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:18.506] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:18.506] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141"
      } [SharedGameFlow] Game flow completed and cleaned up

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.419] [32mINFO [0m [GameStateService] {
        "accessCode": "3142"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.431] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.431] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.432] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.434] [32mINFO [0m [GameStateService] {
        "accessCode": "3142"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.434] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "room": "game_3142",
        "socketIds": [
          "3V6AJ6t8iKdYnty7AAAG",
          "lV7xiIul7m0d2XilAAAH"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.434] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.434] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3142",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "questionType": "single_correct",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "arithmetic"
            ]
          },
          "index": 0,
          "feedbackWaitTime": 2,
          "timer": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.434] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.435] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3142",
        "event": "game_timer_updated",
        "payload": {
          "questionUid": "q-late-1",
          "timer": {
            "status": "play",
            "timeLeftMs": 2000,
            "durationMs": 2000,
            "questionUid": "q-late-1",
            "timestamp": 1749913580432,
            "localTimeLeftMs": null
          }
        }
      } [DEBUG] Emitting game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.435] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "event": "game_timer_updated",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_timer_updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.436] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "3V6AJ6t8iKdYnty7AAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.436] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "3V6AJ6t8iKdYnty7AAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.436] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "3V6AJ6t8iKdYnty7AAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.436] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "3V6AJ6t8iKdYnty7AAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.436] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "lV7xiIul7m0d2XilAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.437] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "lV7xiIul7m0d2XilAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.437] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "lV7xiIul7m0d2XilAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.437] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "lV7xiIul7m0d2XilAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.438] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "questionUid": "q-late-1"
      } Participant already answered this question. Updating answer.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.441] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.442] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.442] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:20.442] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.435] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3142",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.437] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "event": "correct_answers",
        "questionUid": "q-late-1",
        "correctAnswers": [
          false,
          false,
          false,
          true
        ]
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.438] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.451] [32mINFO [0m [GameStateService] {
        "accessCode": "3142",
        "questionUid": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.451] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.453] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "ea5ae838-e6f4-4f6a-9d26-f99206fada08"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.454] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.454] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "6aa06e66-42c9-4ab0-9aa2-1b17a2c91f2c"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.454] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "51956183-d5a2-4640-8b19-e93970d76f71"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.454] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.454] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "d5dbf81c-3848-4ed7-89bc-91e3e3d4ed50"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.455] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "c45e2394-7c21-4ad7-bbbb-164438bfc897"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.455] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.455] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.456] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "2c962360-ae7b-4827-8ab1-8c6c453d6119"
      } Participant info not found in Redis for leaderboard. Attempting DB lookup for user details.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.457] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "ea5ae838-e6f4-4f6a-9d26-f99206fada08"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 1)

    console.log
      [2025-06-14 17:06:22.458] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 2)

    console.log
      [2025-06-14 17:06:22.458] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "6aa06e66-42c9-4ab0-9aa2-1b17a2c91f2c"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 3)

    console.log
      [2025-06-14 17:06:22.458] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "51956183-d5a2-4640-8b19-e93970d76f71"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 4)

    console.log
      [2025-06-14 17:06:22.458] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 5)

    console.log
      [2025-06-14 17:06:22.458] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "d5dbf81c-3848-4ed7-89bc-91e3e3d4ed50"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 6)

    console.log
      [2025-06-14 17:06:22.458] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "c45e2394-7c21-4ad7-bbbb-164438bfc897"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 7)

    console.log
      [2025-06-14 17:06:22.458] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 8)

    console.log
      [2025-06-14 17:06:22.458] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 9)

    console.log
      [2025-06-14 17:06:22.458] [33mWARN [0m [GameStateService] {
        "accessCode": "3142",
        "userId": "2c962360-ae7b-4827-8ab1-8c6c453d6119"
      } User details not found in DB for leaderboard entry.

      at log (src/utils/logger.ts:102:21)
          at async Promise.all (index 10)

    console.log
      [2025-06-14 17:06:22.458] [32mINFO [0m [GameStateService] {
        "accessCode": "3142",
        "count": 12
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: {
        "leaderboard": [
          {
            "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
            "username": "p1-basic",
            "score": 980,
            "rank": 1
          },
          {
            "userId": "ea5ae838-e6f4-4f6a-9d26-f99206fada08",
            "username": "Unknown Player",
            "score": 980,
            "rank": 2
          },
          {
            "userId": "b88a6d1d-2247-450e-ae44-2fdcd535853c",
            "username": "Unknown Player",
            "score": 980,
            "rank": 3
          },
          {
            "userId": "6aa06e66-42c9-4ab0-9aa2-1b17a2c91f2c",
            "username": "Unknown Player",
            "score": 980,
            "rank": 4
          },
          {
            "userId": "51956183-d5a2-4640-8b19-e93970d76f71",
            "username": "Unknown Player",
            "score": 980,
            "rank": 5
          },
          {
            "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
            "username": "Unknown Player",
            "score": 980,
            "rank": 6
          },
          {
            "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
            "username": "p2-basic",
            "score": 0,
            "rank": 7
          },
          {
            "userId": "d5dbf81c-3848-4ed7-89bc-91e3e3d4ed50",
            "username": "Unknown Player",
            "score": 0,
            "rank": 8
          },
          {
            "userId": "c45e2394-7c21-4ad7-bbbb-164438bfc897",
            "username": "Unknown Player",
            "score": 0,
            "rank": 9
          },
          {
            "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
            "username": "Unknown Player",
            "score": 0,
            "rank": 10
          },
          {
            "userId": "751db1a3-dd29-42b1-a0a0-fa15db974285",
            "username": "Unknown Player",
            "score": 0,
            "rank": 11
          },
          {
            "userId": "2c962360-ae7b-4827-8ab1-8c6c453d6119",
            "username": "Unknown Player",
            "score": 0,
            "rank": 12
          }
        ]
      }

      at Object.<anonymous> (tests/integration/tournament.test.ts:469:17)

    console.log
      Starting afterAll cleanup...

      at Object.<anonymous> (tests/integration/tournament.test.ts:77:17)

    console.log
      Processing socket1...

      at disconnectSocket (tests/integration/tournament.test.ts:85:21)

    console.log
      socket1 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament.test.ts:90:25)

    console.log
      socket1 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament.test.ts:100:37)

    console.log
      socket1 processing complete.

      at disconnectSocket (tests/integration/tournament.test.ts:116:21)

    console.log
      Processing socket2...

      at disconnectSocket (tests/integration/tournament.test.ts:85:21)

    console.log
      socket2 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament.test.ts:90:25)

    console.log
      socket2 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament.test.ts:100:37)

    console.log
      socket2 processing complete.

      at disconnectSocket (tests/integration/tournament.test.ts:116:21)

    console.log
      [2025-06-14 17:06:22.461] [32mINFO [0m [DisconnectHandler] {
        "socketId": "3V6AJ6t8iKdYnty7AAAG",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "accessCode": "3142",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.462] [32mINFO [0m [DisconnectHandler] {
        "socketId": "lV7xiIul7m0d2XilAAAH",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "accessCode": "3142",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.464] [32mINFO [0m [DisconnectHandler] {
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "accessCode": "3142",
        "socketId": "3V6AJ6t8iKdYnty7AAAG"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.464] [32mINFO [0m [DisconnectHandler] {
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "accessCode": "3142",
        "socketId": "lV7xiIul7m0d2XilAAAH"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.464] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
          "socketId": "3V6AJ6t8iKdYnty7AAAG"
        },
        "room": "game_3142"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.465] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
          "socketId": "lV7xiIul7m0d2XilAAAH"
        },
        "room": "game_3142"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.467] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3142",
        "gameId": "2f54be8f-7508-4917-9579-ed573697e0de",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.467] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3142",
        "gameId": "2f54be8f-7508-4917-9579-ed573697e0de",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing Socket.IO server...

      at Object.<anonymous> (tests/integration/tournament.test.ts:127:21)

    console.log
      [2025-06-14 17:06:22.963] [32mINFO [0m [DisconnectHandler] {
        "socketId": "w5m-Ahx9VMm72Qg1AAAC",
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "accessCode": "3141",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-14 17:06:22.965] [32mINFO [0m [DisconnectHandler] {
        "socketId": "wMwUivs-Oqg_WGqIAAAD",
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "accessCode": "3141",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-14 17:06:22.970] [32mINFO [0m [DisconnectHandler] {
        "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
        "accessCode": "3141",
        "socketId": "w5m-Ahx9VMm72Qg1AAAC"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.971] [32mINFO [0m [DisconnectHandler] {
        "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
        "accessCode": "3141",
        "socketId": "wMwUivs-Oqg_WGqIAAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket.IO server closed successfully.

      at Server.<anonymous> (tests/integration/tournament.test.ts:139:33)

    console.log
      Attempting to close HTTP server...

      at Object.<anonymous> (tests/integration/tournament.test.ts:147:17)

    console.log
      HTTP server was not listening. Assuming already closed or handled by Socket.IO close.

      at Object.<anonymous> (tests/integration/tournament.test.ts:167:25)

    console.log
      Waiting longer for server resources to release before closing Redis...

      at Object.<anonymous> (tests/integration/tournament.test.ts:173:17)

    console.log
      [2025-06-14 17:06:22.978] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "f0e229a7-eb20-4b4b-ab19-67ab65338d75",
          "socketId": "w5m-Ahx9VMm72Qg1AAAC"
        },
        "room": "game_3141"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.979] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "29e59413-41d4-48a0-a9a0-0aab46b06aef",
          "socketId": "wMwUivs-Oqg_WGqIAAAD"
        },
        "room": "game_3141"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.980] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3141",
        "gameId": "3f02d212-445c-4702-a541-d591bea304bc",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:22.981] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3141",
        "gameId": "3f02d212-445c-4702-a541-d591bea304bc",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:23.953] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3142",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:23.953] [32mINFO [0m [SharedGameFlow] === BACKEND FEEDBACK PAYLOAD DEBUG === {
        "accessCode": "3142",
        "questionIndex": 0,
        "questionUid": "q-late-1",
        "questionExplanation": null,
        "explanationLength": 0,
        "explanationExists": false,
        "fullPayload": "{\"questionUid\":\"q-late-1\",\"feedbackRemaining\":2}"
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:23.953] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2,
        "hasExplanation": false
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:25.955] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3142",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:25.956] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:06:25.956] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142"
      } [SharedGameFlow] Game flow completed and cleaned up

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing SocketIO Redis clients (subClient)...

      at Object.<anonymous> (tests/integration/tournament.test.ts:177:17)

    console.log
      SocketIO Redis clients closed.

      at Object.<anonymous> (tests/integration/tournament.test.ts:180:21)

    console.log
      Closing main Redis client...

      at Object.<anonymous> (tests/integration/tournament.test.ts:188:17)

    console.log
      Main Redis client quit successfully.

      at Object.<anonymous> (tests/integration/tournament.test.ts:192:25)

    console.log
      Cleaning up database...

      at Object.<anonymous> (tests/integration/tournament.test.ts:203:17)

    console.log
      Database cleanup successful.

      at Object.<anonymous> (tests/integration/tournament.test.ts:215:21)

    console.warn
      Error cleaning up Redis keys: Connection is closed.

      225 |             }
      226 |         } catch (e: any) {
    > 227 |             console.warn('Error cleaning up Redis keys:', e.message || e);
          |                     ^
      228 |         }
      229 |
      230 |         await new Promise(resolve => setTimeout(resolve, 300));

      at Object.<anonymous> (tests/integration/tournament.test.ts:227:21)

    console.log
      afterAll cleanup complete.

      at Object.<anonymous> (tests/integration/tournament.test.ts:231:17)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-14 17:06:26.934] [32mINFO [0m [SharedGameFlow] {
      "room": "game_DIFF123",
      "event": "feedback",
      "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73",
      "feedbackDisplayDuration": 5
    } [DEBUG] Emitting feedback".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:142:20)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-14 17:06:26.935] [32mINFO [0m [SharedGameFlow] === BACKEND FEEDBACK PAYLOAD DEBUG === {
      "accessCode": "DIFF123",
      "questionIndex": 0,
      "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73",
      "questionExplanation": null,
      "explanationLength": 0,
      "explanationExists": false,
      "fullPayload": "{\"questionUid\":\"2e57738e-9a3e-4221-88bc-47f7aad85f73\",\"feedbackRemaining\":5}"
    }".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:151:20)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-14 17:06:26.935] [32mINFO [0m [SharedGameFlow] {
      "accessCode": "DIFF123",
      "event": "feedback",
      "questionUid": "2e57738e-9a3e-4221-88bc-47f7aad85f73",
      "feedbackDisplayDuration": 5,
      "hasExplanation": false
    } [TRACE] Emitted feedback".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:163:20)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-14 17:06:31.937] [32mINFO [0m [SharedGameFlow] {
      "room": "game_DIFF123",
      "event": "game_end"
    } [DEBUG] Emitting game_end".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:169:16)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-14 17:06:31.940] [32mINFO [0m [SharedGameFlow] {
      "accessCode": "DIFF123",
      "event": "game_end"
    } [TRACE] Emitted game_end".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:171:16)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-14 17:06:31.941] [32mINFO [0m [SharedGameFlow] {
      "accessCode": "DIFF123"
    } [SharedGameFlow] Game flow completed and cleaned up".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:179:16)

FAIL tests/integration/tournament-creation-e2e.test.ts (71.084 s)
  ‚óè Console

    console.log
      [2025-06-14 17:06:26.939] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      === Starting Tournament Creation and Game Flow E2E Test ===

      at Object.<anonymous> (tests/integration/tournament-creation-e2e.test.ts:237:17)

    console.log
      üèÜ Tournament created in database with access code: TEST123

      at Object.<anonymous> (tests/integration/tournament-creation-e2e.test.ts:238:17)

    console.log
        Niveau: TEST

      at Object.<anonymous> (tests/integration/tournament-creation-e2e.test.ts:239:17)

    console.log
        Discipline: Math√©matiques

      at Object.<anonymous> (tests/integration/tournament-creation-e2e.test.ts:240:17)

    console.log
        Th√®mes: addition

      at Object.<anonymous> (tests/integration/tournament-creation-e2e.test.ts:241:17)

    console.log
        Number of questions: 2

      at Object.<anonymous> (tests/integration/tournament-creation-e2e.test.ts:242:17)

    console.log
      === Starting Tournament Security Validation Test ===

      at Object.<anonymous> (tests/integration/tournament-creation-e2e.test.ts:381:17)

  ‚óè Tournament Creation and Game Flow E2E Test ‚Ä∫ Create Tournament and Run Complete Game Flow

    thrown: "Exceeded timeout of 35000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      234 |     });
      235 |
    > 236 |     test('Create Tournament and Run Complete Game Flow', async () => {
          |     ^
      237 |         console.log('=== Starting Tournament Creation and Game Flow E2E Test ===');
      238 |         console.log(`üèÜ Tournament created in database with access code: ${tournamentAccessCode}`);
      239 |         console.log('  Niveau: TEST');

      at tests/integration/tournament-creation-e2e.test.ts:236:5
      at Object.<anonymous> (tests/integration/tournament-creation-e2e.test.ts:54:1)

  ‚óè Tournament Creation and Game Flow E2E Test ‚Ä∫ Tournament Security Validation - No Database Fields Exposed

    thrown: "Exceeded timeout of 35000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      378 |     });
      379 |
    > 380 |     test('Tournament Security Validation - No Database Fields Exposed', async () => {
          |     ^
      381 |         console.log('=== Starting Tournament Security Validation Test ===');
      382 |
      383 |         // Create another tournament for isolated security testing

      at tests/integration/tournament-creation-e2e.test.ts:380:5
      at Object.<anonymous> (tests/integration/tournament-creation-e2e.test.ts:54:1)


  ‚óè Test suite failed to run

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/aflesch/mathquest/app/backend/tests/integration/tournament-creation-e2e.test.ts:231:27

      228     }
      229 });
      230 
    ‚Üí 231 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `game_templates_creator_id_fkey`

      122 |
      123 | More Information: https://pris.ly/d/execute-raw
    > 124 | `)}var Co=({clientMethod:e,activeProvider:r})=>t=>{let n="",i;if(Nn(t))n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};else if(Array.isArray(t)){let[o,...s]=t;n=o,i={values:Gr(s||[]),__prismaRawParameters__:!0}}else switch(r){case"sqlite":case"mysql":{n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"cockroachdb":case"postgresql":case"postgres":{n=t.text,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"sqlserver":{n=$l(t),i={values:Gr(t.values),__prismaRawParameters__:!0};break}default:throw new Error(`The ${r} provider does not support ${e}`)}return i?.values?Ul(`prisma.${e}(${n}, ${i.values})`):Ul(`prisma.${e}(${n})`),{query:n,parameters:i}},Ql={requestArgsToMiddlewareArgs(e){return[e.strings,...e.values]},middlewareArgsToRequestArgs(e){let[r,...t]=e;return new oe(r,t)}},Gl={requestArgsToMiddlewareArgs(e){return[e]},middlewareArgsToRequestArgs(e){return e[0]}};function Ao(e){return function(t,n){let i,o=(s=e)=>{try{return s===void 0||s?.kind==="itx"?i??=Wl(t(s)):Wl(t(s))}catch(a){return Promise.reject(a)}};return{get spec(){return n},then(s,a){return o().then(s,a)},catch(s){return o().catch(s)},finally(s){return o().finally(s)},requestTransaction(s){let a=o(s);return a.requestTransaction?a.requestTransaction(s):a},[Symbol.toStringTag]:"PrismaPromise"}}}function Wl(e){return typeof e.then=="function"?e:Promise.resolve(e)}var Pf=bi.split(".")[0],Tf={isEnabled(){return!1},getTraceParent(){return"00-10-10-00"},dispatchEngineSpans(){},getActiveContext(){},runInChildSpan(e,r){return r()}},Io=class{isEnabled(){return this.getGlobalTracingHelper().isEnabled()}getTraceParent(r){return this.getGlobalTracingHelper().getTraceParent(r)}dispatchEngineSpans(r){return this.getGlobalTracingHelper().dispatchEngineSpans(r)}getActiveContext(){return this.getGlobalTracingHelper().getActiveContext()}runInChildSpan(r,t){return this.getGlobalTracingHelper().runInChildSpan(r,t)}getGlobalTracingHelper(){let r=globalThis[`V${Pf}_PRISMA_INSTRUMENTATION`],t=globalThis.PRISMA_INSTRUMENTATION;return r?.helper??t?.helper??Tf}};function Jl(){return new Io}function Hl(e,r=()=>{}){let t,n=new Promise(i=>t=i);return{then(i){return--e===0&&t(r()),i?.(n)}}}function Kl(e){return typeof e=="string"?e:e.reduce((r,t)=>{let n=typeof t=="string"?t:t.level;return n==="query"?r:r&&(t==="info"||r==="info")?"info":n},void 0)}var Jn=class{_middlewares=[];use(r){this._middlewares.push(r)}get(r){return this._middlewares[r]}has(r){return!!this._middlewares[r]}length(){return this._middlewares.length}};var zl=k(ki());function Hn(e){return typeof e.batchRequestIdx=="number"}function Yl(e){if(e.action!=="findUnique"&&e.action!=="findUniqueOrThrow")return;let r=[];return e.modelName&&r.push(e.modelName),e.query.arguments&&r.push(ko(e.query.arguments)),r.push(ko(e.query.selection)),r.join("")}function ko(e){return`(${Object.keys(e).sort().map(t=>{let n=e[t];return typeof n=="object"&&n!==null?`(${t} ${ko(n)})`:t}).join(" ")})`}var Sf={aggregate:!1,aggregateRaw:!1,createMany:!0,createManyAndReturn:!0,createOne:!0,deleteMany:!0,deleteOne:!0,executeRaw:!0,findFirst:!1,findFirstOrThrow:!1,findMany:!1,findRaw:!1,findUnique:!1,findUniqueOrThrow:!1,groupBy:!1,queryRaw:!1,runCommandRaw:!0,updateMany:!0,updateManyAndReturn:!0,updateOne:!0,upsertOne:!0};function Oo(e){return Sf[e]}var Kn=class{constructor(r){this.options=r;this.batches={}}batches;tickActive=!1;request(r){let t=this.options.batchBy(r);return t?(this.batches[t]||(this.batches[t]=[],this.tickActive||(this.tickActive=!0,process.nextTick(()=>{this.dispatchBatches(),this.tickActive=!1}))),new Promise((n,i)=>{this.batches[t].push({request:r,resolve:n,reject:i})})):this.options.singleLoader(r)}dispatchBatches(){for(let r in this.batches){let t=this.batches[r];delete this.batches[r],t.length===1?this.options.singleLoader(t[0].request).then(n=>{n instanceof Error?t[0].reject(n):t[0].resolve(n)}).catch(n=>{t[0].reject(n)}):(t.sort((n,i)=>this.options.batchOrder(n.request,i.request)),this.options.batchLoader(t.map(n=>n.request)).then(n=>{if(n instanceof Error)for(let i=0;i<t.length;i++)t[i].reject(n);else for(let i=0;i<t.length;i++){let o=n[i];o instanceof Error?t[i].reject(o):t[i].resolve(o)}}).catch(n=>{for(let i=0;i<t.length;i++)t[i].reject(n)}))}}get[Symbol.toStringTag](){return"DataLoader"}};function mr(e,r){if(r===null)return r;switch(e){case"bigint":return BigInt(r);case"bytes":{let{buffer:t,byteOffset:n,byteLength:i}=Buffer.from(r,"base64");return new Uint8Array(t,n,i)}case"decimal":return new ve(r);case"datetime":case"date":return new Date(r);case"time":return new Date(`1970-01-01T${r}Z`);case"bigint-array":return r.map(t=>mr("bigint",t));case"bytes-array":return r.map(t=>mr("bytes",t));case"decimal-array":return r.map(t=>mr("decimal",t));case"datetime-array":return r.map(t=>mr("datetime",t));case"date-array":return r.map(t=>mr("date",t));case"time-array":return r.map(t=>mr("time",t));default:return r}}function Yn(e){let r=[],t=Rf(e);for(let n=0;n<e.rows.length;n++){let i=e.rows[n],o={...t};for(let s=0;s<i.length;s++)o[e.columns[s]]=mr(e.types[s],i[s]);r.push(o)}return r}function Rf(e){let r={};for(let t=0;t<e.columns.length;t++)r[e.columns[t]]=null;return r}var Cf=N("prisma:client:request_handler"),zn=class{client;dataloader;logEmitter;constructor(r,t){this.logEmitter=t,this.client=r,this.dataloader=new Kn({batchLoader:il(async({requests:n,customDataProxyFetch:i})=>{let{transaction:o,otelParentCtx:s}=n[0],a=n.map(p=>p.protocolQuery),l=this.client._tracingHelper.getTraceParent(s),u=n.some(p=>Oo(p.protocolQuery.action));return(await this.client._engine.requestBatch(a,{traceparent:l,transaction:Af(o),containsWrite:u,customDataProxyFetch:i})).map((p,d)=>{if(p instanceof Error)return p;try{return this.mapQueryEngineResult(n[d],p)}catch(f){return f}})}),singleLoader:async n=>{let i=n.transaction?.kind==="itx"?Zl(n.transaction):void 0,o=await this.client._engine.request(n.protocolQuery,{traceparent:this.client._tracingHelper.getTraceParent(),interactiveTransaction:i,isWrite:Oo(n.protocolQuery.action),customDataProxyFetch:n.customDataProxyFetch});return this.mapQueryEngineResult(n,o)},batchBy:n=>n.transaction?.id?`transaction-${n.transaction.id}`:Yl(n.protocolQuery),batchOrder(n,i){return n.transaction?.kind==="batch"&&i.transaction?.kind==="batch"?n.transaction.index-i.transaction.index:0}})}async request(r){try{return await this.dataloader.request(r)}catch(t){let{clientMethod:n,callsite:i,transaction:o,args:s,modelName:a}=r;this.handleAndLogRequestError({error:t,clientMethod:n,callsite:i,transaction:o,args:s,modelName:a,globalOmit:r.globalOmit})}}mapQueryEngineResult({dataPath:r,unpacker:t},n){let i=n?.data,o=this.unpack(i,r,t);return process.env.PRISMA_CLIENT_GET_TIME?{data:o}:o}handleAndLogRequestError(r){try{this.handleRequestError(r)}catch(t){throw this.logEmitter&&this.logEmitter.emit("error",{message:t.message,target:r.clientMethod,timestamp:new Date}),t}}handleRequestError({error:r,clientMethod:t,callsite:n,transaction:i,args:o,modelName:s,globalOmit:a}){if(Cf(r),If(r,i))throw r;if(r instanceof z&&kf(r)){let u=Xl(r.meta);An({args:o,errors:[u],callsite:n,errorFormat:this.client._errorFormat,originalMethod:t,clientVersion:this.client._clientVersion,globalOmit:a})}let l=r.message;if(n&&(l=bn({callsite:n,originalMethod:t,isPanic:r.isPanic,showColors:this.client._errorFormat==="pretty",message:l})),l=this.sanitizeMessage(l),r.code){let u=s?{modelName:s,...r.meta}:r.meta;throw new z(l,{code:r.code,clientVersion:this.client._clientVersion,meta:u,batchRequestIdx:r.batchRequestIdx})}else{if(r.isPanic)throw new le(l,this.client._clientVersion);if(r instanceof j)throw new j(l,{clientVersion:this.client._clientVersion,batchRequestIdx:r.batchRequestIdx});if(r instanceof T)throw new T(l,this.client._clientVersion);if(r instanceof le)throw new le(l,this.client._clientVersion)}throw r.clientVersion=this.client._clientVersion,r}sanitizeMessage(r){return this.client._errorFormat&&this.client._errorFormat!=="pretty"?(0,zl.default)(r):r}unpack(r,t,n){if(!r||(r.data&&(r=r.data),!r))return r;let i=Object.keys(r)[0],o=Object.values(r)[0],s=t.filter(u=>u!=="select"&&u!=="include"),a=io(o,s),l=i==="queryRaw"?Yn(a):Tr(a);return n?n(l):l}get[Symbol.toStringTag](){return"RequestHandler"}};function Af(e){if(e){if(e.kind==="batch")return{kind:"batch",options:{isolationLevel:e.isolationLevel}};if(e.kind==="itx")return{kind:"itx",options:Zl(e)};_e(e,"Unknown transaction kind")}}function Zl(e){return{id:e.id,payload:e.payload}}function If(e,r){return Hn(e)&&r?.kind==="batch"&&e.batchRequestIdx!==r.index}function kf(e){return e.code==="P2009"||e.code==="P2012"}function Xl(e){if(e.kind==="Union")return{kind:"Union",errors:e.errors.map(Xl)};if(Array.isArray(e.selectionPath)){let[,...r]=e.selectionPath;return{...e,selectionPath:r}}return e}var eu="6.7.0";var ru=eu;var su=k(Gi());var D=class extends Error{constructor(r){super(r+`
          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ^
      125 | Read more at https://pris.ly/d/client-constructor`),this.name="PrismaClientConstructorValidationError"}get[Symbol.toStringTag](){return"PrismaClientConstructorValidationError"}};x(D,"PrismaClientConstructorValidationError");var tu=["datasources","datasourceUrl","errorFormat","adapter","log","transactionOptions","omit","__internal"],nu=["pretty","colorless","minimal"],iu=["info","query","warn","error"],Df={datasources:(e,{datasourceNames:r})=>{if(e){if(typeof e!="object"||Array.isArray(e))throw new D(`Invalid value ${JSON.stringify(e)} for "datasources" provided to PrismaClient constructor`);for(let[t,n]of Object.entries(e)){if(!r.includes(t)){let i=Wr(t,r)||` Available datasources: ${r.join(", ")}`;throw new D(`Unknown datasource ${t} provided to PrismaClient constructor.${i}`)}if(typeof n!="object"||Array.isArray(n))throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      126 | It should have this form: { url: "CONNECTION_STRING" }`);if(n&&typeof n=="object")for(let[i,o]of Object.entries(n)){if(i!=="url")throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      127 | It should have this form: { url: "CONNECTION_STRING" }`);if(typeof o!="string")throw new D(`Invalid value ${JSON.stringify(o)} for datasource "${t}" provided to PrismaClient constructor.

      at zn.handleRequestError (src/db/generated/client/runtime/library.js:124:7459)
      at zn.handleRequestError [as handleAndLogRequestError] (src/db/generated/client/runtime/library.js:124:6784)
      at zn.handleAndLogRequestError [as request] (src/db/generated/client/runtime/library.js:124:6491)
      at l (src/db/generated/client/runtime/library.js:133:9778)
      at Object.<anonymous> (tests/integration/tournament-creation-e2e.test.ts:231:9)

FAIL tests/integration/tournament-flow-e2e.test.ts
  ‚óè Console

    console.log
      [2025-06-14 17:07:38.207] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

  ‚óè Tournament Game Flow E2E Test ‚Ä∫ Complete Tournament Game Flow

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.create()` invocation in
    /home/aflesch/mathquest/app/backend/tests/integration/tournament-flow-e2e.test.ts:68:47

      65 serverCleanup = setup.cleanup;
      66 
      67 // Create test teacher
    ‚Üí 68 const testTeacher = await prisma.user.create(
    Unique constraint failed on the fields: (`email`)

      122 |
      123 | More Information: https://pris.ly/d/execute-raw
    > 124 | `)}var Co=({clientMethod:e,activeProvider:r})=>t=>{let n="",i;if(Nn(t))n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};else if(Array.isArray(t)){let[o,...s]=t;n=o,i={values:Gr(s||[]),__prismaRawParameters__:!0}}else switch(r){case"sqlite":case"mysql":{n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"cockroachdb":case"postgresql":case"postgres":{n=t.text,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"sqlserver":{n=$l(t),i={values:Gr(t.values),__prismaRawParameters__:!0};break}default:throw new Error(`The ${r} provider does not support ${e}`)}return i?.values?Ul(`prisma.${e}(${n}, ${i.values})`):Ul(`prisma.${e}(${n})`),{query:n,parameters:i}},Ql={requestArgsToMiddlewareArgs(e){return[e.strings,...e.values]},middlewareArgsToRequestArgs(e){let[r,...t]=e;return new oe(r,t)}},Gl={requestArgsToMiddlewareArgs(e){return[e]},middlewareArgsToRequestArgs(e){return e[0]}};function Ao(e){return function(t,n){let i,o=(s=e)=>{try{return s===void 0||s?.kind==="itx"?i??=Wl(t(s)):Wl(t(s))}catch(a){return Promise.reject(a)}};return{get spec(){return n},then(s,a){return o().then(s,a)},catch(s){return o().catch(s)},finally(s){return o().finally(s)},requestTransaction(s){let a=o(s);return a.requestTransaction?a.requestTransaction(s):a},[Symbol.toStringTag]:"PrismaPromise"}}}function Wl(e){return typeof e.then=="function"?e:Promise.resolve(e)}var Pf=bi.split(".")[0],Tf={isEnabled(){return!1},getTraceParent(){return"00-10-10-00"},dispatchEngineSpans(){},getActiveContext(){},runInChildSpan(e,r){return r()}},Io=class{isEnabled(){return this.getGlobalTracingHelper().isEnabled()}getTraceParent(r){return this.getGlobalTracingHelper().getTraceParent(r)}dispatchEngineSpans(r){return this.getGlobalTracingHelper().dispatchEngineSpans(r)}getActiveContext(){return this.getGlobalTracingHelper().getActiveContext()}runInChildSpan(r,t){return this.getGlobalTracingHelper().runInChildSpan(r,t)}getGlobalTracingHelper(){let r=globalThis[`V${Pf}_PRISMA_INSTRUMENTATION`],t=globalThis.PRISMA_INSTRUMENTATION;return r?.helper??t?.helper??Tf}};function Jl(){return new Io}function Hl(e,r=()=>{}){let t,n=new Promise(i=>t=i);return{then(i){return--e===0&&t(r()),i?.(n)}}}function Kl(e){return typeof e=="string"?e:e.reduce((r,t)=>{let n=typeof t=="string"?t:t.level;return n==="query"?r:r&&(t==="info"||r==="info")?"info":n},void 0)}var Jn=class{_middlewares=[];use(r){this._middlewares.push(r)}get(r){return this._middlewares[r]}has(r){return!!this._middlewares[r]}length(){return this._middlewares.length}};var zl=k(ki());function Hn(e){return typeof e.batchRequestIdx=="number"}function Yl(e){if(e.action!=="findUnique"&&e.action!=="findUniqueOrThrow")return;let r=[];return e.modelName&&r.push(e.modelName),e.query.arguments&&r.push(ko(e.query.arguments)),r.push(ko(e.query.selection)),r.join("")}function ko(e){return`(${Object.keys(e).sort().map(t=>{let n=e[t];return typeof n=="object"&&n!==null?`(${t} ${ko(n)})`:t}).join(" ")})`}var Sf={aggregate:!1,aggregateRaw:!1,createMany:!0,createManyAndReturn:!0,createOne:!0,deleteMany:!0,deleteOne:!0,executeRaw:!0,findFirst:!1,findFirstOrThrow:!1,findMany:!1,findRaw:!1,findUnique:!1,findUniqueOrThrow:!1,groupBy:!1,queryRaw:!1,runCommandRaw:!0,updateMany:!0,updateManyAndReturn:!0,updateOne:!0,upsertOne:!0};function Oo(e){return Sf[e]}var Kn=class{constructor(r){this.options=r;this.batches={}}batches;tickActive=!1;request(r){let t=this.options.batchBy(r);return t?(this.batches[t]||(this.batches[t]=[],this.tickActive||(this.tickActive=!0,process.nextTick(()=>{this.dispatchBatches(),this.tickActive=!1}))),new Promise((n,i)=>{this.batches[t].push({request:r,resolve:n,reject:i})})):this.options.singleLoader(r)}dispatchBatches(){for(let r in this.batches){let t=this.batches[r];delete this.batches[r],t.length===1?this.options.singleLoader(t[0].request).then(n=>{n instanceof Error?t[0].reject(n):t[0].resolve(n)}).catch(n=>{t[0].reject(n)}):(t.sort((n,i)=>this.options.batchOrder(n.request,i.request)),this.options.batchLoader(t.map(n=>n.request)).then(n=>{if(n instanceof Error)for(let i=0;i<t.length;i++)t[i].reject(n);else for(let i=0;i<t.length;i++){let o=n[i];o instanceof Error?t[i].reject(o):t[i].resolve(o)}}).catch(n=>{for(let i=0;i<t.length;i++)t[i].reject(n)}))}}get[Symbol.toStringTag](){return"DataLoader"}};function mr(e,r){if(r===null)return r;switch(e){case"bigint":return BigInt(r);case"bytes":{let{buffer:t,byteOffset:n,byteLength:i}=Buffer.from(r,"base64");return new Uint8Array(t,n,i)}case"decimal":return new ve(r);case"datetime":case"date":return new Date(r);case"time":return new Date(`1970-01-01T${r}Z`);case"bigint-array":return r.map(t=>mr("bigint",t));case"bytes-array":return r.map(t=>mr("bytes",t));case"decimal-array":return r.map(t=>mr("decimal",t));case"datetime-array":return r.map(t=>mr("datetime",t));case"date-array":return r.map(t=>mr("date",t));case"time-array":return r.map(t=>mr("time",t));default:return r}}function Yn(e){let r=[],t=Rf(e);for(let n=0;n<e.rows.length;n++){let i=e.rows[n],o={...t};for(let s=0;s<i.length;s++)o[e.columns[s]]=mr(e.types[s],i[s]);r.push(o)}return r}function Rf(e){let r={};for(let t=0;t<e.columns.length;t++)r[e.columns[t]]=null;return r}var Cf=N("prisma:client:request_handler"),zn=class{client;dataloader;logEmitter;constructor(r,t){this.logEmitter=t,this.client=r,this.dataloader=new Kn({batchLoader:il(async({requests:n,customDataProxyFetch:i})=>{let{transaction:o,otelParentCtx:s}=n[0],a=n.map(p=>p.protocolQuery),l=this.client._tracingHelper.getTraceParent(s),u=n.some(p=>Oo(p.protocolQuery.action));return(await this.client._engine.requestBatch(a,{traceparent:l,transaction:Af(o),containsWrite:u,customDataProxyFetch:i})).map((p,d)=>{if(p instanceof Error)return p;try{return this.mapQueryEngineResult(n[d],p)}catch(f){return f}})}),singleLoader:async n=>{let i=n.transaction?.kind==="itx"?Zl(n.transaction):void 0,o=await this.client._engine.request(n.protocolQuery,{traceparent:this.client._tracingHelper.getTraceParent(),interactiveTransaction:i,isWrite:Oo(n.protocolQuery.action),customDataProxyFetch:n.customDataProxyFetch});return this.mapQueryEngineResult(n,o)},batchBy:n=>n.transaction?.id?`transaction-${n.transaction.id}`:Yl(n.protocolQuery),batchOrder(n,i){return n.transaction?.kind==="batch"&&i.transaction?.kind==="batch"?n.transaction.index-i.transaction.index:0}})}async request(r){try{return await this.dataloader.request(r)}catch(t){let{clientMethod:n,callsite:i,transaction:o,args:s,modelName:a}=r;this.handleAndLogRequestError({error:t,clientMethod:n,callsite:i,transaction:o,args:s,modelName:a,globalOmit:r.globalOmit})}}mapQueryEngineResult({dataPath:r,unpacker:t},n){let i=n?.data,o=this.unpack(i,r,t);return process.env.PRISMA_CLIENT_GET_TIME?{data:o}:o}handleAndLogRequestError(r){try{this.handleRequestError(r)}catch(t){throw this.logEmitter&&this.logEmitter.emit("error",{message:t.message,target:r.clientMethod,timestamp:new Date}),t}}handleRequestError({error:r,clientMethod:t,callsite:n,transaction:i,args:o,modelName:s,globalOmit:a}){if(Cf(r),If(r,i))throw r;if(r instanceof z&&kf(r)){let u=Xl(r.meta);An({args:o,errors:[u],callsite:n,errorFormat:this.client._errorFormat,originalMethod:t,clientVersion:this.client._clientVersion,globalOmit:a})}let l=r.message;if(n&&(l=bn({callsite:n,originalMethod:t,isPanic:r.isPanic,showColors:this.client._errorFormat==="pretty",message:l})),l=this.sanitizeMessage(l),r.code){let u=s?{modelName:s,...r.meta}:r.meta;throw new z(l,{code:r.code,clientVersion:this.client._clientVersion,meta:u,batchRequestIdx:r.batchRequestIdx})}else{if(r.isPanic)throw new le(l,this.client._clientVersion);if(r instanceof j)throw new j(l,{clientVersion:this.client._clientVersion,batchRequestIdx:r.batchRequestIdx});if(r instanceof T)throw new T(l,this.client._clientVersion);if(r instanceof le)throw new le(l,this.client._clientVersion)}throw r.clientVersion=this.client._clientVersion,r}sanitizeMessage(r){return this.client._errorFormat&&this.client._errorFormat!=="pretty"?(0,zl.default)(r):r}unpack(r,t,n){if(!r||(r.data&&(r=r.data),!r))return r;let i=Object.keys(r)[0],o=Object.values(r)[0],s=t.filter(u=>u!=="select"&&u!=="include"),a=io(o,s),l=i==="queryRaw"?Yn(a):Tr(a);return n?n(l):l}get[Symbol.toStringTag](){return"RequestHandler"}};function Af(e){if(e){if(e.kind==="batch")return{kind:"batch",options:{isolationLevel:e.isolationLevel}};if(e.kind==="itx")return{kind:"itx",options:Zl(e)};_e(e,"Unknown transaction kind")}}function Zl(e){return{id:e.id,payload:e.payload}}function If(e,r){return Hn(e)&&r?.kind==="batch"&&e.batchRequestIdx!==r.index}function kf(e){return e.code==="P2009"||e.code==="P2012"}function Xl(e){if(e.kind==="Union")return{kind:"Union",errors:e.errors.map(Xl)};if(Array.isArray(e.selectionPath)){let[,...r]=e.selectionPath;return{...e,selectionPath:r}}return e}var eu="6.7.0";var ru=eu;var su=k(Gi());var D=class extends Error{constructor(r){super(r+`
          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ^
      125 | Read more at https://pris.ly/d/client-constructor`),this.name="PrismaClientConstructorValidationError"}get[Symbol.toStringTag](){return"PrismaClientConstructorValidationError"}};x(D,"PrismaClientConstructorValidationError");var tu=["datasources","datasourceUrl","errorFormat","adapter","log","transactionOptions","omit","__internal"],nu=["pretty","colorless","minimal"],iu=["info","query","warn","error"],Df={datasources:(e,{datasourceNames:r})=>{if(e){if(typeof e!="object"||Array.isArray(e))throw new D(`Invalid value ${JSON.stringify(e)} for "datasources" provided to PrismaClient constructor`);for(let[t,n]of Object.entries(e)){if(!r.includes(t)){let i=Wr(t,r)||` Available datasources: ${r.join(", ")}`;throw new D(`Unknown datasource ${t} provided to PrismaClient constructor.${i}`)}if(typeof n!="object"||Array.isArray(n))throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      126 | It should have this form: { url: "CONNECTION_STRING" }`);if(n&&typeof n=="object")for(let[i,o]of Object.entries(n)){if(i!=="url")throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      127 | It should have this form: { url: "CONNECTION_STRING" }`);if(typeof o!="string")throw new D(`Invalid value ${JSON.stringify(o)} for datasource "${t}" provided to PrismaClient constructor.

      at zn.handleRequestError (src/db/generated/client/runtime/library.js:124:7459)
      at zn.handleRequestError [as handleAndLogRequestError] (src/db/generated/client/runtime/library.js:124:6784)
      at zn.handleAndLogRequestError [as request] (src/db/generated/client/runtime/library.js:124:6491)
      at l (src/db/generated/client/runtime/library.js:133:9778)
      at Object.<anonymous> (tests/integration/tournament-flow-e2e.test.ts:68:29)

  ‚óè Tournament Game Flow E2E Test ‚Ä∫ Tournament Security Validation - No Database Fields Exposed

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.create()` invocation in
    /home/aflesch/mathquest/app/backend/tests/integration/tournament-flow-e2e.test.ts:68:47

      65 serverCleanup = setup.cleanup;
      66 
      67 // Create test teacher
    ‚Üí 68 const testTeacher = await prisma.user.create(
    Unique constraint failed on the fields: (`email`)

      122 |
      123 | More Information: https://pris.ly/d/execute-raw
    > 124 | `)}var Co=({clientMethod:e,activeProvider:r})=>t=>{let n="",i;if(Nn(t))n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};else if(Array.isArray(t)){let[o,...s]=t;n=o,i={values:Gr(s||[]),__prismaRawParameters__:!0}}else switch(r){case"sqlite":case"mysql":{n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"cockroachdb":case"postgresql":case"postgres":{n=t.text,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"sqlserver":{n=$l(t),i={values:Gr(t.values),__prismaRawParameters__:!0};break}default:throw new Error(`The ${r} provider does not support ${e}`)}return i?.values?Ul(`prisma.${e}(${n}, ${i.values})`):Ul(`prisma.${e}(${n})`),{query:n,parameters:i}},Ql={requestArgsToMiddlewareArgs(e){return[e.strings,...e.values]},middlewareArgsToRequestArgs(e){let[r,...t]=e;return new oe(r,t)}},Gl={requestArgsToMiddlewareArgs(e){return[e]},middlewareArgsToRequestArgs(e){return e[0]}};function Ao(e){return function(t,n){let i,o=(s=e)=>{try{return s===void 0||s?.kind==="itx"?i??=Wl(t(s)):Wl(t(s))}catch(a){return Promise.reject(a)}};return{get spec(){return n},then(s,a){return o().then(s,a)},catch(s){return o().catch(s)},finally(s){return o().finally(s)},requestTransaction(s){let a=o(s);return a.requestTransaction?a.requestTransaction(s):a},[Symbol.toStringTag]:"PrismaPromise"}}}function Wl(e){return typeof e.then=="function"?e:Promise.resolve(e)}var Pf=bi.split(".")[0],Tf={isEnabled(){return!1},getTraceParent(){return"00-10-10-00"},dispatchEngineSpans(){},getActiveContext(){},runInChildSpan(e,r){return r()}},Io=class{isEnabled(){return this.getGlobalTracingHelper().isEnabled()}getTraceParent(r){return this.getGlobalTracingHelper().getTraceParent(r)}dispatchEngineSpans(r){return this.getGlobalTracingHelper().dispatchEngineSpans(r)}getActiveContext(){return this.getGlobalTracingHelper().getActiveContext()}runInChildSpan(r,t){return this.getGlobalTracingHelper().runInChildSpan(r,t)}getGlobalTracingHelper(){let r=globalThis[`V${Pf}_PRISMA_INSTRUMENTATION`],t=globalThis.PRISMA_INSTRUMENTATION;return r?.helper??t?.helper??Tf}};function Jl(){return new Io}function Hl(e,r=()=>{}){let t,n=new Promise(i=>t=i);return{then(i){return--e===0&&t(r()),i?.(n)}}}function Kl(e){return typeof e=="string"?e:e.reduce((r,t)=>{let n=typeof t=="string"?t:t.level;return n==="query"?r:r&&(t==="info"||r==="info")?"info":n},void 0)}var Jn=class{_middlewares=[];use(r){this._middlewares.push(r)}get(r){return this._middlewares[r]}has(r){return!!this._middlewares[r]}length(){return this._middlewares.length}};var zl=k(ki());function Hn(e){return typeof e.batchRequestIdx=="number"}function Yl(e){if(e.action!=="findUnique"&&e.action!=="findUniqueOrThrow")return;let r=[];return e.modelName&&r.push(e.modelName),e.query.arguments&&r.push(ko(e.query.arguments)),r.push(ko(e.query.selection)),r.join("")}function ko(e){return`(${Object.keys(e).sort().map(t=>{let n=e[t];return typeof n=="object"&&n!==null?`(${t} ${ko(n)})`:t}).join(" ")})`}var Sf={aggregate:!1,aggregateRaw:!1,createMany:!0,createManyAndReturn:!0,createOne:!0,deleteMany:!0,deleteOne:!0,executeRaw:!0,findFirst:!1,findFirstOrThrow:!1,findMany:!1,findRaw:!1,findUnique:!1,findUniqueOrThrow:!1,groupBy:!1,queryRaw:!1,runCommandRaw:!0,updateMany:!0,updateManyAndReturn:!0,updateOne:!0,upsertOne:!0};function Oo(e){return Sf[e]}var Kn=class{constructor(r){this.options=r;this.batches={}}batches;tickActive=!1;request(r){let t=this.options.batchBy(r);return t?(this.batches[t]||(this.batches[t]=[],this.tickActive||(this.tickActive=!0,process.nextTick(()=>{this.dispatchBatches(),this.tickActive=!1}))),new Promise((n,i)=>{this.batches[t].push({request:r,resolve:n,reject:i})})):this.options.singleLoader(r)}dispatchBatches(){for(let r in this.batches){let t=this.batches[r];delete this.batches[r],t.length===1?this.options.singleLoader(t[0].request).then(n=>{n instanceof Error?t[0].reject(n):t[0].resolve(n)}).catch(n=>{t[0].reject(n)}):(t.sort((n,i)=>this.options.batchOrder(n.request,i.request)),this.options.batchLoader(t.map(n=>n.request)).then(n=>{if(n instanceof Error)for(let i=0;i<t.length;i++)t[i].reject(n);else for(let i=0;i<t.length;i++){let o=n[i];o instanceof Error?t[i].reject(o):t[i].resolve(o)}}).catch(n=>{for(let i=0;i<t.length;i++)t[i].reject(n)}))}}get[Symbol.toStringTag](){return"DataLoader"}};function mr(e,r){if(r===null)return r;switch(e){case"bigint":return BigInt(r);case"bytes":{let{buffer:t,byteOffset:n,byteLength:i}=Buffer.from(r,"base64");return new Uint8Array(t,n,i)}case"decimal":return new ve(r);case"datetime":case"date":return new Date(r);case"time":return new Date(`1970-01-01T${r}Z`);case"bigint-array":return r.map(t=>mr("bigint",t));case"bytes-array":return r.map(t=>mr("bytes",t));case"decimal-array":return r.map(t=>mr("decimal",t));case"datetime-array":return r.map(t=>mr("datetime",t));case"date-array":return r.map(t=>mr("date",t));case"time-array":return r.map(t=>mr("time",t));default:return r}}function Yn(e){let r=[],t=Rf(e);for(let n=0;n<e.rows.length;n++){let i=e.rows[n],o={...t};for(let s=0;s<i.length;s++)o[e.columns[s]]=mr(e.types[s],i[s]);r.push(o)}return r}function Rf(e){let r={};for(let t=0;t<e.columns.length;t++)r[e.columns[t]]=null;return r}var Cf=N("prisma:client:request_handler"),zn=class{client;dataloader;logEmitter;constructor(r,t){this.logEmitter=t,this.client=r,this.dataloader=new Kn({batchLoader:il(async({requests:n,customDataProxyFetch:i})=>{let{transaction:o,otelParentCtx:s}=n[0],a=n.map(p=>p.protocolQuery),l=this.client._tracingHelper.getTraceParent(s),u=n.some(p=>Oo(p.protocolQuery.action));return(await this.client._engine.requestBatch(a,{traceparent:l,transaction:Af(o),containsWrite:u,customDataProxyFetch:i})).map((p,d)=>{if(p instanceof Error)return p;try{return this.mapQueryEngineResult(n[d],p)}catch(f){return f}})}),singleLoader:async n=>{let i=n.transaction?.kind==="itx"?Zl(n.transaction):void 0,o=await this.client._engine.request(n.protocolQuery,{traceparent:this.client._tracingHelper.getTraceParent(),interactiveTransaction:i,isWrite:Oo(n.protocolQuery.action),customDataProxyFetch:n.customDataProxyFetch});return this.mapQueryEngineResult(n,o)},batchBy:n=>n.transaction?.id?`transaction-${n.transaction.id}`:Yl(n.protocolQuery),batchOrder(n,i){return n.transaction?.kind==="batch"&&i.transaction?.kind==="batch"?n.transaction.index-i.transaction.index:0}})}async request(r){try{return await this.dataloader.request(r)}catch(t){let{clientMethod:n,callsite:i,transaction:o,args:s,modelName:a}=r;this.handleAndLogRequestError({error:t,clientMethod:n,callsite:i,transaction:o,args:s,modelName:a,globalOmit:r.globalOmit})}}mapQueryEngineResult({dataPath:r,unpacker:t},n){let i=n?.data,o=this.unpack(i,r,t);return process.env.PRISMA_CLIENT_GET_TIME?{data:o}:o}handleAndLogRequestError(r){try{this.handleRequestError(r)}catch(t){throw this.logEmitter&&this.logEmitter.emit("error",{message:t.message,target:r.clientMethod,timestamp:new Date}),t}}handleRequestError({error:r,clientMethod:t,callsite:n,transaction:i,args:o,modelName:s,globalOmit:a}){if(Cf(r),If(r,i))throw r;if(r instanceof z&&kf(r)){let u=Xl(r.meta);An({args:o,errors:[u],callsite:n,errorFormat:this.client._errorFormat,originalMethod:t,clientVersion:this.client._clientVersion,globalOmit:a})}let l=r.message;if(n&&(l=bn({callsite:n,originalMethod:t,isPanic:r.isPanic,showColors:this.client._errorFormat==="pretty",message:l})),l=this.sanitizeMessage(l),r.code){let u=s?{modelName:s,...r.meta}:r.meta;throw new z(l,{code:r.code,clientVersion:this.client._clientVersion,meta:u,batchRequestIdx:r.batchRequestIdx})}else{if(r.isPanic)throw new le(l,this.client._clientVersion);if(r instanceof j)throw new j(l,{clientVersion:this.client._clientVersion,batchRequestIdx:r.batchRequestIdx});if(r instanceof T)throw new T(l,this.client._clientVersion);if(r instanceof le)throw new le(l,this.client._clientVersion)}throw r.clientVersion=this.client._clientVersion,r}sanitizeMessage(r){return this.client._errorFormat&&this.client._errorFormat!=="pretty"?(0,zl.default)(r):r}unpack(r,t,n){if(!r||(r.data&&(r=r.data),!r))return r;let i=Object.keys(r)[0],o=Object.values(r)[0],s=t.filter(u=>u!=="select"&&u!=="include"),a=io(o,s),l=i==="queryRaw"?Yn(a):Tr(a);return n?n(l):l}get[Symbol.toStringTag](){return"RequestHandler"}};function Af(e){if(e){if(e.kind==="batch")return{kind:"batch",options:{isolationLevel:e.isolationLevel}};if(e.kind==="itx")return{kind:"itx",options:Zl(e)};_e(e,"Unknown transaction kind")}}function Zl(e){return{id:e.id,payload:e.payload}}function If(e,r){return Hn(e)&&r?.kind==="batch"&&e.batchRequestIdx!==r.index}function kf(e){return e.code==="P2009"||e.code==="P2012"}function Xl(e){if(e.kind==="Union")return{kind:"Union",errors:e.errors.map(Xl)};if(Array.isArray(e.selectionPath)){let[,...r]=e.selectionPath;return{...e,selectionPath:r}}return e}var eu="6.7.0";var ru=eu;var su=k(Gi());var D=class extends Error{constructor(r){super(r+`
          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ^
      125 | Read more at https://pris.ly/d/client-constructor`),this.name="PrismaClientConstructorValidationError"}get[Symbol.toStringTag](){return"PrismaClientConstructorValidationError"}};x(D,"PrismaClientConstructorValidationError");var tu=["datasources","datasourceUrl","errorFormat","adapter","log","transactionOptions","omit","__internal"],nu=["pretty","colorless","minimal"],iu=["info","query","warn","error"],Df={datasources:(e,{datasourceNames:r})=>{if(e){if(typeof e!="object"||Array.isArray(e))throw new D(`Invalid value ${JSON.stringify(e)} for "datasources" provided to PrismaClient constructor`);for(let[t,n]of Object.entries(e)){if(!r.includes(t)){let i=Wr(t,r)||` Available datasources: ${r.join(", ")}`;throw new D(`Unknown datasource ${t} provided to PrismaClient constructor.${i}`)}if(typeof n!="object"||Array.isArray(n))throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      126 | It should have this form: { url: "CONNECTION_STRING" }`);if(n&&typeof n=="object")for(let[i,o]of Object.entries(n)){if(i!=="url")throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      127 | It should have this form: { url: "CONNECTION_STRING" }`);if(typeof o!="string")throw new D(`Invalid value ${JSON.stringify(o)} for datasource "${t}" provided to PrismaClient constructor.

      at zn.handleRequestError (src/db/generated/client/runtime/library.js:124:7459)
      at zn.handleRequestError [as handleAndLogRequestError] (src/db/generated/client/runtime/library.js:124:6784)
      at zn.handleAndLogRequestError [as request] (src/db/generated/client/runtime/library.js:124:6491)
      at l (src/db/generated/client/runtime/library.js:133:9778)
      at Object.<anonymous> (tests/integration/tournament-flow-e2e.test.ts:68:29)

FAIL tests/integration/gameFlow-e2e.test.ts (90.647 s)
  ‚óè Console

    console.log
      [2025-06-14 17:07:39.305] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      === Starting Complete Game Flow E2E Test ===

      at Object.<anonymous> (tests/integration/gameFlow-e2e.test.ts:220:17)

    console.log
      === Starting Security Validation Test ===

      at Object.<anonymous> (tests/integration/gameFlow-e2e.test.ts:357:17)

    console.log
      === Starting Timer Integration Test ===

      at Object.<anonymous> (tests/integration/gameFlow-e2e.test.ts:422:17)

  ‚óè Game Flow E2E Test ‚Ä∫ Complete Game Flow - Security, Timer, Answers, Feedback

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      217 |     });
      218 |
    > 219 |     test('Complete Game Flow - Security, Timer, Answers, Feedback', async () => {
          |     ^
      220 |         console.log('=== Starting Complete Game Flow E2E Test ===');
      221 |
      222 |         // Connect sockets

      at tests/integration/gameFlow-e2e.test.ts:219:5
      at Object.<anonymous> (tests/integration/gameFlow-e2e.test.ts:55:1)

  ‚óè Game Flow E2E Test ‚Ä∫ Security Validation - Raw Database Objects Not Exposed

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      354 |     });
      355 |
    > 356 |     test('Security Validation - Raw Database Objects Not Exposed', async () => {
          |     ^
      357 |         console.log('=== Starting Security Validation Test ===');
      358 |
      359 |         // Connect sockets

      at tests/integration/gameFlow-e2e.test.ts:356:5
      at Object.<anonymous> (tests/integration/gameFlow-e2e.test.ts:55:1)

  ‚óè Game Flow E2E Test ‚Ä∫ Timer Integration and State Management

    thrown: "Exceeded timeout of 30000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      419 |     });
      420 |
    > 421 |     test('Timer Integration and State Management', async () => {
          |     ^
      422 |         console.log('=== Starting Timer Integration Test ===');
      423 |
      424 |         studentSocket.connect();

      at tests/integration/gameFlow-e2e.test.ts:421:5
      at Object.<anonymous> (tests/integration/gameFlow-e2e.test.ts:55:1)

PASS tests/unit/gameParticipantService.test.ts
FAIL tests/integration/teacherQuiz.test.ts
  ‚óè Console

    console.log
      [2025-06-14 17:09:10.374] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      Creating game template with payload: {
        name: 'My First Quiz Template',
        discipline: 'math',
        gradeLevel: 'middle',
        themes: [ 'arithmetic' ],
        questions: [ { questionUid: 'test-q-quiz-1', sequence: 1 } ]
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:96:17)

    console.log
      [2025-06-14 17:09:10.441] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjMTFlYjAwNS1iNTdjLTQ3ZjUtYTIwYy04NThjOTZhOWVjZWEiLCJ1c2VybmFtZSI6InF1aXpUZWFjaGVyIiwicm9sZSI6IlRFQUNIRVIiLCJpYXQiOjE3NDk5MTM3NTAsImV4cCI6MTc0OTkxNzM1MH0.q6Q6l84Dp_7MP_BFdJ7FqH8jYrlAIfyXy6f4q-HLyLk"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:10.442] [31mERROR[0m [Server] {
        "error": {
          "issues": [
            {
              "code": "invalid_type",
              "expected": "array",
              "received": "undefined",
              "path": [
                "questionUids"
              ],
              "message": "Required"
            }
          ],
          "name": "ZodError"
        }
      } Unexpected validation error

      at log (src/utils/logger.ts:102:21)

    console.log
      Game template response status: 500

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:113:17)

    console.log
      Game template response body: { error: 'Internal validation error', success: false }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:114:17)

  ‚óè Teacher-driven Quiz Flow ‚Ä∫ should have initialized sockets, created entities, and teacher/player joined

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 500

      113 |         console.log('Game template response status:', quizTemplateRes.status);
      114 |         console.log('Game template response body:', quizTemplateRes.body);
    > 115 |         expect(quizTemplateRes.status).toBe(201);
          |                                        ^
      116 |         quizTemplate = quizTemplateRes.body.gameTemplate;
      117 |         expect(quizTemplate).toBeDefined(); // Add this check
      118 |

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:115:40)

  ‚óè Teacher-driven Quiz Flow ‚Ä∫ teacher should be able to set a question, and player receives it

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 500

      113 |         console.log('Game template response status:', quizTemplateRes.status);
      114 |         console.log('Game template response body:', quizTemplateRes.body);
    > 115 |         expect(quizTemplateRes.status).toBe(201);
          |                                        ^
      116 |         quizTemplate = quizTemplateRes.body.gameTemplate;
      117 |         expect(quizTemplate).toBeDefined(); // Add this check
      118 |

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:115:40)

  ‚óè Teacher-driven Quiz Flow ‚Ä∫ should allow teacher to control timer using quiz_timer_action

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 500

      113 |         console.log('Game template response status:', quizTemplateRes.status);
      114 |         console.log('Game template response body:', quizTemplateRes.body);
    > 115 |         expect(quizTemplateRes.status).toBe(201);
          |                                        ^
      116 |         quizTemplate = quizTemplateRes.body.gameTemplate;
      117 |         expect(quizTemplate).toBeDefined(); // Add this check
      118 |

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:115:40)

PASS tests/unit/questionService.test.ts
PASS tests/integration/lobbyDebug.test.ts
  ‚óè Console

    console.log
      [2025-06-14 17:09:11.230] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      üîß Starting debug test...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:191:17)

    console.log
      üîå Connecting socket...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:227:21)

    console.log
      [2025-06-14 17:09:11.322] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "4-H4KY-xU8TYmMAwAAAB",
        "user": {
          "id": "player-123",
          "userId": "player-123",
          "username": "Test Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.329] [32mINFO [0m [GameHandlers] {
        "socketId": "4-H4KY-xU8TYmMAwAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.329] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "4-H4KY-xU8TYmMAwAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.330] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "4-H4KY-xU8TYmMAwAAAB"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 4-H4KY-xU8TYmMAwAAAB

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:09:11.330] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "4-H4KY-xU8TYmMAwAAAB"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.331] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.331] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.331] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.331] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.332] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.332] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.332] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.332] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.332] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "4-H4KY-xU8TYmMAwAAAB"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      ‚úÖ Socket connected

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:233:29)

    console.log
      üì° Received event: connection_established [
        {
          socketId: '4-H4KY-xU8TYmMAwAAAB',
          timestamp: '2025-06-14T15:09:11.323Z',
          user: { role: 'STUDENT', userId: 'player-123', username: 'Test Player' }
        }
      ]

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:223:21)

    console.log
      üè† Joining lobby...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:250:21)

    console.log
      üì§ Sent join_lobby event with full payload

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:257:21)

    console.log
      [2025-06-14 17:09:11.335] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-123",
        "username": "Test Player",
        "socketId": "4-H4KY-xU8TYmMAwAAAB"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      üì° Received event: room_joined [ { room: 'lobby_TEST123', timestamp: '2025-06-14T15:09:11.344Z' } ]

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:223:21)

    console.log
      üì° Received event: participants_list [
        {
          participants: [ [Object] ],
          gameId: 'd7a08407-e336-439b-8186-b4afba0858b1',
          gameName: 'Test Game Debug'
        }
      ]

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:223:21)

    console.log
      ‚úÖ Received event: participants_list {
        participants: [
          {
            id: '4-H4KY-xU8TYmMAwAAAB',
            userId: 'player-123',
            username: 'Test Player',
            avatarEmoji: 'üòä',
            joinedAt: 1749913751344
          }
        ],
        gameId: 'd7a08407-e336-439b-8186-b4afba0858b1',
        gameName: 'Test Game Debug'
      }

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:208:21)

    console.log
      [2025-06-14 17:09:11.350] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d7a08407-e336-439b-8186-b4afba0858b1",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.351] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      ‚úÖ Got participants list: {
        participants: [
          {
            id: '4-H4KY-xU8TYmMAwAAAB',
            userId: 'player-123',
            username: 'Test Player',
            avatarEmoji: 'üòä',
            joinedAt: 1749913751344
          }
        ],
        gameId: 'd7a08407-e336-439b-8186-b4afba0858b1',
        gameName: 'Test Game Debug'
      }

      at Timeout.<anonymous> (tests/integration/lobbyDebug.test.ts:264:33)

    console.log
      üîç Checking participantsResponse is defined...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:275:21)

    console.log
      ‚úÖ participantsResponse is defined

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:277:21)

    console.log
      üîç Checking participantsResponse.participants is defined...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:278:21)

    console.log
      ‚úÖ participantsResponse.participants is defined

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:280:21)

    console.log
      üîç Checking participants length is 1...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:281:21)

    console.log
      Actual length: 1

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:282:21)

    console.log
      ‚úÖ participants length is correct

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:284:21)

    console.log
      üîç Checking first participant username...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:285:21)

    console.log
      Actual username: Test Player

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:286:21)

    console.log
      ‚úÖ username is correct

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:288:21)

    console.log
      üö™ Leaving lobby...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:290:21)

    console.log
      üì§ Sent leave_lobby event

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:292:21)

    console.log
      [2025-06-14 17:09:11.437] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "4-H4KY-xU8TYmMAwAAAB"
      } Player leaving lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      üì° Received event: room_left [ { room: 'lobby_TEST123', timestamp: '2025-06-14T15:09:11.438Z' } ]

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:223:21)

    console.log
      ‚úÖ Received event: room_left { room: 'lobby_TEST123', timestamp: '2025-06-14T15:09:11.438Z' }

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:217:21)

    console.log
      üì° Received event: room_left [ { accessCode: 'TEST123' } ]

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:223:21)

    console.log
      ‚úÖ Received event: room_left { accessCode: 'TEST123' }

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:217:21)

    console.log
      [2025-06-14 17:09:11.442] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d7a08407-e336-439b-8186-b4afba0858b1",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.442] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Stopped game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      ‚úÖ Got room_left event

      at Timeout.<anonymous> (tests/integration/lobbyDebug.test.ts:299:33)

    console.log
      üìã Getting updated participants list...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:310:21)

    console.log
      üì§ Sent get_participants event

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:312:21)

    console.log
      üì° Received event: room_joined [ { room: 'lobby_TEST123', timestamp: '2025-06-14T15:09:11.539Z' } ]

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:223:21)

    console.log
      üì° Received event: participants_list [
        {
          participants: [],
          gameId: 'd7a08407-e336-439b-8186-b4afba0858b1',
          gameName: 'Test Game Debug'
        }
      ]

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:223:21)

    console.log
      ‚úÖ Received event: participants_list {
        participants: [],
        gameId: 'd7a08407-e336-439b-8186-b4afba0858b1',
        gameName: 'Test Game Debug'
      }

      at Socket.<anonymous> (tests/integration/lobbyDebug.test.ts:208:21)

    console.log
      ‚úÖ Got updated participants list: {
        participants: [],
        gameId: 'd7a08407-e336-439b-8186-b4afba0858b1',
        gameName: 'Test Game Debug'
      }

      at Timeout.<anonymous> (tests/integration/lobbyDebug.test.ts:319:33)

    console.log
      üîç Checking updatedParticipantsResponse is defined...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:330:21)

    console.log
      ‚úÖ updatedParticipantsResponse is defined

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:332:21)

    console.log
      üîç Checking updatedParticipantsResponse.participants is defined...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:333:21)

    console.log
      ‚úÖ updatedParticipantsResponse.participants is defined

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:335:21)

    console.log
      üîç Checking updated participants length is 0...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:336:21)

    console.log
      Actual updated length: 0

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:337:21)

    console.log
      ‚úÖ updated participants length is correct

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:339:21)

    console.log
      üîß Debug test completed successfully!

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:341:21)

    console.log
      üßπ Disconnecting socket...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:344:21)

    console.log
      [2025-06-14 17:09:11.640] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "4-H4KY-xU8TYmMAwAAAB"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.641] [32mINFO [0m [DisconnectHandler] {
        "socketId": "4-H4KY-xU8TYmMAwAAAB",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.641] [33mWARN [0m [DisconnectHandler] {
        "socketId": "4-H4KY-xU8TYmMAwAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:11.646] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d7a08407-e336-439b-8186-b4afba0858b1",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      ‚úÖ Socket disconnected and cleanup waited

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:349:21)

    console.log
      üßπ [afterAll] Calling serverCleanup...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:148:21)

    console.log
      ‚úÖ [afterAll] serverCleanup completed.

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:150:21)

    console.log
      üßπ [afterAll] Closing Socket.IO Redis clients...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:164:21)

    console.log
      ‚úÖ [afterAll] Socket.IO Redis clients closed.

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:166:21)

    console.log
      üßπ [afterAll] Quitting Redis client...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:173:21)

    console.log
      ‚úÖ [afterAll] Redis client quit.

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:175:21)

    console.log
      üßπ [afterAll] Disconnecting Prisma client...

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:180:21)

    console.log
      ‚úÖ [afterAll] Prisma client disconnected.

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:182:21)

    console.log
      üèÅ [afterAll] Cleanup finished.

      at Object.<anonymous> (tests/integration/lobbyDebug.test.ts:185:17)

FAIL tests/integration/gamesApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:83:13)

    console.log
      [2025-06-14 17:09:13.350] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:13.361] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:13.365] [31mERROR[0m [Server] {
        "error": {
          "issues": [
            {
              "validation": "uuid",
              "code": "invalid_string",
              "message": "Invalid game template ID",
              "path": [
                "gameTemplateId"
              ]
            }
          ],
          "name": "ZodError"
        }
      } Unexpected validation error

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:13.376] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Missing Fields",
          "playMode": "quiz"
        },
        "keys": [
          "name",
          "playMode"
        ],
        "user": {
          "userId": "teacher-123",
          "username": "testteacher",
          "role": "TEACHER"
        },
        "headers": {
          "host": "127.0.0.1:39615",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "content-length": "43",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:13.377] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Missing Fields",
        "playMode": "quiz",
        "nameCheck": true,
        "templateIdCheck": false,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:13.379] [31mERROR[0m [Server] {
        "error": {
          "issues": [
            {
              "validation": "uuid",
              "code": "invalid_string",
              "message": "Invalid game template ID",
              "path": [
                "gameTemplateId"
              ]
            },
            {
              "received": "invalid-mode",
              "code": "invalid_enum_value",
              "options": [
                "quiz",
                "tournament",
                "practice",
                "class"
              ],
              "path": [
                "playMode"
              ],
              "message": "Invalid enum value. Expected 'quiz' | 'tournament' | 'practice' | 'class', received 'invalid-mode'"
            }
          ],
          "name": "ZodError"
        }
      } Unexpected validation error

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:13.391] [31mERROR[0m [Server] {
        "error": {
          "issues": [
            {
              "validation": "uuid",
              "code": "invalid_string",
              "message": "Invalid user ID",
              "path": [
                "userId"
              ]
            }
          ],
          "name": "ZodError"
        }
      } Unexpected validation error

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:13.393] [31mERROR[0m [Server] {
        "error": {
          "issues": [
            {
              "code": "invalid_type",
              "expected": "string",
              "received": "undefined",
              "path": [
                "userId"
              ],
              "message": "Required"
            }
          ],
          "name": "ZodError"
        }
      } Unexpected validation error

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:13.396] [31mERROR[0m [Server] {
        "error": {
          "issues": [
            {
              "validation": "uuid",
              "code": "invalid_string",
              "message": "Invalid user ID",
              "path": [
                "userId"
              ]
            }
          ],
          "name": "ZodError"
        }
      } Unexpected validation error

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:13.402] [31mERROR[0m [Server] {
        "error": {
          "issues": [
            {
              "expected": "'pending' | 'active' | 'paused' | 'completed' | 'archived'",
              "received": "undefined",
              "code": "invalid_type",
              "path": [
                "status"
              ],
              "message": "Required"
            }
          ],
          "name": "ZodError"
        }
      } Unexpected validation error

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:13.405] [31mERROR[0m [Server] {
        "error": {
          "issues": [
            {
              "received": "invalid-status",
              "code": "invalid_enum_value",
              "options": [
                "pending",
                "active",
                "paused",
                "completed",
                "archived"
              ],
              "path": [
                "status"
              ],
              "message": "Invalid enum value. Expected 'pending' | 'active' | 'paused' | 'completed' | 'archived', received 'invalid-status'"
            }
          ],
          "name": "ZodError"
        }
      } Unexpected validation error

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG response: 200 application/json; charset=utf-8 {"games":[{"id":"game-1","status":"pending","name":"Game 1"},{"id":"game-2","status":"active","name":"Game 2"}]}

      at Object.<anonymous> (tests/integration/gamesApi.test.ts:376:21)

  ‚óè Games API Integration Tests ‚Ä∫ POST /api/v1/games ‚Ä∫ should create a game instance successfully

    expected 201 "Created", got 500 "Internal Server Error"

      87 |                 .send(gameData)
      88 |                 .expect('Content-Type', /json/)
    > 89 |                 .expect(201);
         |                  ^
      90 |
      91 |             expect(mockGameInstanceService.createGameInstanceUnified).toHaveBeenCalledWith(
      92 |                 expect.objectContaining({

      at Object.<anonymous> (tests/integration/gamesApi.test.ts:89:18)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)
      at node_modules/supertest/lib/test.js:323:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)
      at Test.assert (node_modules/supertest/lib/test.js:179:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:135:14)

  ‚óè Games API Integration Tests ‚Ä∫ POST /api/v1/games ‚Ä∫ should return 400 if playMode is invalid

    expected 400 "Bad Request", got 500 "Internal Server Error"

      128 |                 .send(invalidData)
      129 |                 .expect('Content-Type', /json/)
    > 130 |                 .expect(400);
          |                  ^
      131 |
      132 |             expect(response.body.error).toBe('Invalid or missing playMode value');
      133 |             expect(mockGameInstanceService.createGameInstance).not.toHaveBeenCalled();

      at Object.<anonymous> (tests/integration/gamesApi.test.ts:130:18)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)
      at node_modules/supertest/lib/test.js:323:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)
      at Test.assert (node_modules/supertest/lib/test.js:179:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:135:14)

  ‚óè Games API Integration Tests ‚Ä∫ POST /api/v1/games/:accessCode/join ‚Ä∫ should allow player to join a game

    expected 200 "OK", got 500 "Internal Server Error"

      226 |                 .send({ userId })
      227 |                 .expect('Content-Type', /json/)
    > 228 |                 .expect(200);
          |                  ^
      229 |
      230 |             expect(mockGameParticipantService.joinGame).toHaveBeenCalledWith(userId, accessCode);
      231 |             expect(response.body).toEqual(mockJoinResult);

      at Object.<anonymous> (tests/integration/gamesApi.test.ts:228:18)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)
      at node_modules/supertest/lib/test.js:323:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)
      at Test.assert (node_modules/supertest/lib/test.js:179:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:135:14)

  ‚óè Games API Integration Tests ‚Ä∫ POST /api/v1/games/:accessCode/join ‚Ä∫ should return 400 if player ID is missing

    expected 400 "Bad Request", got 500 "Internal Server Error"

      239 |                 .send({}) // No userId
      240 |                 .expect('Content-Type', /json/)
    > 241 |                 .expect(400);
          |                  ^
      242 |
      243 |             expect(response.body.error).toBe('Player ID is required');
      244 |             expect(mockGameParticipantService.joinGame).not.toHaveBeenCalled();

      at Object.<anonymous> (tests/integration/gamesApi.test.ts:241:18)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)
      at node_modules/supertest/lib/test.js:323:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)
      at Test.assert (node_modules/supertest/lib/test.js:179:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:135:14)

  ‚óè Games API Integration Tests ‚Ä∫ POST /api/v1/games/:accessCode/join ‚Ä∫ should return error if joining fails

    expected 400 "Bad Request", got 500 "Internal Server Error"

      260 |                 .send({ userId })
      261 |                 .expect('Content-Type', /json/)
    > 262 |                 .expect(400);
          |                  ^
      263 |
      264 |             expect(response.body.error).toBe('Game not found');
      265 |         });

      at Object.<anonymous> (tests/integration/gamesApi.test.ts:262:18)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)
      at node_modules/supertest/lib/test.js:323:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)
      at Test.assert (node_modules/supertest/lib/test.js:179:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:135:14)

  ‚óè Games API Integration Tests ‚Ä∫ PUT /api/v1/games/:id/status ‚Ä∫ should return 400 if status is missing

    expected 400 "Bad Request", got 500 "Internal Server Error"

      306 |                 .send({ currentQuestionIndex: 1 }) // No status
      307 |                 .expect('Content-Type', /json/)
    > 308 |                 .expect(400);
          |                  ^
      309 |
      310 |             expect(response.body.error).toBe('Status is required');
      311 |             expect(mockGameInstanceService.updateGameStatus).not.toHaveBeenCalled();

      at Object.<anonymous> (tests/integration/gamesApi.test.ts:308:18)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)
      at node_modules/supertest/lib/test.js:323:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)
      at Test.assert (node_modules/supertest/lib/test.js:179:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:135:14)

  ‚óè Games API Integration Tests ‚Ä∫ PUT /api/v1/games/:id/status ‚Ä∫ should return 400 if status is invalid

    expected 400 "Bad Request", got 500 "Internal Server Error"

      319 |                 .send({ status: 'invalid-status' })
      320 |                 .expect('Content-Type', /json/)
    > 321 |                 .expect(400);
          |                  ^
      322 |
      323 |             expect(response.body.error).toBe('Invalid status value');
      324 |             expect(mockGameInstanceService.updateGameStatus).not.toHaveBeenCalled();

      at Object.<anonymous> (tests/integration/gamesApi.test.ts:321:18)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)
      at node_modules/supertest/lib/test.js:323:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)
      at Test.assert (node_modules/supertest/lib/test.js:179:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:135:14)

FAIL tests/integration/questionApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:83:13)

    console.log
      [2025-06-14 17:09:13.998] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.007] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.010] [31mERROR[0m [Server] {
        "error": {
          "issues": [
            {
              "code": "invalid_type",
              "expected": "string",
              "received": "undefined",
              "path": [
                "defaultMode"
              ],
              "message": "Required"
            },
            {
              "code": "invalid_type",
              "expected": "string",
              "received": "undefined",
              "path": [
                "correctAnswer"
              ],
              "message": "Required"
            }
          ],
          "name": "ZodError"
        }
      } Unexpected validation error

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.014] [31mERROR[0m [Server] {
        "error": {
          "issues": [
            {
              "code": "invalid_type",
              "expected": "string",
              "received": "undefined",
              "path": [
                "text"
              ],
              "message": "Required"
            },
            {
              "code": "invalid_type",
              "expected": "string",
              "received": "undefined",
              "path": [
                "defaultMode"
              ],
              "message": "Required"
            },
            {
              "code": "invalid_type",
              "expected": "string",
              "received": "undefined",
              "path": [
                "discipline"
              ],
              "message": "Required"
            },
            {
              "code": "invalid_type",
              "expected": "string",
              "received": "undefined",
              "path": [
                "correctAnswer"
              ],
              "message": "Required"
            }
          ],
          "name": "ZodError"
        }
      } Unexpected validation error

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.025] [32mINFO [0m [QuestionsAPI] Returning 2 questions for API request

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.027] [32mINFO [0m [QuestionsAPI] First question sample: {
        "uid": "question-1",
        "title": "Question 1",
        "createdAt": "2025-06-14T15:09:14.024Z",
        "updatedAt": "2025-06-14T15:09:14.024Z",
        "text": "What is 1+1?",
        "answerOptions": [],
        "correctAnswers": [],
        "questionType": "multiple_choice_single_answer",
        "discipline": "math",
        "themes": [
          "arithmetic"
        ],
        "gradeLevel": "6th Grade",
        "difficulty": 1,
        "author": "Test Author",
        "sourceName": "Test Source",
        "sourceUrl": null,
        "associatedImageUrl": null,
        "isHidden": false,
        "explanation": "This is an explanation",
        "tags": [],
        "timeLimit": 60
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.034] [31mERROR[0m [QuestionsAPI] {
        "error": {}
      } Error updating question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.043] [31mERROR[0m [QuestionsAPI] {
        "error": {}
      } Error deleting question

      at log (src/utils/logger.ts:102:21)

  ‚óè Question API Integration Tests ‚Ä∫ POST /api/v1/questions ‚Ä∫ should create a question successfully

    expected 201 "Created", got 500 "Internal Server Error"

      84 |                 .send(questionData)
      85 |                 .expect('Content-Type', /json/)
    > 86 |                 .expect(201);
         |                  ^
      87 |
      88 |             expect(mockQuestionService.createQuestion).toHaveBeenCalledWith(
      89 |                 'teacher-123',

      at Object.<anonymous> (tests/integration/questionApi.test.ts:86:18)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)
      at node_modules/supertest/lib/test.js:323:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)
      at Test.assert (node_modules/supertest/lib/test.js:179:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:135:14)

  ‚óè Question API Integration Tests ‚Ä∫ POST /api/v1/questions ‚Ä∫ should return 400 if required fields are missing

    expected 400 "Bad Request", got 500 "Internal Server Error"

      111 |                 .send(incompleteData)
      112 |                 .expect('Content-Type', /json/)
    > 113 |                 .expect(400);
          |                  ^
      114 |
      115 |             expect(response.body.error).toBe('Required fields missing');
      116 |             expect(mockQuestionService.createQuestion).not.toHaveBeenCalled();

      at Object.<anonymous> (tests/integration/questionApi.test.ts:113:18)
      ----
      at Test._assertStatus (node_modules/supertest/lib/test.js:267:14)
      at node_modules/supertest/lib/test.js:323:13
      at Test._assertFunction (node_modules/supertest/lib/test.js:300:13)
      at Test.assert (node_modules/supertest/lib/test.js:179:23)
      at Server.localAssert (node_modules/supertest/lib/test.js:135:14)

  ‚óè Question API Integration Tests ‚Ä∫ PUT /api/v1/questions/:uid ‚Ä∫ should update a question successfully

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "difficulty": 2,
        "title": "Updated Question",
        "uid": "question-123",
      },

    Number of calls: 1

      332 |                 .expect(200);
      333 |
    > 334 |             expect(mockQuestionService.updateQuestion).toHaveBeenCalledWith({
          |                                                        ^
      335 |                 uid: 'question-123',
      336 |                 ...updateData
      337 |             } as any);

      at Object.<anonymous> (tests/integration/questionApi.test.ts:334:56)

  ‚óè Question API Integration Tests ‚Ä∫ DELETE /api/v1/questions/:uid ‚Ä∫ should delete a question successfully

    expect(received).toEqual(expected) // deep equality

    - Expected  - 0
    + Received  + 1

      Object {
    +   "message": "Question deleted successfully",
        "success": true,
      }

      369 |
      370 |             expect(mockQuestionService.deleteQuestion).toHaveBeenCalledWith('question-123');
    > 371 |             expect(response.body).toEqual({ success: true });
          |                                   ^
      372 |         });
      373 |
      374 |         it('should return 404 if question to delete is not found', async () => {

      at Object.<anonymous> (tests/integration/questionApi.test.ts:371:35)

PASS tests/unit/quizTemplateService.test.ts
PASS tests/integration/lobbyHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-14 17:09:14.673] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.739] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "uu_7Gh_xDNUiabD6AAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.740] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "uu_7Gh_xDNUiabD6AAAB",
        "user": {
          "id": "player-123",
          "userId": "player-123",
          "username": "Test Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.744] [32mINFO [0m [GameHandlers] {
        "socketId": "uu_7Gh_xDNUiabD6AAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.744] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "uu_7Gh_xDNUiabD6AAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.745] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "uu_7Gh_xDNUiabD6AAAB"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: uu_7Gh_xDNUiabD6AAAB

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:09:14.745] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "uu_7Gh_xDNUiabD6AAAB"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.745] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.745] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.745] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.745] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.745] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.745] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.745] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.746] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.746] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "uu_7Gh_xDNUiabD6AAAB"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.752] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-123",
        "username": "Test Player",
        "socketId": "uu_7Gh_xDNUiabD6AAAB"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.756] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "uu_7Gh_xDNUiabD6AAAB"
      } Player leaving lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.756] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.757] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.759] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.759] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Stopped game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.768] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "uu_7Gh_xDNUiabD6AAAB"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.768] [32mINFO [0m [DisconnectHandler] {
        "socketId": "uu_7Gh_xDNUiabD6AAAB",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.768] [33mWARN [0m [DisconnectHandler] {
        "socketId": "uu_7Gh_xDNUiabD6AAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.774] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.775] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "friDUG4zW2owZ9S9AAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.776] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "friDUG4zW2owZ9S9AAAE",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.776] [32mINFO [0m [GameHandlers] {
        "socketId": "friDUG4zW2owZ9S9AAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.776] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "friDUG4zW2owZ9S9AAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.776] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "friDUG4zW2owZ9S9AAAE"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: friDUG4zW2owZ9S9AAAE

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:09:14.776] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "friDUG4zW2owZ9S9AAAE"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.776] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.777] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.777] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.777] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.777] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.777] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.777] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.777] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.777] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "friDUG4zW2owZ9S9AAAE"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.779] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "GV9DC0DKCKfs0OXcAAAG"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.779] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "GV9DC0DKCKfs0OXcAAAG",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.779] [32mINFO [0m [GameHandlers] {
        "socketId": "GV9DC0DKCKfs0OXcAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.779] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "GV9DC0DKCKfs0OXcAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.779] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "GV9DC0DKCKfs0OXcAAAG"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: GV9DC0DKCKfs0OXcAAAG

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:09:14.779] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "GV9DC0DKCKfs0OXcAAAG"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.779] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.779] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.780] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.780] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.780] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.780] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.780] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.780] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.780] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "GV9DC0DKCKfs0OXcAAAG"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.781] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "MzQqyaLwqJMu1_EqAAAH"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.781] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "MzQqyaLwqJMu1_EqAAAH",
        "user": {
          "id": "player-3",
          "userId": "player-3",
          "username": "Player 3",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.781] [32mINFO [0m [GameHandlers] {
        "socketId": "MzQqyaLwqJMu1_EqAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.782] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "MzQqyaLwqJMu1_EqAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.782] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "MzQqyaLwqJMu1_EqAAAH"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: MzQqyaLwqJMu1_EqAAAH

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:09:14.782] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "MzQqyaLwqJMu1_EqAAAH"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.782] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.782] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.782] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.782] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.782] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.782] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.782] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.782] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.782] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "MzQqyaLwqJMu1_EqAAAH"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.783] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-1",
        "username": "Player 1",
        "socketId": "friDUG4zW2owZ9S9AAAE"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.787] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-2",
        "username": "Player 2",
        "socketId": "GV9DC0DKCKfs0OXcAAAG"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.787] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.787] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.789] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-3",
        "username": "Player 3",
        "socketId": "MzQqyaLwqJMu1_EqAAAH"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.790] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2",
        "lobbyCount": 2,
        "gameCount": 0,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.790] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.796] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2",
        "lobbyCount": 3,
        "gameCount": 0,
        "totalCount": 3
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.797] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.797] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "friDUG4zW2owZ9S9AAAE"
      } Player leaving lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.801] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "MzQqyaLwqJMu1_EqAAAH"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.801] [32mINFO [0m [DisconnectHandler] {
        "socketId": "MzQqyaLwqJMu1_EqAAAH",
        "userId": "player-3",
        "accessCode": "TEST123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.802] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.802] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Stopped game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.802] [32mINFO [0m [DisconnectHandler] {
        "socketId": "friDUG4zW2owZ9S9AAAE",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.802] [33mWARN [0m [DisconnectHandler] {
        "socketId": "friDUG4zW2owZ9S9AAAE",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.802] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "GV9DC0DKCKfs0OXcAAAG"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.803] [32mINFO [0m [DisconnectHandler] {
        "socketId": "GV9DC0DKCKfs0OXcAAAG",
        "userId": "player-2",
        "accessCode": "TEST123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.831] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-3",
        "accessCode": "TEST123",
        "disconnectedSocketId": "MzQqyaLwqJMu1_EqAAAH",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.831] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TEST123",
        "disconnectedSocketId": "GV9DC0DKCKfs0OXcAAAG",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.836] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "KaXU3Px49nWjzjw1AAAJ"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.836] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "KaXU3Px49nWjzjw1AAAJ",
        "user": {
          "id": "player-redirect-test",
          "userId": "player-redirect-test",
          "username": "Redirect Test",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.836] [32mINFO [0m [GameHandlers] {
        "socketId": "KaXU3Px49nWjzjw1AAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.836] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "KaXU3Px49nWjzjw1AAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.836] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "KaXU3Px49nWjzjw1AAAJ"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: KaXU3Px49nWjzjw1AAAJ

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:09:14.837] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "KaXU3Px49nWjzjw1AAAJ"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.837] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.837] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.837] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.837] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.837] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.837] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.837] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.837] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.838] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "KaXU3Px49nWjzjw1AAAJ"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.838] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.838] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.839] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-redirect-test",
        "username": "Redirect Test",
        "socketId": "KaXU3Px49nWjzjw1AAAJ"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.844] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:14.844] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.850] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2"
      } Game became active, notifying lobby participants

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.862] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "KaXU3Px49nWjzjw1AAAJ"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.862] [32mINFO [0m [DisconnectHandler] {
        "socketId": "KaXU3Px49nWjzjw1AAAJ",
        "userId": "player-redirect-test",
        "accessCode": "TEST123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.870] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-redirect-test",
        "accessCode": "TEST123",
        "disconnectedSocketId": "KaXU3Px49nWjzjw1AAAJ",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.873] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.874] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "mqyTHTJoOBVV-67iAAAM"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.874] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "mqyTHTJoOBVV-67iAAAM",
        "user": {
          "id": "player-d1",
          "userId": "player-d1",
          "username": "Disconnect Test 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.874] [32mINFO [0m [GameHandlers] {
        "socketId": "mqyTHTJoOBVV-67iAAAM"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.874] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "mqyTHTJoOBVV-67iAAAM"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.874] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "mqyTHTJoOBVV-67iAAAM"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: mqyTHTJoOBVV-67iAAAM

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:09:16.875] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "mqyTHTJoOBVV-67iAAAM"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.875] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.875] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.875] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.875] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.875] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.875] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.875] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.875] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.875] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "mqyTHTJoOBVV-67iAAAM"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.877] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "AS2Ieqq_6CJYt6qmAAAN"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.877] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "AS2Ieqq_6CJYt6qmAAAN",
        "user": {
          "id": "player-d2",
          "userId": "player-d2",
          "username": "Disconnect Test 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.877] [32mINFO [0m [GameHandlers] {
        "socketId": "AS2Ieqq_6CJYt6qmAAAN"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.877] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "AS2Ieqq_6CJYt6qmAAAN"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.877] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "AS2Ieqq_6CJYt6qmAAAN"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: AS2Ieqq_6CJYt6qmAAAN

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:09:16.877] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "AS2Ieqq_6CJYt6qmAAAN"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.877] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.877] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.878] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.878] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.878] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.878] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.878] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.878] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.878] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "AS2Ieqq_6CJYt6qmAAAN"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.878] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-d1",
        "username": "Disconnect Test 1",
        "socketId": "mqyTHTJoOBVV-67iAAAM"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.879] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-d2",
        "username": "Disconnect Test 2",
        "socketId": "AS2Ieqq_6CJYt6qmAAAN"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.884] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "mqyTHTJoOBVV-67iAAAM"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.884] [32mINFO [0m [DisconnectHandler] {
        "socketId": "mqyTHTJoOBVV-67iAAAM",
        "userId": "player-d1",
        "accessCode": "TEST123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.885] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.885] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.885] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.885] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.886] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-d1",
        "accessCode": "TEST123",
        "disconnectedSocketId": "mqyTHTJoOBVV-67iAAAM",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.888] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:16.888] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "mqyTHTJoOBVV-67iAAAM",
        "userId": "player-d1",
        "username": "Disconnect Test 1"
      } Participant disconnected from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.190] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "AS2Ieqq_6CJYt6qmAAAN"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.191] [32mINFO [0m [DisconnectHandler] {
        "socketId": "AS2Ieqq_6CJYt6qmAAAN",
        "userId": "player-d2",
        "accessCode": "TEST123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.193] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-d2",
        "accessCode": "TEST123",
        "disconnectedSocketId": "AS2Ieqq_6CJYt6qmAAAN",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.195] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TEST123",
        "gameId": "d5fa6730-ddf4-4205-8de2-c3e3b33454f2",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

FAIL tests/integration/quizTemplateApi.test.ts (240.296 s)
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:83:13)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:09:17.704] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.706] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.707] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.708] [31mERROR[0m [Server] {
        "error": {
          "issues": [
            {
              "code": "invalid_type",
              "expected": "array",
              "received": "undefined",
              "path": [
                "questionUids"
              ],
              "message": "Required"
            }
          ],
          "name": "ZodError"
        }
      } Unexpected validation error

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:09:17.722] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.723] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.724] [31mERROR[0m [Server] {
        "error": {
          "issues": [
            {
              "code": "invalid_type",
              "expected": "array",
              "received": "undefined",
              "path": [
                "questionUids"
              ],
              "message": "Required"
            }
          ],
          "name": "ZodError"
        }
      } Unexpected validation error

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:09:17.727] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.728] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.728] [31mERROR[0m [Server] {
        "error": {
          "issues": [
            {
              "code": "invalid_type",
              "expected": "string",
              "received": "undefined",
              "path": [
                "name"
              ],
              "message": "Required"
            },
            {
              "code": "invalid_type",
              "expected": "array",
              "received": "undefined",
              "path": [
                "questionUids"
              ],
              "message": "Required"
            }
          ],
          "name": "ZodError"
        }
      } Unexpected validation error

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:09:17.731] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.731] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:09:17.733] [32mINFO [0m [Auth] {
        "authHeader": "Bearer invalid-token"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.734] [31mERROR[0m [Auth] {
        "error": {
          "name": "JsonWebTokenError",
          "message": "jwt malformed"
        }
      } Authentication error

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:09:17.735] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.737] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:09:17.740] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.740] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:09:17.742] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.743] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:09:17.749] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.750] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:09:17.752] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.753] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:09:17.754] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.755] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:09:17.758] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:09:17.760] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:10:17.761] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:10:17.765] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:11:17.764] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:11:17.765] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:11:17.769] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:11:17.771] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:12:17.775] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:12:17.777] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5OTEzNzU3LCJleHAiOjE3NDk5MTczNTd9.oUJTCXQp008rwzRp-8l36XbIkXa47zj31-vfob3S3jY

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-14 17:13:17.774] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:17.775] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

  ‚óè /api/v1/quiz-templates ‚Ä∫ POST /api/v1/quiz-templates ‚Ä∫ should create a quiz template successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 500

      91 |                 .send(quizData);
      92 |
    > 93 |             expect(response.status).toBe(201);
         |                                     ^
      94 |             expect(response.body.gameTemplate).toEqual(mockFullGameTemplate);
      95 |             expect(mockGameTemplateServiceInstance.creategameTemplate).toHaveBeenCalledTimes(1);
      96 |             expect(mockGameTemplateServiceInstance.creategameTemplate).toHaveBeenCalledWith('teacher-1', quizData);

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:93:37)

  ‚óè /api/v1/quiz-templates ‚Ä∫ POST /api/v1/quiz-templates ‚Ä∫ should create a quiz template successfully (alternative test)

    expect(received).toBe(expected) // Object.is equality

    Expected: 201
    Received: 500

      105 |                 .send(quizData);
      106 |
    > 107 |             expect(response.status).toBe(201);
          |                                     ^
      108 |             expect(response.body.gameTemplate).toEqual(mockFullGameTemplate);
      109 |             expect(mockGameTemplateServiceInstance.creategameTemplate).toHaveBeenCalledTimes(1);
      110 |             expect(mockGameTemplateServiceInstance.creategameTemplate).toHaveBeenCalledWith('teacher-1', quizData);

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:107:37)

  ‚óè /api/v1/quiz-templates ‚Ä∫ POST /api/v1/quiz-templates ‚Ä∫ should return 400 if required fields are missing

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      116 |                 .set('Authorization', `Bearer ${teacherToken}`)
      117 |                 .send({});
    > 118 |             expect(response.status).toBe(400);
          |                                     ^
      119 |             expect(response.body.error).toBe('Required fields missing');
      120 |             expect(response.body.required).toEqual(expect.arrayContaining(['name', 'themes']));
      121 |         });

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:118:37)

  ‚óè /api/v1/quiz-templates ‚Ä∫ PUT /api/v1/quiz-templates/:id ‚Ä∫ should update a quiz template successfully

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      202 |         const updateData = { name: 'Updated Quiz Template' };
      203 |
    > 204 |         it('should update a quiz template successfully', async () => {
          |         ^
      205 |             const updatedTemplate = { ...mockFullGameTemplate, ...updateData, name: updateData.name! };
      206 |             (mockGameTemplateServiceInstance.updategameTemplate as jest.Mock).mockResolvedValue(updatedTemplate);
      207 |             const response = await requestApp

      at tests/integration/quizTemplateApi.test.ts:204:9
      at tests/integration/quizTemplateApi.test.ts:201:5
      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:36:1)

  ‚óè /api/v1/quiz-templates ‚Ä∫ PUT /api/v1/quiz-templates/:id ‚Ä∫ should return 404 if template not found for update

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      214 |         });
      215 |
    > 216 |         it('should return 404 if template not found for update', async () => {
          |         ^
      217 |             (mockGameTemplateServiceInstance.updategameTemplate as jest.Mock).mockImplementation(async () => {
      218 |                 throw new Error("Quiz template with ID non-existent-id not found or you don't have permission to update it");
      219 |             });

      at tests/integration/quizTemplateApi.test.ts:216:9
      at tests/integration/quizTemplateApi.test.ts:201:5
      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:36:1)

  ‚óè /api/v1/quiz-templates ‚Ä∫ DELETE /api/v1/quiz-templates/:id ‚Ä∫ should delete a quiz template successfully

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      236 |
      237 |     describe('DELETE /api/v1/quiz-templates/:id', () => {
    > 238 |         it('should delete a quiz template successfully', async () => {
          |         ^
      239 |             (mockGameTemplateServiceInstance.deletegameTemplate as jest.Mock).mockResolvedValue(undefined);
      240 |
      241 |             const response = await requestApp

      at tests/integration/quizTemplateApi.test.ts:238:9
      at tests/integration/quizTemplateApi.test.ts:237:5
      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:36:1)

  ‚óè /api/v1/quiz-templates ‚Ä∫ DELETE /api/v1/quiz-templates/:id ‚Ä∫ should return 404 if template not found for deletion

    thrown: "Exceeded timeout of 60000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      247 |         });
      248 |
    > 249 |         it('should return 404 if template not found for deletion', async () => {
          |         ^
      250 |             (mockGameTemplateServiceInstance.deletegameTemplate as jest.Mock).mockImplementation(async () => {
      251 |                 throw new Error("Quiz template with ID non-existent-id not found or you don't have permission to delete it");
      252 |             });

      at tests/integration/quizTemplateApi.test.ts:249:9
      at tests/integration/quizTemplateApi.test.ts:237:5
      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:36:1)

FAIL tests/unit/gameInstanceService.test.ts
  ‚óè GameInstanceService ‚Ä∫ createGameInstance ‚Ä∫ should handle errors during game instance creation

    expect(received).rejects.toThrow(expected)

    Expected message: "Database error"
    Received message: "Unable to generate unique access code"

          380 |         } catch (error) {
          381 |             logger.error('Error generating access code:', error);
        > 382 |             throw new Error('Unable to generate unique access code');
              |                   ^
          383 |         }
          384 |     }
          385 |

      at GameInstanceService.generateUniqueAccessCode (src/core/services/gameInstanceService.ts:382:19)
      at GameInstanceService.createGameInstance (src/core/services/gameInstanceService.ts:43:32)
      at Object.<anonymous> (tests/unit/gameInstanceService.test.ts:99:13)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/unit/gameInstanceService.test.ts:99:100)

  ‚óè GameInstanceService ‚Ä∫ updateGameStatus ‚Ä∫ should update game status

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "data": ObjectContaining {
    +   "data": Object {
          "currentQuestionIndex": 1,
          "status": "active",
    +   },
    +   "include": Object {
    +     "gameTemplate": Object {
    +       "select": Object {
    +         "createdAt": true,
    +         "creatorId": true,
    +         "defaultMode": true,
    +         "description": true,
    +         "discipline": true,
    +         "gradeLevel": true,
    +         "id": true,
    +         "name": true,
    +         "themes": true,
    +         "updatedAt": true,
    +       },
    +     },
        },
        "where": Object {
          "id": "game-123",
        },
      },

    Number of calls: 1

      202 |             const result = await gameInstanceService.updateGameStatus(gameId, updateData);
      203 |
    > 204 |             expect(prisma.gameInstance.update).toHaveBeenCalledWith({
          |                                                ^
      205 |                 where: { id: gameId },
      206 |                 data: expect.objectContaining({
      207 |                     status: updateData.status,

      at Object.<anonymous> (tests/unit/gameInstanceService.test.ts:204:48)

  ‚óè GameInstanceService ‚Ä∫ updateGameStatus ‚Ä∫ should set startedAt when first activating a game

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "data": ObjectContaining {
    +   "data": Object {
          "currentQuestionIndex": 0,
    -     "startedAt": Any<Date>,
    +     "startedAt": 2025-06-14T15:13:18.337Z,
          "status": "active",
    +   },
    +   "include": Object {
    +     "gameTemplate": Object {
    +       "select": Object {
    +         "createdAt": true,
    +         "creatorId": true,
    +         "defaultMode": true,
    +         "description": true,
    +         "discipline": true,
    +         "gradeLevel": true,
    +         "id": true,
    +         "name": true,
    +         "themes": true,
    +         "updatedAt": true,
    +       },
    +     },
        },
        "where": Object {
          "id": "game-123",
        },
      },

    Number of calls: 1

      237 |             const result = await gameInstanceService.updateGameStatus(gameId, updateData);
      238 |
    > 239 |             expect(prisma.gameInstance.update).toHaveBeenCalledWith({
          |                                                ^
      240 |                 where: { id: gameId },
      241 |                 data: expect.objectContaining({
      242 |                     status: 'active',

      at Object.<anonymous> (tests/unit/gameInstanceService.test.ts:239:48)

  ‚óè GameInstanceService ‚Ä∫ updateGameStatus ‚Ä∫ should set endedAt when completing a game

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    - Expected
    + Received

      Object {
    -   "data": ObjectContaining {
    -     "endedAt": Any<Date>,
    +   "data": Object {
    +     "endedAt": 2025-06-14T15:13:18.338Z,
          "status": "completed",
    +   },
    +   "include": Object {
    +     "gameTemplate": Object {
    +       "select": Object {
    +         "createdAt": true,
    +         "creatorId": true,
    +         "defaultMode": true,
    +         "description": true,
    +         "discipline": true,
    +         "gradeLevel": true,
    +         "id": true,
    +         "name": true,
    +         "themes": true,
    +         "updatedAt": true,
    +       },
    +     },
        },
        "where": Object {
          "id": "game-123",
        },
      },

    Number of calls: 1

      265 |             const result = await gameInstanceService.updateGameStatus(gameId, updateData);
      266 |
    > 267 |             expect(prisma.gameInstance.update).toHaveBeenCalledWith({
          |                                                ^
      268 |                 where: { id: gameId },
      269 |                 data: expect.objectContaining({
      270 |                     status: 'completed',

      at Object.<anonymous> (tests/unit/gameInstanceService.test.ts:267:48)

  ‚óè GameInstanceService ‚Ä∫ generateUniqueAccessCode ‚Ä∫ should generate sequential access codes

    Unable to generate unique access code

      380 |         } catch (error) {
      381 |             logger.error('Error generating access code:', error);
    > 382 |             throw new Error('Unable to generate unique access code');
          |                   ^
      383 |         }
      384 |     }
      385 |

      at GameInstanceService.generateUniqueAccessCode (src/core/services/gameInstanceService.ts:382:19)
      at Object.<anonymous> (tests/unit/gameInstanceService.test.ts:291:26)

  ‚óè GameInstanceService ‚Ä∫ generateUniqueAccessCode ‚Ä∫ should increment from existing highest code

    Unable to generate unique access code

      380 |         } catch (error) {
      381 |             logger.error('Error generating access code:', error);
    > 382 |             throw new Error('Unable to generate unique access code');
          |                   ^
      383 |         }
      384 |     }
      385 |

      at GameInstanceService.generateUniqueAccessCode (src/core/services/gameInstanceService.ts:382:19)
      at Object.<anonymous> (tests/unit/gameInstanceService.test.ts:313:26)

  ‚óè GameInstanceService ‚Ä∫ generateUniqueAccessCode ‚Ä∫ should throw error if access code range exhausted

    expect(received).rejects.toThrow(expected)

    Expected substring: "Access code range exhausted"
    Received message:   "Unable to generate unique access code"

          380 |         } catch (error) {
          381 |             logger.error('Error generating access code:', error);
        > 382 |             throw new Error('Unable to generate unique access code');
              |                   ^
          383 |         }
          384 |     }
          385 |

      at GameInstanceService.generateUniqueAccessCode (src/core/services/gameInstanceService.ts:382:19)
      at Object.<anonymous> (tests/unit/gameInstanceService.test.ts:322:13)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/unit/gameInstanceService.test.ts:323:26)

PASS tests/integration/lobbyDeduplication.test.ts
  ‚óè Console

    console.log
      [2025-06-14 17:13:20.456] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.527] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "Wu6jpy1hrcGBLqL1AAAC"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.527] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "Wu6jpy1hrcGBLqL1AAAC",
        "user": {
          "id": "user-1",
          "userId": "user-1",
          "username": "Test User",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.530] [32mINFO [0m [GameHandlers] {
        "socketId": "Wu6jpy1hrcGBLqL1AAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.530] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "Wu6jpy1hrcGBLqL1AAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.531] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "Wu6jpy1hrcGBLqL1AAAC"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: Wu6jpy1hrcGBLqL1AAAC

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:13:20.531] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "Wu6jpy1hrcGBLqL1AAAC"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.532] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.532] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.532] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.532] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.532] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.532] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.533] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.533] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.533] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "Wu6jpy1hrcGBLqL1AAAC"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.536] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "PED1JumSx2G6gfRzAAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.536] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "PED1JumSx2G6gfRzAAAE",
        "user": {
          "id": "user-1",
          "userId": "user-1",
          "username": "Test User",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.536] [32mINFO [0m [GameHandlers] {
        "socketId": "PED1JumSx2G6gfRzAAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.536] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "PED1JumSx2G6gfRzAAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.536] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "PED1JumSx2G6gfRzAAAE"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: PED1JumSx2G6gfRzAAAE

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:13:20.536] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "PED1JumSx2G6gfRzAAAE"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.537] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.537] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.537] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.537] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.537] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.537] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.537] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.537] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.537] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "PED1JumSx2G6gfRzAAAE"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.538] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "6ItHfjCogu2FjO9LAAAF"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.538] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "6ItHfjCogu2FjO9LAAAF",
        "user": {
          "id": "user-1",
          "userId": "user-1",
          "username": "Test User",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.539] [32mINFO [0m [GameHandlers] {
        "socketId": "6ItHfjCogu2FjO9LAAAF"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.539] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "6ItHfjCogu2FjO9LAAAF"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.539] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "6ItHfjCogu2FjO9LAAAF"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 6ItHfjCogu2FjO9LAAAF

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:13:20.539] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "6ItHfjCogu2FjO9LAAAF"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.539] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.539] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.539] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.539] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.539] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.539] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.539] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.540] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.540] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "6ItHfjCogu2FjO9LAAAF"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.640] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-1",
        "username": "Test User",
        "socketId": "Wu6jpy1hrcGBLqL1AAAC"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.649] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.650] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.691] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-1",
        "username": "Test User",
        "socketId": "PED1JumSx2G6gfRzAAAE"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.693] [32mINFO [0m [LobbyHandler] {
        "existingSocketIds": [
          "Wu6jpy1hrcGBLqL1AAAC"
        ],
        "newSocketId": "PED1JumSx2G6gfRzAAAE",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "count": 1
      } Removing existing participant connections for user

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.696] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 2,
        "gameCount": 0,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.697] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.742] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-1",
        "username": "Test User",
        "socketId": "6ItHfjCogu2FjO9LAAAF"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.748] [32mINFO [0m [LobbyHandler] {
        "existingSocketIds": [
          "PED1JumSx2G6gfRzAAAE"
        ],
        "newSocketId": "6ItHfjCogu2FjO9LAAAF",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "count": 1
      } Removing existing participant connections for user

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.755] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 3,
        "gameCount": 0,
        "totalCount": 3
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.756] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.956] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "Wu6jpy1hrcGBLqL1AAAC"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.956] [32mINFO [0m [DisconnectHandler] {
        "socketId": "Wu6jpy1hrcGBLqL1AAAC",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.956] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "PED1JumSx2G6gfRzAAAE"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.957] [32mINFO [0m [DisconnectHandler] {
        "socketId": "PED1JumSx2G6gfRzAAAE",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.957] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "6ItHfjCogu2FjO9LAAAF"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.957] [32mINFO [0m [DisconnectHandler] {
        "socketId": "6ItHfjCogu2FjO9LAAAF",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.960] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "Wu6jpy1hrcGBLqL1AAAC",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.960] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "PED1JumSx2G6gfRzAAAE",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.960] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "6ItHfjCogu2FjO9LAAAF",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.964] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.965] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:20.965] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.070] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "zW_0SK0sYcgZDiqtAAAI"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.070] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "zW_0SK0sYcgZDiqtAAAI",
        "user": {
          "id": "user-1",
          "userId": "user-1",
          "username": "User One",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.071] [32mINFO [0m [GameHandlers] {
        "socketId": "zW_0SK0sYcgZDiqtAAAI"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.071] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "zW_0SK0sYcgZDiqtAAAI"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.071] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "zW_0SK0sYcgZDiqtAAAI"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: zW_0SK0sYcgZDiqtAAAI

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:13:21.071] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "zW_0SK0sYcgZDiqtAAAI"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.072] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.072] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.072] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.072] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.072] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.072] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.072] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.072] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.072] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "zW_0SK0sYcgZDiqtAAAI"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.075] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "gLhSMP5agc6r9SHxAAAK"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.075] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "gLhSMP5agc6r9SHxAAAK",
        "user": {
          "id": "user-1",
          "userId": "user-1",
          "username": "User One",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.075] [32mINFO [0m [GameHandlers] {
        "socketId": "gLhSMP5agc6r9SHxAAAK"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.075] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "gLhSMP5agc6r9SHxAAAK"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.075] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "gLhSMP5agc6r9SHxAAAK"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: gLhSMP5agc6r9SHxAAAK

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:13:21.075] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "gLhSMP5agc6r9SHxAAAK"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.075] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.075] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.076] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.076] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.076] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.076] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.076] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.076] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.076] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "gLhSMP5agc6r9SHxAAAK"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.077] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "pEGvGa81FGZubwVjAAAL"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.077] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "pEGvGa81FGZubwVjAAAL",
        "user": {
          "id": "user-2",
          "userId": "user-2",
          "username": "User Two",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.077] [32mINFO [0m [GameHandlers] {
        "socketId": "pEGvGa81FGZubwVjAAAL"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.077] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "pEGvGa81FGZubwVjAAAL"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.078] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "pEGvGa81FGZubwVjAAAL"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: pEGvGa81FGZubwVjAAAL

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:13:21.078] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "pEGvGa81FGZubwVjAAAL"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.078] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.078] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.078] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.078] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.078] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.078] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.078] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.078] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.078] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "pEGvGa81FGZubwVjAAAL"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.182] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-1",
        "username": "User One",
        "socketId": "zW_0SK0sYcgZDiqtAAAI"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.192] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.192] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.232] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-2",
        "username": "User Two",
        "socketId": "pEGvGa81FGZubwVjAAAL"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.241] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 2,
        "gameCount": 0,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.242] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.283] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-1",
        "username": "User One",
        "socketId": "gLhSMP5agc6r9SHxAAAK"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.289] [32mINFO [0m [LobbyHandler] {
        "existingSocketIds": [
          "zW_0SK0sYcgZDiqtAAAI"
        ],
        "newSocketId": "gLhSMP5agc6r9SHxAAAK",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "count": 1
      } Removing existing participant connections for user

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.295] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 3,
        "gameCount": 0,
        "totalCount": 3
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.296] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.486] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "zW_0SK0sYcgZDiqtAAAI"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.487] [32mINFO [0m [DisconnectHandler] {
        "socketId": "zW_0SK0sYcgZDiqtAAAI",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.487] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "gLhSMP5agc6r9SHxAAAK"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.487] [32mINFO [0m [DisconnectHandler] {
        "socketId": "gLhSMP5agc6r9SHxAAAK",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.488] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "pEGvGa81FGZubwVjAAAL"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.488] [32mINFO [0m [DisconnectHandler] {
        "socketId": "pEGvGa81FGZubwVjAAAL",
        "userId": "user-2",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.489] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "zW_0SK0sYcgZDiqtAAAI",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.489] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "gLhSMP5agc6r9SHxAAAK",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.490] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-2",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "pEGvGa81FGZubwVjAAAL",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.492] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.492] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.492] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.593] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "SPm8_lFwsFjO6ZvGAAAO"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.593] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "SPm8_lFwsFjO6ZvGAAAO",
        "user": {
          "id": "user-cleanup",
          "userId": "user-cleanup",
          "username": "Cleanup User",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.593] [32mINFO [0m [GameHandlers] {
        "socketId": "SPm8_lFwsFjO6ZvGAAAO"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.594] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "SPm8_lFwsFjO6ZvGAAAO"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.594] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "SPm8_lFwsFjO6ZvGAAAO"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: SPm8_lFwsFjO6ZvGAAAO

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:13:21.594] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "SPm8_lFwsFjO6ZvGAAAO"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.594] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.594] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.594] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.595] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.595] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.595] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.595] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.595] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.595] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "SPm8_lFwsFjO6ZvGAAAO"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.596] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "J7mOgD1qNX0fA2AfAAAP"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.597] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "J7mOgD1qNX0fA2AfAAAP",
        "user": {
          "id": "user-cleanup",
          "userId": "user-cleanup",
          "username": "Cleanup User",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.597] [32mINFO [0m [GameHandlers] {
        "socketId": "J7mOgD1qNX0fA2AfAAAP"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.597] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "J7mOgD1qNX0fA2AfAAAP"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.597] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "J7mOgD1qNX0fA2AfAAAP"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: J7mOgD1qNX0fA2AfAAAP

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:13:21.597] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "J7mOgD1qNX0fA2AfAAAP"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.597] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.598] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.598] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.598] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.598] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.598] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.598] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.598] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.598] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "J7mOgD1qNX0fA2AfAAAP"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.701] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-cleanup",
        "username": "Cleanup User",
        "socketId": "SPm8_lFwsFjO6ZvGAAAO"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.704] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.704] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.751] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-cleanup",
        "username": "Cleanup User",
        "socketId": "J7mOgD1qNX0fA2AfAAAP"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.754] [32mINFO [0m [LobbyHandler] {
        "existingSocketIds": [
          "SPm8_lFwsFjO6ZvGAAAO"
        ],
        "newSocketId": "J7mOgD1qNX0fA2AfAAAP",
        "userId": "user-cleanup",
        "accessCode": "DEDUP123",
        "count": 1
      } Removing existing participant connections for user

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.759] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 2,
        "gameCount": 0,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.759] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123"
      } Setup game status checking for lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.960] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "J7mOgD1qNX0fA2AfAAAP"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.961] [32mINFO [0m [DisconnectHandler] {
        "socketId": "J7mOgD1qNX0fA2AfAAAP",
        "userId": "user-cleanup",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.965] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-cleanup",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "J7mOgD1qNX0fA2AfAAAP",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.968] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 1,
        "gameCount": 0,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:21.968] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "J7mOgD1qNX0fA2AfAAAP",
        "userId": "user-cleanup",
        "username": "Cleanup User"
      } Participant disconnected from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:22.163] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "SPm8_lFwsFjO6ZvGAAAO"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:22.163] [32mINFO [0m [DisconnectHandler] {
        "socketId": "SPm8_lFwsFjO6ZvGAAAO",
        "userId": "user-cleanup",
        "accessCode": "DEDUP123",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:22.168] [32mINFO [0m [DisconnectHandler] {
        "userId": "user-cleanup",
        "accessCode": "DEDUP123",
        "disconnectedSocketId": "SPm8_lFwsFjO6ZvGAAAO",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:22.171] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DEDUP123",
        "gameId": "dedup-test-game-id",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.warn
      missing 'error' handler on this Redis client

      at EventEmitter.RedisAdapter.friendlyErrorHandler (node_modules/@socket.io/redis-adapter/dist/index.js:110:25)
      at EventEmitter.silentEmit (node_modules/ioredis/built/Redis.js:482:30)
      at Socket.<anonymous> (node_modules/ioredis/built/redis/event_handler.js:196:14)

    console.warn
      missing 'error' handler on this Redis client

      at EventEmitter.RedisAdapter.friendlyErrorHandler (node_modules/@socket.io/redis-adapter/dist/index.js:110:25)
      at EventEmitter.silentEmit (node_modules/ioredis/built/Redis.js:482:30)
      at Socket.<anonymous> (node_modules/ioredis/built/redis/event_handler.js:196:14)

FAIL tests/integration/practiceMode.test.ts (120.547 s)
  ‚óè Console

    console.log
      [2025-06-14 17:13:22.948] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.080] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "7536dfe2-37e3-4bbf-89c9-6060e1d7884d",
        "accessCode": "PRACTICE1"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket query params: {
        token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJwcmFjdGljZS1wbGF5ZXItMSIsInVzZXJuYW1lIjoiUHJhY3RpY2UgUGxheWVyIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk5MTQwMDMsImV4cCI6MTc0OTkxNzYwM30.uXu9_wbySVMLFbPRYCvV0ZpUL7jtxFgXjjNC_ugrsPs',
        role: 'STUDENT'
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:135:17)

    console.log
      [2025-06-14 17:13:23.090] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "EqrqTXk9wIhaX6c8AAAB",
        "user": {
          "id": "practice-player-1",
          "userId": "practice-player-1",
          "username": "Practice Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.094] [32mINFO [0m [GameHandlers] {
        "socketId": "EqrqTXk9wIhaX6c8AAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.094] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "EqrqTXk9wIhaX6c8AAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.094] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "EqrqTXk9wIhaX6c8AAAB"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: EqrqTXk9wIhaX6c8AAAB

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-14 17:13:23.094] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "EqrqTXk9wIhaX6c8AAAB"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.096] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.096] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.096] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.096] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.096] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.096] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.096] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.096] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.097] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "EqrqTXk9wIhaX6c8AAAB"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] connection_established [
        {
          socketId: 'EqrqTXk9wIhaX6c8AAAB',
          timestamp: '2025-06-14T15:13:23.090Z',
          user: {
            role: 'STUDENT',
            userId: 'practice-player-1',
            username: 'Practice Player'
          }
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:146:21)

    console.log
      Socket connected and ready to emit events, ID: EqrqTXk9wIhaX6c8AAAB

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:163:17)

    console.log
      Waiting for event: game_joined with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:11:13)

    console.log
      [2025-06-14 17:13:23.113] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.113] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "username": "Practice Player"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.113] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.115] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "username": "Practice Player"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.115] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.115] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.116] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "gameJoinedPayload": {
          "accessCode": "PRACTICE1",
          "participant": {
            "id": "EqrqTXk9wIhaX6c8AAAB",
            "userId": "practice-player-1",
            "username": "Practice Player",
            "avatar": "üë§",
            "score": 0,
            "socketId": "EqrqTXk9wIhaX6c8AAAB",
            "online": true,
            "joinedAt": "2025-06-14T15:13:23.116Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.117] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "gameJoinedPayload": {
          "accessCode": "PRACTICE1",
          "participant": {
            "id": "EqrqTXk9wIhaX6c8AAAB",
            "userId": "practice-player-1",
            "username": "Practice Player",
            "avatar": "üë§",
            "score": 0,
            "socketId": "EqrqTXk9wIhaX6c8AAAB",
            "online": true,
            "joinedAt": "2025-06-14T15:13:23.117Z",
            "isDeferred": false
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } [DEBUG] Emitted game_joined with correct payload structure

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          accessCode: 'PRACTICE1',
          participant: {
            id: 'EqrqTXk9wIhaX6c8AAAB',
            userId: 'practice-player-1',
            username: 'Practice Player',
            avatar: 'üë§',
            score: 0,
            socketId: 'EqrqTXk9wIhaX6c8AAAB',
            online: true,
            joinedAt: '2025-06-14T15:13:23.116Z',
            isDeferred: false
          },
          gameStatus: 'pending',
          isDiffered: false
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:146:21)

    console.log
      ‚úÖ Event received: game_joined {
        accessCode: 'PRACTICE1',
        participant: {
          id: 'EqrqTXk9wIhaX6c8AAAB',
          userId: 'practice-player-1',
          username: 'Practice Player',
          avatar: 'üë§',
          score: 0,
          socketId: 'EqrqTXk9wIhaX6c8AAAB',
          online: true,
          joinedAt: '2025-06-14T15:13:23.116Z',
          isDeferred: false
        },
        gameStatus: 'pending',
        isDiffered: false
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:18:21)

    console.log
      [SOCKET EVENT] participant_joined [
        {
          userId: 'practice-player-1',
          username: 'Practice Player',
          playMode: 'practice'
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:146:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          accessCode: 'PRACTICE1',
          participant: {
            id: 'EqrqTXk9wIhaX6c8AAAB',
            userId: 'practice-player-1',
            username: 'Practice Player',
            avatar: 'üë§',
            score: 0,
            socketId: 'EqrqTXk9wIhaX6c8AAAB',
            online: true,
            joinedAt: '2025-06-14T15:13:23.117Z',
            isDeferred: false
          },
          gameStatus: 'pending',
          isDiffered: false
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:146:21)

    console.log
      [SOCKET EVENT] participant_joined [
        {
          userId: 'practice-player-1',
          username: 'Practice Player',
          playMode: 'practice'
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:146:21)

    console.log
      Successfully received game_joined event, now starting game...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:172:17)

    console.log
      Emitted start_game again to ensure it gets processed

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:188:17)

    console.log
      [2025-06-14 17:13:23.121] [32mINFO [0m [GameHandlers] {
        "socketId": "EqrqTXk9wIhaX6c8AAAB",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1"
        }
      } Start game event received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.122] [32mINFO [0m [GameHandlers] {
        "socketId": "EqrqTXk9wIhaX6c8AAAB",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1"
        }
      } Start game event received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.122] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.122] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.125] [32mINFO [0m [GameParticipantService] {
        "userId": "practice-player-1",
        "accessCode": "PRACTICE1",
        "participantId": "f84d508b-72e9-414c-85a3-b5513e0383d9"
      } Updated existing participant join time

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.126] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "PRACTICE1",
          "participant": {
            "id": "f84d508b-72e9-414c-85a3-b5513e0383d9",
            "userId": "practice-player-1",
            "username": "Practice Player",
            "avatar": "üòÄ",
            "score": 0,
            "joinedAt": "2025-06-14T15:13:23.120Z",
            "online": true
          },
          "gameStatus": "waiting",
          "isDiffered": true
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          accessCode: 'PRACTICE1',
          participant: {
            id: 'f84d508b-72e9-414c-85a3-b5513e0383d9',
            userId: 'practice-player-1',
            username: 'Practice Player',
            avatar: 'üòÄ',
            score: 0,
            joinedAt: '2025-06-14T15:13:23.120Z',
            online: true
          },
          gameStatus: 'waiting',
          isDiffered: true
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:146:21)

    console.log
      [2025-06-14 17:13:23.129] [32mINFO [0m [GameHandlers] {
        "socketId": "EqrqTXk9wIhaX6c8AAAB",
        "questionUid": "ca2ebe01-a621-403a-a803-b6aa48cad562"
      } Sending first question

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_question [
        {
          question: {
            uid: 'ca2ebe01-a621-403a-a803-b6aa48cad562',
            questionType: 'multiple_choice_single_answer',
            text: 'What is 1+1?',
            answerOptions: [Array],
            explanation: null,
            correctAnswers: [Array],
            timeLimit: 20,
            gradeLevel: null,
            difficulty: 1,
            themes: [Array]
          },
          timer: 20,
          questionIndex: 0,
          totalQuestions: 2,
          questionState: 'active'
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:146:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        question: {
          uid: 'ca2ebe01-a621-403a-a803-b6aa48cad562',
          questionType: 'multiple_choice_single_answer',
          text: 'What is 1+1?',
          answerOptions: [ '1', '2', '3' ],
          explanation: null,
          correctAnswers: [ false, true, false ],
          timeLimit: 20,
          gradeLevel: null,
          difficulty: 1,
          themes: [ 'arithmetic' ]
        },
        timer: 20,
        questionIndex: 0,
        totalQuestions: 2,
        questionState: 'active'
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:157:21)

    console.log
      ‚úÖ Direct handler for game_question event received: {
        question: {
          uid: 'ca2ebe01-a621-403a-a803-b6aa48cad562',
          questionType: 'multiple_choice_single_answer',
          text: 'What is 1+1?',
          answerOptions: [ '1', '2', '3' ],
          explanation: null,
          correctAnswers: [ false, true, false ],
          timeLimit: 20,
          gradeLevel: null,
          difficulty: 1,
          themes: [ 'arithmetic' ]
        },
        timer: 20,
        questionIndex: 0,
        totalQuestions: 2,
        questionState: 'active'
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:181:25)

    console.log
      Promise resolved with game_question data

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:192:17)

    console.log
      [2025-06-14 17:13:23.136] [32mINFO [0m [GameHandlers] {
        "socketId": "EqrqTXk9wIhaX6c8AAAB",
        "questionUid": "ca2ebe01-a621-403a-a803-b6aa48cad562"
      } Sending first question

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_question [
        {
          question: {
            uid: 'ca2ebe01-a621-403a-a803-b6aa48cad562',
            questionType: 'multiple_choice_single_answer',
            text: 'What is 1+1?',
            answerOptions: [Array],
            explanation: null,
            correctAnswers: [Array],
            timeLimit: 20,
            gradeLevel: null,
            difficulty: 1,
            themes: [Array]
          },
          timer: 20,
          questionIndex: 0,
          totalQuestions: 2,
          questionState: 'active'
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:146:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        question: {
          uid: 'ca2ebe01-a621-403a-a803-b6aa48cad562',
          questionType: 'multiple_choice_single_answer',
          text: 'What is 1+1?',
          answerOptions: [ '1', '2', '3' ],
          explanation: null,
          correctAnswers: [ false, true, false ],
          timeLimit: 20,
          gradeLevel: null,
          difficulty: 1,
          themes: [ 'arithmetic' ]
        },
        timer: 20,
        questionIndex: 0,
        totalQuestions: 2,
        questionState: 'active'
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:157:21)

    console.log
      [2025-06-14 17:13:23.139] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "PRACTICE1",
        "gameId": "7536dfe2-37e3-4bbf-89c9-6060e1d7884d",
        "lobbyCount": 0,
        "gameCount": 1,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-14 17:13:23.141] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 1,
        "room": "game_PRACTICE1"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

  ‚óè Self-Paced (Practice) Mode ‚Ä∫ Player can play a self-paced game and receive feedback and score

    expect(received).toContain(expected) // indexOf

    Matcher error: received value must not be null nor undefined

    Received has value: undefined

      192 |         console.log('Promise resolved with game_question data');
      193 |         expect(firstQ).toBeDefined();
    > 194 |         expect(firstQ.text).toContain('1+1');
          |                             ^
      195 |         // 4. Answer first question
      196 |         socket.emit('game_answer', { accessCode, userId: playerId, questionUid: firstQ.uid, answer: 1, timeSpent: 1000 });
      197 |         const feedback1 = await waitForEvent(socket, 'answer_received');

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:194:29)


  ‚óè Test suite failed to run

    thrown: "Exceeded timeout of 60000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      106 |     });
      107 |
    > 108 |     afterAll(async () => {
          |     ^
      109 |         await serverCleanup();
      110 |     }, 60000); // 60 second timeout
      111 |

      at tests/integration/practiceMode.test.ts:108:5
      at Object.<anonymous> (tests/integration/practiceMode.test.ts:25:1)

  ‚óè Test suite failed to run

    thrown: "Exceeded timeout of 60000 ms for a hook.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      218 | // Make sure all servers are stopped after tests complete
      219 | if (typeof afterAll === 'function') {
    > 220 |     afterAll(async () => {
          |     ^
      221 |         await stopAllTestServers();
      222 |     }, 60000); // 60 second timeout
      223 | }

      at Object.afterAll (tests/testSetup.ts:220:5)
      at Object.<anonymous> (tests/integration/practiceMode.test.ts:3:1)

