
> backend@1.0.0 test
> jest

Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma

‚úî Generated Prisma Client (v6.7.0) to ./src/db/generated/client in 81ms

Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)

Tip: Want to react to database changes in your app as they happen? Discover how with Pulse: https://pris.ly/tip-1-pulse

Test setup complete, using port 7898
Database URL: postgresql://postgre:Phuf0pohooFee8auohFahk7vChae4Iv0wiem5voT@localhost:5432/mathquest_test
Redis URL: redis://localhost:6379
Cleaning test database...
Database cleaned successfully
Inserted default test questions.
Seeded integration teacher, template, questions, and game instance.
FAIL tests/integration/projectorHandler.test.ts (5.184 s)
  ‚óè Console

    console.log
      [2025-05-26 12:31:19.149] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:19.193] [32mINFO [0m [ProjectorHandler] Projector joined room: projector_test-game-id

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:19.261] [31mERROR[0m [ProjectorHandler] Game instance not found for gameId: test-game-id

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:22.194] [32mINFO [0m [ProjectorHandler] Projector left room: projector_test-game-id

      at log (src/utils/logger.ts:102:21)

  ‚óè Projector Mode Socket Handler ‚Ä∫ should join projector room and receive initial state

    thrown: "Exceeded timeout of 3000 ms for a test while waiting for `done()` to be called.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      35 |     });
      36 |
    > 37 |     it('should join projector room and receive initial state', (done) => {
         |     ^
      38 |         // Mock Redis state for the game
      39 |         const mockState = {
      40 |             question: 'What is 2+2?',

      at tests/integration/projectorHandler.test.ts:37:5
      at Object.<anonymous> (tests/integration/projectorHandler.test.ts:9:1)

PASS tests/integration/updated-gameHandler.test.ts
  ‚óè Console

    console.log
      [2025-05-26 12:31:22.933] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/tournament2.test.ts (45.414 s)
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-26 12:31:24.902] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:24.906] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.065] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "4b9e46b3-ee00-4ac6-8889-eff68a19dbf1",
        "accessCode": "999NFR"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.219] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "mRSKFPMNYqjjZ3weAAAC",
        "user": {
          "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.645] [32mINFO [0m [GameHandlers] {
        "socketId": "mRSKFPMNYqjjZ3weAAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.648] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "mRSKFPMNYqjjZ3weAAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.656] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "2DHQi8sPZ7j0pL_mAAAD",
        "user": {
          "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.657] [32mINFO [0m [GameHandlers] {
        "socketId": "2DHQi8sPZ7j0pL_mAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.657] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "2DHQi8sPZ7j0pL_mAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.659] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_999NFR",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.663] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_999NFR",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.663] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_999NFR",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.664] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_999NFR",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.664] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_999NFR",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.664] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_999NFR",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.665] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_999NFR",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.665] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_999NFR",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.673] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_999NFR",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4b9e46b3-ee00-4ac6-8889-eff68a19dbf1",
          "accessCode": "999NFR",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.675] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_999NFR",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4b9e46b3-ee00-4ac6-8889-eff68a19dbf1",
          "accessCode": "999NFR",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.675] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_999NFR",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4b9e46b3-ee00-4ac6-8889-eff68a19dbf1",
          "accessCode": "999NFR",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.676] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_999NFR",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "4b9e46b3-ee00-4ac6-8889-eff68a19dbf1",
          "accessCode": "999NFR",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.679] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.679] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.679] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.680] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.691] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "4b9e46b3-ee00-4ac6-8889-eff68a19dbf1",
        "templateId": "19048c50-d61e-4fe7-b277-7908be814835",
        "initiator": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "999NFR",
        "socketId": "mRSKFPMNYqjjZ3weAAAC"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.895] [32mINFO [0m [GameStateService] {
        "accessCode": "999NFR"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:25.906] [32mINFO [0m [TournamentHandler] {
        "room": "game_999NFR",
        "duration": 5,
        "accessCode": "999NFR",
        "socketId": "mRSKFPMNYqjjZ3weAAAC"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.908] [32mINFO [0m [GameStateService] {
        "accessCode": "999NFR"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.916] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "999NFR"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.918] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "999NFR",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.918] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "999NFR"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.921] [32mINFO [0m [GameStateService] {
        "accessCode": "999NFR"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.921] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "999NFR",
        "room": "game_999NFR",
        "socketIds": [
          "mRSKFPMNYqjjZ3weAAAC",
          "2DHQi8sPZ7j0pL_mAAAD"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.921] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "999NFR",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.921] [32mINFO [0m [SharedGameFlow] {
        "room": "game_999NFR",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 2,
            "createdAt": "2025-05-26T10:31:17.175Z",
            "updatedAt": "2025-05-26T10:31:24.981Z"
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.922] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "999NFR",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.924] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "mRSKFPMNYqjjZ3weAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.924] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "mRSKFPMNYqjjZ3weAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.925] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "mRSKFPMNYqjjZ3weAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.925] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "mRSKFPMNYqjjZ3weAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.925] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "2DHQi8sPZ7j0pL_mAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.925] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "2DHQi8sPZ7j0pL_mAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.926] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "2DHQi8sPZ7j0pL_mAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.926] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "2DHQi8sPZ7j0pL_mAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.931] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.933] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.934] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:30.934] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "999NFR",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:32.922] [32mINFO [0m [SharedGameFlow] {
        "room": "game_999NFR",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:32.923] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "999NFR",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:32.923] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "999NFR",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:32.932] [32mINFO [0m [GameStateService] {
        "accessCode": "999NFR",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:32.932] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "999NFR",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:32.933] [32mINFO [0m [GameStateService] {
        "accessCode": "999NFR",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
          "username": "p1-extended",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
          "username": "p2-extended",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament2.test.ts:327:17)

    console.log
      [2025-05-26 12:31:32.952] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "2c7f29aa-0b42-4d66-bf78-89470244edf1",
        "accessCode": "SKRX4Y"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.078] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "7fDSaaKE7XAWFQCSAAAG",
        "user": {
          "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.078] [32mINFO [0m [GameHandlers] {
        "socketId": "7fDSaaKE7XAWFQCSAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.078] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "7fDSaaKE7XAWFQCSAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.080] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "sk_ct8lhtCes50CfAAAH",
        "user": {
          "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.080] [32mINFO [0m [GameHandlers] {
        "socketId": "sk_ct8lhtCes50CfAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.080] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "sk_ct8lhtCes50CfAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.080] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_SKRX4Y",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.081] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_SKRX4Y",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.081] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_SKRX4Y",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.081] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_SKRX4Y",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.081] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_SKRX4Y",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.081] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_SKRX4Y",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.081] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_SKRX4Y",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.082] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_SKRX4Y",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.082] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_SKRX4Y",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "2c7f29aa-0b42-4d66-bf78-89470244edf1",
          "accessCode": "SKRX4Y",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.082] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_SKRX4Y",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "2c7f29aa-0b42-4d66-bf78-89470244edf1",
          "accessCode": "SKRX4Y",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.083] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_SKRX4Y",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "2c7f29aa-0b42-4d66-bf78-89470244edf1",
          "accessCode": "SKRX4Y",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.083] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_SKRX4Y",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "2c7f29aa-0b42-4d66-bf78-89470244edf1",
          "accessCode": "SKRX4Y",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.085] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.085] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.087] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.088] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.102] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "2c7f29aa-0b42-4d66-bf78-89470244edf1",
        "templateId": "88aeb8cd-b551-4531-81da-9777ebc63854",
        "initiator": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "SKRX4Y",
        "socketId": "7fDSaaKE7XAWFQCSAAAG"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.303] [32mINFO [0m [GameStateService] {
        "accessCode": "SKRX4Y"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:33.307] [32mINFO [0m [TournamentHandler] {
        "room": "game_SKRX4Y",
        "duration": 5,
        "accessCode": "SKRX4Y",
        "socketId": "7fDSaaKE7XAWFQCSAAAG"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:34.932] [32mINFO [0m [SharedGameFlow] {
        "room": "game_999NFR",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:34.933] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "999NFR",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:34.934] [32mINFO [0m [SharedGameFlow] {
        "room": "game_999NFR",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:34.934] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "999NFR",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.310] [32mINFO [0m [GameStateService] {
        "accessCode": "SKRX4Y"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.315] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SKRX4Y"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.316] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SKRX4Y",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.316] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SKRX4Y"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.317] [32mINFO [0m [GameStateService] {
        "accessCode": "SKRX4Y"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.317] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SKRX4Y",
        "room": "game_SKRX4Y",
        "socketIds": [
          "7fDSaaKE7XAWFQCSAAAG",
          "sk_ct8lhtCes50CfAAAH"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.317] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SKRX4Y",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.317] [32mINFO [0m [SharedGameFlow] {
        "room": "game_SKRX4Y",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 2,
            "createdAt": "2025-05-26T10:31:17.175Z",
            "updatedAt": "2025-05-26T10:31:24.981Z"
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.318] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SKRX4Y",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.319] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "7fDSaaKE7XAWFQCSAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.319] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "7fDSaaKE7XAWFQCSAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.320] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "7fDSaaKE7XAWFQCSAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.320] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "7fDSaaKE7XAWFQCSAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.320] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "sk_ct8lhtCes50CfAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.320] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "sk_ct8lhtCes50CfAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.320] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "sk_ct8lhtCes50CfAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.321] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "sk_ct8lhtCes50CfAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.324] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.324] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.324] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:38.331] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SKRX4Y",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.317] [32mINFO [0m [SharedGameFlow] {
        "room": "game_SKRX4Y",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.318] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SKRX4Y",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.318] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SKRX4Y",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.324] [32mINFO [0m [GameStateService] {
        "accessCode": "SKRX4Y",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.325] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SKRX4Y",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.327] [32mINFO [0m [GameStateService] {
        "accessCode": "SKRX4Y",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
          "username": "p1-extended",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
          "username": "p2-extended",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament2.test.ts:442:17)

    console.log
      [2025-05-26 12:31:40.349] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "f8ed1d3a-eee1-4a14-a448-654a6800280b",
        "accessCode": "AN6AUM"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.478] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "32c7QSf68uJmuNAgAAAK",
        "user": {
          "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.479] [32mINFO [0m [GameHandlers] {
        "socketId": "32c7QSf68uJmuNAgAAAK"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.481] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "32c7QSf68uJmuNAgAAAK"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.482] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "J7NDKRhFyyeZi1JBAAAL",
        "user": {
          "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.483] [32mINFO [0m [GameHandlers] {
        "socketId": "J7NDKRhFyyeZi1JBAAAL"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.483] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "J7NDKRhFyyeZi1JBAAAL"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.490] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_AN6AUM",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.490] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_AN6AUM",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.490] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_AN6AUM",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.490] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_AN6AUM",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.493] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_AN6AUM",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.493] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_AN6AUM",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.493] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_AN6AUM",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.494] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_AN6AUM",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.495] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_AN6AUM",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "f8ed1d3a-eee1-4a14-a448-654a6800280b",
          "accessCode": "AN6AUM",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.495] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_AN6AUM",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "f8ed1d3a-eee1-4a14-a448-654a6800280b",
          "accessCode": "AN6AUM",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.496] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_AN6AUM",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "f8ed1d3a-eee1-4a14-a448-654a6800280b",
          "accessCode": "AN6AUM",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.496] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_AN6AUM",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "f8ed1d3a-eee1-4a14-a448-654a6800280b",
          "accessCode": "AN6AUM",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.498] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.500] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.502] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.502] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.514] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "f8ed1d3a-eee1-4a14-a448-654a6800280b",
        "templateId": "54af7826-41b4-4115-9fb2-3ce00cfb7aa0",
        "initiator": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 2,
        "nbParticipants": 2,
        "accessCode": "AN6AUM",
        "socketId": "32c7QSf68uJmuNAgAAAK"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.715] [32mINFO [0m [GameStateService] {
        "accessCode": "AN6AUM"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:40.724] [32mINFO [0m [TournamentHandler] {
        "room": "game_AN6AUM",
        "duration": 5,
        "accessCode": "AN6AUM",
        "socketId": "32c7QSf68uJmuNAgAAAK"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:42.324] [32mINFO [0m [SharedGameFlow] {
        "room": "game_SKRX4Y",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:42.326] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SKRX4Y",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:42.326] [32mINFO [0m [SharedGameFlow] {
        "room": "game_SKRX4Y",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:42.326] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SKRX4Y",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.730] [32mINFO [0m [GameStateService] {
        "accessCode": "AN6AUM"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.735] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.736] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM",
        "playMode": "tournament",
        "questionCount": 2
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.737] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.743] [32mINFO [0m [GameStateService] {
        "accessCode": "AN6AUM"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.744] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM",
        "room": "game_AN6AUM",
        "socketIds": [
          "32c7QSf68uJmuNAgAAAK",
          "J7NDKRhFyyeZi1JBAAAL"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.744] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.744] [32mINFO [0m [SharedGameFlow] {
        "room": "game_AN6AUM",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 2,
            "createdAt": "2025-05-26T10:31:17.175Z",
            "updatedAt": "2025-05-26T10:31:24.981Z"
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.746] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.748] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "32c7QSf68uJmuNAgAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.750] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "32c7QSf68uJmuNAgAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.751] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "32c7QSf68uJmuNAgAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.751] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "32c7QSf68uJmuNAgAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.752] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "J7NDKRhFyyeZi1JBAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.752] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "J7NDKRhFyyeZi1JBAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.753] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "J7NDKRhFyyeZi1JBAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.754] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "J7NDKRhFyyeZi1JBAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.765] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.765] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.766] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:45.767] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:47.747] [32mINFO [0m [SharedGameFlow] {
        "room": "game_AN6AUM",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:47.748] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:47.748] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:47.751] [32mINFO [0m [GameStateService] {
        "accessCode": "AN6AUM",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:47.752] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.752] [32mINFO [0m [SharedGameFlow] {
        "room": "game_AN6AUM",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.753] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.759] [32mINFO [0m [GameStateService] {
        "accessCode": "AN6AUM"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.760] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM",
        "questionIndex": 1,
        "questionUid": "q-late-2"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.760] [32mINFO [0m [SharedGameFlow] {
        "room": "game_AN6AUM",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-2",
            "title": null,
            "text": "What is 7 x 3?",
            "answerOptions": [
              "20",
              "21",
              "24",
              "27"
            ],
            "correctAnswers": [
              false,
              true,
              false,
              false
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "multiplication"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "multiplication",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 0,
            "createdAt": "2025-05-26T10:31:17.175Z",
            "updatedAt": "2025-05-26T10:31:24.987Z"
          },
          "index": 1,
          "feedbackWaitTime": 1.5
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.760] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM",
        "event": "game_question",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.762] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "32c7QSf68uJmuNAgAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.763] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "32c7QSf68uJmuNAgAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.765] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "32c7QSf68uJmuNAgAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.766] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "32c7QSf68uJmuNAgAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.766] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "J7NDKRhFyyeZi1JBAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.766] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "J7NDKRhFyyeZi1JBAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.766] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "J7NDKRhFyyeZi1JBAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.766] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "J7NDKRhFyyeZi1JBAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.773] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.775] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.775] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:49.787] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "AN6AUM",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.761] [32mINFO [0m [SharedGameFlow] {
        "room": "game_AN6AUM",
        "event": "correct_answers",
        "questionId": "q-late-2"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.763] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM",
        "event": "correct_answers",
        "questionUid": "q-late-2"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.764] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM",
        "questionId": "q-late-2"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.771] [32mINFO [0m [GameStateService] {
        "accessCode": "AN6AUM",
        "questionId": "q-late-2"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.772] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM",
        "questionId": "q-late-2"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.794] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "0889b458-c2d9-4442-93a2-b56141546903",
        "accessCode": "EVY4DY"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.931] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "eSUNb0MKoq-MuGfAAAAN",
        "user": {
          "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.931] [32mINFO [0m [GameHandlers] {
        "socketId": "eSUNb0MKoq-MuGfAAAAN"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.931] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "eSUNb0MKoq-MuGfAAAAN"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.935] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "ZOL6oQ3seTSYncE_AAAP",
        "user": {
          "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.935] [32mINFO [0m [GameHandlers] {
        "socketId": "ZOL6oQ3seTSYncE_AAAP"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.935] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "ZOL6oQ3seTSYncE_AAAP"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.936] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_EVY4DY",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.936] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_EVY4DY",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.936] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_EVY4DY",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.938] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_EVY4DY",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.938] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_EVY4DY",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.938] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_EVY4DY",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.938] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_EVY4DY",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.938] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_EVY4DY",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.939] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_EVY4DY",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "0889b458-c2d9-4442-93a2-b56141546903",
          "accessCode": "EVY4DY",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.939] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "room": "game_EVY4DY",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "0889b458-c2d9-4442-93a2-b56141546903",
          "accessCode": "EVY4DY",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.940] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_EVY4DY",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "0889b458-c2d9-4442-93a2-b56141546903",
          "accessCode": "EVY4DY",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.940] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "room": "game_EVY4DY",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "0889b458-c2d9-4442-93a2-b56141546903",
          "accessCode": "EVY4DY",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.943] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.944] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.944] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.944] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:51.951] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "0889b458-c2d9-4442-93a2-b56141546903",
        "templateId": "5f4eefa8-54b1-4496-bd2a-794b0118ed00",
        "initiator": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 2,
        "nbParticipants": 2,
        "accessCode": "EVY4DY",
        "socketId": "eSUNb0MKoq-MuGfAAAAN"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:52.155] [32mINFO [0m [GameStateService] {
        "accessCode": "EVY4DY"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:52.163] [32mINFO [0m [TournamentHandler] {
        "room": "game_EVY4DY",
        "duration": 5,
        "accessCode": "EVY4DY",
        "socketId": "eSUNb0MKoq-MuGfAAAAN"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:53.274] [32mINFO [0m [SharedGameFlow] {
        "room": "game_AN6AUM",
        "event": "feedback",
        "questionId": "q-late-2"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:53.276] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM",
        "event": "feedback",
        "questionUid": "q-late-2"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:53.278] [32mINFO [0m [SharedGameFlow] {
        "room": "game_AN6AUM",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:53.279] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "AN6AUM",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.166] [32mINFO [0m [GameStateService] {
        "accessCode": "EVY4DY"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.171] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.171] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY",
        "playMode": "tournament",
        "questionCount": 2
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.171] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.172] [32mINFO [0m [GameStateService] {
        "accessCode": "EVY4DY"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.173] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY",
        "room": "game_EVY4DY",
        "socketIds": [
          "eSUNb0MKoq-MuGfAAAAN",
          "ZOL6oQ3seTSYncE_AAAP"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.173] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.173] [32mINFO [0m [SharedGameFlow] {
        "room": "game_EVY4DY",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 2,
            "createdAt": "2025-05-26T10:31:17.175Z",
            "updatedAt": "2025-05-26T10:31:24.981Z"
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.173] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.176] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "eSUNb0MKoq-MuGfAAAAN"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.176] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "eSUNb0MKoq-MuGfAAAAN"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.177] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "eSUNb0MKoq-MuGfAAAAN"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.177] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "eSUNb0MKoq-MuGfAAAAN"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.178] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "ZOL6oQ3seTSYncE_AAAP"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.178] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "ZOL6oQ3seTSYncE_AAAP"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.179] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "ZOL6oQ3seTSYncE_AAAP"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.179] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "ZOL6oQ3seTSYncE_AAAP"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.184] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.185] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.185] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:57.186] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.174] [32mINFO [0m [SharedGameFlow] {
        "room": "game_EVY4DY",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.175] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.176] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.184] [32mINFO [0m [GameStateService] {
        "accessCode": "EVY4DY",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.185] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.464] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "oAyClPeH7DnR-aFjAAAR",
        "user": {
          "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
          "username": "p3",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.464] [32mINFO [0m [GameHandlers] {
        "socketId": "oAyClPeH7DnR-aFjAAAR"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.464] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "oAyClPeH7DnR-aFjAAAR"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.465] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "room": "game_EVY4DY",
        "playMode": "tournament",
        "username": "p3"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.465] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "room": "game_EVY4DY",
        "playMode": "tournament",
        "username": "p3"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.465] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "room": "game_EVY4DY",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.465] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "room": "game_EVY4DY",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.470] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "room": "game_EVY4DY",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "0889b458-c2d9-4442-93a2-b56141546903",
          "accessCode": "EVY4DY",
          "status": "active",
          "currentQuestionIndex": 0,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 1748255517171,
            "duration": 2000,
            "isPaused": false
          },
          "question": {
            "uid": "q-late-1",
            "type": "single_correct",
            "text": "What is 10 + 5?",
            "answers": [
              "12",
              "13",
              "14",
              "15"
            ]
          }
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.471] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "room": "game_EVY4DY",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "0889b458-c2d9-4442-93a2-b56141546903",
          "accessCode": "EVY4DY",
          "status": "active",
          "currentQuestionIndex": 0,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 1748255517171,
            "duration": 2000,
            "isPaused": false
          },
          "question": {
            "uid": "q-late-1",
            "type": "single_correct",
            "text": "What is 10 + 5?",
            "answers": [
              "12",
              "13",
              "14",
              "15"
            ]
          }
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.472] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.472] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.474] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "socketId": "oAyClPeH7DnR-aFjAAAR",
        "liveRoom": "game_EVY4DY",
        "socketIds": [
          "eSUNb0MKoq-MuGfAAAAN",
          "ZOL6oQ3seTSYncE_AAAP",
          "oAyClPeH7DnR-aFjAAAR"
        ]
      } [DEBUG] Late joiner socket and current live room members before emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.475] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "currentIndex": 0,
        "questionId": "q-late-1",
        "questionState": "stopped",
        "timer": 0,
        "playMode": "tournament",
        "phase": "show_answers",
        "feedbackRemaining": 0
      } [DEBUG] Emitted game_question to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.475] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "questionId": "q-late-1",
        "playMode": "tournament",
        "questionState": "stopped",
        "phase": "show_answers"
      } [DEBUG] Emitted correct_answers to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.475] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "socketId": "oAyClPeH7DnR-aFjAAAR",
        "liveRoom": "game_EVY4DY",
        "socketIds": [
          "eSUNb0MKoq-MuGfAAAAN",
          "ZOL6oQ3seTSYncE_AAAP",
          "oAyClPeH7DnR-aFjAAAR"
        ]
      } [DEBUG] Late joiner socket and current live room members before emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.475] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "currentIndex": 0,
        "questionId": "q-late-1",
        "questionState": "stopped",
        "timer": 0,
        "playMode": "tournament",
        "phase": "show_answers",
        "feedbackRemaining": 0
      } [DEBUG] Emitted game_question to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:31:59.475] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "questionId": "q-late-1",
        "playMode": "tournament",
        "questionState": "stopped",
        "phase": "show_answers"
      } [DEBUG] Emitted correct_answers to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:01.186] [32mINFO [0m [SharedGameFlow] {
        "room": "game_EVY4DY",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:01.188] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:01.192] [32mINFO [0m [GameStateService] {
        "accessCode": "EVY4DY"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:01.192] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY",
        "questionIndex": 1,
        "questionUid": "q-late-2"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:01.193] [32mINFO [0m [SharedGameFlow] {
        "room": "game_EVY4DY",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-2",
            "title": null,
            "text": "What is 7 x 3?",
            "answerOptions": [
              "20",
              "21",
              "24",
              "27"
            ],
            "correctAnswers": [
              false,
              true,
              false,
              false
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "multiplication"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "multiplication",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 0,
            "createdAt": "2025-05-26T10:31:17.175Z",
            "updatedAt": "2025-05-26T10:31:24.987Z"
          },
          "index": 1,
          "feedbackWaitTime": 1.5
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:01.193] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY",
        "event": "game_question",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:03.195] [32mINFO [0m [SharedGameFlow] {
        "room": "game_EVY4DY",
        "event": "correct_answers",
        "questionId": "q-late-2"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:03.197] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY",
        "event": "correct_answers",
        "questionUid": "q-late-2"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:03.197] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY",
        "questionId": "q-late-2"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:03.201] [32mINFO [0m [GameStateService] {
        "accessCode": "EVY4DY",
        "questionId": "q-late-2"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:03.202] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY",
        "questionId": "q-late-2"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.704] [32mINFO [0m [SharedGameFlow] {
        "room": "game_EVY4DY",
        "event": "feedback",
        "questionId": "q-late-2"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.706] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY",
        "event": "feedback",
        "questionUid": "q-late-2"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.706] [32mINFO [0m [SharedGameFlow] {
        "room": "game_EVY4DY",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.707] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "EVY4DY",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.710] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "receivedPlayMode": "tournament",
        "socketId": "oAyClPeH7DnR-aFjAAAR"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.710] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "finalPlayMode": "tournament",
        "socketId": "oAyClPeH7DnR-aFjAAAR"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.711] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "receivedPlayMode": "tournament",
        "socketId": "oAyClPeH7DnR-aFjAAAR"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.713] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "finalPlayMode": "tournament",
        "socketId": "oAyClPeH7DnR-aFjAAAR"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.715] [33mWARN [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "questionId": "q-late-1"
      } Answer submitted after timer expired (tournament mode).

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.715] [33mWARN [0m [SharedLiveHandler] {
        "accessCode": "EVY4DY",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "questionId": "q-late-1"
      } Answer submitted after timer expired (tournament mode).

      at log (src/utils/logger.ts:102:21)

    console.log
      socket3 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:790:33)

    console.log
      Starting afterAll cleanup...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:74:17)

    console.log
      Processing socket1...

      at disconnectSocket (tests/integration/tournament2.test.ts:82:21)

    console.log
      socket1 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament2.test.ts:87:25)

    console.log
      socket1 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:97:37)

    console.log
      socket1 processing complete.

      at disconnectSocket (tests/integration/tournament2.test.ts:113:21)

    console.log
      Processing socket2...

      at disconnectSocket (tests/integration/tournament2.test.ts:82:21)

    console.log
      socket2 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament2.test.ts:87:25)

    console.log
      socket2 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:97:37)

    console.log
      socket2 processing complete.

      at disconnectSocket (tests/integration/tournament2.test.ts:113:21)

    console.log
      [2025-05-26 12:32:04.724] [32mINFO [0m [DisconnectHandler] {
        "socketId": "oAyClPeH7DnR-aFjAAAR",
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "accessCode": "EVY4DY",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.727] [32mINFO [0m [DisconnectHandler] {
        "socketId": "eSUNb0MKoq-MuGfAAAAN",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "accessCode": "EVY4DY",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.727] [32mINFO [0m [DisconnectHandler] {
        "socketId": "ZOL6oQ3seTSYncE_AAAP",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "accessCode": "EVY4DY",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.731] [32mINFO [0m [DisconnectHandler] {
        "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
        "accessCode": "EVY4DY",
        "socketId": "oAyClPeH7DnR-aFjAAAR"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.731] [32mINFO [0m [DisconnectHandler] {
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "accessCode": "EVY4DY",
        "socketId": "eSUNb0MKoq-MuGfAAAAN"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.731] [32mINFO [0m [DisconnectHandler] {
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "accessCode": "EVY4DY",
        "socketId": "ZOL6oQ3seTSYncE_AAAP"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.734] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "0e17c72a-be6f-4ae7-823b-a4bb0b465342",
          "socketId": "oAyClPeH7DnR-aFjAAAR"
        },
        "room": "game_EVY4DY"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.735] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
          "socketId": "eSUNb0MKoq-MuGfAAAAN"
        },
        "room": "game_EVY4DY"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:04.735] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
          "socketId": "ZOL6oQ3seTSYncE_AAAP"
        },
        "room": "game_EVY4DY"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing Socket.IO server...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:124:21)

    console.log
      [2025-05-26 12:32:05.225] [32mINFO [0m [DisconnectHandler] {
        "socketId": "mRSKFPMNYqjjZ3weAAAC",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "accessCode": "999NFR",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-26 12:32:05.227] [32mINFO [0m [DisconnectHandler] {
        "socketId": "2DHQi8sPZ7j0pL_mAAAD",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "accessCode": "999NFR",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-26 12:32:05.227] [32mINFO [0m [DisconnectHandler] {
        "socketId": "7fDSaaKE7XAWFQCSAAAG",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "accessCode": "SKRX4Y",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-26 12:32:05.228] [32mINFO [0m [DisconnectHandler] {
        "socketId": "sk_ct8lhtCes50CfAAAH",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "accessCode": "SKRX4Y",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-26 12:32:05.228] [32mINFO [0m [DisconnectHandler] {
        "socketId": "32c7QSf68uJmuNAgAAAK",
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "accessCode": "AN6AUM",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-26 12:32:05.229] [32mINFO [0m [DisconnectHandler] {
        "socketId": "J7NDKRhFyyeZi1JBAAAL",
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "accessCode": "AN6AUM",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-26 12:32:05.236] [32mINFO [0m [DisconnectHandler] {
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "accessCode": "999NFR",
        "socketId": "mRSKFPMNYqjjZ3weAAAC"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:05.237] [32mINFO [0m [DisconnectHandler] {
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "accessCode": "999NFR",
        "socketId": "2DHQi8sPZ7j0pL_mAAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:05.237] [32mINFO [0m [DisconnectHandler] {
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "accessCode": "SKRX4Y",
        "socketId": "7fDSaaKE7XAWFQCSAAAG"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:05.238] [32mINFO [0m [DisconnectHandler] {
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "accessCode": "SKRX4Y",
        "socketId": "sk_ct8lhtCes50CfAAAH"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:05.244] [32mINFO [0m [DisconnectHandler] {
        "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
        "accessCode": "AN6AUM",
        "socketId": "32c7QSf68uJmuNAgAAAK"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:05.244] [32mINFO [0m [DisconnectHandler] {
        "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
        "accessCode": "AN6AUM",
        "socketId": "J7NDKRhFyyeZi1JBAAAL"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket.IO server closed successfully.

      at Server.<anonymous> (tests/integration/tournament2.test.ts:136:33)

    console.log
      Attempting to close HTTP server...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:144:17)

    console.log
      HTTP server was not listening. Assuming already closed or handled by Socket.IO close.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:164:25)

    console.log
      Waiting longer for server resources to release before closing Redis...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:170:17)

    console.log
      [2025-05-26 12:32:05.250] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
          "socketId": "mRSKFPMNYqjjZ3weAAAC"
        },
        "room": "game_999NFR"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:05.250] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
          "socketId": "2DHQi8sPZ7j0pL_mAAAD"
        },
        "room": "game_999NFR"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:05.250] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
          "socketId": "7fDSaaKE7XAWFQCSAAAG"
        },
        "room": "game_SKRX4Y"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:05.253] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
          "socketId": "sk_ct8lhtCes50CfAAAH"
        },
        "room": "game_SKRX4Y"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:05.254] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "c1fb43c1-a651-4dd6-8d07-54e512b611d4",
          "socketId": "32c7QSf68uJmuNAgAAAK"
        },
        "room": "game_AN6AUM"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:05.255] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "9c4fc481-68ee-498c-837c-83fbcbf4cd23",
          "socketId": "J7NDKRhFyyeZi1JBAAAL"
        },
        "room": "game_AN6AUM"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing SocketIO Redis clients (subClient)...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:174:17)

    console.log
      SocketIO Redis clients closed.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:177:21)

    console.log
      Closing main Redis client...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:185:17)

    console.log
      Main Redis client quit successfully.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:189:25)

    console.log
      Cleaning up database...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:200:17)

    console.log
      Database cleanup successful.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:212:21)

    console.warn
      Error cleaning up Redis keys: Connection is closed.

      222 |             }
      223 |         } catch (e: any) {
    > 224 |             console.warn('Error cleaning up Redis keys:', e.message || e);
          |                     ^
      225 |         }
      226 |
      227 |         await new Promise(resolve => setTimeout(resolve, 300));

      at Object.<anonymous> (tests/integration/tournament2.test.ts:224:21)

    console.log
      afterAll cleanup complete.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:228:17)

PASS tests/integration/tournament.test.ts (19.633 s)
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-26 12:32:09.591] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.669] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.696] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "8c3464bf-aff9-4086-924f-b49853f0b0f5",
        "accessCode": "3UMXBP"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.842] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "8QshAPZdh0kiPwjFAAAC",
        "user": {
          "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
          "username": "p1-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.847] [32mINFO [0m [GameHandlers] {
        "socketId": "8QshAPZdh0kiPwjFAAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.848] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "8QshAPZdh0kiPwjFAAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.849] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "4CFKGgUz9SP1qV9NAAAD",
        "user": {
          "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
          "username": "p2-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.849] [32mINFO [0m [GameHandlers] {
        "socketId": "4CFKGgUz9SP1qV9NAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.849] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "4CFKGgUz9SP1qV9NAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.850] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "room": "game_3UMXBP",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.850] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "room": "game_3UMXBP",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.851] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "room": "game_3UMXBP",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.851] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "room": "game_3UMXBP",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.851] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "room": "game_3UMXBP",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.851] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "room": "game_3UMXBP",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.851] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "room": "game_3UMXBP",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.852] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "room": "game_3UMXBP",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.853] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "room": "game_3UMXBP",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "8c3464bf-aff9-4086-924f-b49853f0b0f5",
          "accessCode": "3UMXBP",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.854] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "room": "game_3UMXBP",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "8c3464bf-aff9-4086-924f-b49853f0b0f5",
          "accessCode": "3UMXBP",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.855] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "room": "game_3UMXBP",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "8c3464bf-aff9-4086-924f-b49853f0b0f5",
          "accessCode": "3UMXBP",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.855] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "room": "game_3UMXBP",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "8c3464bf-aff9-4086-924f-b49853f0b0f5",
          "accessCode": "3UMXBP",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.857] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.857] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.857] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.858] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:09.873] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "8c3464bf-aff9-4086-924f-b49853f0b0f5",
        "templateId": "6c123606-8753-44e9-958c-d172ad7d05a4",
        "initiator": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "3UMXBP",
        "socketId": "8QshAPZdh0kiPwjFAAAC"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:10.077] [32mINFO [0m [GameStateService] {
        "accessCode": "3UMXBP"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:10.089] [32mINFO [0m [TournamentHandler] {
        "room": "game_3UMXBP",
        "duration": 5,
        "accessCode": "3UMXBP",
        "socketId": "8QshAPZdh0kiPwjFAAAC"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.092] [32mINFO [0m [GameStateService] {
        "accessCode": "3UMXBP"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.102] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3UMXBP"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.102] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3UMXBP",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.102] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3UMXBP"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.105] [32mINFO [0m [GameStateService] {
        "accessCode": "3UMXBP"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.105] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3UMXBP",
        "room": "game_3UMXBP",
        "socketIds": [
          "8QshAPZdh0kiPwjFAAAC",
          "4CFKGgUz9SP1qV9NAAAD"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.105] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3UMXBP",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.106] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3UMXBP",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 2,
            "createdAt": "2025-05-26T10:32:09.665Z",
            "updatedAt": "2025-05-26T10:32:09.677Z"
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.106] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3UMXBP",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.108] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "8QshAPZdh0kiPwjFAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.108] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "8QshAPZdh0kiPwjFAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.108] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "8QshAPZdh0kiPwjFAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.108] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "8QshAPZdh0kiPwjFAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.109] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "4CFKGgUz9SP1qV9NAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.109] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "4CFKGgUz9SP1qV9NAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.109] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "4CFKGgUz9SP1qV9NAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.109] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "4CFKGgUz9SP1qV9NAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.117] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.118] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.119] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:15.120] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3UMXBP",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.107] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3UMXBP",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.108] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3UMXBP",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.108] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3UMXBP",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.116] [32mINFO [0m [GameStateService] {
        "accessCode": "3UMXBP",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.117] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3UMXBP",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.128] [32mINFO [0m [GameStateService] {
        "accessCode": "3UMXBP",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
          "username": "p1-basic",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
          "username": "p2-basic",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament.test.ts:331:17)

    console.log
      [2025-05-26 12:32:17.147] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "d50c30aa-8693-465c-bee7-9783b0c86001",
        "accessCode": "SA8G7M"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.287] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "jDWPfBAq4XaQX97-AAAG",
        "user": {
          "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
          "username": "p1-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.287] [32mINFO [0m [GameHandlers] {
        "socketId": "jDWPfBAq4XaQX97-AAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.288] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "jDWPfBAq4XaQX97-AAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.290] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "LbwwZ2nNPhcIVlWEAAAH",
        "user": {
          "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
          "username": "p2-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.290] [32mINFO [0m [GameHandlers] {
        "socketId": "LbwwZ2nNPhcIVlWEAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.290] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "LbwwZ2nNPhcIVlWEAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.292] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "room": "game_SA8G7M",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.292] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "room": "game_SA8G7M",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.292] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "room": "game_SA8G7M",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.292] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "room": "game_SA8G7M",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.293] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "room": "game_SA8G7M",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.293] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "room": "game_SA8G7M",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.293] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "room": "game_SA8G7M",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.294] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "room": "game_SA8G7M",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.297] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "room": "game_SA8G7M",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "d50c30aa-8693-465c-bee7-9783b0c86001",
          "accessCode": "SA8G7M",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.300] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "room": "game_SA8G7M",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "d50c30aa-8693-465c-bee7-9783b0c86001",
          "accessCode": "SA8G7M",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.302] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "room": "game_SA8G7M",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "d50c30aa-8693-465c-bee7-9783b0c86001",
          "accessCode": "SA8G7M",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.303] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "room": "game_SA8G7M",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "d50c30aa-8693-465c-bee7-9783b0c86001",
          "accessCode": "SA8G7M",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.310] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.310] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.310] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.310] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.326] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "d50c30aa-8693-465c-bee7-9783b0c86001",
        "templateId": "6938bb88-6b8e-48fa-a976-ed9ebaf61984",
        "initiator": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "SA8G7M",
        "socketId": "jDWPfBAq4XaQX97-AAAG"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.529] [32mINFO [0m [GameStateService] {
        "accessCode": "SA8G7M"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:17.539] [32mINFO [0m [TournamentHandler] {
        "room": "game_SA8G7M",
        "duration": 5,
        "accessCode": "SA8G7M",
        "socketId": "jDWPfBAq4XaQX97-AAAG"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:19.118] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3UMXBP",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:19.121] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3UMXBP",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:19.121] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3UMXBP",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:19.122] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3UMXBP",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.544] [32mINFO [0m [GameStateService] {
        "accessCode": "SA8G7M"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.557] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SA8G7M"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.557] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SA8G7M",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.558] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SA8G7M"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.560] [32mINFO [0m [GameStateService] {
        "accessCode": "SA8G7M"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.561] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SA8G7M",
        "room": "game_SA8G7M",
        "socketIds": [
          "jDWPfBAq4XaQX97-AAAG",
          "LbwwZ2nNPhcIVlWEAAAH"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.561] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SA8G7M",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.561] [32mINFO [0m [SharedGameFlow] {
        "room": "game_SA8G7M",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "feedbackWaitTime": 2,
            "createdAt": "2025-05-26T10:32:09.665Z",
            "updatedAt": "2025-05-26T10:32:09.677Z"
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.562] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SA8G7M",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.563] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "jDWPfBAq4XaQX97-AAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.563] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "jDWPfBAq4XaQX97-AAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.564] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "jDWPfBAq4XaQX97-AAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.564] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "jDWPfBAq4XaQX97-AAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.564] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "LbwwZ2nNPhcIVlWEAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.564] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "LbwwZ2nNPhcIVlWEAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.565] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "LbwwZ2nNPhcIVlWEAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.565] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "LbwwZ2nNPhcIVlWEAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.569] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.570] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.570] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:22.570] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SA8G7M",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:24.563] [32mINFO [0m [SharedGameFlow] {
        "room": "game_SA8G7M",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:24.564] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SA8G7M",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:24.564] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SA8G7M",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:24.570] [32mINFO [0m [GameStateService] {
        "accessCode": "SA8G7M",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:24.571] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SA8G7M",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:24.574] [32mINFO [0m [GameStateService] {
        "accessCode": "SA8G7M",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
          "username": "p1-basic",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
          "username": "p2-basic",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament.test.ts:446:17)

    console.log
      Starting afterAll cleanup...

      at Object.<anonymous> (tests/integration/tournament.test.ts:78:17)

    console.log
      Processing socket1...

      at disconnectSocket (tests/integration/tournament.test.ts:86:21)

    console.log
      socket1 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament.test.ts:91:25)

    console.log
      socket1 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament.test.ts:101:37)

    console.log
      socket1 processing complete.

      at disconnectSocket (tests/integration/tournament.test.ts:117:21)

    console.log
      Processing socket2...

      at disconnectSocket (tests/integration/tournament.test.ts:86:21)

    console.log
      socket2 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament.test.ts:91:25)

    console.log
      socket2 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament.test.ts:101:37)

    console.log
      socket2 processing complete.

      at disconnectSocket (tests/integration/tournament.test.ts:117:21)

    console.log
      [2025-05-26 12:32:24.578] [32mINFO [0m [DisconnectHandler] {
        "socketId": "jDWPfBAq4XaQX97-AAAG",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "accessCode": "SA8G7M",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:24.578] [32mINFO [0m [DisconnectHandler] {
        "socketId": "LbwwZ2nNPhcIVlWEAAAH",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "accessCode": "SA8G7M",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:24.580] [32mINFO [0m [DisconnectHandler] {
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "accessCode": "SA8G7M",
        "socketId": "jDWPfBAq4XaQX97-AAAG"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:24.580] [32mINFO [0m [DisconnectHandler] {
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "accessCode": "SA8G7M",
        "socketId": "LbwwZ2nNPhcIVlWEAAAH"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:24.581] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
          "socketId": "jDWPfBAq4XaQX97-AAAG"
        },
        "room": "game_SA8G7M"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:24.581] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
          "socketId": "LbwwZ2nNPhcIVlWEAAAH"
        },
        "room": "game_SA8G7M"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing Socket.IO server...

      at Object.<anonymous> (tests/integration/tournament.test.ts:128:21)

    console.log
      [2025-05-26 12:32:25.079] [32mINFO [0m [DisconnectHandler] {
        "socketId": "8QshAPZdh0kiPwjFAAAC",
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "accessCode": "3UMXBP",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-26 12:32:25.080] [32mINFO [0m [DisconnectHandler] {
        "socketId": "4CFKGgUz9SP1qV9NAAAD",
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "accessCode": "3UMXBP",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-26 12:32:25.082] [32mINFO [0m [DisconnectHandler] {
        "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
        "accessCode": "3UMXBP",
        "socketId": "8QshAPZdh0kiPwjFAAAC"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:25.082] [32mINFO [0m [DisconnectHandler] {
        "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
        "accessCode": "3UMXBP",
        "socketId": "4CFKGgUz9SP1qV9NAAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket.IO server closed successfully.

      at Server.<anonymous> (tests/integration/tournament.test.ts:140:33)

    console.log
      Attempting to close HTTP server...

      at Object.<anonymous> (tests/integration/tournament.test.ts:148:17)

    console.log
      HTTP server was not listening. Assuming already closed or handled by Socket.IO close.

      at Object.<anonymous> (tests/integration/tournament.test.ts:168:25)

    console.log
      Waiting longer for server resources to release before closing Redis...

      at Object.<anonymous> (tests/integration/tournament.test.ts:174:17)

    console.log
      [2025-05-26 12:32:25.084] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "af6c65dc-2c57-4433-8461-1ef4c929f895",
          "socketId": "8QshAPZdh0kiPwjFAAAC"
        },
        "room": "game_3UMXBP"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:25.085] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "4792d42b-215f-42ba-9ac4-acd6c450c241",
          "socketId": "4CFKGgUz9SP1qV9NAAAD"
        },
        "room": "game_3UMXBP"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:26.571] [32mINFO [0m [SharedGameFlow] {
        "room": "game_SA8G7M",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:26.572] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SA8G7M",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:26.573] [32mINFO [0m [SharedGameFlow] {
        "room": "game_SA8G7M",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:26.573] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SA8G7M",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing SocketIO Redis clients (subClient)...

      at Object.<anonymous> (tests/integration/tournament.test.ts:178:17)

    console.log
      SocketIO Redis clients closed.

      at Object.<anonymous> (tests/integration/tournament.test.ts:181:21)

    console.log
      Closing main Redis client...

      at Object.<anonymous> (tests/integration/tournament.test.ts:189:17)

    console.log
      Main Redis client quit successfully.

      at Object.<anonymous> (tests/integration/tournament.test.ts:193:25)

    console.log
      Cleaning up database...

      at Object.<anonymous> (tests/integration/tournament.test.ts:204:17)

    console.log
      Database cleanup successful.

      at Object.<anonymous> (tests/integration/tournament.test.ts:216:21)

    console.warn
      Error cleaning up Redis keys: Connection is closed.

      226 |             }
      227 |         } catch (e: any) {
    > 228 |             console.warn('Error cleaning up Redis keys:', e.message || e);
          |                     ^
      229 |         }
      230 |
      231 |         await new Promise(resolve => setTimeout(resolve, 300));

      at Object.<anonymous> (tests/integration/tournament.test.ts:228:21)

    console.log
      afterAll cleanup complete.

      at Object.<anonymous> (tests/integration/tournament.test.ts:232:17)

PASS tests/integration/lobbyHandler.test.ts
  ‚óè Console

    console.log
      [2025-05-26 12:32:28.931] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.002] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "I0dvppdKrwY9Vr2hAAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.004] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "I0dvppdKrwY9Vr2hAAAB",
        "user": {
          "id": "player-123",
          "userId": "player-123",
          "username": "Test Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.012] [32mINFO [0m [GameHandlers] {
        "socketId": "I0dvppdKrwY9Vr2hAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.013] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "I0dvppdKrwY9Vr2hAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.022] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-123",
        "username": "Test Player",
        "socketId": "I0dvppdKrwY9Vr2hAAAB"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.029] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "I0dvppdKrwY9Vr2hAAAB"
      } Player leaving lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.033] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "I0dvppdKrwY9Vr2hAAAB"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.033] [32mINFO [0m [DisconnectHandler] {
        "socketId": "I0dvppdKrwY9Vr2hAAAB",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.033] [33mWARN [0m [DisconnectHandler] {
        "socketId": "I0dvppdKrwY9Vr2hAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.040] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "xF5-S0-CLuce5rpiAAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.040] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "xF5-S0-CLuce5rpiAAAE",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.040] [32mINFO [0m [GameHandlers] {
        "socketId": "xF5-S0-CLuce5rpiAAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.040] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "xF5-S0-CLuce5rpiAAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.042] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "y_DUFRQUE-PF3bdcAAAG"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.042] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "y_DUFRQUE-PF3bdcAAAG",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.042] [32mINFO [0m [GameHandlers] {
        "socketId": "y_DUFRQUE-PF3bdcAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.042] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "y_DUFRQUE-PF3bdcAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.044] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "ugp9smWJ2efR4943AAAH"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.044] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "ugp9smWJ2efR4943AAAH",
        "user": {
          "id": "player-3",
          "userId": "player-3",
          "username": "Player 3",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.045] [32mINFO [0m [GameHandlers] {
        "socketId": "ugp9smWJ2efR4943AAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.045] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "ugp9smWJ2efR4943AAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.046] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-1",
        "username": "Player 1",
        "socketId": "y_DUFRQUE-PF3bdcAAAG"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.050] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-2",
        "username": "Player 2",
        "socketId": "xF5-S0-CLuce5rpiAAAE"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.053] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-3",
        "username": "Player 3",
        "socketId": "ugp9smWJ2efR4943AAAH"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.055] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "y_DUFRQUE-PF3bdcAAAG"
      } Player leaving lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.058] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "ugp9smWJ2efR4943AAAH"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.058] [32mINFO [0m [DisconnectHandler] {
        "socketId": "ugp9smWJ2efR4943AAAH",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.058] [33mWARN [0m [DisconnectHandler] {
        "socketId": "ugp9smWJ2efR4943AAAH",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.059] [32mINFO [0m [DisconnectHandler] {
        "socketId": "y_DUFRQUE-PF3bdcAAAG",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.059] [33mWARN [0m [DisconnectHandler] {
        "socketId": "y_DUFRQUE-PF3bdcAAAG",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.059] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "xF5-S0-CLuce5rpiAAAE"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.059] [32mINFO [0m [DisconnectHandler] {
        "socketId": "xF5-S0-CLuce5rpiAAAE",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.059] [33mWARN [0m [DisconnectHandler] {
        "socketId": "xF5-S0-CLuce5rpiAAAE",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.062] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "q4z0Zsbjfe3CrNgLAAAJ"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.063] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "q4z0Zsbjfe3CrNgLAAAJ",
        "user": {
          "id": "player-redirect-test",
          "userId": "player-redirect-test",
          "username": "Redirect Test",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.063] [32mINFO [0m [GameHandlers] {
        "socketId": "q4z0Zsbjfe3CrNgLAAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.063] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "q4z0Zsbjfe3CrNgLAAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:29.064] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-redirect-test",
        "username": "Redirect Test",
        "socketId": "q4z0Zsbjfe3CrNgLAAAJ"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.073] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "gameId": "259b3ef3-0c59-4f6c-896e-0fbbcd63606f",
        "socketId": "q4z0Zsbjfe3CrNgLAAAJ"
      } Game is now active, sending redirect

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.085] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "q4z0Zsbjfe3CrNgLAAAJ"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.086] [32mINFO [0m [DisconnectHandler] {
        "socketId": "q4z0Zsbjfe3CrNgLAAAJ",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.087] [33mWARN [0m [DisconnectHandler] {
        "socketId": "q4z0Zsbjfe3CrNgLAAAJ",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.095] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "nN6rfc57OaGb73TLAAAM"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.095] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "nN6rfc57OaGb73TLAAAM",
        "user": {
          "id": "player-d1",
          "userId": "player-d1",
          "username": "Disconnect Test 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.096] [32mINFO [0m [GameHandlers] {
        "socketId": "nN6rfc57OaGb73TLAAAM"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.096] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "nN6rfc57OaGb73TLAAAM"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.097] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "0rKbQ3D2PEq9gL9HAAAN"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.097] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "0rKbQ3D2PEq9gL9HAAAN",
        "user": {
          "id": "player-d2",
          "userId": "player-d2",
          "username": "Disconnect Test 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.097] [32mINFO [0m [GameHandlers] {
        "socketId": "0rKbQ3D2PEq9gL9HAAAN"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.098] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "0rKbQ3D2PEq9gL9HAAAN"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.098] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-d1",
        "username": "Disconnect Test 1",
        "socketId": "nN6rfc57OaGb73TLAAAM"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.099] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-d2",
        "username": "Disconnect Test 2",
        "socketId": "0rKbQ3D2PEq9gL9HAAAN"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.111] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "nN6rfc57OaGb73TLAAAM"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.111] [32mINFO [0m [DisconnectHandler] {
        "socketId": "nN6rfc57OaGb73TLAAAM",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.111] [33mWARN [0m [DisconnectHandler] {
        "socketId": "nN6rfc57OaGb73TLAAAM",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.417] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "0rKbQ3D2PEq9gL9HAAAN"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.418] [32mINFO [0m [DisconnectHandler] {
        "socketId": "0rKbQ3D2PEq9gL9HAAAN",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:31.418] [33mWARN [0m [DisconnectHandler] {
        "socketId": "0rKbQ3D2PEq9gL9HAAAN",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

FAIL tests/integration/gameHandler.test.ts
  ‚óè Console

    console.log
      [2025-05-26 12:32:32.063] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.150] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "d2278884-2936-448c-9a89-fcf7ee99476d",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.157] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "InUqh696R6lERAdVAAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.158] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "InUqh696R6lERAdVAAAB",
        "user": {
          "id": "player-123",
          "userId": "player-123",
          "username": "Test Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.166] [32mINFO [0m [GameHandlers] {
        "socketId": "InUqh696R6lERAdVAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.166] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "InUqh696R6lERAdVAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.170] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "d2278884-2936-448c-9a89-fcf7ee99476d",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'InUqh696R6lERAdVAAAB',
        joinedRoomSocketIds: [ 'InUqh696R6lERAdVAAAB' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [2025-05-26 12:32:32.182] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.182] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Test Player",
        "avatarUrl": "https://example.com/avatar.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.182] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.182] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Test Player",
        "avatarUrl": "https://example.com/avatar.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.182] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.182] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.183] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "d2278884-2936-448c-9a89-fcf7ee99476d",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.184] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "d2278884-2936-448c-9a89-fcf7ee99476d",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.185] [32mINFO [0m [DisconnectHandler] {
        "socketId": "InUqh696R6lERAdVAAAB",
        "userId": "player-123",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.188] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.189] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.189] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-123",
        "accessCode": "TST789",
        "disconnectedSocketId": "InUqh696R6lERAdVAAAB",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.191] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "gX6yUqd5RKiMbQO1AAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.192] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "gX6yUqd5RKiMbQO1AAAE",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.192] [32mINFO [0m [GameHandlers] {
        "socketId": "gX6yUqd5RKiMbQO1AAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.192] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "gX6yUqd5RKiMbQO1AAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.197] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "d5_pYhELl_HeaqTVAAAF"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.198] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "d5_pYhELl_HeaqTVAAAF",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.198] [32mINFO [0m [GameHandlers] {
        "socketId": "d5_pYhELl_HeaqTVAAAF"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.198] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "d5_pYhELl_HeaqTVAAAF"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.199] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "40660f29-c686-4ee8-b7d6-209fd3116de6",
            "userId": "player-123",
            "username": "Test Player",
            "avatarUrl": "https://example.com/avatar.jpg",
            "score": 0,
            "joinedAt": "2025-05-26T10:32:32.189Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.199] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "40660f29-c686-4ee8-b7d6-209fd3116de6",
            "userId": "player-123",
            "username": "Test Player",
            "avatarUrl": "https://example.com/avatar.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.204] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "d2278884-2936-448c-9a89-fcf7ee99476d",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'gX6yUqd5RKiMbQO1AAAE',
        joinedRoomSocketIds: [ 'gX6yUqd5RKiMbQO1AAAE' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [2025-05-26 12:32:32.207] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.208] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarUrl": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.208] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.208] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarUrl": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.208] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.209] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.210] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "d2278884-2936-448c-9a89-fcf7ee99476d",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.211] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "d2278884-2936-448c-9a89-fcf7ee99476d",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.214] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.214] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'd5_pYhELl_HeaqTVAAAF',
        joinedRoomSocketIds: [ 'gX6yUqd5RKiMbQO1AAAE', 'd5_pYhELl_HeaqTVAAAF' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [2025-05-26 12:32:32.222] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "81ee0806-3f94-4b6d-8e45-493b03e5284d",
            "userId": "player-1",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "joinedAt": "2025-05-26T10:32:32.216Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.222] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "81ee0806-3f94-4b6d-8e45-493b03e5284d",
            "userId": "player-1",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.223] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.223] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarUrl": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.223] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.223] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarUrl": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.223] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.224] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.225] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "d2278884-2936-448c-9a89-fcf7ee99476d",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.226] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "d2278884-2936-448c-9a89-fcf7ee99476d",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.227] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.227] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.227] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "d22f25eb-97e7-4fd7-9737-8d7535bf5c5a",
            "userId": "player-2",
            "username": "Player 2",
            "avatarUrl": "https://example.com/avatar2.jpg",
            "score": 0,
            "joinedAt": "2025-05-26T10:32:32.221Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.228] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "d22f25eb-97e7-4fd7-9737-8d7535bf5c5a",
            "userId": "player-2",
            "username": "Player 2",
            "avatarUrl": "https://example.com/avatar2.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: Redis participants: {
        'player-2': '{"userId":"player-2","username":"Player 2","avatarUrl":"https://example.com/avatar2.jpg","joinedAt":"2025-05-26T10:32:32.221Z","score":0,"online":true,"lastSocketId":"d5_pYhELl_HeaqTVAAAF"}',
        'player-1': '{"userId":"player-1","username":"Player 1","avatarUrl":"https://example.com/avatar1.jpg","joinedAt":"2025-05-26T10:32:32.216Z","score":0,"online":true,"lastSocketId":"gX6yUqd5RKiMbQO1AAAE"}'
      }

      at Object.<anonymous> (tests/integration/gameHandler.test.ts:503:17)

    console.log
      [2025-05-26 12:32:32.330] [32mINFO [0m [DisconnectHandler] {
        "socketId": "gX6yUqd5RKiMbQO1AAAE",
        "userId": "player-1",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.331] [32mINFO [0m [DisconnectHandler] {
        "socketId": "d5_pYhELl_HeaqTVAAAF",
        "userId": "player-2",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.332] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-1",
        "accessCode": "TST789",
        "disconnectedSocketId": "gX6yUqd5RKiMbQO1AAAE",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.332] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TST789",
        "disconnectedSocketId": "d5_pYhELl_HeaqTVAAAF",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.336] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "Cwsd5QJoBERmroRIAAAI"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.336] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "Cwsd5QJoBERmroRIAAAI",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.336] [32mINFO [0m [GameHandlers] {
        "socketId": "Cwsd5QJoBERmroRIAAAI"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.337] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "Cwsd5QJoBERmroRIAAAI"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.338] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "t8GRIPDbh6zyGV80AAAJ"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.338] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "t8GRIPDbh6zyGV80AAAJ",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.338] [32mINFO [0m [GameHandlers] {
        "socketId": "t8GRIPDbh6zyGV80AAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.338] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "t8GRIPDbh6zyGV80AAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.345] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "d2278884-2936-448c-9a89-fcf7ee99476d",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'Cwsd5QJoBERmroRIAAAI',
        joinedRoomSocketIds: [ 'Cwsd5QJoBERmroRIAAAI' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [2025-05-26 12:32:32.348] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.348] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarUrl": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.348] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.348] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarUrl": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.348] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.348] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 't8GRIPDbh6zyGV80AAAJ',
        joinedRoomSocketIds: [ 'Cwsd5QJoBERmroRIAAAI', 't8GRIPDbh6zyGV80AAAJ' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [2025-05-26 12:32:32.349] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.349] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarUrl": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.349] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.349] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarUrl": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.349] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.349] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.350] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "d2278884-2936-448c-9a89-fcf7ee99476d",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.351] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "d2278884-2936-448c-9a89-fcf7ee99476d",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.351] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "d2278884-2936-448c-9a89-fcf7ee99476d",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.351] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "d2278884-2936-448c-9a89-fcf7ee99476d",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.352] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.353] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.353] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.353] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.357] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "81ee0806-3f94-4b6d-8e45-493b03e5284d",
            "userId": "player-1",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "joinedAt": "2025-05-26T10:32:32.352Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.357] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "81ee0806-3f94-4b6d-8e45-493b03e5284d",
            "userId": "player-1",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.359] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "d22f25eb-97e7-4fd7-9737-8d7535bf5c5a",
            "userId": "player-2",
            "username": "Player 2",
            "avatarUrl": "https://example.com/avatar2.jpg",
            "score": 0,
            "joinedAt": "2025-05-26T10:32:32.353Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.359] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "d22f25eb-97e7-4fd7-9737-8d7535bf5c5a",
            "userId": "player-2",
            "username": "Player 2",
            "avatarUrl": "https://example.com/avatar2.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: Redis participants: {
        'player-2': '{"userId":"player-2","username":"Player 2","avatarUrl":"https://example.com/avatar2.jpg","joinedAt":"2025-05-26T10:32:32.353Z","score":0,"online":true,"lastSocketId":"t8GRIPDbh6zyGV80AAAJ"}',
        'player-1': '{"userId":"player-1","username":"Player 1","avatarUrl":"https://example.com/avatar1.jpg","joinedAt":"2025-05-26T10:32:32.352Z","score":0,"online":true,"lastSocketId":"Cwsd5QJoBERmroRIAAAI"}'
      }

      at Object.<anonymous> (tests/integration/gameHandler.test.ts:599:17)

    console.log
      [2025-05-26 12:32:32.858] [32mINFO [0m [DisconnectHandler] {
        "socketId": "Cwsd5QJoBERmroRIAAAI",
        "userId": "player-1",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.860] [32mINFO [0m [DisconnectHandler] {
        "socketId": "t8GRIPDbh6zyGV80AAAJ",
        "userId": "player-2",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.862] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-1",
        "accessCode": "TST789",
        "disconnectedSocketId": "Cwsd5QJoBERmroRIAAAI",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:32.863] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TST789",
        "disconnectedSocketId": "t8GRIPDbh6zyGV80AAAJ",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)



  ‚óè Test suite failed to run

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/aflesch/mathquest/app/backend/tests/integration/gameHandler.test.ts:246:27

      243     }
      244 });
      245 // Clean up test players
    ‚Üí 246 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `StudentProfile_id_fkey`

      122 |
      123 | More Information: https://pris.ly/d/execute-raw
    > 124 | `)}var Co=({clientMethod:e,activeProvider:r})=>t=>{let n="",i;if(Nn(t))n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};else if(Array.isArray(t)){let[o,...s]=t;n=o,i={values:Gr(s||[]),__prismaRawParameters__:!0}}else switch(r){case"sqlite":case"mysql":{n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"cockroachdb":case"postgresql":case"postgres":{n=t.text,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"sqlserver":{n=$l(t),i={values:Gr(t.values),__prismaRawParameters__:!0};break}default:throw new Error(`The ${r} provider does not support ${e}`)}return i?.values?Ul(`prisma.${e}(${n}, ${i.values})`):Ul(`prisma.${e}(${n})`),{query:n,parameters:i}},Ql={requestArgsToMiddlewareArgs(e){return[e.strings,...e.values]},middlewareArgsToRequestArgs(e){let[r,...t]=e;return new oe(r,t)}},Gl={requestArgsToMiddlewareArgs(e){return[e]},middlewareArgsToRequestArgs(e){return e[0]}};function Ao(e){return function(t,n){let i,o=(s=e)=>{try{return s===void 0||s?.kind==="itx"?i??=Wl(t(s)):Wl(t(s))}catch(a){return Promise.reject(a)}};return{get spec(){return n},then(s,a){return o().then(s,a)},catch(s){return o().catch(s)},finally(s){return o().finally(s)},requestTransaction(s){let a=o(s);return a.requestTransaction?a.requestTransaction(s):a},[Symbol.toStringTag]:"PrismaPromise"}}}function Wl(e){return typeof e.then=="function"?e:Promise.resolve(e)}var Pf=bi.split(".")[0],Tf={isEnabled(){return!1},getTraceParent(){return"00-10-10-00"},dispatchEngineSpans(){},getActiveContext(){},runInChildSpan(e,r){return r()}},Io=class{isEnabled(){return this.getGlobalTracingHelper().isEnabled()}getTraceParent(r){return this.getGlobalTracingHelper().getTraceParent(r)}dispatchEngineSpans(r){return this.getGlobalTracingHelper().dispatchEngineSpans(r)}getActiveContext(){return this.getGlobalTracingHelper().getActiveContext()}runInChildSpan(r,t){return this.getGlobalTracingHelper().runInChildSpan(r,t)}getGlobalTracingHelper(){let r=globalThis[`V${Pf}_PRISMA_INSTRUMENTATION`],t=globalThis.PRISMA_INSTRUMENTATION;return r?.helper??t?.helper??Tf}};function Jl(){return new Io}function Hl(e,r=()=>{}){let t,n=new Promise(i=>t=i);return{then(i){return--e===0&&t(r()),i?.(n)}}}function Kl(e){return typeof e=="string"?e:e.reduce((r,t)=>{let n=typeof t=="string"?t:t.level;return n==="query"?r:r&&(t==="info"||r==="info")?"info":n},void 0)}var Jn=class{_middlewares=[];use(r){this._middlewares.push(r)}get(r){return this._middlewares[r]}has(r){return!!this._middlewares[r]}length(){return this._middlewares.length}};var zl=k(ki());function Hn(e){return typeof e.batchRequestIdx=="number"}function Yl(e){if(e.action!=="findUnique"&&e.action!=="findUniqueOrThrow")return;let r=[];return e.modelName&&r.push(e.modelName),e.query.arguments&&r.push(ko(e.query.arguments)),r.push(ko(e.query.selection)),r.join("")}function ko(e){return`(${Object.keys(e).sort().map(t=>{let n=e[t];return typeof n=="object"&&n!==null?`(${t} ${ko(n)})`:t}).join(" ")})`}var Sf={aggregate:!1,aggregateRaw:!1,createMany:!0,createManyAndReturn:!0,createOne:!0,deleteMany:!0,deleteOne:!0,executeRaw:!0,findFirst:!1,findFirstOrThrow:!1,findMany:!1,findRaw:!1,findUnique:!1,findUniqueOrThrow:!1,groupBy:!1,queryRaw:!1,runCommandRaw:!0,updateMany:!0,updateManyAndReturn:!0,updateOne:!0,upsertOne:!0};function Oo(e){return Sf[e]}var Kn=class{constructor(r){this.options=r;this.batches={}}batches;tickActive=!1;request(r){let t=this.options.batchBy(r);return t?(this.batches[t]||(this.batches[t]=[],this.tickActive||(this.tickActive=!0,process.nextTick(()=>{this.dispatchBatches(),this.tickActive=!1}))),new Promise((n,i)=>{this.batches[t].push({request:r,resolve:n,reject:i})})):this.options.singleLoader(r)}dispatchBatches(){for(let r in this.batches){let t=this.batches[r];delete this.batches[r],t.length===1?this.options.singleLoader(t[0].request).then(n=>{n instanceof Error?t[0].reject(n):t[0].resolve(n)}).catch(n=>{t[0].reject(n)}):(t.sort((n,i)=>this.options.batchOrder(n.request,i.request)),this.options.batchLoader(t.map(n=>n.request)).then(n=>{if(n instanceof Error)for(let i=0;i<t.length;i++)t[i].reject(n);else for(let i=0;i<t.length;i++){let o=n[i];o instanceof Error?t[i].reject(o):t[i].resolve(o)}}).catch(n=>{for(let i=0;i<t.length;i++)t[i].reject(n)}))}}get[Symbol.toStringTag](){return"DataLoader"}};function mr(e,r){if(r===null)return r;switch(e){case"bigint":return BigInt(r);case"bytes":{let{buffer:t,byteOffset:n,byteLength:i}=Buffer.from(r,"base64");return new Uint8Array(t,n,i)}case"decimal":return new ve(r);case"datetime":case"date":return new Date(r);case"time":return new Date(`1970-01-01T${r}Z`);case"bigint-array":return r.map(t=>mr("bigint",t));case"bytes-array":return r.map(t=>mr("bytes",t));case"decimal-array":return r.map(t=>mr("decimal",t));case"datetime-array":return r.map(t=>mr("datetime",t));case"date-array":return r.map(t=>mr("date",t));case"time-array":return r.map(t=>mr("time",t));default:return r}}function Yn(e){let r=[],t=Rf(e);for(let n=0;n<e.rows.length;n++){let i=e.rows[n],o={...t};for(let s=0;s<i.length;s++)o[e.columns[s]]=mr(e.types[s],i[s]);r.push(o)}return r}function Rf(e){let r={};for(let t=0;t<e.columns.length;t++)r[e.columns[t]]=null;return r}var Cf=N("prisma:client:request_handler"),zn=class{client;dataloader;logEmitter;constructor(r,t){this.logEmitter=t,this.client=r,this.dataloader=new Kn({batchLoader:il(async({requests:n,customDataProxyFetch:i})=>{let{transaction:o,otelParentCtx:s}=n[0],a=n.map(p=>p.protocolQuery),l=this.client._tracingHelper.getTraceParent(s),u=n.some(p=>Oo(p.protocolQuery.action));return(await this.client._engine.requestBatch(a,{traceparent:l,transaction:Af(o),containsWrite:u,customDataProxyFetch:i})).map((p,d)=>{if(p instanceof Error)return p;try{return this.mapQueryEngineResult(n[d],p)}catch(f){return f}})}),singleLoader:async n=>{let i=n.transaction?.kind==="itx"?Zl(n.transaction):void 0,o=await this.client._engine.request(n.protocolQuery,{traceparent:this.client._tracingHelper.getTraceParent(),interactiveTransaction:i,isWrite:Oo(n.protocolQuery.action),customDataProxyFetch:n.customDataProxyFetch});return this.mapQueryEngineResult(n,o)},batchBy:n=>n.transaction?.id?`transaction-${n.transaction.id}`:Yl(n.protocolQuery),batchOrder(n,i){return n.transaction?.kind==="batch"&&i.transaction?.kind==="batch"?n.transaction.index-i.transaction.index:0}})}async request(r){try{return await this.dataloader.request(r)}catch(t){let{clientMethod:n,callsite:i,transaction:o,args:s,modelName:a}=r;this.handleAndLogRequestError({error:t,clientMethod:n,callsite:i,transaction:o,args:s,modelName:a,globalOmit:r.globalOmit})}}mapQueryEngineResult({dataPath:r,unpacker:t},n){let i=n?.data,o=this.unpack(i,r,t);return process.env.PRISMA_CLIENT_GET_TIME?{data:o}:o}handleAndLogRequestError(r){try{this.handleRequestError(r)}catch(t){throw this.logEmitter&&this.logEmitter.emit("error",{message:t.message,target:r.clientMethod,timestamp:new Date}),t}}handleRequestError({error:r,clientMethod:t,callsite:n,transaction:i,args:o,modelName:s,globalOmit:a}){if(Cf(r),If(r,i))throw r;if(r instanceof z&&kf(r)){let u=Xl(r.meta);An({args:o,errors:[u],callsite:n,errorFormat:this.client._errorFormat,originalMethod:t,clientVersion:this.client._clientVersion,globalOmit:a})}let l=r.message;if(n&&(l=bn({callsite:n,originalMethod:t,isPanic:r.isPanic,showColors:this.client._errorFormat==="pretty",message:l})),l=this.sanitizeMessage(l),r.code){let u=s?{modelName:s,...r.meta}:r.meta;throw new z(l,{code:r.code,clientVersion:this.client._clientVersion,meta:u,batchRequestIdx:r.batchRequestIdx})}else{if(r.isPanic)throw new le(l,this.client._clientVersion);if(r instanceof j)throw new j(l,{clientVersion:this.client._clientVersion,batchRequestIdx:r.batchRequestIdx});if(r instanceof T)throw new T(l,this.client._clientVersion);if(r instanceof le)throw new le(l,this.client._clientVersion)}throw r.clientVersion=this.client._clientVersion,r}sanitizeMessage(r){return this.client._errorFormat&&this.client._errorFormat!=="pretty"?(0,zl.default)(r):r}unpack(r,t,n){if(!r||(r.data&&(r=r.data),!r))return r;let i=Object.keys(r)[0],o=Object.values(r)[0],s=t.filter(u=>u!=="select"&&u!=="include"),a=io(o,s),l=i==="queryRaw"?Yn(a):Tr(a);return n?n(l):l}get[Symbol.toStringTag](){return"RequestHandler"}};function Af(e){if(e){if(e.kind==="batch")return{kind:"batch",options:{isolationLevel:e.isolationLevel}};if(e.kind==="itx")return{kind:"itx",options:Zl(e)};_e(e,"Unknown transaction kind")}}function Zl(e){return{id:e.id,payload:e.payload}}function If(e,r){return Hn(e)&&r?.kind==="batch"&&e.batchRequestIdx!==r.index}function kf(e){return e.code==="P2009"||e.code==="P2012"}function Xl(e){if(e.kind==="Union")return{kind:"Union",errors:e.errors.map(Xl)};if(Array.isArray(e.selectionPath)){let[,...r]=e.selectionPath;return{...e,selectionPath:r}}return e}var eu="6.7.0";var ru=eu;var su=k(Gi());var D=class extends Error{constructor(r){super(r+`
          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ^
      125 | Read more at https://pris.ly/d/client-constructor`),this.name="PrismaClientConstructorValidationError"}get[Symbol.toStringTag](){return"PrismaClientConstructorValidationError"}};x(D,"PrismaClientConstructorValidationError");var tu=["datasources","datasourceUrl","errorFormat","adapter","log","transactionOptions","omit","__internal"],nu=["pretty","colorless","minimal"],iu=["info","query","warn","error"],Df={datasources:(e,{datasourceNames:r})=>{if(e){if(typeof e!="object"||Array.isArray(e))throw new D(`Invalid value ${JSON.stringify(e)} for "datasources" provided to PrismaClient constructor`);for(let[t,n]of Object.entries(e)){if(!r.includes(t)){let i=Wr(t,r)||` Available datasources: ${r.join(", ")}`;throw new D(`Unknown datasource ${t} provided to PrismaClient constructor.${i}`)}if(typeof n!="object"||Array.isArray(n))throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      126 | It should have this form: { url: "CONNECTION_STRING" }`);if(n&&typeof n=="object")for(let[i,o]of Object.entries(n)){if(i!=="url")throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      127 | It should have this form: { url: "CONNECTION_STRING" }`);if(typeof o!="string")throw new D(`Invalid value ${JSON.stringify(o)} for datasource "${t}" provided to PrismaClient constructor.

      at zn.handleRequestError (src/db/generated/client/runtime/library.js:124:7459)
      at zn.handleRequestError [as handleAndLogRequestError] (src/db/generated/client/runtime/library.js:124:6784)
      at zn.handleAndLogRequestError [as request] (src/db/generated/client/runtime/library.js:124:6491)
      at l (src/db/generated/client/runtime/library.js:133:9778)
      at Object.<anonymous> (tests/integration/gameHandler.test.ts:246:9)

PASS tests/integration/mockedGameHandler.test.ts
  ‚óè Console

    console.log
      [2025-05-26 12:32:33.947] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.122] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "0c6e23fe-5a00-48be-ae7d-cf279a83c151",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.132] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-71c8ctrzw1"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.132] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-71c8ctrzw1"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'socket-71c8ctrzw1',
        joinedRoomSocketIds: []
      }

      at log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [2025-05-26 12:32:34.145] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "8e83141e-e7b2-4e5f-b906-8fcb97c1faf6",
            "userId": "player-1_mb4y7us5f9577x",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "joinedAt": "2025-05-26T10:32:34.140Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.145] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "8e83141e-e7b2-4e5f-b906-8fcb97c1faf6",
            "userId": "player-1_mb4y7us5f9577x",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.258] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-s1c237htgu"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.258] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-s1c237htgu"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.269] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-iinwdhast6"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.269] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-iinwdhast6"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        questionId: 'q-3',
        answer: { selectedOption: 'b' },
        timeSpent: 5000
      } Socket ID: socket-iinwdhast6 Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-26 12:32:34.273] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-iinwdhast6",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "questionId": "q-3",
          "answer": {
            "selectedOption": "b"
          },
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.274] [33mWARN [0m [GameAnswerHandler] {
        "socketId": "socket-iinwdhast6",
        "error": "Invalid payload",
        "details": {
          "_errors": [],
          "userId": {
            "_errors": [
              "Required"
            ]
          },
          "answer": {
            "_errors": [
              "Expected string, received object",
              "Expected number, received object",
              "Expected array, received object",
              "Expected array, received object"
            ]
          }
        }
      } Invalid game answer payload

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        questionId: 'q-3',
        answer: { selectedOption: 'b' },
        timeSpent: 5000
      } Socket ID: socket-iinwdhast6 Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-26 12:32:34.274] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-iinwdhast6",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "questionId": "q-3",
          "answer": {
            "selectedOption": "b"
          },
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.275] [33mWARN [0m [GameAnswerHandler] {
        "socketId": "socket-iinwdhast6",
        "error": "Invalid payload",
        "details": {
          "_errors": [],
          "userId": {
            "_errors": [
              "Required"
            ]
          },
          "answer": {
            "_errors": [
              "Expected string, received object",
              "Expected number, received object",
              "Expected array, received object",
              "Expected array, received object"
            ]
          }
        }
      } Invalid game answer payload

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.286] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-0i6e85mh3i7t"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.286] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-0i6e85mh3i7t"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.431] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-3c5dy03lkcw"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.431] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-3c5dy03lkcw"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.461] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-u2t6iy7wb08"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.461] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-u2t6iy7wb08"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.470] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "DIFF123",
          "participant": {
            "id": "18e6043f-b066-4b6b-ae03-0c5b16e1fcd7",
            "userId": "player-1_mb4y7us5f9577x",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "joinedAt": "2025-05-26T10:32:34.467Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": true,
          "differedAvailableFrom": "2025-05-26T10:32:34.451Z",
          "differedAvailableTo": "2025-05-26T11:32:34.451Z"
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.481] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-9uvpn52v7h"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.481] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-9uvpn52v7h"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.482] [33mWARN [0m [JoinGameHandler] {
        "errorPayload": {
          "message": "Differed mode not available at this time."
        }
      } Emitting game_error: differed window not available

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.493] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-t4gtg31axeh"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.493] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-t4gtg31axeh"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.496] [32mINFO [0m [JoinGameHandler] {
        "gameAlreadyPlayedPayload": {
          "accessCode": "DIFF123"
        }
      } Emitting game_already_played

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.505] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-br5s474imd9"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.505] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-br5s474imd9"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.517] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "DIFF123",
          "participant": {
            "id": "4d1f4329-de57-45d2-84aa-ad99b7b2c965",
            "userId": "player-3_mb4y7us5f9577x",
            "username": "Player 3",
            "avatarUrl": "https://example.com/avatar3.jpg",
            "score": 0,
            "joinedAt": "2025-05-26T10:32:34.515Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": true,
          "differedAvailableFrom": "2025-05-26T10:32:34.482Z",
          "differedAvailableTo": "2025-05-26T11:32:34.482Z"
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'DIFF123',
        userId: 'player-3_mb4y7us5f9577x',
        questionId: '54678be7-6b00-45bc-8bf3-d3e2ee892286',
        answer: 'b',
        timeSpent: 2000
      } Socket ID: socket-br5s474imd9 Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-26 12:32:34.518] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-br5s474imd9",
        "event": "game_answer",
        "payload": {
          "accessCode": "DIFF123",
          "userId": "player-3_mb4y7us5f9577x",
          "questionId": "54678be7-6b00-45bc-8bf3-d3e2ee892286",
          "answer": "b",
          "timeSpent": 2000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.530] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mb4y7us5f9577x",
        "questionId": "54678be7-6b00-45bc-8bf3-d3e2ee892286"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at log (src/sockets/handlers/game/gameAnswer.ts:178:25)

    console.log
      [GAME_ANSWER] Adding current questionId 54678be7-6b00-45bc-8bf3-d3e2ee892286 to answered questions

      at log (src/sockets/handlers/game/gameAnswer.ts:190:29)

    console.log
      [GAME_ANSWER] Found 1/1 answered questions: [ '54678be7-6b00-45bc-8bf3-d3e2ee892286' ]

      at log (src/sockets/handlers/game/gameAnswer.ts:197:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=1

      at log (src/sockets/handlers/game/gameAnswer.ts:206:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at log (src/sockets/handlers/game/gameAnswer.ts:216:29)

    console.log
      [2025-05-26 12:32:34.531] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mb4y7us5f9577x",
        "questionId": "54678be7-6b00-45bc-8bf3-d3e2ee892286"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'DIFF123',
        userId: 'player-3_mb4y7us5f9577x',
        questionId: '54678be7-6b00-45bc-8bf3-d3e2ee892286',
        answer: 'b',
        timeSpent: 2000
      } Socket ID: socket-br5s474imd9 Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-26 12:32:34.531] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-br5s474imd9",
        "event": "game_answer",
        "payload": {
          "accessCode": "DIFF123",
          "userId": "player-3_mb4y7us5f9577x",
          "questionId": "54678be7-6b00-45bc-8bf3-d3e2ee892286",
          "answer": "b",
          "timeSpent": 2000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.541] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mb4y7us5f9577x",
        "questionId": "54678be7-6b00-45bc-8bf3-d3e2ee892286"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":"b","timestamp":"2025-05-26T10:32:34.520Z","questionUid":"54678be7-6b00-45bc-8bf3-d3e2ee892286","timeTakenMs":2000}]

      at log (src/sockets/handlers/game/gameAnswer.ts:178:25)

    console.log
      [GAME_ANSWER] Found 1/1 answered questions: [ '54678be7-6b00-45bc-8bf3-d3e2ee892286' ]

      at log (src/sockets/handlers/game/gameAnswer.ts:197:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=1

      at log (src/sockets/handlers/game/gameAnswer.ts:206:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at log (src/sockets/handlers/game/gameAnswer.ts:216:29)

    console.log
      [2025-05-26 12:32:34.542] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mb4y7us5f9577x",
        "questionId": "54678be7-6b00-45bc-8bf3-d3e2ee892286"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.552] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-6rgttgb123y"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.552] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-6rgttgb123y"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'socket-6rgttgb123y',
        joinedRoomSocketIds: []
      }

      at log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [2025-05-26 12:32:34.557] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "8e83141e-e7b2-4e5f-b906-8fcb97c1faf6",
            "userId": "player-1_mb4y7us5f9577x",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "joinedAt": "2025-05-26T10:32:34.555Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.558] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "8e83141e-e7b2-4e5f-b906-8fcb97c1faf6",
            "userId": "player-1_mb4y7us5f9577x",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.561] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.564] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789",
        "questionIndex": 0
      } Current question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        userId: 'player-1_mb4y7us5f9577x',
        questionId: '60818927-d6b5-4a29-bc1c-2e92a7f8e319',
        answer: 1,
        timeSpent: 5000
      } Socket ID: socket-6rgttgb123y Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-26 12:32:34.565] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-6rgttgb123y",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "userId": "player-1_mb4y7us5f9577x",
          "questionId": "60818927-d6b5-4a29-bc1c-2e92a7f8e319",
          "answer": 1,
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.575] [32mINFO [0m [GameAnswerHandler] {
        "leaderboard": [
          {
            "userId": "player-1_mb4y7us5f9577x",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0
          }
        ],
        "roomName": "teacher_47809baf-99b3-4b31-a3ea-54d17e8af095_TST789"
      } Emitting leaderboard_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.575] [32mINFO [0m [GameAnswerHandler] {
        "questionId": "60818927-d6b5-4a29-bc1c-2e92a7f8e319",
        "timeSpent": 5000
      } Emitting answer_received for non-differed mode

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Successfully emitted answer_received for question 60818927-d6b5-4a29-bc1c-2e92a7f8e319 to socket socket-6rgttgb123y

      at log (src/sockets/handlers/game/gameAnswer.ts:242:29)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        userId: 'player-1_mb4y7us5f9577x',
        questionId: '60818927-d6b5-4a29-bc1c-2e92a7f8e319',
        answer: 1,
        timeSpent: 5000
      } Socket ID: socket-6rgttgb123y Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-26 12:32:34.576] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-6rgttgb123y",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "userId": "player-1_mb4y7us5f9577x",
          "questionId": "60818927-d6b5-4a29-bc1c-2e92a7f8e319",
          "answer": 1,
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.586] [32mINFO [0m [GameAnswerHandler] {
        "leaderboard": [
          {
            "userId": "player-1_mb4y7us5f9577x",
            "username": "Player 1",
            "avatarUrl": "https://example.com/avatar1.jpg",
            "score": 0
          }
        ],
        "roomName": "teacher_47809baf-99b3-4b31-a3ea-54d17e8af095_TST789"
      } Emitting leaderboard_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:34.586] [32mINFO [0m [GameAnswerHandler] {
        "questionId": "60818927-d6b5-4a29-bc1c-2e92a7f8e319",
        "timeSpent": 5000
      } Emitting answer_received for non-differed mode

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Successfully emitted answer_received for question 60818927-d6b5-4a29-bc1c-2e92a7f8e319 to socket socket-6rgttgb123y

      at log (src/sockets/handlers/game/gameAnswer.ts:242:29)

    console.log
      [DEBUG before scoring] Redis key: mathquest:game:answers:TST789:60818927-d6b5-4a29-bc1c-2e92a7f8e319 value: {
        'player-1_mb4y7us5f9577x': '{"userId":"player-1_mb4y7us5f9577x","answer":1,"timeSpent":5000,"submittedAt":1748255554583}'
      }

      at Object.<anonymous> (tests/integration/mockedGameHandler.test.ts:920:21)

    console.log
      [2025-05-26 12:32:34.591] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789",
        "questionId": "60818927-d6b5-4a29-bc1c-2e92a7f8e319"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG after scoring] Redis key: mathquest:game:answers:TST789:60818927-d6b5-4a29-bc1c-2e92a7f8e319 value: {
        'player-1_mb4y7us5f9577x': '{"userId":"player-1_mb4y7us5f9577x","answer":1,"timeSpent":5000,"submittedAt":1748255554583}'
      }

      at Object.<anonymous> (tests/integration/mockedGameHandler.test.ts:927:21)

PASS tests/integration/teacherQuiz.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-26 12:32:35.043] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.046] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      Creating game template with payload: {
        name: 'My First Quiz Template',
        discipline: 'math',
        gradeLevel: 'middle',
        themes: [ 'arithmetic' ],
        questions: [ { questionUid: 'test-q-quiz-1', sequence: 1 } ]
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:94:17)

    console.log
      [2025-05-26 12:32:35.129] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJlMWMwMTJiNC0zZjVhLTQ5MTktYjYyNC0zMjEwY2M0NmQ2NTAiLCJ1c2VybmFtZSI6InF1aXpUZWFjaGVyIiwicm9sZSI6IlRFQUNIRVIiLCJpYXQiOjE3NDgyNTU1NTUsImV4cCI6MTc0ODI1OTE1NX0.1J78UPE_ACpfn3-J-l0rmE65UoFyIvbDOpUcCUOn15Y"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.131] [32mINFO [0m [GameTemplatesAPI] {
        "body": {
          "name": "My First Quiz Template",
          "discipline": "math",
          "gradeLevel": "middle",
          "themes": [
            "arithmetic"
          ],
          "questions": [
            {
              "questionUid": "test-q-quiz-1",
              "sequence": 1
            }
          ]
        },
        "user": {
          "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
          "username": "quizTeacher",
          "role": "TEACHER",
          "iat": 1748255555,
          "exp": 1748259155
        }
      } Received request for game template creation

      at log (src/utils/logger.ts:102:21)

    console.log
      Game template response status: 201

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:111:17)

    console.log
      Game template response body: {
        gameTemplate: {
          id: 'cccb804d-7262-497d-aa5f-59e2b8cf4384',
          name: 'My First Quiz Template',
          creatorId: 'e1c012b4-3f5a-4919-b624-3210cc46d650',
          gradeLevel: 'middle',
          themes: [ 'arithmetic' ],
          discipline: 'math',
          description: null,
          defaultMode: null,
          createdAt: '2025-05-26T10:32:35.135Z',
          updatedAt: '2025-05-26T10:32:35.135Z',
          questions: [ [Object] ]
        }
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:112:17)

    console.log
      Creating game instance with payload: {
        name: 'Live Quiz Session 1',
        playMode: 'quiz',
        gameTemplateId: 'cccb804d-7262-497d-aa5f-59e2b8cf4384'
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:118:17)

    console.log
      [2025-05-26 12:32:35.153] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "accessCode": "93L9HG"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      Game instance response status: 201

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:131:17)

    console.log
      Game instance response body: {
        gameInstance: {
          id: '21a3628e-6c0e-44e8-bda7-195999931ff1',
          name: 'Live Quiz Session 1',
          gameTemplateId: 'cccb804d-7262-497d-aa5f-59e2b8cf4384',
          initiatorUserId: 'e1c012b4-3f5a-4919-b624-3210cc46d650',
          accessCode: '93L9HG',
          status: 'pending',
          playMode: 'quiz',
          leaderboard: null,
          currentQuestionIndex: null,
          settings: {},
          createdAt: '2025-05-26T10:32:35.146Z',
          startedAt: null,
          endedAt: null,
          isDiffered: false,
          differedAvailableFrom: null,
          differedAvailableTo: null,
          gameTemplate: {
            name: 'My First Quiz Template',
            themes: [Array],
            discipline: 'math',
            gradeLevel: 'middle'
          }
        }
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:132:17)

    console.log
      [2025-05-26 12:32:35.157] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "leEqRlUtJm6qBrBgAAAB",
        "user": {
          "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
          "role": "TEACHER"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.162] [32mINFO [0m [GameHandlers] {
        "socketId": "leEqRlUtJm6qBrBgAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.162] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "leEqRlUtJm6qBrBgAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.163] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "leEqRlUtJm6qBrBgAAAB",
        "socketData": {
          "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
          "user": {
            "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
            "role": "TEACHER"
          },
          "connectionInfo": {
            "id": "leEqRlUtJm6qBrBgAAAB",
            "address": "::ffff:127.0.0.1",
            "time": "2025-05-26T10:32:35.157Z"
          }
        },
        "auth": {
          "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJlMWMwMTJiNC0zZjVhLTQ5MTktYjYyNC0zMjEwY2M0NmQ2NTAiLCJ1c2VybmFtZSI6InF1aXpUZWFjaGVyIiwicm9sZSI6IlRFQUNIRVIiLCJpYXQiOjE3NDgyNTU1NTUsImV4cCI6MTc0ODI1OTE1NX0.1J78UPE_ACpfn3-J-l0rmE65UoFyIvbDOpUcCUOn15Y",
          "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
          "userType": "teacher"
        },
        "headers": {
          "sec-websocket-version": "13",
          "sec-websocket-key": "ycefIlmT3GMnl94VW107gQ==",
          "connection": "Upgrade",
          "upgrade": "websocket",
          "sec-websocket-extensions": "permessage-deflate; client_max_window_bits",
          "host": "localhost:41645"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.164] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
        "socketId": "leEqRlUtJm6qBrBgAAAB"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.166] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "leEqRlUtJm6qBrBgAAAB",
        "allRooms": [
          "leEqRlUtJm6qBrBgAAAB",
          "dashboard_21a3628e-6c0e-44e8-bda7-195999931ff1",
          "projection_21a3628e-6c0e-44e8-bda7-195999931ff1"
        ],
        "dashboardRoom": "dashboard_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "dashboardSockets": [
          "leEqRlUtJm6qBrBgAAAB"
        ],
        "projectionRoom": "projection_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "projectionSockets": [
          "leEqRlUtJm6qBrBgAAAB"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.172] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
        "socketId": "leEqRlUtJm6qBrBgAAAB"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-26 12:32:35.175] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "Vo5e0aGgTHszEhFwAAAD",
        "user": {
          "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
          "username": "quizPlayer1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.175] [32mINFO [0m [GameHandlers] {
        "socketId": "Vo5e0aGgTHszEhFwAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.175] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "Vo5e0aGgTHszEhFwAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_93L9HG',
        socketId: 'Vo5e0aGgTHszEhFwAAAD',
        joinedRoomSocketIds: [ 'Vo5e0aGgTHszEhFwAAAD' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:108:25)

    console.log
      [2025-05-26 12:32:35.188] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "93L9HG",
        "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.188] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "93L9HG",
        "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
        "room": "game_93L9HG",
        "playMode": "quiz",
        "username": "quizPlayer1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.189] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "93L9HG",
        "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.189] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "93L9HG",
        "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
        "room": "game_93L9HG",
        "playMode": "quiz",
        "username": "quizPlayer1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.189] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "93L9HG",
        "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
        "room": "game_93L9HG",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.189] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "93L9HG",
        "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
        "room": "game_93L9HG",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.190] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "93L9HG",
        "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
        "room": "game_93L9HG",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
          "accessCode": "93L9HG",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.190] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "93L9HG",
        "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
        "room": "game_93L9HG",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
          "accessCode": "93L9HG",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.198] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
        "questionUid": "test-q-quiz-1"
      } Setting question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.200] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "93L9HG",
        "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.200] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "93L9HG",
        "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.202] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "93L9HG",
          "participant": {
            "id": "f7c7e943-3e5c-4675-8ff1-3158ba5f7e6b",
            "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
            "username": "quizPlayer1",
            "score": 0,
            "joinedAt": "2025-05-26T10:32:35.189Z",
            "online": true
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.202] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "f7c7e943-3e5c-4675-8ff1-3158ba5f7e6b",
            "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
            "username": "quizPlayer1",
            "score": 0,
            "online": true
          }
        },
        "room": "game_93L9HG"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.205] [32mINFO [0m [GameStateService] {
        "accessCode": "93L9HG"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.205] [32mINFO [0m [SetQuestionHandler] {
        "liveRoom": "game_93L9HG",
        "liveRoomSocketIds": [
          "Vo5e0aGgTHszEhFwAAAD"
        ],
        "payload": {
          "question": {
            "uid": "test-q-quiz-1",
            "text": "What is 2+2 for quiz?",
            "answerOptions": [
              "3",
              "4",
              "5"
            ],
            "correctAnswers": [
              false,
              false,
              false
            ],
            "questionType": "multiple_choice_single_answer",
            "timeLimit": 30,
            "currentQuestionIndex": 0,
            "totalQuestions": 1
          },
          "timer": {
            "startedAt": 1748255555205,
            "duration": 30000,
            "isPaused": true
          }
        }
      } [DEBUG] Emitting game_question to live room

      at log (src/utils/logger.ts:102:21)

    console.log
      [setQuestion] Emitting game_question: {
        liveRoom: 'game_93L9HG',
        liveRoomSocketIds: [ 'Vo5e0aGgTHszEhFwAAAD' ],
        payload: {
          question: {
            uid: 'test-q-quiz-1',
            title: undefined,
            text: 'What is 2+2 for quiz?',
            answerOptions: [Array],
            correctAnswers: [Array],
            questionType: 'multiple_choice_single_answer',
            timeLimit: 30,
            currentQuestionIndex: 0,
            totalQuestions: 1
          },
          timer: { startedAt: 1748255555205, duration: 30000, isPaused: true }
        }
      }

      at Socket.log (src/sockets/handlers/teacherControl/setQuestion.ts:192:25)

    console.log
      [2025-05-26 12:32:35.206] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "questionUid": "test-q-quiz-1",
        "questionIndex": 0
      } Question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.207] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
          "action": "resume"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.208] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
        "action": "resume"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.208] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
        "action": "resume"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.210] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "resume",
        "timer": {
          "startedAt": 1748255555210,
          "duration": 30000,
          "isPaused": false
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.211] [32mINFO [0m [GameStateService] {
        "accessCode": "93L9HG"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.211] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "resume",
        "dashboardRoom": "dashboard_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "liveRoom": "game_93L9HG",
        "projectionRoom": "projection_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "timer": {
          "startedAt": 1748255555210,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.211] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "resume",
        "dashboardRoom": "dashboard_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "timer": {
          "startedAt": 1748255555210,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.211] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "resume",
        "liveRoom": "game_93L9HG",
        "timer": {
          "startedAt": 1748255555210,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.212] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "resume",
        "projectionRoom": "projection_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "timer": {
          "startedAt": 1748255555210,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.212] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "resume"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.212] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
          "action": "pause"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.212] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
        "action": "pause"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.212] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
        "action": "pause"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.215] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "pause",
        "timer": {
          "startedAt": 1748255555210,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1748255555215,
          "timeRemaining": 29995
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.215] [32mINFO [0m [GameStateService] {
        "accessCode": "93L9HG"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.215] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "pause",
        "dashboardRoom": "dashboard_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "liveRoom": "game_93L9HG",
        "projectionRoom": "projection_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "timer": {
          "startedAt": 1748255555210,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1748255555215,
          "timeRemaining": 29995
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.216] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "pause",
        "dashboardRoom": "dashboard_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "timer": {
          "startedAt": 1748255555210,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1748255555215,
          "timeRemaining": 29995
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.216] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "pause",
        "liveRoom": "game_93L9HG",
        "timer": {
          "startedAt": 1748255555210,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1748255555215,
          "timeRemaining": 29995
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.217] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "pause",
        "projectionRoom": "projection_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "timer": {
          "startedAt": 1748255555210,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1748255555215,
          "timeRemaining": 29995
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:35.217] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "pause"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.220] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
          "action": "resume"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.220] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
        "action": "resume"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.221] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
        "action": "resume"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.228] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "resume",
        "timer": {
          "startedAt": 1748255556228,
          "duration": 29995,
          "isPaused": false
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.230] [32mINFO [0m [GameStateService] {
        "accessCode": "93L9HG"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.230] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "resume",
        "dashboardRoom": "dashboard_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "liveRoom": "game_93L9HG",
        "projectionRoom": "projection_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "timer": {
          "startedAt": 1748255556228,
          "duration": 29995,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.231] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "resume",
        "dashboardRoom": "dashboard_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "timer": {
          "startedAt": 1748255556228,
          "duration": 29995,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.231] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "resume",
        "liveRoom": "game_93L9HG",
        "timer": {
          "startedAt": 1748255556228,
          "duration": 29995,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.232] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "resume",
        "projectionRoom": "projection_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "timer": {
          "startedAt": 1748255556228,
          "duration": 29995,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.232] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "resume"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.234] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
          "action": "stop"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.234] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
        "action": "stop"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.234] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
        "action": "stop"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.239] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "stop",
        "timer": {
          "startedAt": 0,
          "duration": 29995,
          "isPaused": true,
          "timeRemaining": 0
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.240] [32mINFO [0m [GameStateService] {
        "accessCode": "93L9HG"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.240] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "stop",
        "dashboardRoom": "dashboard_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "liveRoom": "game_93L9HG",
        "projectionRoom": "projection_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "timer": {
          "startedAt": 0,
          "duration": 29995,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.240] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "stop",
        "dashboardRoom": "dashboard_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "timer": {
          "startedAt": 0,
          "duration": 29995,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.241] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "stop",
        "liveRoom": "game_93L9HG",
        "timer": {
          "startedAt": 0,
          "duration": 29995,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.241] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "stop",
        "projectionRoom": "projection_21a3628e-6c0e-44e8-bda7-195999931ff1",
        "timer": {
          "startedAt": 0,
          "duration": 29995,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.241] [32mINFO [0m [TimerActionHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "action": "stop"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.242] [32mINFO [0m [DisconnectHandler] {
        "socketId": "leEqRlUtJm6qBrBgAAAB",
        "userId": "e1c012b4-3f5a-4919-b624-3210cc46d650",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.243] [33mWARN [0m [DisconnectHandler] {
        "socketId": "leEqRlUtJm6qBrBgAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.243] [32mINFO [0m [DisconnectHandler] {
        "socketId": "Vo5e0aGgTHszEhFwAAAD",
        "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
        "accessCode": "93L9HG",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.245] [32mINFO [0m [DisconnectHandler] {
        "gameId": "21a3628e-6c0e-44e8-bda7-195999931ff1",
        "socketId": "leEqRlUtJm6qBrBgAAAB"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.245] [32mINFO [0m [DisconnectHandler] {
        "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
        "accessCode": "93L9HG",
        "socketId": "Vo5e0aGgTHszEhFwAAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.246] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "2d15d2e1-5c86-42e2-84c3-ae064c689a34",
          "socketId": "Vo5e0aGgTHszEhFwAAAD"
        },
        "room": "game_93L9HG"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/practiceMode.test.ts
  ‚óè Console

    console.log
      [2025-05-26 12:32:36.718] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.812] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "865f0cb3-3525-4f09-8311-ba67cae7a674",
        "accessCode": "PRACTICE1"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket query params: {
        token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJwcmFjdGljZS1wbGF5ZXItMSIsInVzZXJuYW1lIjoiUHJhY3RpY2UgUGxheWVyIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDgyNTU1NTYsImV4cCI6MTc0ODI1OTE1Nn0.OCdhU5ah-J-5iB_tyCHTxPTMwpVYCfbtUBvALLxmRAg',
        role: 'STUDENT'
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:134:17)

    console.log
      [2025-05-26 12:32:36.817] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "FsYD8OPVRh7JxpohAAAB",
        "user": {
          "id": "practice-player-1",
          "userId": "practice-player-1",
          "username": "Practice Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.823] [32mINFO [0m [GameHandlers] {
        "socketId": "FsYD8OPVRh7JxpohAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.823] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "FsYD8OPVRh7JxpohAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] connection_established [
        {
          socketId: 'FsYD8OPVRh7JxpohAAAB',
          timestamp: '2025-05-26T10:32:36.817Z',
          user: {
            role: 'STUDENT',
            userId: 'practice-player-1',
            username: 'Practice Player'
          }
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      Socket connected and ready to emit events, ID: FsYD8OPVRh7JxpohAAAB

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:162:17)

    console.log
      Waiting for event: game_joined with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-05-26 12:32:36.837] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.837] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "username": "Practice Player"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.837] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.837] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "username": "Practice Player"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.837] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.838] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.839] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "gameJoinPayload": {
          "gameId": "865f0cb3-3525-4f09-8311-ba67cae7a674",
          "accessCode": "PRACTICE1",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.839] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "gameJoinPayload": {
          "gameId": "865f0cb3-3525-4f09-8311-ba67cae7a674",
          "accessCode": "PRACTICE1",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          gameId: '865f0cb3-3525-4f09-8311-ba67cae7a674',
          accessCode: 'PRACTICE1',
          status: 'pending',
          currentQuestionIndex: -1,
          totalQuestions: 2,
          timer: { startedAt: 0, duration: 0, isPaused: true },
          question: null
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      ‚úÖ Event received: game_joined {
        gameId: '865f0cb3-3525-4f09-8311-ba67cae7a674',
        accessCode: 'PRACTICE1',
        status: 'pending',
        currentQuestionIndex: -1,
        totalQuestions: 2,
        timer: { startedAt: 0, duration: 0, isPaused: true },
        question: null
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      [SOCKET EVENT] participant_joined [
        {
          userId: 'practice-player-1',
          username: 'Practice Player',
          playMode: 'practice'
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          gameId: '865f0cb3-3525-4f09-8311-ba67cae7a674',
          accessCode: 'PRACTICE1',
          status: 'pending',
          currentQuestionIndex: -1,
          totalQuestions: 2,
          timer: { startedAt: 0, duration: 0, isPaused: true },
          question: null
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [SOCKET EVENT] participant_joined [
        {
          userId: 'practice-player-1',
          username: 'Practice Player',
          playMode: 'practice'
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      Successfully received game_joined event, now starting game...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:171:17)

    console.log
      Emitted start_game again to ensure it gets processed

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:187:17)

    console.log
      [2025-05-26 12:32:36.844] [32mINFO [0m [GameHandlers] {
        "socketId": "FsYD8OPVRh7JxpohAAAB",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1"
        }
      } Start game event received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.845] [32mINFO [0m [GameHandlers] {
        "socketId": "FsYD8OPVRh7JxpohAAAB",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1"
        }
      } Start game event received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.845] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.846] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.851] [32mINFO [0m [GameHandlers] {
        "socketId": "FsYD8OPVRh7JxpohAAAB",
        "questionId": "cb72bbec-93c3-48ec-a46d-58354dbec1cd"
      } Sending first question

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_question [
        {
          uid: 'cb72bbec-93c3-48ec-a46d-58354dbec1cd',
          text: 'What is 1+1?',
          answerOptions: [ '1', '2', '3' ],
          correctAnswers: [ false, true, false ],
          timeLimit: 20,
          questionType: 'multiple_choice_single_answer',
          themes: [ 'arithmetic' ],
          difficulty: 1,
          discipline: 'math',
          title: 'Practice Q1',
          currentQuestionIndex: 0,
          totalQuestions: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        uid: 'cb72bbec-93c3-48ec-a46d-58354dbec1cd',
        text: 'What is 1+1?',
        answerOptions: [ '1', '2', '3' ],
        correctAnswers: [ false, true, false ],
        timeLimit: 20,
        questionType: 'multiple_choice_single_answer',
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q1',
        currentQuestionIndex: 0,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:156:21)

    console.log
      ‚úÖ Direct handler for game_question event received: {
        uid: 'cb72bbec-93c3-48ec-a46d-58354dbec1cd',
        text: 'What is 1+1?',
        answerOptions: [ '1', '2', '3' ],
        correctAnswers: [ false, true, false ],
        timeLimit: 20,
        questionType: 'multiple_choice_single_answer',
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q1',
        currentQuestionIndex: 0,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:180:25)

    console.log
      Promise resolved with game_question data

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:191:17)

    console.log
      Waiting for event: answer_received with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-05-26 12:32:36.852] [32mINFO [0m [GameHandlers] {
        "socketId": "FsYD8OPVRh7JxpohAAAB",
        "questionId": "cb72bbec-93c3-48ec-a46d-58354dbec1cd"
      } Sending first question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.853] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "cb72bbec-93c3-48ec-a46d-58354dbec1cd",
        "answer": 1,
        "timeSpent": 1000,
        "socketId": "FsYD8OPVRh7JxpohAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: 'cb72bbec-93c3-48ec-a46d-58354dbec1cd',
        answer: 1,
        timeSpent: 1000
      } Socket ID: FsYD8OPVRh7JxpohAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-26 12:32:36.853] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "FsYD8OPVRh7JxpohAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "cb72bbec-93c3-48ec-a46d-58354dbec1cd",
          "answer": 1,
          "timeSpent": 1000
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: 'cb72bbec-93c3-48ec-a46d-58354dbec1cd',
        answer: 1,
        timeSpent: 1000
      } Socket ID: FsYD8OPVRh7JxpohAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-26 12:32:36.853] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "FsYD8OPVRh7JxpohAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "cb72bbec-93c3-48ec-a46d-58354dbec1cd",
          "answer": 1,
          "timeSpent": 1000
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.854] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "cb72bbec-93c3-48ec-a46d-58354dbec1cd",
        "answer": 1,
        "timeSpent": 1000,
        "socketId": "FsYD8OPVRh7JxpohAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_question [
        {
          uid: 'cb72bbec-93c3-48ec-a46d-58354dbec1cd',
          text: 'What is 1+1?',
          answerOptions: [ '1', '2', '3' ],
          correctAnswers: [ false, true, false ],
          timeLimit: 20,
          questionType: 'multiple_choice_single_answer',
          themes: [ 'arithmetic' ],
          difficulty: 1,
          discipline: 'math',
          title: 'Practice Q1',
          currentQuestionIndex: 0,
          totalQuestions: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        uid: 'cb72bbec-93c3-48ec-a46d-58354dbec1cd',
        text: 'What is 1+1?',
        answerOptions: [ '1', '2', '3' ],
        correctAnswers: [ false, true, false ],
        timeLimit: 20,
        questionType: 'multiple_choice_single_answer',
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q1',
        currentQuestionIndex: 0,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:156:21)

    console.log
      [2025-05-26 12:32:36.856] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.856] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.856] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.856] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.862] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "PRACTICE1",
          "participant": {
            "id": "c5488767-b53a-44e5-a2a4-17ceb3552803",
            "userId": "practice-player-1",
            "username": "Practice Player",
            "score": 0,
            "joinedAt": "2025-05-26T10:32:36.848Z",
            "online": true
          },
          "gameStatus": "waiting",
          "isDiffered": true
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          accessCode: 'PRACTICE1',
          participant: {
            id: 'c5488767-b53a-44e5-a2a4-17ceb3552803',
            userId: 'practice-player-1',
            username: 'Practice Player',
            score: 0,
            joinedAt: '2025-05-26T10:32:36.848Z',
            online: true
          },
          gameStatus: 'waiting',
          isDiffered: true
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: 'cb72bbec-93c3-48ec-a46d-58354dbec1cd',
          timeSpent: 1000,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      ‚úÖ Event received: answer_received {
        questionId: 'cb72bbec-93c3-48ec-a46d-58354dbec1cd',
        timeSpent: 1000,
        correct: true,
        correctAnswers: [ false, true, false ]
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      Waiting for event: game_question with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-05-26 12:32:36.872] [32mINFO [0m [RequestNextQuestionHandler] {
        "socketId": "FsYD8OPVRh7JxpohAAAB",
        "event": "request_next_question",
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "currentQuestionId": "cb72bbec-93c3-48ec-a46d-58354dbec1cd"
      } Player requested next question

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: 'cb72bbec-93c3-48ec-a46d-58354dbec1cd',
          timeSpent: 1000,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [2025-05-26 12:32:36.873] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "cb72bbec-93c3-48ec-a46d-58354dbec1cd"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:178:25)

    console.log
      [GAME_ANSWER] Adding current questionId cb72bbec-93c3-48ec-a46d-58354dbec1cd to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:190:29)

    console.log
      [GAME_ANSWER] Found 1/2 answered questions: [ 'cb72bbec-93c3-48ec-a46d-58354dbec1cd' ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:197:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:206:25)

    console.log
      [GAME_ANSWER] Not all questions answered yet. Waiting for client to request next question.

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:223:29)

    console.log
      [2025-05-26 12:32:36.875] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "cb72bbec-93c3-48ec-a46d-58354dbec1cd"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:178:25)

    console.log
      [GAME_ANSWER] Adding current questionId cb72bbec-93c3-48ec-a46d-58354dbec1cd to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:190:29)

    console.log
      [GAME_ANSWER] Found 1/2 answered questions: [ 'cb72bbec-93c3-48ec-a46d-58354dbec1cd' ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:197:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:206:25)

    console.log
      [GAME_ANSWER] Not all questions answered yet. Waiting for client to request next question.

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:223:29)

    console.log
      [2025-05-26 12:32:36.877] [32mINFO [0m [RequestNextQuestionHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "nextQuestionId": "eced396b-6271-4646-9570-f77ee4504ab0"
      } Sending next question

      at log (src/utils/logger.ts:102:21)

    console.log
      [REQUEST_NEXT_QUESTION] About to send question: {
        uid: 'eced396b-6271-4646-9570-f77ee4504ab0',
        text: 'What is 2+2?',
        index: 1
      }

      at Socket.log (src/sockets/handlers/game/requestNextQuestion.ts:83:25)

    console.log
      [SOCKET EVENT] game_question [
        {
          uid: 'eced396b-6271-4646-9570-f77ee4504ab0',
          text: 'What is 2+2?',
          answerOptions: [ '3', '4', '5' ],
          correctAnswers: [ false, true, false ],
          questionType: 'multiple_choice_single_answer',
          timeLimit: 20,
          themes: [ 'arithmetic' ],
          difficulty: 1,
          discipline: 'math',
          title: 'Practice Q2',
          currentQuestionIndex: 1,
          totalQuestions: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        uid: 'eced396b-6271-4646-9570-f77ee4504ab0',
        text: 'What is 2+2?',
        answerOptions: [ '3', '4', '5' ],
        correctAnswers: [ false, true, false ],
        questionType: 'multiple_choice_single_answer',
        timeLimit: 20,
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q2',
        currentQuestionIndex: 1,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:156:21)

    console.log
      ‚úÖ Event received: game_question {
        uid: 'eced396b-6271-4646-9570-f77ee4504ab0',
        text: 'What is 2+2?',
        answerOptions: [ '3', '4', '5' ],
        correctAnswers: [ false, true, false ],
        questionType: 'multiple_choice_single_answer',
        timeLimit: 20,
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q2',
        currentQuestionIndex: 1,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      Answering second question: {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: 'eced396b-6271-4646-9570-f77ee4504ab0',
        answer: 1,
        timeSpent: 1200
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:207:17)

    console.log
      Waiting for event: answer_received with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-05-26 12:32:36.878] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "eced396b-6271-4646-9570-f77ee4504ab0",
        "answer": 1,
        "timeSpent": 1200,
        "socketId": "FsYD8OPVRh7JxpohAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: 'eced396b-6271-4646-9570-f77ee4504ab0',
        answer: 1,
        timeSpent: 1200
      } Socket ID: FsYD8OPVRh7JxpohAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-26 12:32:36.878] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "FsYD8OPVRh7JxpohAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "eced396b-6271-4646-9570-f77ee4504ab0",
          "answer": 1,
          "timeSpent": 1200
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: 'eced396b-6271-4646-9570-f77ee4504ab0',
        answer: 1,
        timeSpent: 1200
      } Socket ID: FsYD8OPVRh7JxpohAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:26:17)

    console.log
      [2025-05-26 12:32:36.878] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "FsYD8OPVRh7JxpohAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "eced396b-6271-4646-9570-f77ee4504ab0",
          "answer": 1,
          "timeSpent": 1200
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.879] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "eced396b-6271-4646-9570-f77ee4504ab0",
        "answer": 1,
        "timeSpent": 1200,
        "socketId": "FsYD8OPVRh7JxpohAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.881] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.881] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.881] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.881] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: 'eced396b-6271-4646-9570-f77ee4504ab0',
          timeSpent: 1200,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      ‚úÖ Event received: answer_received {
        questionId: 'eced396b-6271-4646-9570-f77ee4504ab0',
        timeSpent: 1200,
        correct: true,
        correctAnswers: [ false, true, false ]
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      Received feedback for second question: {
        questionId: 'eced396b-6271-4646-9570-f77ee4504ab0',
        timeSpent: 1200,
        correct: true,
        correctAnswers: [ false, true, false ]
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:210:17)

    console.log
      Requesting to proceed after last question...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:221:17)

    console.log
      Waiting for game_ended event after requesting next question...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:225:17)

    console.log
      Waiting for event: game_ended with timeout 15000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-05-26 12:32:36.891] [32mINFO [0m [RequestNextQuestionHandler] {
        "socketId": "FsYD8OPVRh7JxpohAAAB",
        "event": "request_next_question",
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "currentQuestionId": "eced396b-6271-4646-9570-f77ee4504ab0"
      } Player requested next question

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: 'eced396b-6271-4646-9570-f77ee4504ab0',
          timeSpent: 1200,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [2025-05-26 12:32:36.892] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "eced396b-6271-4646-9570-f77ee4504ab0"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":1,"timestamp":"2025-05-26T10:32:36.860Z","questionUid":"cb72bbec-93c3-48ec-a46d-58354dbec1cd","timeTakenMs":1000}]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:178:25)

    console.log
      [GAME_ANSWER] Adding current questionId eced396b-6271-4646-9570-f77ee4504ab0 to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:190:29)

    console.log
      [GAME_ANSWER] Found 2/2 answered questions: [
        'cb72bbec-93c3-48ec-a46d-58354dbec1cd',
        'eced396b-6271-4646-9570-f77ee4504ab0'
      ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:197:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=2, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:206:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:216:29)

    console.log
      [2025-05-26 12:32:36.892] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "eced396b-6271-4646-9570-f77ee4504ab0"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.894] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "eced396b-6271-4646-9570-f77ee4504ab0"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":1,"timestamp":"2025-05-26T10:32:36.860Z","questionUid":"cb72bbec-93c3-48ec-a46d-58354dbec1cd","timeTakenMs":1000}]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:178:25)

    console.log
      [GAME_ANSWER] Adding current questionId eced396b-6271-4646-9570-f77ee4504ab0 to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:190:29)

    console.log
      [GAME_ANSWER] Found 2/2 answered questions: [
        'cb72bbec-93c3-48ec-a46d-58354dbec1cd',
        'eced396b-6271-4646-9570-f77ee4504ab0'
      ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:197:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=2, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:206:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:216:29)

    console.log
      [2025-05-26 12:32:36.894] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "eced396b-6271-4646-9570-f77ee4504ab0"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.898] [32mINFO [0m [RequestNextQuestionHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "correctCount": 2,
        "total": 2
      } Practice mode completed, sending final score

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_ended [
        {
          accessCode: 'PRACTICE1',
          score: 2,
          totalQuestions: 2,
          correct: 2,
          total: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      üëÄ DIRECT LISTENER: game_ended event received: {
        accessCode: 'PRACTICE1',
        score: 2,
        totalQuestions: 2,
        correct: 2,
        total: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:216:21)

    console.log
      ‚úÖ Event received: game_ended {
        accessCode: 'PRACTICE1',
        score: 2,
        totalQuestions: 2,
        correct: 2,
        total: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      ‚úÖ Successfully received game_ended event: {
        accessCode: 'PRACTICE1',
        score: 2,
        totalQuestions: 2,
        correct: 2,
        total: 2
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:227:17)

    console.log
      Test completed successfully, disconnecting socket

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:232:17)

    console.log
      [2025-05-26 12:32:36.900] [32mINFO [0m [DisconnectHandler] {
        "socketId": "FsYD8OPVRh7JxpohAAAB",
        "userId": "practice-player-1",
        "accessCode": "PRACTICE1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.901] [32mINFO [0m [DisconnectHandler] {
        "userId": "practice-player-1",
        "accessCode": "PRACTICE1",
        "socketId": "FsYD8OPVRh7JxpohAAAB"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:36.902] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "practice-player-1",
          "socketId": "FsYD8OPVRh7JxpohAAAB"
        },
        "room": "game_PRACTICE1"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/teacherDashboard.test.ts
  ‚óè Console

    console.log
      [2025-05-26 12:32:37.578] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.706] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "accessCode": "TEST123"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.723] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "flxbCvV3dITDtZNWAAAB",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.800] [32mINFO [0m [GameHandlers] {
        "socketId": "flxbCvV3dITDtZNWAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.800] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "flxbCvV3dITDtZNWAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.806] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "flxbCvV3dITDtZNWAAAB",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "flxbCvV3dITDtZNWAAAB",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-05-26T10:32:37.723Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.806] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "socketId": "flxbCvV3dITDtZNWAAAB"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.809] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "flxbCvV3dITDtZNWAAAB",
        "allRooms": [
          "flxbCvV3dITDtZNWAAAB",
          "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
          "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd"
        ],
        "dashboardRoom": "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "dashboardSockets": [
          "flxbCvV3dITDtZNWAAAB"
        ],
        "projectionRoom": "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "projectionSockets": [
          "flxbCvV3dITDtZNWAAAB"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.816] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "socketId": "flxbCvV3dITDtZNWAAAB"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-26 12:32:37.817] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "flxbCvV3dITDtZNWAAAB",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "flxbCvV3dITDtZNWAAAB",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-05-26T10:32:37.723Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.817] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "socketId": "flxbCvV3dITDtZNWAAAB"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.819] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "flxbCvV3dITDtZNWAAAB",
        "allRooms": [
          "flxbCvV3dITDtZNWAAAB",
          "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
          "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd"
        ],
        "dashboardRoom": "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "dashboardSockets": [
          "flxbCvV3dITDtZNWAAAB"
        ],
        "projectionRoom": "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "projectionSockets": [
          "flxbCvV3dITDtZNWAAAB"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.824] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "socketId": "flxbCvV3dITDtZNWAAAB"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-26 12:32:37.827] [32mINFO [0m [DisconnectHandler] {
        "socketId": "flxbCvV3dITDtZNWAAAB",
        "userId": "teacher-1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.827] [33mWARN [0m [DisconnectHandler] {
        "socketId": "flxbCvV3dITDtZNWAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.830] [32mINFO [0m [DisconnectHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "socketId": "flxbCvV3dITDtZNWAAAB"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.835] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "BwPME7SXsp4D_WUcAAAD",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.836] [32mINFO [0m [GameHandlers] {
        "socketId": "BwPME7SXsp4D_WUcAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.836] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "BwPME7SXsp4D_WUcAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.839] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "BwPME7SXsp4D_WUcAAAD",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "BwPME7SXsp4D_WUcAAAD",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-05-26T10:32:37.835Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.840] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "socketId": "BwPME7SXsp4D_WUcAAAD"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.841] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "BwPME7SXsp4D_WUcAAAD",
        "allRooms": [
          "BwPME7SXsp4D_WUcAAAD",
          "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
          "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd"
        ],
        "dashboardRoom": "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "dashboardSockets": [
          "BwPME7SXsp4D_WUcAAAD"
        ],
        "projectionRoom": "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "projectionSockets": [
          "BwPME7SXsp4D_WUcAAAD"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.847] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "socketId": "BwPME7SXsp4D_WUcAAAD"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-26 12:32:37.848] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "questionUid": "q-late-1"
      } Setting question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.854] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.855] [32mINFO [0m [SetQuestionHandler] {
        "liveRoom": "game_TEST123",
        "liveRoomSocketIds": [],
        "payload": {
          "question": {
            "uid": "q-late-1",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              false
            ],
            "questionType": "single_correct",
            "timeLimit": 2,
            "currentQuestionIndex": 0,
            "totalQuestions": 14
          },
          "timer": {
            "startedAt": 1748255557853,
            "duration": 2000,
            "isPaused": true
          }
        }
      } [DEBUG] Emitting game_question to live room

      at log (src/utils/logger.ts:102:21)

    console.log
      [setQuestion] Emitting game_question: {
        liveRoom: 'game_TEST123',
        liveRoomSocketIds: [],
        payload: {
          question: {
            uid: 'q-late-1',
            title: undefined,
            text: 'What is 10 + 5?',
            answerOptions: [Array],
            correctAnswers: [Array],
            questionType: 'single_correct',
            timeLimit: 2,
            currentQuestionIndex: 0,
            totalQuestions: 14
          },
          timer: { startedAt: 1748255557853, duration: 2000, isPaused: true }
        }
      }

      at Socket.log (src/sockets/handlers/teacherControl/setQuestion.ts:192:25)

    console.log
      [2025-05-26 12:32:37.855] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "questionUid": "q-late-1",
        "questionIndex": 0
      } Question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.859] [32mINFO [0m [DisconnectHandler] {
        "socketId": "BwPME7SXsp4D_WUcAAAD",
        "userId": "teacher-1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.859] [33mWARN [0m [DisconnectHandler] {
        "socketId": "BwPME7SXsp4D_WUcAAAD",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.861] [32mINFO [0m [DisconnectHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "socketId": "BwPME7SXsp4D_WUcAAAD"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.864] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "l0rvs3TIGCBy8OyLAAAF",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.865] [32mINFO [0m [GameHandlers] {
        "socketId": "l0rvs3TIGCBy8OyLAAAF"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.865] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "l0rvs3TIGCBy8OyLAAAF"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.868] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "l0rvs3TIGCBy8OyLAAAF",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "l0rvs3TIGCBy8OyLAAAF",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-05-26T10:32:37.864Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.869] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "socketId": "l0rvs3TIGCBy8OyLAAAF"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.870] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "l0rvs3TIGCBy8OyLAAAF",
        "allRooms": [
          "l0rvs3TIGCBy8OyLAAAF",
          "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
          "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd"
        ],
        "dashboardRoom": "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "dashboardSockets": [
          "l0rvs3TIGCBy8OyLAAAF"
        ],
        "projectionRoom": "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "projectionSockets": [
          "l0rvs3TIGCBy8OyLAAAF"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.876] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "socketId": "l0rvs3TIGCBy8OyLAAAF"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-26 12:32:37.877] [32mINFO [0m [Test] [TEST] About to emit quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.878] [32mINFO [0m [Test] [TEST] quiz_timer_action event emitted

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.878] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
          "action": "start",
          "duration": 30
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.878] [32mINFO [0m [TimerActionHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "action": "start",
        "duration": 30
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.878] [32mINFO [0m [TimerActionHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "action": "start",
        "duration": 30
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.880] [32mINFO [0m [TimerActionHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "action": "start",
        "now": 1748255557880,
        "validDuration": 30,
        "timer": {
          "startedAt": 1748255557853,
          "duration": 2000,
          "isPaused": true
        }
      } [TIMER_ACTION] Processing start action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.881] [32mINFO [0m [TimerActionHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "action": "start",
        "timer": {
          "startedAt": 1748255557880,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Timer object after start processing

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.881] [32mINFO [0m [TimerActionHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "action": "start",
        "timer": {
          "startedAt": 1748255557880,
          "duration": 30000,
          "isPaused": false
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.881] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.881] [32mINFO [0m [TimerActionHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "action": "start",
        "dashboardRoom": "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "liveRoom": "game_TEST123",
        "projectionRoom": "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "timer": {
          "startedAt": 1748255557880,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.881] [32mINFO [0m [TimerActionHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "action": "start",
        "dashboardRoom": "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "timer": {
          "startedAt": 1748255557880,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.882] [32mINFO [0m [TimerActionHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "action": "start",
        "liveRoom": "game_TEST123",
        "timer": {
          "startedAt": 1748255557880,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.882] [32mINFO [0m [TimerActionHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "action": "start",
        "projectionRoom": "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "timer": {
          "startedAt": 1748255557880,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.882] [32mINFO [0m [TimerActionHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "action": "start"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.882] [32mINFO [0m [Test] [TEST] Received dashboard_timer_updated event {
        "timer": {
          "startedAt": 1748255557880,
          "duration": 30000,
          "isPaused": false
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.884] [32mINFO [0m [DisconnectHandler] {
        "socketId": "l0rvs3TIGCBy8OyLAAAF",
        "userId": "teacher-1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.885] [33mWARN [0m [DisconnectHandler] {
        "socketId": "l0rvs3TIGCBy8OyLAAAF",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.887] [32mINFO [0m [DisconnectHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "socketId": "l0rvs3TIGCBy8OyLAAAF"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.891] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "4rFsDcKprIpmtWFRAAAH",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.891] [32mINFO [0m [GameHandlers] {
        "socketId": "4rFsDcKprIpmtWFRAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.892] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "4rFsDcKprIpmtWFRAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.898] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "4rFsDcKprIpmtWFRAAAH",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "4rFsDcKprIpmtWFRAAAH",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-05-26T10:32:37.891Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.898] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "socketId": "4rFsDcKprIpmtWFRAAAH"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.900] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "4rFsDcKprIpmtWFRAAAH",
        "allRooms": [
          "4rFsDcKprIpmtWFRAAAH",
          "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
          "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd"
        ],
        "dashboardRoom": "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "dashboardSockets": [
          "4rFsDcKprIpmtWFRAAAH"
        ],
        "projectionRoom": "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "projectionSockets": [
          "4rFsDcKprIpmtWFRAAAH"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.907] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "socketId": "4rFsDcKprIpmtWFRAAAH"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-26 12:32:37.908] [32mINFO [0m [LockAnswersHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "lock": true
      } Answer lock requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.911] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.912] [32mINFO [0m [LockAnswersHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "lock": true
      } Answers lock status updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.914] [32mINFO [0m [DisconnectHandler] {
        "socketId": "4rFsDcKprIpmtWFRAAAH",
        "userId": "teacher-1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.914] [33mWARN [0m [DisconnectHandler] {
        "socketId": "4rFsDcKprIpmtWFRAAAH",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.915] [32mINFO [0m [DisconnectHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "socketId": "4rFsDcKprIpmtWFRAAAH"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.917] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "eYHlUY-YHgou23wkAAAJ",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.918] [32mINFO [0m [GameHandlers] {
        "socketId": "eYHlUY-YHgou23wkAAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.918] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "eYHlUY-YHgou23wkAAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.920] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "eYHlUY-YHgou23wkAAAJ",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "eYHlUY-YHgou23wkAAAJ",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-05-26T10:32:37.917Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.920] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "socketId": "eYHlUY-YHgou23wkAAAJ"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.922] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "eYHlUY-YHgou23wkAAAJ",
        "allRooms": [
          "eYHlUY-YHgou23wkAAAJ",
          "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
          "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd"
        ],
        "dashboardRoom": "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "dashboardSockets": [
          "eYHlUY-YHgou23wkAAAJ"
        ],
        "projectionRoom": "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "projectionSockets": [
          "eYHlUY-YHgou23wkAAAJ"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.927] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "socketId": "eYHlUY-YHgou23wkAAAJ"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-26 12:32:37.929] [32mINFO [0m [EndGameHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1"
      } Game end requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.932] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.935] [32mINFO [0m [EndGameHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd"
      } Game ended successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.936] [32mINFO [0m [DisconnectHandler] {
        "socketId": "eYHlUY-YHgou23wkAAAJ",
        "userId": "teacher-1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.937] [33mWARN [0m [DisconnectHandler] {
        "socketId": "eYHlUY-YHgou23wkAAAJ",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.938] [32mINFO [0m [DisconnectHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "socketId": "eYHlUY-YHgou23wkAAAJ"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.942] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "ZYbvJzfL98FlEvyZAAAL",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.943] [32mINFO [0m [GameHandlers] {
        "socketId": "ZYbvJzfL98FlEvyZAAAL"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.943] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "ZYbvJzfL98FlEvyZAAAL"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.947] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "ZYbvJzfL98FlEvyZAAAL",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "ZYbvJzfL98FlEvyZAAAL",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-05-26T10:32:37.942Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.948] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "socketId": "ZYbvJzfL98FlEvyZAAAL"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.949] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "ZYbvJzfL98FlEvyZAAAL",
        "allRooms": [
          "ZYbvJzfL98FlEvyZAAAL",
          "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
          "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd"
        ],
        "dashboardRoom": "dashboard_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "dashboardSockets": [
          "ZYbvJzfL98FlEvyZAAAL"
        ],
        "projectionRoom": "projection_275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "projectionSockets": [
          "ZYbvJzfL98FlEvyZAAAL"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:37.953] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "userId": "teacher-1",
        "socketId": "ZYbvJzfL98FlEvyZAAAL"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:214:25)

    console.log
      [2025-05-26 12:32:37.955] [32mINFO [0m [DisconnectHandler] {
        "socketId": "ZYbvJzfL98FlEvyZAAAL",
        "userId": "teacher-1",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-26 12:32:37.956] [33mWARN [0m [DisconnectHandler] {
        "socketId": "ZYbvJzfL98FlEvyZAAAL",
        "reason": "server shutting down"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-05-26 12:32:37.957] [32mINFO [0m [DisconnectHandler] {
        "gameId": "275411a6-bfbc-46f9-86af-bfe5770a14bd",
        "socketId": "ZYbvJzfL98FlEvyZAAAL"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/socketConnection.test.ts
  ‚óè Console

    console.log
      Connecting to server...

      at Object.<anonymous> (tests/integration/socketConnection.test.ts:80:17)

    console.log
      [2025-05-26 12:32:38.369] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:38.374] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "Xek4lEcRg2C7KkoiAAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:38.375] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "Xek4lEcRg2C7KkoiAAAB",
        "user": {
          "id": "test-player-123",
          "userId": "test-player-123",
          "username": "test-player-123",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:38.388] [32mINFO [0m [GameHandlers] {
        "socketId": "Xek4lEcRg2C7KkoiAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:38.389] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "Xek4lEcRg2C7KkoiAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket connected successfully

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:60:21)

    console.log
      Received connection_established event: {
        socketId: 'Xek4lEcRg2C7KkoiAAAB',
        timestamp: '2025-05-26T10:32:38.376Z',
        user: {
          role: 'STUDENT',
          userId: 'test-player-123',
          username: 'test-player-123'
        }
      }

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:71:21)

    console.log
      Authentication test connecting to server...

      at Object.<anonymous> (tests/integration/socketConnection.test.ts:122:17)

    console.log
      [2025-05-26 12:32:38.399] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "C4r3CAQSSHA0h8YWAAAD"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:38.399] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "C4r3CAQSSHA0h8YWAAAD",
        "user": {
          "id": "test-player-123",
          "userId": "test-player-123",
          "username": "test-player-123",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:38.400] [32mINFO [0m [GameHandlers] {
        "socketId": "C4r3CAQSSHA0h8YWAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:38.400] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "C4r3CAQSSHA0h8YWAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      Authentication test socket connected successfully

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:103:21)

    console.log
      Authentication test received connection_established event: {
        socketId: 'C4r3CAQSSHA0h8YWAAAD',
        timestamp: '2025-05-26T10:32:38.400Z',
        user: {
          role: 'STUDENT',
          userId: 'test-player-123',
          username: 'test-player-123'
        }
      }

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:113:21)

    console.log
      [2025-05-26 12:32:38.402] [32mINFO [0m [DisconnectHandler] {
        "socketId": "C4r3CAQSSHA0h8YWAAAD",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:38.402] [33mWARN [0m [DisconnectHandler] {
        "socketId": "C4r3CAQSSHA0h8YWAAAD",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:38.402] [32mINFO [0m [DisconnectHandler] {
        "socketId": "Xek4lEcRg2C7KkoiAAAB",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:38.403] [33mWARN [0m [DisconnectHandler] {
        "socketId": "Xek4lEcRg2C7KkoiAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

PASS tests/unit/quizTemplateService.test.ts
PASS tests/integration/lobbyBasic.test.ts
  ‚óè Console

    console.log
      Server listening on port 36768

      at Server.<anonymous> (tests/integration/lobbyBasic.test.ts:72:25)

    console.log
      Socket connected: 4YnRwiLJcYnOsoHGAAAB

      at Namespace.<anonymous> (tests/integration/lobbyBasic.test.ts:41:21)

    console.log
      Client connected

      at Socket.<anonymous> (tests/integration/lobbyBasic.test.ts:171:21)

    console.log
      Player Test Player 1 joining lobby TEST123

      at Socket.<anonymous> (tests/integration/lobbyBasic.test.ts:46:25)

    console.log
      Received participants list: {
        participants: [
          {
            id: '4YnRwiLJcYnOsoHGAAAB',
            username: 'Test Player 1',
            userId: 'test-player-1'
          }
        ],
        gameId: 'test-game-id',
        gameName: 'Test Game'
      }

      at Socket.<anonymous> (tests/integration/lobbyBasic.test.ts:181:21)

PASS tests/unit/questionService.test.ts
PASS tests/integration/teacherAuth.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-26 12:32:40.540] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/gamesApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-26 12:32:40.819] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:40.846] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:40.900] [31mERROR[0m [GameStateService] {
        "gameInstanceId": "game-123"
      } Game instance not found

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG response: 200 application/json; charset=utf-8 {"games":[{"id":"game-1","status":"pending","name":"Game 1"},{"id":"game-2","status":"active","name":"Game 2"}]}

      at Object.<anonymous> (tests/integration/gamesApi.test.ts:370:21)

PASS tests/unit/gameParticipantService.test.ts
PASS tests/integration/basic-check.test.ts
PASS tests/unit/gameInstanceService.test.ts
PASS tests/integration/quizTemplateApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.027] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.031] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.033] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.048] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.049] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.054] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.055] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.062] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.065] [32mINFO [0m [Auth] {
        "authHeader": "Bearer invalid-token"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.066] [31mERROR[0m [Auth] {
        "error": {
          "name": "JsonWebTokenError",
          "message": "jwt malformed"
        }
      } Authentication error

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.071] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.072] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.080] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.082] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.083] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.086] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.087] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.090] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.100] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.102] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.106] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.108] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.112] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.113] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.114] [31mERROR[0m [gameTemplatesAPI] {
        "error": {}
      } Error updating quiz template

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.119] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.121] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.122] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.125] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.126] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.127] [31mERROR[0m [gameTemplatesAPI] {
        "error": {}
      } Error deleting quiz template

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ4MjU1NTYxLCJleHAiOjE3NDgyNTkxNjF9.AWYusx6tKh5ENnplC2RLr401gCIfywtJYbgFTFy8Q7s

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-05-26 12:32:42.129] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

PASS tests/unit/accessCodeGeneration.test.ts
PASS tests/integration/questionApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-26 12:32:42.633] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.658] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.695] [31mERROR[0m [QuestionsAPI] {
        "error": {}
      } Error updating question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-05-26 12:32:42.708] [31mERROR[0m [QuestionsAPI] {
        "error": {}
      } Error deleting question

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/playerApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-26 12:32:43.000] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/server.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:67:13)

    console.log
      [2025-05-26 12:32:43.291] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

PASS tests/unit/roomUtils.test.ts
PASS tests/unit/utils/testPathAliases.test.ts
PASS tests/setupTests.test.ts
-------------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
File                                 | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s                                                                                                                                                             
-------------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
All files                            |   46.82 |    26.95 |   37.34 |   65.69 |                                                                                                                                                                               
 src                                 |    82.5 |     37.5 |      60 |    82.5 |                                                                                                                                                                               
  server.ts                          |    82.5 |     37.5 |      60 |    82.5 | 22,38,46-48,55,61-62                                                                                                                                                          
 src/api                             |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  index.ts                           |     100 |      100 |     100 |     100 |                                                                                                                                                                               
 src/api/v1                          |   52.26 |    33.84 |   75.55 |   52.45 |                                                                                                                                                                               
  gameControl.ts                     |   12.03 |        0 |       0 |   12.03 | 19-53,63-132,142-213,223-271                                                                                                                                                  
  gameTemplates.ts                   |   48.48 |    34.48 |     100 |   51.61 | 37-38,48,52-53,56-57,64-69,75-77,94-125                                                                                                                                       
  games.ts                           |    60.1 |    47.45 |   76.92 |   59.66 | 79-80,86-98,124-125,154-155,187-188,202-203,236-237,245-286,296-307,320-321,332-333,342-361,369-370,375-376                                                                   
  index.ts                           |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  players.ts                         |   76.74 |       50 |     100 |   76.19 | 15,55-63,76-77,89-90                                                                                                                                                          
  questions.ts                       |   74.74 |     47.5 |     100 |   76.59 | 17,35-36,54-55,82-83,111,120,130-135,151-152,164-165,172-173,191,203-204,218                                                                                                  
  quizTemplates.ts                   |   46.71 |    31.94 |      70 |   46.97 | 16,34-35,69-70,82-83,104-105,117-118,135,155-156,168-169,192-197,209-210,226-231,241-276,286-314,324-358                                                                      
  teachers.ts                        |      50 |       20 |      80 |   49.15 | 17,37-38,42-43,56-64,78-79,88-89,94-105,114-128                                                                                                                               
 src/config                          |      75 |        0 |      50 |      75 |                                                                                                                                                                               
  redis.ts                           |      75 |        0 |      50 |      75 | 7-8,23                                                                                                                                                                        
 src/core                            |   67.12 |    50.98 |   69.56 |   67.31 |                                                                                                                                                                               
  gameStateService.ts                |   67.12 |    50.98 |   69.56 |   67.31 | 74-95,106,116-117,158-159,201-202,218-219,226-228,238-239,288-289,309-310,331,367-368,379-407,425-426,435-436,447-458,462,471-472,492-494,498,501-502,529-535,543-544,568-569 
 src/core/services                   |   66.29 |    65.78 |   59.09 |   66.38 |                                                                                                                                                                               
  gameInstanceService.ts             |   86.36 |    95.45 |   77.77 |   85.93 | 107-108,236-249,325                                                                                                                                                           
  gameParticipantService.ts          |   92.53 |     91.3 |     100 |   92.42 | 81,87,103,156-157                                                                                                                                                             
  gameTemplateService.ts             |   16.66 |     5.55 |   18.18 |   16.66 | 44-77,104-222                                                                                                                                                                 
  questionService.ts                 |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  quizTemplateService.ts             |   63.29 |    46.42 |   66.66 |   63.29 | 54,95-96,125,131,162-163,188,256,265,288-367                                                                                                                                  
  userService.ts                     |   18.86 |     6.25 |       0 |    19.6 | 41-170                                                                                                                                                                        
 src/db                              |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  prisma.ts                          |     100 |      100 |     100 |     100 |                                                                                                                                                                               
 src/db/generated/client             |   92.06 |       50 |       0 |   92.06 |                                                                                                                                                                               
  index.js                           |   92.06 |       50 |       0 |   92.06 | 293-303                                                                                                                                                                       
 src/db/generated/client/runtime     |    33.2 |    19.78 |   28.66 |      62 |                                                                                                                                                                               
  library.js                         |    33.2 |    19.78 |   28.66 |      62 | 14,18-22,26,38-60,68,72-104,126-129                                                                                                                                           
 src/middleware                      |   86.48 |       60 |     100 |   85.71 |                                                                                                                                                                               
  auth.ts                            |   86.48 |       60 |     100 |   85.71 | 46-47,76,82,94                                                                                                                                                                
 src/sockets                         |    87.8 |    33.33 |   85.71 |    87.8 |                                                                                                                                                                               
  index.ts                           |    87.8 |    33.33 |   85.71 |    87.8 | 24-25,72,83,94                                                                                                                                                                
 src/sockets/handlers                |   76.48 |     58.4 |    91.3 |   76.22 |                                                                                                                                                                               
  connectionHandlers.ts              |     100 |       70 |     100 |     100 | 38                                                                                                                                                                            
  disconnectHandler.ts               |   94.11 |       70 |     100 |   94.11 | 65,76                                                                                                                                                                         
  gameHandler.ts                     |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  lobbyHandler.ts                    |   69.81 |       30 |   85.71 |   69.81 | 62-67,72-77,82-93,138-139,170,194-198,204,214-215,250,264-265,275-281,298-299,305-315                                                                                         
  projectorHandler.ts                |   61.76 |       50 |      80 |   61.76 | 36-40,61-77                                                                                                                                                                   
  sharedAnswers.ts                   |   44.44 |        0 |       0 |   57.14 | 16-18                                                                                                                                                                         
  sharedGameFlow.ts                  |   97.95 |    76.92 |     100 |   97.82 | 80                                                                                                                                                                            
  sharedLeaderboard.ts               |   86.66 |    66.66 |      80 |    92.3 | 38                                                                                                                                                                            
  sharedLiveHandler.ts               |   73.52 |    57.69 |     100 |   72.26 | 46-51,133,179,207,219-225,234-245,253-264,276-278,293-295,322-327,338-344,350-356,360-366,388-394,404-405,410-412,424-430,439,443-444,465-466,473-474,487-488                 
  sharedScore.ts                     |      60 |       50 |     100 |    62.5 | 18-20                                                                                                                                                                         
  teacherControlHandler.ts           |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  tournamentHandler.ts               |      75 |     62.5 |     100 |   74.32 | 38-40,57-59,72-74,82-84,93-94,118-120,142-144                                                                                                                                 
 src/sockets/handlers/game           |   76.48 |    72.72 |   95.23 |   76.29 |                                                                                                                                                                               
  disconnect.ts                      |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  gameAnswer.ts                      |   68.46 |    77.19 |     100 |   68.46 | 69-73,82-86,98-100,104-108,111-115,138-143,163-164,229-230,244-261                                                                                                            
  index.ts                           |    73.8 |    42.85 |      75 |    72.5 | 44-46,50-52,63-65,91-92                                                                                                                                                       
  joinGame.ts                        |   80.68 |    74.28 |     100 |   80.68 | 44-50,69-72,100-101,117-120,184-186                                                                                                                                           
  requestNextQuestion.ts             |   83.63 |    72.09 |     100 |   82.69 | 29-30,34-36,45-46,147-148                                                                                                                                                     
  requestParticipants.ts             |   92.85 |        0 |     100 |     100 | 15                                                                                                                                                                            
 src/sockets/handlers/teacherControl |   48.02 |       25 |   86.36 |   47.92 |                                                                                                                                                                               
  disconnect.ts                      |   93.33 |      100 |     100 |   93.33 | 27                                                                                                                                                                            
  endGame.ts                         |   71.05 |    18.18 |     100 |   71.05 | 16-20,35-39,45-49,93-102,112                                                                                                                                                  
  helpers.ts                         |   63.46 |    51.85 |      75 |   63.46 | 19-20,32-33,52-53,59-60,112-113,128,133-141,147-148                                                                                                                           
  index.ts                           |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  joinDashboard.ts                   |    42.3 |    15.78 |     100 |    42.3 | 27-51,65-75,79-84,88-110,148-187,196-211,217-226                                                                                                                              
  lockAnswers.ts                     |   70.27 |    18.18 |     100 |   70.27 | 16-20,35-39,45-49,82-91,101                                                                                                                                                   
  pauseTimer.ts                      |    8.97 |        0 |      50 |    8.97 | 13-207                                                                                                                                                                        
  setQuestion.ts                     |   53.76 |    33.33 |     100 |   53.26 | 18-22,26-37,52-70,76-80,83-94,101,107-119,214-228                                                                                                                             
  startTimer.ts                      |    8.97 |        0 |      50 |    8.97 | 13-202                                                                                                                                                                        
  timerAction.ts                     |      75 |    54.28 |     100 |      75 | 20-25,29-34,49-54,60-65,126-132,162-163                                                                                                                                       
 src/sockets/handlers/tournament     |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  index.ts                           |     100 |      100 |     100 |     100 |                                                                                                                                                                               
 src/sockets/middleware              |   87.87 |       85 |     100 |    87.5 |                                                                                                                                                                               
  socketAuth.ts                      |   87.87 |       85 |     100 |    87.5 | 67,85,95-96                                                                                                                                                                   
 src/sockets/utils                   |   84.31 |    66.66 |     100 |   83.67 |                                                                                                                                                                               
  roomUtils.ts                       |   84.31 |    66.66 |     100 |   83.67 | 91-99,118-123,137-142,176-182                                                                                                                                                 
 src/utils                           |   89.79 |       52 |     100 |   89.58 |                                                                                                                                                                               
  logger.ts                          |   89.79 |       52 |     100 |   89.58 | 39,90,96,108,112                                                                                                                                                              
 tests                               |   82.71 |    73.91 |      80 |   83.11 |                                                                                                                                                                               
  testSetup.ts                       |   82.71 |    73.91 |      80 |   83.11 | 69-70,89-105,168-169,183                                                                                                                                                      
 tests/helpers                       |   80.95 |     37.5 |      50 |   78.94 |                                                                                                                                                                               
  generateTeacherToken.ts            |     100 |       25 |     100 |     100 | 3-5                                                                                                                                                                           
  jwt.ts                             |     100 |       50 |     100 |     100 | 3-5                                                                                                                                                                           
  serviceMocks.ts                    |      60 |      100 |      25 |      50 | 21-24                                                                                                                                                                         
 tests/support                       |     100 |      100 |     100 |     100 |                                                                                                                                                                               
  testQuestions.ts                   |     100 |      100 |     100 |     100 |                                                                                                                                                                               
-------------------------------------|---------|----------|---------|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

Summary of all failing tests
FAIL tests/integration/projectorHandler.test.ts (5.184 s)
  ‚óè Projector Mode Socket Handler ‚Ä∫ should join projector room and receive initial state

    thrown: "Exceeded timeout of 3000 ms for a test while waiting for `done()` to be called.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      35 |     });
      36 |
    > 37 |     it('should join projector room and receive initial state', (done) => {
         |     ^
      38 |         // Mock Redis state for the game
      39 |         const mockState = {
      40 |             question: 'What is 2+2?',

      at tests/integration/projectorHandler.test.ts:37:5
      at Object.<anonymous> (tests/integration/projectorHandler.test.ts:9:1)

FAIL tests/integration/gameHandler.test.ts


  ‚óè Test suite failed to run

    PrismaClientKnownRequestError: 
    Invalid `prisma.user.deleteMany()` invocation in
    /home/aflesch/mathquest/app/backend/tests/integration/gameHandler.test.ts:246:27

      243     }
      244 });
      245 // Clean up test players
    ‚Üí 246 await prisma.user.deleteMany(
    Foreign key constraint violated on the constraint: `StudentProfile_id_fkey`

      122 |
      123 | More Information: https://pris.ly/d/execute-raw
    > 124 | `)}var Co=({clientMethod:e,activeProvider:r})=>t=>{let n="",i;if(Nn(t))n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};else if(Array.isArray(t)){let[o,...s]=t;n=o,i={values:Gr(s||[]),__prismaRawParameters__:!0}}else switch(r){case"sqlite":case"mysql":{n=t.sql,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"cockroachdb":case"postgresql":case"postgres":{n=t.text,i={values:Gr(t.values),__prismaRawParameters__:!0};break}case"sqlserver":{n=$l(t),i={values:Gr(t.values),__prismaRawParameters__:!0};break}default:throw new Error(`The ${r} provider does not support ${e}`)}return i?.values?Ul(`prisma.${e}(${n}, ${i.values})`):Ul(`prisma.${e}(${n})`),{query:n,parameters:i}},Ql={requestArgsToMiddlewareArgs(e){return[e.strings,...e.values]},middlewareArgsToRequestArgs(e){let[r,...t]=e;return new oe(r,t)}},Gl={requestArgsToMiddlewareArgs(e){return[e]},middlewareArgsToRequestArgs(e){return e[0]}};function Ao(e){return function(t,n){let i,o=(s=e)=>{try{return s===void 0||s?.kind==="itx"?i??=Wl(t(s)):Wl(t(s))}catch(a){return Promise.reject(a)}};return{get spec(){return n},then(s,a){return o().then(s,a)},catch(s){return o().catch(s)},finally(s){return o().finally(s)},requestTransaction(s){let a=o(s);return a.requestTransaction?a.requestTransaction(s):a},[Symbol.toStringTag]:"PrismaPromise"}}}function Wl(e){return typeof e.then=="function"?e:Promise.resolve(e)}var Pf=bi.split(".")[0],Tf={isEnabled(){return!1},getTraceParent(){return"00-10-10-00"},dispatchEngineSpans(){},getActiveContext(){},runInChildSpan(e,r){return r()}},Io=class{isEnabled(){return this.getGlobalTracingHelper().isEnabled()}getTraceParent(r){return this.getGlobalTracingHelper().getTraceParent(r)}dispatchEngineSpans(r){return this.getGlobalTracingHelper().dispatchEngineSpans(r)}getActiveContext(){return this.getGlobalTracingHelper().getActiveContext()}runInChildSpan(r,t){return this.getGlobalTracingHelper().runInChildSpan(r,t)}getGlobalTracingHelper(){let r=globalThis[`V${Pf}_PRISMA_INSTRUMENTATION`],t=globalThis.PRISMA_INSTRUMENTATION;return r?.helper??t?.helper??Tf}};function Jl(){return new Io}function Hl(e,r=()=>{}){let t,n=new Promise(i=>t=i);return{then(i){return--e===0&&t(r()),i?.(n)}}}function Kl(e){return typeof e=="string"?e:e.reduce((r,t)=>{let n=typeof t=="string"?t:t.level;return n==="query"?r:r&&(t==="info"||r==="info")?"info":n},void 0)}var Jn=class{_middlewares=[];use(r){this._middlewares.push(r)}get(r){return this._middlewares[r]}has(r){return!!this._middlewares[r]}length(){return this._middlewares.length}};var zl=k(ki());function Hn(e){return typeof e.batchRequestIdx=="number"}function Yl(e){if(e.action!=="findUnique"&&e.action!=="findUniqueOrThrow")return;let r=[];return e.modelName&&r.push(e.modelName),e.query.arguments&&r.push(ko(e.query.arguments)),r.push(ko(e.query.selection)),r.join("")}function ko(e){return`(${Object.keys(e).sort().map(t=>{let n=e[t];return typeof n=="object"&&n!==null?`(${t} ${ko(n)})`:t}).join(" ")})`}var Sf={aggregate:!1,aggregateRaw:!1,createMany:!0,createManyAndReturn:!0,createOne:!0,deleteMany:!0,deleteOne:!0,executeRaw:!0,findFirst:!1,findFirstOrThrow:!1,findMany:!1,findRaw:!1,findUnique:!1,findUniqueOrThrow:!1,groupBy:!1,queryRaw:!1,runCommandRaw:!0,updateMany:!0,updateManyAndReturn:!0,updateOne:!0,upsertOne:!0};function Oo(e){return Sf[e]}var Kn=class{constructor(r){this.options=r;this.batches={}}batches;tickActive=!1;request(r){let t=this.options.batchBy(r);return t?(this.batches[t]||(this.batches[t]=[],this.tickActive||(this.tickActive=!0,process.nextTick(()=>{this.dispatchBatches(),this.tickActive=!1}))),new Promise((n,i)=>{this.batches[t].push({request:r,resolve:n,reject:i})})):this.options.singleLoader(r)}dispatchBatches(){for(let r in this.batches){let t=this.batches[r];delete this.batches[r],t.length===1?this.options.singleLoader(t[0].request).then(n=>{n instanceof Error?t[0].reject(n):t[0].resolve(n)}).catch(n=>{t[0].reject(n)}):(t.sort((n,i)=>this.options.batchOrder(n.request,i.request)),this.options.batchLoader(t.map(n=>n.request)).then(n=>{if(n instanceof Error)for(let i=0;i<t.length;i++)t[i].reject(n);else for(let i=0;i<t.length;i++){let o=n[i];o instanceof Error?t[i].reject(o):t[i].resolve(o)}}).catch(n=>{for(let i=0;i<t.length;i++)t[i].reject(n)}))}}get[Symbol.toStringTag](){return"DataLoader"}};function mr(e,r){if(r===null)return r;switch(e){case"bigint":return BigInt(r);case"bytes":{let{buffer:t,byteOffset:n,byteLength:i}=Buffer.from(r,"base64");return new Uint8Array(t,n,i)}case"decimal":return new ve(r);case"datetime":case"date":return new Date(r);case"time":return new Date(`1970-01-01T${r}Z`);case"bigint-array":return r.map(t=>mr("bigint",t));case"bytes-array":return r.map(t=>mr("bytes",t));case"decimal-array":return r.map(t=>mr("decimal",t));case"datetime-array":return r.map(t=>mr("datetime",t));case"date-array":return r.map(t=>mr("date",t));case"time-array":return r.map(t=>mr("time",t));default:return r}}function Yn(e){let r=[],t=Rf(e);for(let n=0;n<e.rows.length;n++){let i=e.rows[n],o={...t};for(let s=0;s<i.length;s++)o[e.columns[s]]=mr(e.types[s],i[s]);r.push(o)}return r}function Rf(e){let r={};for(let t=0;t<e.columns.length;t++)r[e.columns[t]]=null;return r}var Cf=N("prisma:client:request_handler"),zn=class{client;dataloader;logEmitter;constructor(r,t){this.logEmitter=t,this.client=r,this.dataloader=new Kn({batchLoader:il(async({requests:n,customDataProxyFetch:i})=>{let{transaction:o,otelParentCtx:s}=n[0],a=n.map(p=>p.protocolQuery),l=this.client._tracingHelper.getTraceParent(s),u=n.some(p=>Oo(p.protocolQuery.action));return(await this.client._engine.requestBatch(a,{traceparent:l,transaction:Af(o),containsWrite:u,customDataProxyFetch:i})).map((p,d)=>{if(p instanceof Error)return p;try{return this.mapQueryEngineResult(n[d],p)}catch(f){return f}})}),singleLoader:async n=>{let i=n.transaction?.kind==="itx"?Zl(n.transaction):void 0,o=await this.client._engine.request(n.protocolQuery,{traceparent:this.client._tracingHelper.getTraceParent(),interactiveTransaction:i,isWrite:Oo(n.protocolQuery.action),customDataProxyFetch:n.customDataProxyFetch});return this.mapQueryEngineResult(n,o)},batchBy:n=>n.transaction?.id?`transaction-${n.transaction.id}`:Yl(n.protocolQuery),batchOrder(n,i){return n.transaction?.kind==="batch"&&i.transaction?.kind==="batch"?n.transaction.index-i.transaction.index:0}})}async request(r){try{return await this.dataloader.request(r)}catch(t){let{clientMethod:n,callsite:i,transaction:o,args:s,modelName:a}=r;this.handleAndLogRequestError({error:t,clientMethod:n,callsite:i,transaction:o,args:s,modelName:a,globalOmit:r.globalOmit})}}mapQueryEngineResult({dataPath:r,unpacker:t},n){let i=n?.data,o=this.unpack(i,r,t);return process.env.PRISMA_CLIENT_GET_TIME?{data:o}:o}handleAndLogRequestError(r){try{this.handleRequestError(r)}catch(t){throw this.logEmitter&&this.logEmitter.emit("error",{message:t.message,target:r.clientMethod,timestamp:new Date}),t}}handleRequestError({error:r,clientMethod:t,callsite:n,transaction:i,args:o,modelName:s,globalOmit:a}){if(Cf(r),If(r,i))throw r;if(r instanceof z&&kf(r)){let u=Xl(r.meta);An({args:o,errors:[u],callsite:n,errorFormat:this.client._errorFormat,originalMethod:t,clientVersion:this.client._clientVersion,globalOmit:a})}let l=r.message;if(n&&(l=bn({callsite:n,originalMethod:t,isPanic:r.isPanic,showColors:this.client._errorFormat==="pretty",message:l})),l=this.sanitizeMessage(l),r.code){let u=s?{modelName:s,...r.meta}:r.meta;throw new z(l,{code:r.code,clientVersion:this.client._clientVersion,meta:u,batchRequestIdx:r.batchRequestIdx})}else{if(r.isPanic)throw new le(l,this.client._clientVersion);if(r instanceof j)throw new j(l,{clientVersion:this.client._clientVersion,batchRequestIdx:r.batchRequestIdx});if(r instanceof T)throw new T(l,this.client._clientVersion);if(r instanceof le)throw new le(l,this.client._clientVersion)}throw r.clientVersion=this.client._clientVersion,r}sanitizeMessage(r){return this.client._errorFormat&&this.client._errorFormat!=="pretty"?(0,zl.default)(r):r}unpack(r,t,n){if(!r||(r.data&&(r=r.data),!r))return r;let i=Object.keys(r)[0],o=Object.values(r)[0],s=t.filter(u=>u!=="select"&&u!=="include"),a=io(o,s),l=i==="queryRaw"?Yn(a):Tr(a);return n?n(l):l}get[Symbol.toStringTag](){return"RequestHandler"}};function Af(e){if(e){if(e.kind==="batch")return{kind:"batch",options:{isolationLevel:e.isolationLevel}};if(e.kind==="itx")return{kind:"itx",options:Zl(e)};_e(e,"Unknown transaction kind")}}function Zl(e){return{id:e.id,payload:e.payload}}function If(e,r){return Hn(e)&&r?.kind==="batch"&&e.batchRequestIdx!==r.index}function kf(e){return e.code==="P2009"||e.code==="P2012"}function Xl(e){if(e.kind==="Union")return{kind:"Union",errors:e.errors.map(Xl)};if(Array.isArray(e.selectionPath)){let[,...r]=e.selectionPath;return{...e,selectionPath:r}}return e}var eu="6.7.0";var ru=eu;var su=k(Gi());var D=class extends Error{constructor(r){super(r+`
          |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ^
      125 | Read more at https://pris.ly/d/client-constructor`),this.name="PrismaClientConstructorValidationError"}get[Symbol.toStringTag](){return"PrismaClientConstructorValidationError"}};x(D,"PrismaClientConstructorValidationError");var tu=["datasources","datasourceUrl","errorFormat","adapter","log","transactionOptions","omit","__internal"],nu=["pretty","colorless","minimal"],iu=["info","query","warn","error"],Df={datasources:(e,{datasourceNames:r})=>{if(e){if(typeof e!="object"||Array.isArray(e))throw new D(`Invalid value ${JSON.stringify(e)} for "datasources" provided to PrismaClient constructor`);for(let[t,n]of Object.entries(e)){if(!r.includes(t)){let i=Wr(t,r)||` Available datasources: ${r.join(", ")}`;throw new D(`Unknown datasource ${t} provided to PrismaClient constructor.${i}`)}if(typeof n!="object"||Array.isArray(n))throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      126 | It should have this form: { url: "CONNECTION_STRING" }`);if(n&&typeof n=="object")for(let[i,o]of Object.entries(n)){if(i!=="url")throw new D(`Invalid value ${JSON.stringify(e)} for datasource "${t}" provided to PrismaClient constructor.
      127 | It should have this form: { url: "CONNECTION_STRING" }`);if(typeof o!="string")throw new D(`Invalid value ${JSON.stringify(o)} for datasource "${t}" provided to PrismaClient constructor.

      at zn.handleRequestError (src/db/generated/client/runtime/library.js:124:7459)
      at zn.handleRequestError [as handleAndLogRequestError] (src/db/generated/client/runtime/library.js:124:6784)
      at zn.handleAndLogRequestError [as request] (src/db/generated/client/runtime/library.js:124:6491)
      at l (src/db/generated/client/runtime/library.js:133:9778)
      at Object.<anonymous> (tests/integration/gameHandler.test.ts:246:9)


Test Suites: 2 failed, 25 passed, 27 total
Tests:       1 failed, 168 passed, 169 total
Snapshots:   0 total
Time:        86.698 s
Ran all test suites.
Error: Jest: Got error running globalTeardown - /home/aflesch/mathquest/app/backend/tests/globalTeardown.ts, reason: Cannot find module '@/config/redis'
Require stack:
- /home/aflesch/mathquest/app/backend/tests/globalTeardown.ts
- /home/aflesch/mathquest/app/backend/node_modules/jest-util/build/requireOrImportModule.js
- /home/aflesch/mathquest/app/backend/node_modules/jest-util/build/index.js
- /home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/FailedTestsInteractiveMode.js
- /home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/plugins/FailedTestsInteractive.js
- /home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/watch.js
- /home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/cli/index.js
- /home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/index.js
- /home/aflesch/mathquest/app/backend/node_modules/jest-cli/build/run.js
- /home/aflesch/mathquest/app/backend/node_modules/jest-cli/build/index.js
- /home/aflesch/mathquest/app/backend/node_modules/jest-cli/bin/jest.js
- /home/aflesch/mathquest/app/backend/node_modules/jest/bin/jest.js
    at Function._resolveFilename (node:internal/modules/cjs/loader:1249:15)
    at Function._load (node:internal/modules/cjs/loader:1075:27)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)
    at Module.require (node:internal/modules/cjs/loader:1340:12)
    at require (node:internal/modules/helpers:138:16)
    at Object.<anonymous> (/home/aflesch/mathquest/app/backend/tests/globalTeardown.ts:4:17)
    at Module._compile (node:internal/modules/cjs/loader:1565:14)
    at Module._compile (/home/aflesch/mathquest/app/backend/node_modules/pirates/lib/index.js:129:24)
    at node:internal/modules/cjs/loader:1708:10
    at Object.newLoader (/home/aflesch/mathquest/app/backend/node_modules/pirates/lib/index.js:134:7)
    at Module.load (node:internal/modules/cjs/loader:1318:32)
    at Function._load (node:internal/modules/cjs/loader:1128:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:219:24)
    at Module.require (node:internal/modules/cjs/loader:1340:12)
    at require (node:internal/modules/helpers:138:16)
    at requireOrImportModule (/home/aflesch/mathquest/app/backend/node_modules/jest-util/build/requireOrImportModule.js:44:28)
    at ScriptTransformer.requireAndTranspileModule (/home/aflesch/mathquest/app/backend/node_modules/@jest/transform/build/ScriptTransformer.js:798:66)
    at runGlobalHook (/home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/runGlobalHook.js:101:27)
    at runJest (/home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/runJest.js:374:5)
    at _run10000 (/home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/cli/index.js:343:7)
    at runCLI (/home/aflesch/mathquest/app/backend/node_modules/@jest/core/build/cli/index.js:198:3)
    at Object.run (/home/aflesch/mathquest/app/backend/node_modules/jest-cli/build/run.js:130:37)
