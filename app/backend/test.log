
> backend@1.0.0 test
> jest

Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma

‚úî Generated Prisma Client (v6.7.0) to ./src/db/generated/client in 89ms

Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)

Tip: Want to turn off tips and other hints? https://pris.ly/tip-4-nohints

Test setup complete, using port 7680
Database URL: postgresql://postgre:Phuf0pohooFee8auohFahk7vChae4Iv0wiem5voT@localhost:5432/mathquest_test
Redis URL: redis://localhost:6379
Cleaning test database...
Database cleaned successfully
Inserted default test questions.
Seeded integration teacher, template, questions, and game instance.
FAIL tests/integration/tournament2.test.ts (53.658 s)
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:83:13)

    console.log
      [2025-06-13 13:35:47.737] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:47.753] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:47.931] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "playMode": "tournament",
          "gameTemplateId": "c1891de4-c0b5-4a9e-9257-0bc9eb6f6045",
          "discipline": "math",
          "nbOfQuestions": 1
        },
        "keys": [
          "name",
          "playMode",
          "gameTemplateId",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
          "username": "p1-extended",
          "role": "STUDENT",
          "iat": 1749814547,
          "exp": 1749818147
        },
        "headers": {
          "host": "localhost:35453",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIwNzgzMWM1Ny04ZWI4LTRjODMtODIwNi1kMDBjNWU4ZWQ5MDEiLCJ1c2VybmFtZSI6InAxLWV4dGVuZGVkIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk4MTQ1NDcsImV4cCI6MTc0OTgxODE0N30.f9xWWAk2ucEoURbmSp94i4WHk0px2ZdvtOccXZMoJas",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:47.937] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "c1891de4-c0b5-4a9e-9257-0bc9eb6f6045",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:47.954] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "634cc503-b83e-4dc5-a152-c66b5f4daee0",
        "accessCode": "3141"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.101] [32mINFO [0m [GameParticipantService] {
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "accessCode": "3141",
        "participantId": "043a445e-d253-4ecf-ad2b-2c5bbe317187"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.119] [32mINFO [0m [GameParticipantService] {
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "accessCode": "3141",
        "participantId": "6f21737b-0380-4222-a09a-c3bad99226de"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'MkUYiuSaTwIwVtG0AAAC',
        finalUserId: '07831c57-8eb8-4c83-8206-d00c5e8ed901',
        setUserId: '07831c57-8eb8-4c83-8206-d00c5e8ed901',
        setUserData: {
          userId: '07831c57-8eb8-4c83-8206-d00c5e8ed901',
          username: 'p1-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-13 13:35:48.136] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "MkUYiuSaTwIwVtG0AAAC",
        "user": {
          "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.861] [32mINFO [0m [GameHandlers] {
        "socketId": "MkUYiuSaTwIwVtG0AAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.863] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "MkUYiuSaTwIwVtG0AAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.865] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "MkUYiuSaTwIwVtG0AAAC"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: MkUYiuSaTwIwVtG0AAAC

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-13 13:35:48.866] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "MkUYiuSaTwIwVtG0AAAC"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.867] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.874] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.874] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.875] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.875] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.875] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.876] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.876] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.876] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "MkUYiuSaTwIwVtG0AAAC"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: '-apOcRCTCC2ft1GRAAAD',
        finalUserId: '837078cd-69c7-4d89-800c-ed1c238832aa',
        setUserId: '837078cd-69c7-4d89-800c-ed1c238832aa',
        setUserData: {
          userId: '837078cd-69c7-4d89-800c-ed1c238832aa',
          username: 'p2-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-13 13:35:48.880] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "-apOcRCTCC2ft1GRAAAD",
        "user": {
          "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.881] [32mINFO [0m [GameHandlers] {
        "socketId": "-apOcRCTCC2ft1GRAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.881] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "-apOcRCTCC2ft1GRAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.881] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "-apOcRCTCC2ft1GRAAAD"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: -apOcRCTCC2ft1GRAAAD

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-13 13:35:48.881] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "-apOcRCTCC2ft1GRAAAD"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.881] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.881] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.881] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.882] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.882] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.882] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.882] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.882] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.882] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "-apOcRCTCC2ft1GRAAAD"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.884] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3141",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.891] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3141",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.891] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3141",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.892] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3141",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.892] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3141",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.893] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3141",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.893] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3141",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.893] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3141",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.895] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3141",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "634cc503-b83e-4dc5-a152-c66b5f4daee0",
          "accessCode": "3141",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.897] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3141",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "634cc503-b83e-4dc5-a152-c66b5f4daee0",
          "accessCode": "3141",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.897] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3141",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "634cc503-b83e-4dc5-a152-c66b5f4daee0",
          "accessCode": "3141",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.898] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3141",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "634cc503-b83e-4dc5-a152-c66b5f4daee0",
          "accessCode": "3141",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.901] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.901] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.901] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.901] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:48.915] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "634cc503-b83e-4dc5-a152-c66b5f4daee0",
        "templateId": "c1891de4-c0b5-4a9e-9257-0bc9eb6f6045",
        "initiator": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "3141",
        "socketId": "MkUYiuSaTwIwVtG0AAAC"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:49.118] [32mINFO [0m [GameStateService] {
        "accessCode": "3141"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:49.127] [32mINFO [0m [TournamentHandler] {
        "room": "game_3141",
        "duration": 5,
        "accessCode": "3141",
        "socketId": "MkUYiuSaTwIwVtG0AAAC"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.133] [32mINFO [0m [GameStateService] {
        "accessCode": "3141"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.142] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.144] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.144] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.146] [32mINFO [0m [GameStateService] {
        "accessCode": "3141"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.146] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "room": "game_3141",
        "socketIds": [
          "MkUYiuSaTwIwVtG0AAAC",
          "-apOcRCTCC2ft1GRAAAD"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.146] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.147] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3141",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "questionType": "single_correct",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "arithmetic"
            ]
          },
          "index": 0,
          "feedbackWaitTime": 2,
          "timer": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.147] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.149] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "MkUYiuSaTwIwVtG0AAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.150] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "MkUYiuSaTwIwVtG0AAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.150] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "MkUYiuSaTwIwVtG0AAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.150] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "MkUYiuSaTwIwVtG0AAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.150] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "-apOcRCTCC2ft1GRAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.150] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "-apOcRCTCC2ft1GRAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.150] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "-apOcRCTCC2ft1GRAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.151] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "-apOcRCTCC2ft1GRAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.154] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.167] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.167] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:54.167] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3141",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.148] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3141",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.149] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "event": "correct_answers",
        "questionUid": "q-late-1",
        "correctAnswers": [
          false,
          false,
          false,
          true
        ]
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.149] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.154] [32mINFO [0m [GameStateService] {
        "accessCode": "3141",
        "questionUid": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.154] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.157] [32mINFO [0m [GameStateService] {
        "accessCode": "3141",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
          "username": "p1-extended",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
          "username": "p2-extended",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament2.test.ts:327:17)

    console.log
      [2025-06-13 13:35:56.171] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "playMode": "tournament",
          "gameTemplateId": "e8775e5b-b060-4964-a8ea-9f5b6f11400d",
          "discipline": "math",
          "nbOfQuestions": 1
        },
        "keys": [
          "name",
          "playMode",
          "gameTemplateId",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
          "username": "p1-extended",
          "role": "STUDENT",
          "iat": 1749814547,
          "exp": 1749818147
        },
        "headers": {
          "host": "localhost:35453",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIwNzgzMWM1Ny04ZWI4LTRjODMtODIwNi1kMDBjNWU4ZWQ5MDEiLCJ1c2VybmFtZSI6InAxLWV4dGVuZGVkIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk4MTQ1NDcsImV4cCI6MTc0OTgxODE0N30.f9xWWAk2ucEoURbmSp94i4WHk0px2ZdvtOccXZMoJas",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.172] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "e8775e5b-b060-4964-a8ea-9f5b6f11400d",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.179] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "e57876ed-e8bd-481a-bf35-f23880405b2d",
        "accessCode": "3142"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.293] [32mINFO [0m [GameParticipantService] {
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "accessCode": "3142",
        "participantId": "051cb40f-8122-4fbe-8f54-48715b2e1c88"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.305] [32mINFO [0m [GameParticipantService] {
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "accessCode": "3142",
        "participantId": "c2a2e481-f75a-4f94-b119-cdacb4933071"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'F8q2dWeFeFE5HRFGAAAG',
        finalUserId: '07831c57-8eb8-4c83-8206-d00c5e8ed901',
        setUserId: '07831c57-8eb8-4c83-8206-d00c5e8ed901',
        setUserData: {
          userId: '07831c57-8eb8-4c83-8206-d00c5e8ed901',
          username: 'p1-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-13 13:35:56.311] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "F8q2dWeFeFE5HRFGAAAG",
        "user": {
          "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.311] [32mINFO [0m [GameHandlers] {
        "socketId": "F8q2dWeFeFE5HRFGAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.311] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "F8q2dWeFeFE5HRFGAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.312] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "F8q2dWeFeFE5HRFGAAAG"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: F8q2dWeFeFE5HRFGAAAG

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-13 13:35:56.312] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "F8q2dWeFeFE5HRFGAAAG"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.312] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.312] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.312] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.312] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.312] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.312] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.312] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.313] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.313] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "F8q2dWeFeFE5HRFGAAAG"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: '2oFFENeE943N3SgwAAAH',
        finalUserId: '837078cd-69c7-4d89-800c-ed1c238832aa',
        setUserId: '837078cd-69c7-4d89-800c-ed1c238832aa',
        setUserData: {
          userId: '837078cd-69c7-4d89-800c-ed1c238832aa',
          username: 'p2-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-13 13:35:56.315] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "2oFFENeE943N3SgwAAAH",
        "user": {
          "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.316] [32mINFO [0m [GameHandlers] {
        "socketId": "2oFFENeE943N3SgwAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.316] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "2oFFENeE943N3SgwAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.316] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "2oFFENeE943N3SgwAAAH"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 2oFFENeE943N3SgwAAAH

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-13 13:35:56.316] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "2oFFENeE943N3SgwAAAH"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.316] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.317] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.317] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.317] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.317] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.317] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.317] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.317] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.317] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "2oFFENeE943N3SgwAAAH"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.318] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3142",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.318] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3142",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.318] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3142",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.318] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3142",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.319] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3142",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.319] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3142",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.319] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3142",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.319] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3142",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.320] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3142",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "e57876ed-e8bd-481a-bf35-f23880405b2d",
          "accessCode": "3142",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.321] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3142",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "e57876ed-e8bd-481a-bf35-f23880405b2d",
          "accessCode": "3142",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.321] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3142",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "e57876ed-e8bd-481a-bf35-f23880405b2d",
          "accessCode": "3142",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.321] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3142",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "e57876ed-e8bd-481a-bf35-f23880405b2d",
          "accessCode": "3142",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.323] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.324] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.324] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.324] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.333] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "e57876ed-e8bd-481a-bf35-f23880405b2d",
        "templateId": "e8775e5b-b060-4964-a8ea-9f5b6f11400d",
        "initiator": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "3142",
        "socketId": "F8q2dWeFeFE5HRFGAAAG"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.535] [32mINFO [0m [GameStateService] {
        "accessCode": "3142"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:56.542] [32mINFO [0m [TournamentHandler] {
        "room": "game_3142",
        "duration": 5,
        "accessCode": "3142",
        "socketId": "F8q2dWeFeFE5HRFGAAAG"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:57.655] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3141",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:57.655] [32mINFO [0m [SharedGameFlow] === BACKEND FEEDBACK PAYLOAD DEBUG === {
        "accessCode": "3141",
        "questionIndex": 0,
        "questionUid": "q-late-1",
        "questionExplanation": null,
        "explanationLength": 0,
        "explanationExists": false,
        "fullPayload": "{\"questionUid\":\"q-late-1\",\"feedbackRemaining\":2}"
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:57.656] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2,
        "hasExplanation": false
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:59.656] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3141",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:59.657] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:35:59.657] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3141"
      } [SharedGameFlow] Game flow completed and cleaned up

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.552] [32mINFO [0m [GameStateService] {
        "accessCode": "3142"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.563] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.563] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.563] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.566] [32mINFO [0m [GameStateService] {
        "accessCode": "3142"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.566] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "room": "game_3142",
        "socketIds": [
          "F8q2dWeFeFE5HRFGAAAG",
          "2oFFENeE943N3SgwAAAH"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.567] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.567] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3142",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "questionType": "single_correct",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "arithmetic"
            ]
          },
          "index": 0,
          "feedbackWaitTime": 2,
          "timer": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.567] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.568] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "F8q2dWeFeFE5HRFGAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.569] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "F8q2dWeFeFE5HRFGAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.569] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "F8q2dWeFeFE5HRFGAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.569] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "F8q2dWeFeFE5HRFGAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.569] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "2oFFENeE943N3SgwAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.569] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "2oFFENeE943N3SgwAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.569] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "2oFFENeE943N3SgwAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.570] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "2oFFENeE943N3SgwAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.574] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.575] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.576] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:01.576] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3142",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.569] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3142",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.571] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "event": "correct_answers",
        "questionUid": "q-late-1",
        "correctAnswers": [
          false,
          false,
          false,
          true
        ]
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.571] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.581] [32mINFO [0m [GameStateService] {
        "accessCode": "3142",
        "questionUid": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.581] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.583] [32mINFO [0m [GameStateService] {
        "accessCode": "3142",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
          "username": "p1-extended",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
          "username": "p2-extended",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament2.test.ts:442:17)

    console.log
      [2025-06-13 13:36:03.602] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "playMode": "tournament",
          "gameTemplateId": "7b739354-0007-4ddd-9806-a00a2c1b2f7e",
          "discipline": "math",
          "nbOfQuestions": 2
        },
        "keys": [
          "name",
          "playMode",
          "gameTemplateId",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
          "username": "p1-extended",
          "role": "STUDENT",
          "iat": 1749814547,
          "exp": 1749818147
        },
        "headers": {
          "host": "localhost:35453",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIwNzgzMWM1Ny04ZWI4LTRjODMtODIwNi1kMDBjNWU4ZWQ5MDEiLCJ1c2VybmFtZSI6InAxLWV4dGVuZGVkIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk4MTQ1NDcsImV4cCI6MTc0OTgxODE0N30.f9xWWAk2ucEoURbmSp94i4WHk0px2ZdvtOccXZMoJas",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.603] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "7b739354-0007-4ddd-9806-a00a2c1b2f7e",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.614] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "6741d2f5-f484-42ea-9066-de2c8606dd47",
        "accessCode": "3143"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.729] [32mINFO [0m [GameParticipantService] {
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "accessCode": "3143",
        "participantId": "a107c486-28ab-419a-83bf-91a2f2501ae1"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.739] [32mINFO [0m [GameParticipantService] {
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "accessCode": "3143",
        "participantId": "dfd03071-49d3-4c8c-8dbf-28608ff45175"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'IeZ3Bh8X-Z7PTQUeAAAK',
        finalUserId: '07831c57-8eb8-4c83-8206-d00c5e8ed901',
        setUserId: '07831c57-8eb8-4c83-8206-d00c5e8ed901',
        setUserData: {
          userId: '07831c57-8eb8-4c83-8206-d00c5e8ed901',
          username: 'p1-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-13 13:36:03.744] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK",
        "user": {
          "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.745] [32mINFO [0m [GameHandlers] {
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.745] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.745] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: IeZ3Bh8X-Z7PTQUeAAAK

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-13 13:36:03.745] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.745] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.745] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.745] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.746] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.746] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.746] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.746] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.746] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.746] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'jysj3ai_lz1_9TknAAAL',
        finalUserId: '837078cd-69c7-4d89-800c-ed1c238832aa',
        setUserId: '837078cd-69c7-4d89-800c-ed1c238832aa',
        setUserData: {
          userId: '837078cd-69c7-4d89-800c-ed1c238832aa',
          username: 'p2-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-13 13:36:03.748] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "jysj3ai_lz1_9TknAAAL",
        "user": {
          "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.748] [32mINFO [0m [GameHandlers] {
        "socketId": "jysj3ai_lz1_9TknAAAL"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.748] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "jysj3ai_lz1_9TknAAAL"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.749] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "jysj3ai_lz1_9TknAAAL"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: jysj3ai_lz1_9TknAAAL

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-13 13:36:03.749] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "jysj3ai_lz1_9TknAAAL"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.749] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.749] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.749] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.749] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.749] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.749] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.749] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.750] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.750] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "jysj3ai_lz1_9TknAAAL"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.755] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3143",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.755] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3143",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.756] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3143",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.756] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3143",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.756] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3143",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.756] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3143",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.756] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3143",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.756] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3143",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.757] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3143",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "6741d2f5-f484-42ea-9066-de2c8606dd47",
          "accessCode": "3143",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.757] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3143",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "6741d2f5-f484-42ea-9066-de2c8606dd47",
          "accessCode": "3143",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.758] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3143",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "6741d2f5-f484-42ea-9066-de2c8606dd47",
          "accessCode": "3143",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.758] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3143",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "6741d2f5-f484-42ea-9066-de2c8606dd47",
          "accessCode": "3143",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.761] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.761] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.762] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.762] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.773] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "6741d2f5-f484-42ea-9066-de2c8606dd47",
        "templateId": "7b739354-0007-4ddd-9806-a00a2c1b2f7e",
        "initiator": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 2,
        "nbParticipants": 2,
        "accessCode": "3143",
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.974] [32mINFO [0m [GameStateService] {
        "accessCode": "3143"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:03.979] [32mINFO [0m [TournamentHandler] {
        "room": "game_3143",
        "duration": 5,
        "accessCode": "3143",
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:05.082] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3142",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:05.082] [32mINFO [0m [SharedGameFlow] === BACKEND FEEDBACK PAYLOAD DEBUG === {
        "accessCode": "3142",
        "questionIndex": 0,
        "questionUid": "q-late-1",
        "questionExplanation": null,
        "explanationLength": 0,
        "explanationExists": false,
        "fullPayload": "{\"questionUid\":\"q-late-1\",\"feedbackRemaining\":2}"
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:05.082] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2,
        "hasExplanation": false
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:07.083] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3142",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:07.084] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:07.085] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3142"
      } [SharedGameFlow] Game flow completed and cleaned up

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:08.992] [32mINFO [0m [GameStateService] {
        "accessCode": "3143"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.000] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.001] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "playMode": "tournament",
        "questionCount": 2
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.001] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.004] [32mINFO [0m [GameStateService] {
        "accessCode": "3143"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.004] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "room": "game_3143",
        "socketIds": [
          "IeZ3Bh8X-Z7PTQUeAAAK",
          "jysj3ai_lz1_9TknAAAL"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.005] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.006] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "questionType": "single_correct",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "arithmetic"
            ]
          },
          "index": 0,
          "feedbackWaitTime": 2,
          "timer": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.007] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.009] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.009] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.010] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.010] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.013] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "jysj3ai_lz1_9TknAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.013] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "jysj3ai_lz1_9TknAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.013] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "jysj3ai_lz1_9TknAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.014] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "jysj3ai_lz1_9TknAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.015] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1"
      } Participant already answered this question. Updating answer.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.018] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.018] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.019] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:09.019] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:11.008] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:11.009] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "correct_answers",
        "questionUid": "q-late-1",
        "correctAnswers": [
          false,
          false,
          false,
          true
        ]
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:11.009] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:11.014] [32mINFO [0m [GameStateService] {
        "accessCode": "3143",
        "questionUid": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:11.014] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:12.516] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:12.516] [32mINFO [0m [SharedGameFlow] === BACKEND FEEDBACK PAYLOAD DEBUG === {
        "accessCode": "3143",
        "questionIndex": 0,
        "questionUid": "q-late-1",
        "questionExplanation": null,
        "explanationLength": 0,
        "explanationExists": false,
        "fullPayload": "{\"questionUid\":\"q-late-1\",\"feedbackRemaining\":2}"
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:12.517] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2,
        "hasExplanation": false
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.525] [32mINFO [0m [GameStateService] {
        "accessCode": "3143"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.526] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "questionIndex": 1,
        "questionUid": "q-late-2"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.526] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-2",
            "questionType": "single_correct",
            "text": "What is 7 x 3?",
            "answerOptions": [
              "20",
              "21",
              "24",
              "27"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              true,
              false,
              false
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "multiplication"
            ]
          },
          "index": 1,
          "feedbackWaitTime": 1.5,
          "timer": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.527] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "game_question",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.533] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.533] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.533] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.534] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.534] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "jysj3ai_lz1_9TknAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.534] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "jysj3ai_lz1_9TknAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.534] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "jysj3ai_lz1_9TknAAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.537] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "jysj3ai_lz1_9TknAAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.544] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.544] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.544] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:14.545] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3143",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.528] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "correct_answers",
        "questionUid": "q-late-2"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.530] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "correct_answers",
        "questionUid": "q-late-2",
        "correctAnswers": [
          false,
          true,
          false,
          false
        ]
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.530] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "questionUid": "q-late-2"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.533] [32mINFO [0m [GameStateService] {
        "accessCode": "3143",
        "questionUid": "q-late-2"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.534] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "questionUid": "q-late-2"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.544] [32mINFO [0m [GamesAPI] Games POST request body debug {
        "fullBody": {
          "name": "Test Tournament",
          "playMode": "tournament",
          "gameTemplateId": "18758501-c645-475f-93be-3a91b8c137c9",
          "discipline": "math",
          "nbOfQuestions": 2
        },
        "keys": [
          "name",
          "playMode",
          "gameTemplateId",
          "discipline",
          "nbOfQuestions"
        ],
        "user": {
          "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
          "username": "p1-extended",
          "role": "STUDENT",
          "iat": 1749814547,
          "exp": 1749818147
        },
        "headers": {
          "host": "localhost:35453",
          "accept-encoding": "gzip, deflate",
          "content-type": "application/json",
          "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiIwNzgzMWM1Ny04ZWI4LTRjODMtODIwNi1kMDBjNWU4ZWQ5MDEiLCJ1c2VybmFtZSI6InAxLWV4dGVuZGVkIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDk4MTQ1NDcsImV4cCI6MTc0OTgxODE0N30.f9xWWAk2ucEoURbmSp94i4WHk0px2ZdvtOccXZMoJas",
          "content-length": "144",
          "connection": "close"
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.545] [32mINFO [0m [GamesAPI] Games validation debug {
        "name": "Test Tournament",
        "finalgameTemplateId": "18758501-c645-475f-93be-3a91b8c137c9",
        "playMode": "tournament",
        "nameCheck": true,
        "templateIdCheck": true,
        "playModeCheck": true
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.558] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "35f7d646-ca53-4f06-9403-dc8f787da0d3",
        "accessCode": "3144"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.673] [32mINFO [0m [GameParticipantService] {
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "accessCode": "3144",
        "participantId": "ccf5906d-0d5c-4089-87f3-33322ff0ddbb"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.685] [32mINFO [0m [GameParticipantService] {
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "accessCode": "3144",
        "participantId": "fee485ff-956b-4185-969a-70d43acbedb9"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: 'nLrY68PAod7gS10tAAAO',
        finalUserId: '07831c57-8eb8-4c83-8206-d00c5e8ed901',
        setUserId: '07831c57-8eb8-4c83-8206-d00c5e8ed901',
        setUserData: {
          userId: '07831c57-8eb8-4c83-8206-d00c5e8ed901',
          username: 'p1-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-13 13:36:16.692] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "nLrY68PAod7gS10tAAAO",
        "user": {
          "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.692] [32mINFO [0m [GameHandlers] {
        "socketId": "nLrY68PAod7gS10tAAAO"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.693] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "nLrY68PAod7gS10tAAAO"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.693] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "nLrY68PAod7gS10tAAAO"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: nLrY68PAod7gS10tAAAO

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-13 13:36:16.694] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "nLrY68PAod7gS10tAAAO"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.694] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.694] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.695] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.695] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.695] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.695] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.695] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.695] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.695] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "nLrY68PAod7gS10tAAAO"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: '7K3ZuJEw4pcDFfmmAAAP',
        finalUserId: '837078cd-69c7-4d89-800c-ed1c238832aa',
        setUserId: '837078cd-69c7-4d89-800c-ed1c238832aa',
        setUserData: {
          userId: '837078cd-69c7-4d89-800c-ed1c238832aa',
          username: 'p2-extended',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-13 13:36:16.697] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "7K3ZuJEw4pcDFfmmAAAP",
        "user": {
          "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.697] [32mINFO [0m [GameHandlers] {
        "socketId": "7K3ZuJEw4pcDFfmmAAAP"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.697] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "7K3ZuJEw4pcDFfmmAAAP"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.698] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "7K3ZuJEw4pcDFfmmAAAP"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 7K3ZuJEw4pcDFfmmAAAP

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-13 13:36:16.699] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "7K3ZuJEw4pcDFfmmAAAP"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.699] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.699] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.699] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.699] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.699] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.699] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.700] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.700] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.700] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "7K3ZuJEw4pcDFfmmAAAP"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.700] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3144",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.701] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3144",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.701] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3144",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.701] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3144",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.701] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3144",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.701] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3144",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.701] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3144",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.701] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3144",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.703] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3144",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "35f7d646-ca53-4f06-9403-dc8f787da0d3",
          "accessCode": "3144",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.704] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "room": "game_3144",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "35f7d646-ca53-4f06-9403-dc8f787da0d3",
          "accessCode": "3144",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.704] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3144",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "35f7d646-ca53-4f06-9403-dc8f787da0d3",
          "accessCode": "3144",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.704] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "room": "game_3144",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "35f7d646-ca53-4f06-9403-dc8f787da0d3",
          "accessCode": "3144",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.706] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.706] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.706] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.706] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.716] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "35f7d646-ca53-4f06-9403-dc8f787da0d3",
        "templateId": "18758501-c645-475f-93be-3a91b8c137c9",
        "initiator": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 2,
        "nbParticipants": 2,
        "accessCode": "3144",
        "socketId": "nLrY68PAod7gS10tAAAO"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.919] [32mINFO [0m [GameStateService] {
        "accessCode": "3144"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:16.930] [32mINFO [0m [TournamentHandler] {
        "room": "game_3144",
        "duration": 5,
        "accessCode": "3144",
        "socketId": "nLrY68PAod7gS10tAAAO"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:18.035] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "feedback",
        "questionUid": "q-late-2",
        "feedbackDisplayDuration": 5
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:18.035] [32mINFO [0m [SharedGameFlow] === BACKEND FEEDBACK PAYLOAD DEBUG === {
        "accessCode": "3143",
        "questionIndex": 1,
        "questionUid": "q-late-2",
        "questionExplanation": null,
        "explanationLength": 0,
        "explanationExists": false,
        "fullPayload": "{\"questionUid\":\"q-late-2\",\"feedbackRemaining\":5}"
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:18.036] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "feedback",
        "questionUid": "q-late-2",
        "feedbackDisplayDuration": 5,
        "hasExplanation": false
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.941] [32mINFO [0m [GameStateService] {
        "accessCode": "3144"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.952] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.952] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "playMode": "tournament",
        "questionCount": 2
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.952] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.954] [32mINFO [0m [GameStateService] {
        "accessCode": "3144"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.955] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "room": "game_3144",
        "socketIds": [
          "nLrY68PAod7gS10tAAAO",
          "7K3ZuJEw4pcDFfmmAAAP"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.955] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.955] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3144",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "questionType": "single_correct",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "arithmetic"
            ]
          },
          "index": 0,
          "feedbackWaitTime": 2,
          "timer": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.955] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.957] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "nLrY68PAod7gS10tAAAO"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.957] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "nLrY68PAod7gS10tAAAO"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.957] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "nLrY68PAod7gS10tAAAO"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.957] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "nLrY68PAod7gS10tAAAO"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.957] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "7K3ZuJEw4pcDFfmmAAAP"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.957] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "7K3ZuJEw4pcDFfmmAAAP"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.958] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "7K3ZuJEw4pcDFfmmAAAP"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.958] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "7K3ZuJEw4pcDFfmmAAAP"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.965] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.965] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.965] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:21.966] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "questionUid": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:23.037] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3143",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:23.038] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:23.038] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3143"
      } [SharedGameFlow] Game flow completed and cleaned up

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:23.956] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3144",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:23.957] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "event": "correct_answers",
        "questionUid": "q-late-1",
        "correctAnswers": [
          false,
          false,
          false,
          true
        ]
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:23.958] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:23.962] [32mINFO [0m [GameStateService] {
        "accessCode": "3144",
        "questionUid": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:23.963] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "questionUid": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.234] [32mINFO [0m [GameParticipantService] {
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "accessCode": "3144",
        "participantId": "d23e2fc2-1540-42f1-9d94-aef8d818156e"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      SOCKET AUTH DEBUG: {
        socketId: '_kloiK35d0dZLBcwAAAR',
        finalUserId: '90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca',
        setUserId: '90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca',
        setUserData: {
          userId: '90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca',
          username: 'p3',
          role: 'STUDENT'
        }
      }

      at Array.log (src/sockets/middleware/socketAuth.ts:132:21)

    console.log
      [2025-06-13 13:36:24.241] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "_kloiK35d0dZLBcwAAAR",
        "user": {
          "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
          "username": "p3",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.242] [32mINFO [0m [GameHandlers] {
        "socketId": "_kloiK35d0dZLBcwAAAR"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.242] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "_kloiK35d0dZLBcwAAAR"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.242] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "_kloiK35d0dZLBcwAAAR"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: _kloiK35d0dZLBcwAAAR

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-13 13:36:24.244] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "_kloiK35d0dZLBcwAAAR"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.244] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.244] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.244] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.244] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.244] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.244] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.244] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.245] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.246] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "_kloiK35d0dZLBcwAAAR"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.246] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "room": "game_3144",
        "playMode": "tournament",
        "username": "p3"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.246] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "room": "game_3144",
        "playMode": "tournament",
        "username": "p3"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.247] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "room": "game_3144",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.247] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "room": "game_3144",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.249] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "room": "game_3144",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "35f7d646-ca53-4f06-9403-dc8f787da0d3",
          "accessCode": "3144",
          "status": "active",
          "currentQuestionIndex": 0,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 1749814581952,
            "durationMs": 2000,
            "isPaused": false
          },
          "question": {
            "uid": "q-late-1",
            "questionType": "single_correct",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "arithmetic"
            ]
          }
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.250] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "room": "game_3144",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "35f7d646-ca53-4f06-9403-dc8f787da0d3",
          "accessCode": "3144",
          "status": "active",
          "currentQuestionIndex": 0,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 1749814581952,
            "durationMs": 2000,
            "isPaused": false
          },
          "question": {
            "uid": "q-late-1",
            "questionType": "single_correct",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "arithmetic"
            ]
          }
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.253] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.253] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.255] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "socketId": "_kloiK35d0dZLBcwAAAR",
        "liveRoom": "game_3144",
        "socketIds": [
          "nLrY68PAod7gS10tAAAO",
          "7K3ZuJEw4pcDFfmmAAAP",
          "_kloiK35d0dZLBcwAAAR"
        ]
      } [DEBUG] Late joiner socket and current live room members before emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.256] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "currentIndex": 0,
        "questionUid": "q-late-1",
        "questionState": "stopped",
        "timer": 0,
        "playMode": "tournament",
        "phase": "show_answers",
        "feedbackRemaining": 0
      } [DEBUG] Emitted game_question to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.256] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "questionUid": "q-late-1",
        "playMode": "tournament",
        "questionState": "stopped",
        "phase": "show_answers"
      } [DEBUG] Emitted correct_answers to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.256] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "socketId": "_kloiK35d0dZLBcwAAAR",
        "liveRoom": "game_3144",
        "socketIds": [
          "nLrY68PAod7gS10tAAAO",
          "7K3ZuJEw4pcDFfmmAAAP",
          "_kloiK35d0dZLBcwAAAR"
        ]
      } [DEBUG] Late joiner socket and current live room members before emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.257] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "currentIndex": 0,
        "questionUid": "q-late-1",
        "questionState": "stopped",
        "timer": 0,
        "playMode": "tournament",
        "phase": "show_answers",
        "feedbackRemaining": 0
      } [DEBUG] Emitted game_question to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:24.257] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "3144",
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "questionUid": "q-late-1",
        "playMode": "tournament",
        "questionState": "stopped",
        "phase": "show_answers"
      } [DEBUG] Emitted correct_answers to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:25.463] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3144",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:25.464] [32mINFO [0m [SharedGameFlow] === BACKEND FEEDBACK PAYLOAD DEBUG === {
        "accessCode": "3144",
        "questionIndex": 0,
        "questionUid": "q-late-1",
        "questionExplanation": null,
        "explanationLength": 0,
        "explanationExists": false,
        "fullPayload": "{\"questionUid\":\"q-late-1\",\"feedbackRemaining\":2}"
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:25.465] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "event": "feedback",
        "questionUid": "q-late-1",
        "feedbackDisplayDuration": 2,
        "hasExplanation": false
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:27.470] [32mINFO [0m [GameStateService] {
        "accessCode": "3144"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:27.471] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "questionIndex": 1,
        "questionUid": "q-late-2"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:27.472] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3144",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-2",
            "questionType": "single_correct",
            "text": "What is 7 x 3?",
            "answerOptions": [
              "20",
              "21",
              "24",
              "27"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              true,
              false,
              false
            ],
            "timeLimit": 2,
            "gradeLevel": "elementary",
            "difficulty": 1,
            "themes": [
              "multiplication"
            ]
          },
          "index": 1,
          "feedbackWaitTime": 1.5,
          "timer": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:27.473] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "event": "game_question",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:29.474] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3144",
        "event": "correct_answers",
        "questionUid": "q-late-2"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:29.475] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "event": "correct_answers",
        "questionUid": "q-late-2",
        "correctAnswers": [
          false,
          true,
          false,
          false
        ]
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:29.476] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "questionUid": "q-late-2"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:29.478] [32mINFO [0m [GameStateService] {
        "accessCode": "3144",
        "questionUid": "q-late-2"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:29.478] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "questionUid": "q-late-2"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      Starting afterAll cleanup...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:74:17)

    console.log
      Processing socket1...

      at disconnectSocket (tests/integration/tournament2.test.ts:82:21)

    console.log
      socket1 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament2.test.ts:87:25)

    console.log
      socket1 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:97:37)

    console.log
      socket1 processing complete.

      at disconnectSocket (tests/integration/tournament2.test.ts:113:21)

    console.log
      Processing socket2...

      at disconnectSocket (tests/integration/tournament2.test.ts:82:21)

    console.log
      socket2 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament2.test.ts:87:25)

    console.log
      socket2 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:97:37)

    console.log
      socket2 processing complete.

      at disconnectSocket (tests/integration/tournament2.test.ts:113:21)

    console.log
      [2025-06-13 13:36:30.571] [32mINFO [0m [DisconnectHandler] {
        "socketId": "nLrY68PAod7gS10tAAAO",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "accessCode": "3144",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:30.574] [32mINFO [0m [DisconnectHandler] {
        "socketId": "7K3ZuJEw4pcDFfmmAAAP",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "accessCode": "3144",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:30.579] [32mINFO [0m [DisconnectHandler] {
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "accessCode": "3144",
        "socketId": "nLrY68PAod7gS10tAAAO"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:30.580] [32mINFO [0m [DisconnectHandler] {
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "accessCode": "3144",
        "socketId": "7K3ZuJEw4pcDFfmmAAAP"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:30.581] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
          "socketId": "nLrY68PAod7gS10tAAAO"
        },
        "room": "game_3144"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:30.582] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
          "socketId": "7K3ZuJEw4pcDFfmmAAAP"
        },
        "room": "game_3144"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:30.586] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3144",
        "gameId": "35f7d646-ca53-4f06-9403-dc8f787da0d3",
        "lobbyCount": 0,
        "gameCount": 1,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:30.588] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3144",
        "gameId": "35f7d646-ca53-4f06-9403-dc8f787da0d3",
        "lobbyCount": 0,
        "gameCount": 1,
        "totalCount": 1
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:30.979] [32mINFO [0m [SharedGameFlow] {
        "room": "game_3144",
        "event": "feedback",
        "questionUid": "q-late-2",
        "feedbackDisplayDuration": 5
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:30.979] [32mINFO [0m [SharedGameFlow] === BACKEND FEEDBACK PAYLOAD DEBUG === {
        "accessCode": "3144",
        "questionIndex": 1,
        "questionUid": "q-late-2",
        "questionExplanation": null,
        "explanationLength": 0,
        "explanationExists": false,
        "fullPayload": "{\"questionUid\":\"q-late-2\",\"feedbackRemaining\":5}"
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:30.980] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "3144",
        "event": "feedback",
        "questionUid": "q-late-2",
        "feedbackDisplayDuration": 5,
        "hasExplanation": false
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing Socket.IO server...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:124:21)

    console.log
      [2025-06-13 13:36:31.069] [32mINFO [0m [DisconnectHandler] {
        "socketId": "MkUYiuSaTwIwVtG0AAAC",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "accessCode": "3141",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-13 13:36:31.069] [32mINFO [0m [DisconnectHandler] {
        "socketId": "-apOcRCTCC2ft1GRAAAD",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "accessCode": "3141",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-13 13:36:31.070] [32mINFO [0m [DisconnectHandler] {
        "socketId": "F8q2dWeFeFE5HRFGAAAG",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "accessCode": "3142",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-13 13:36:31.070] [32mINFO [0m [DisconnectHandler] {
        "socketId": "2oFFENeE943N3SgwAAAH",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "accessCode": "3142",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-13 13:36:31.070] [32mINFO [0m [DisconnectHandler] {
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK",
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "accessCode": "3143",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-13 13:36:31.072] [32mINFO [0m [DisconnectHandler] {
        "socketId": "jysj3ai_lz1_9TknAAAL",
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "accessCode": "3143",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-13 13:36:31.073] [32mINFO [0m [DisconnectHandler] {
        "socketId": "_kloiK35d0dZLBcwAAAR",
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "accessCode": "3144",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-13 13:36:31.083] [32mINFO [0m [DisconnectHandler] {
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "accessCode": "3141",
        "socketId": "MkUYiuSaTwIwVtG0AAAC"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.084] [32mINFO [0m [DisconnectHandler] {
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "accessCode": "3141",
        "socketId": "-apOcRCTCC2ft1GRAAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.085] [32mINFO [0m [DisconnectHandler] {
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "accessCode": "3142",
        "socketId": "F8q2dWeFeFE5HRFGAAAG"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.085] [32mINFO [0m [DisconnectHandler] {
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "accessCode": "3142",
        "socketId": "2oFFENeE943N3SgwAAAH"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.085] [32mINFO [0m [DisconnectHandler] {
        "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
        "accessCode": "3143",
        "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.087] [32mINFO [0m [DisconnectHandler] {
        "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
        "accessCode": "3143",
        "socketId": "jysj3ai_lz1_9TknAAAL"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.087] [32mINFO [0m [DisconnectHandler] {
        "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
        "accessCode": "3144",
        "socketId": "_kloiK35d0dZLBcwAAAR"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket.IO server closed successfully.

      at Server.<anonymous> (tests/integration/tournament2.test.ts:136:33)

    console.log
      Attempting to close HTTP server...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:144:17)

    console.log
      HTTP server was not listening. Assuming already closed or handled by Socket.IO close.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:164:25)

    console.log
      Waiting longer for server resources to release before closing Redis...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:170:17)

    console.log
      [2025-06-13 13:36:31.090] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
          "socketId": "MkUYiuSaTwIwVtG0AAAC"
        },
        "room": "game_3141"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.091] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
          "socketId": "-apOcRCTCC2ft1GRAAAD"
        },
        "room": "game_3141"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.091] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
          "socketId": "F8q2dWeFeFE5HRFGAAAG"
        },
        "room": "game_3142"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.091] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
          "socketId": "2oFFENeE943N3SgwAAAH"
        },
        "room": "game_3142"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.091] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "07831c57-8eb8-4c83-8206-d00c5e8ed901",
          "socketId": "IeZ3Bh8X-Z7PTQUeAAAK"
        },
        "room": "game_3143"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.092] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "837078cd-69c7-4d89-800c-ed1c238832aa",
          "socketId": "jysj3ai_lz1_9TknAAAL"
        },
        "room": "game_3143"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.092] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "90c9e433-0c42-4c05-81a5-fe0c2ae0f5ca",
          "socketId": "_kloiK35d0dZLBcwAAAR"
        },
        "room": "game_3144"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.096] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3141",
        "gameId": "634cc503-b83e-4dc5-a152-c66b5f4daee0",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.097] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3141",
        "gameId": "634cc503-b83e-4dc5-a152-c66b5f4daee0",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.097] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3142",
        "gameId": "e57876ed-e8bd-481a-bf35-f23880405b2d",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.097] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3142",
        "gameId": "e57876ed-e8bd-481a-bf35-f23880405b2d",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.097] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3143",
        "gameId": "6741d2f5-f484-42ea-9066-de2c8606dd47",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.098] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3143",
        "gameId": "6741d2f5-f484-42ea-9066-de2c8606dd47",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:31.098] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "3144",
        "gameId": "35f7d646-ca53-4f06-9403-dc8f787da0d3",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing SocketIO Redis clients (subClient)...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:174:17)

    console.log
      SocketIO Redis clients closed.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:177:21)

    console.log
      Closing main Redis client...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:185:17)

    console.log
      Main Redis client quit successfully.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:189:25)

    console.log
      Cleaning up database...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:200:17)

    console.log
      Database cleanup successful.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:212:21)

    console.warn
      Error cleaning up Redis keys: Connection is closed.

      222 |             }
      223 |         } catch (e: any) {
    > 224 |             console.warn('Error cleaning up Redis keys:', e.message || e);
          |                     ^
      225 |         }
      226 |
      227 |         await new Promise(resolve => setTimeout(resolve, 300));

      at Object.<anonymous> (tests/integration/tournament2.test.ts:224:21)

    console.log
      afterAll cleanup complete.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:228:17)

  ‚óè Tournament Flow - Extended Tests ‚Ä∫ P3 joins after Q1 answers: receives Q1 with timer and correct_answers payload, cannot answer Q1

    Timeout waiting for feedback

      27 |         setTimeout(() => {
      28 |             socket.off(eventName, handler);
    > 29 |             reject(new Error(`Timeout waiting for ${eventName}`));
         |                    ^
      30 |         }, timeout);
      31 |     });
      32 | };

      at Timeout._onTimeout (tests/integration/tournament2.test.ts:29:20)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-13 13:36:35.980] [32mINFO [0m [SharedGameFlow] {
      "room": "game_3144",
      "event": "game_end"
    } [DEBUG] Emitting game_end".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:148:16)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-13 13:36:35.982] [32mINFO [0m [SharedGameFlow] {
      "accessCode": "3144",
      "event": "game_end"
    } [TRACE] Emitted game_end".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:150:16)


  ‚óè  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "[2025-06-13 13:36:35.983] [32mINFO [0m [SharedGameFlow] {
      "accessCode": "3144"
    } [SharedGameFlow] Game flow completed and cleaned up".

      100 |             });
      101 |
    > 102 |             console.log(`${timestamp} ${color}${levelToString(level).padEnd(5)}${COLORS.RESET} ${prefixStr}`, ...processedArgs);
          |                     ^
      103 |         }
      104 |     };
      105 |

      at console.log (node_modules/@jest/console/build/BufferedConsole.js:156:10)
      at log (src/utils/logger.ts:102:21)
      at Object.log [as info] (src/utils/logger.ts:118:35)
      at info (src/sockets/handlers/sharedGameFlow.ts:158:16)

FAIL tests/integration/mockedGameHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-13 13:36:35.415] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.567] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "39e7a40d-7989-4cde-9d2b-fe52b07f6c80",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.584] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-sllkq6bt8di"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.584] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-sllkq6bt8di"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'socket-sllkq6bt8di',
        joinedRoomSocketIds: []
      }

      at log (src/sockets/handlers/game/joinGame.ts:113:25)

    console.log
      [2025-06-13 13:36:35.599] [32mINFO [0m [GameParticipantService] {
        "userId": "player-1_mbuqfivi73x45x",
        "accessCode": "TST789",
        "participantId": "d66a3d89-11d1-42ad-8b7b-27d44d81e286"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.599] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "d66a3d89-11d1-42ad-8b7b-27d44d81e286",
            "userId": "player-1_mbuqfivi73x45x",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-13T11:36:35.595Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.600] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "d66a3d89-11d1-42ad-8b7b-27d44d81e286",
            "userId": "player-1_mbuqfivi73x45x",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.601] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "39e7a40d-7989-4cde-9d2b-fe52b07f6c80",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.604] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 1,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.719] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-ls45osfa7q"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.719] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-ls45osfa7q"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.731] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-7qe27n4qi3"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.732] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-7qe27n4qi3"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        questionUid: 'q-late-1',
        answer: { selectedOption: 'b' },
        timeSpent: 5000
      } Socket ID: socket-7qe27n4qi3 Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-13 13:36:35.737] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-7qe27n4qi3",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "questionUid": "q-late-1",
          "answer": {
            "selectedOption": "b"
          },
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.739] [33mWARN [0m [GameAnswerHandler] {
        "socketId": "socket-7qe27n4qi3",
        "error": "Invalid payload",
        "details": {
          "_errors": [],
          "userId": {
            "_errors": [
              "Required"
            ]
          },
          "answer": {
            "_errors": [
              "Expected string, received object",
              "Expected number, received object",
              "Expected array, received object",
              "Expected array, received object"
            ]
          }
        }
      } Invalid game answer payload

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        questionUid: 'q-late-1',
        answer: { selectedOption: 'b' },
        timeSpent: 5000
      } Socket ID: socket-7qe27n4qi3 Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-13 13:36:35.739] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-7qe27n4qi3",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "questionUid": "q-late-1",
          "answer": {
            "selectedOption": "b"
          },
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.739] [33mWARN [0m [GameAnswerHandler] {
        "socketId": "socket-7qe27n4qi3",
        "error": "Invalid payload",
        "details": {
          "_errors": [],
          "userId": {
            "_errors": [
              "Required"
            ]
          },
          "answer": {
            "_errors": [
              "Expected string, received object",
              "Expected number, received object",
              "Expected array, received object",
              "Expected array, received object"
            ]
          }
        }
      } Invalid game answer payload

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.750] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-877oft2cg83"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.750] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-877oft2cg83"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.917] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-t6s4wqyyz7d"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.917] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-t6s4wqyyz7d"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.968] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-hzsx7xvexs"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.968] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-hzsx7xvexs"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.986] [32mINFO [0m [GameParticipantService] {
        "userId": "player-1_mbuqfivi73x45x",
        "accessCode": "DIFF123",
        "participantId": "8b762785-4d51-495e-a1e4-8a844e272b06"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.987] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "DIFF123",
          "participant": {
            "id": "8b762785-4d51-495e-a1e4-8a844e272b06",
            "userId": "player-1_mbuqfivi73x45x",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-13T11:36:35.979Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": true,
          "differedAvailableFrom": "2025-06-13T11:36:35.951Z",
          "differedAvailableTo": "2025-06-13T12:36:35.951Z"
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.988] [32mINFO [0m [JoinGameHandler] {
        "accessCode": "DIFF123",
        "userId": "player-1_mbuqfivi73x45x"
      } Starting deferred tournament game flow for individual player

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.991] [32mINFO [0m [JoinGameHandler] {
        "accessCode": "DIFF123",
        "userId": "player-1_mbuqfivi73x45x",
        "questionCount": 1
      } Starting individual deferred tournament game flow

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.992] [33mWARN [0m [GameStateService] {
        "accessCode": "DIFF123"
      } Game state not found in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.993] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "DIFF123"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.993] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "DIFF123",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.993] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "DIFF123"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.994] [33mWARN [0m [GameStateService] {
        "accessCode": "DIFF123"
      } Game state not found in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.994] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "DIFF123",
        "room": "game_DIFF123",
        "socketIds": []
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.994] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "DIFF123",
        "questionIndex": 0,
        "questionUid": "bb65cbc5-8967-4e7f-939e-c64dc5f0fbff"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.995] [32mINFO [0m [SharedGameFlow] {
        "room": "game_DIFF123",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "bb65cbc5-8967-4e7f-939e-c64dc5f0fbff",
            "questionType": "multiple_choice_single_answer",
            "text": "What is 1+1?",
            "answerOptions": [
              "1",
              "2"
            ],
            "explanation": null,
            "correctAnswers": [
              false,
              true
            ],
            "timeLimit": 20,
            "gradeLevel": null,
            "difficulty": 1,
            "themes": [
              "arithmetic"
            ]
          },
          "index": 0,
          "feedbackWaitTime": 1.5,
          "timer": 20
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.995] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "DIFF123",
        "event": "game_question",
        "questionUid": "bb65cbc5-8967-4e7f-939e-c64dc5f0fbff"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.995] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DIFF123",
        "gameId": "46853867-373d-4854-a5ff-ab7a8d08be94",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:35.996] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 1
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.014] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-ksslrfn8g6e"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.015] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-ksslrfn8g6e"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.016] [33mWARN [0m [JoinGameHandler] {
        "errorPayload": {
          "message": "Differed mode not available at this time."
        }
      } Emitting game_error: differed window not available

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.034] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-10gsvz361c1l"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.035] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-10gsvz361c1l"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.036] [32mINFO [0m [JoinGameHandler] {
        "gameAlreadyPlayedPayload": {
          "accessCode": "DIFF123"
        }
      } Emitting game_already_played

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.046] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-5dp5vhsl2dg"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.046] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-5dp5vhsl2dg"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.063] [32mINFO [0m [GameParticipantService] {
        "userId": "player-3_mbuqfivi73x45x",
        "accessCode": "DIFF123",
        "participantId": "dbb7cedf-adb2-41bc-8180-f68896352f62"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.064] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "DIFF123",
          "participant": {
            "id": "dbb7cedf-adb2-41bc-8180-f68896352f62",
            "userId": "player-3_mbuqfivi73x45x",
            "username": "Player 3",
            "avatar": "https://example.com/avatar3.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar3.jpg",
            "joinedAt": "2025-06-13T11:36:36.058Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": true,
          "differedAvailableFrom": "2025-06-13T11:36:36.016Z",
          "differedAvailableTo": "2025-06-13T12:36:36.016Z"
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.064] [32mINFO [0m [JoinGameHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbuqfivi73x45x"
      } Starting deferred tournament game flow for individual player

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.067] [32mINFO [0m [JoinGameHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbuqfivi73x45x",
        "questionCount": 1
      } Starting individual deferred tournament game flow

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.068] [33mWARN [0m [GameStateService] {
        "accessCode": "DIFF123"
      } Game state not found in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.068] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "DIFF123"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.068] [33mWARN [0m [SharedGameFlow] {
        "accessCode": "DIFF123"
      } [SharedGameFlow] Game flow already running for this access code. Skipping duplicate.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.069] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "DIFF123",
        "gameId": "46853867-373d-4854-a5ff-ab7a8d08be94",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.071] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 2
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'DIFF123',
        userId: 'player-3_mbuqfivi73x45x',
        questionUid: 'bb65cbc5-8967-4e7f-939e-c64dc5f0fbff',
        answer: 'b',
        timeSpent: 2000
      } Socket ID: socket-5dp5vhsl2dg Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-13 13:36:36.072] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-5dp5vhsl2dg",
        "event": "game_answer",
        "payload": {
          "accessCode": "DIFF123",
          "userId": "player-3_mbuqfivi73x45x",
          "questionUid": "bb65cbc5-8967-4e7f-939e-c64dc5f0fbff",
          "answer": "b",
          "timeSpent": 2000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.087] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbuqfivi73x45x",
        "questionUid": "bb65cbc5-8967-4e7f-939e-c64dc5f0fbff"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at log (src/sockets/handlers/game/gameAnswer.ts:181:25)

    console.log
      [GAME_ANSWER] Adding current questionUid bb65cbc5-8967-4e7f-939e-c64dc5f0fbff to answered questions

      at log (src/sockets/handlers/game/gameAnswer.ts:193:29)

    console.log
      [GAME_ANSWER] Found 1/1 answered questions: [ 'bb65cbc5-8967-4e7f-939e-c64dc5f0fbff' ]

      at log (src/sockets/handlers/game/gameAnswer.ts:200:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=1

      at log (src/sockets/handlers/game/gameAnswer.ts:209:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at log (src/sockets/handlers/game/gameAnswer.ts:219:29)

    console.log
      [2025-06-13 13:36:36.088] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbuqfivi73x45x",
        "questionUid": "bb65cbc5-8967-4e7f-939e-c64dc5f0fbff"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'DIFF123',
        userId: 'player-3_mbuqfivi73x45x',
        questionUid: 'bb65cbc5-8967-4e7f-939e-c64dc5f0fbff',
        answer: 'b',
        timeSpent: 2000
      } Socket ID: socket-5dp5vhsl2dg Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-13 13:36:36.088] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-5dp5vhsl2dg",
        "event": "game_answer",
        "payload": {
          "accessCode": "DIFF123",
          "userId": "player-3_mbuqfivi73x45x",
          "questionUid": "bb65cbc5-8967-4e7f-939e-c64dc5f0fbff",
          "answer": "b",
          "timeSpent": 2000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.108] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbuqfivi73x45x",
        "questionUid": "bb65cbc5-8967-4e7f-939e-c64dc5f0fbff"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":"b","timestamp":"2025-06-13T11:36:36.077Z","questionUid":"bb65cbc5-8967-4e7f-939e-c64dc5f0fbff","timeTakenMs":2000}]

      at log (src/sockets/handlers/game/gameAnswer.ts:181:25)

    console.log
      [GAME_ANSWER] Found 1/1 answered questions: [ 'bb65cbc5-8967-4e7f-939e-c64dc5f0fbff' ]

      at log (src/sockets/handlers/game/gameAnswer.ts:200:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=1

      at log (src/sockets/handlers/game/gameAnswer.ts:209:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at log (src/sockets/handlers/game/gameAnswer.ts:219:29)

    console.log
      [2025-06-13 13:36:36.109] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbuqfivi73x45x",
        "questionUid": "bb65cbc5-8967-4e7f-939e-c64dc5f0fbff"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.130] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-8kaw2sn9vo9"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.130] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-8kaw2sn9vo9"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'socket-8kaw2sn9vo9',
        joinedRoomSocketIds: []
      }

      at log (src/sockets/handlers/game/joinGame.ts:113:25)

    console.log
      [2025-06-13 13:36:36.137] [32mINFO [0m [GameParticipantService] {
        "userId": "player-1_mbuqfivi73x45x",
        "accessCode": "TST789",
        "participantId": "d66a3d89-11d1-42ad-8b7b-27d44d81e286"
      } Updated existing participant join time

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.138] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "d66a3d89-11d1-42ad-8b7b-27d44d81e286",
            "userId": "player-1_mbuqfivi73x45x",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-13T11:36:36.135Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.138] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "d66a3d89-11d1-42ad-8b7b-27d44d81e286",
            "userId": "player-1_mbuqfivi73x45x",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.139] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "39e7a40d-7989-4cde-9d2b-fe52b07f6c80",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.140] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 1,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.146] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.149] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789",
        "questionIndex": 0
      } Current question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        userId: 'player-1_mbuqfivi73x45x',
        questionUid: 'ed97b533-34c1-4331-af7c-af2a3e23d62f',
        answer: 1,
        timeSpent: 5000
      } Socket ID: socket-8kaw2sn9vo9 Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-13 13:36:36.149] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-8kaw2sn9vo9",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "userId": "player-1_mbuqfivi73x45x",
          "questionUid": "ed97b533-34c1-4331-af7c-af2a3e23d62f",
          "answer": 1,
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.156] [32mINFO [0m [GameAnswerHandler] {
        "leaderboard": [
          {
            "userId": "player-1_mbuqfivi73x45x",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0
          }
        ],
        "roomName": "teacher_a9a63f36-244c-4d42-9b56-d3d2eda277bd_TST789"
      } Emitting leaderboard_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.156] [32mINFO [0m [GameAnswerHandler] {
        "questionUid": "ed97b533-34c1-4331-af7c-af2a3e23d62f",
        "timeSpent": 5000
      } Emitting answer_received for non-differed mode

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Successfully emitted answer_received for question ed97b533-34c1-4331-af7c-af2a3e23d62f to socket socket-8kaw2sn9vo9

      at log (src/sockets/handlers/game/gameAnswer.ts:245:29)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        userId: 'player-1_mbuqfivi73x45x',
        questionUid: 'ed97b533-34c1-4331-af7c-af2a3e23d62f',
        answer: 1,
        timeSpent: 5000
      } Socket ID: socket-8kaw2sn9vo9 Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-13 13:36:36.156] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-8kaw2sn9vo9",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "userId": "player-1_mbuqfivi73x45x",
          "questionUid": "ed97b533-34c1-4331-af7c-af2a3e23d62f",
          "answer": 1,
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.167] [32mINFO [0m [GameAnswerHandler] {
        "leaderboard": [
          {
            "userId": "player-1_mbuqfivi73x45x",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0
          }
        ],
        "roomName": "teacher_a9a63f36-244c-4d42-9b56-d3d2eda277bd_TST789"
      } Emitting leaderboard_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:36.167] [32mINFO [0m [GameAnswerHandler] {
        "questionUid": "ed97b533-34c1-4331-af7c-af2a3e23d62f",
        "timeSpent": 5000
      } Emitting answer_received for non-differed mode

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Successfully emitted answer_received for question ed97b533-34c1-4331-af7c-af2a3e23d62f to socket socket-8kaw2sn9vo9

      at log (src/sockets/handlers/game/gameAnswer.ts:245:29)

    console.log
      [DEBUG before scoring] Redis key: mathquest:game:answers:TST789:ed97b533-34c1-4331-af7c-af2a3e23d62f value: {
        'player-1_mbuqfivi73x45x': '{"userId":"player-1_mbuqfivi73x45x","answer":1,"timeSpent":5000,"submittedAt":1749814596164}'
      }

      at Object.<anonymous> (tests/integration/mockedGameHandler.test.ts:921:21)

    console.log
      [2025-06-13 13:36:36.172] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789",
        "questionUid": "ed97b533-34c1-4331-af7c-af2a3e23d62f"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG after scoring] Redis key: mathquest:game:answers:TST789:ed97b533-34c1-4331-af7c-af2a3e23d62f value: {
        'player-1_mbuqfivi73x45x': '{"userId":"player-1_mbuqfivi73x45x","answer":1,"timeSpent":5000,"submittedAt":1749814596164}'
      }

      at Object.<anonymous> (tests/integration/mockedGameHandler.test.ts:928:21)

  ‚óè Mocked Game Handler ‚Ä∫ Differed Mode - Game Handler ‚Ä∫ Player can join a differed game within window

    Connection is closed.



      at EventEmitter.sendCommand (node_modules/ioredis/built/Redis.js:332:28)
      at EventEmitter.publish (node_modules/ioredis/built/utils/Commander.js:90:25)
      at RedisAdapter.broadcast (node_modules/@socket.io/redis-adapter/dist/index.js:473:28)
      at BroadcastOperator.emit (node_modules/socket.io/dist/broadcast-operator.js:169:26)
      at runGameFlow (src/sockets/handlers/sharedGameFlow.ts:1994:33)

PASS tests/integration/gameHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-13 13:36:37.096] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.165] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "ef024266-dca3-4992-a044-55bb6627e5bd",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.178] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "ZQSczgiB8s08vZpOAAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.179] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "ZQSczgiB8s08vZpOAAAB",
        "user": {
          "id": "player-123",
          "userId": "player-123",
          "username": "Test Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.185] [32mINFO [0m [GameHandlers] {
        "socketId": "ZQSczgiB8s08vZpOAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.185] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "ZQSczgiB8s08vZpOAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.186] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ZQSczgiB8s08vZpOAAAB"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: ZQSczgiB8s08vZpOAAAB

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-13 13:36:37.186] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "ZQSczgiB8s08vZpOAAAB"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.186] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.186] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.186] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.186] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.186] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.186] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.187] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.187] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.187] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "ZQSczgiB8s08vZpOAAAB"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.193] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "ef024266-dca3-4992-a044-55bb6627e5bd",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'ZQSczgiB8s08vZpOAAAB',
        joinedRoomSocketIds: [ 'ZQSczgiB8s08vZpOAAAB' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:113:25)

    console.log
      [2025-06-13 13:36:37.204] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.204] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Test Player",
        "avatarEmoji": "https://example.com/avatar.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.205] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.205] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Test Player",
        "avatarEmoji": "https://example.com/avatar.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.205] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.205] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.206] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.206] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.208] [32mINFO [0m [GameParticipantService] {
        "userId": "player-123",
        "accessCode": "TST789",
        "participantId": "5a7afdfb-e66c-4782-b44d-c2ed1ce37522"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.208] [32mINFO [0m [DisconnectHandler] {
        "socketId": "ZQSczgiB8s08vZpOAAAB",
        "userId": "player-123",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.209] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.209] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.212] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-123",
        "accessCode": "TST789",
        "socketId": "ZQSczgiB8s08vZpOAAAB"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.212] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "5a7afdfb-e66c-4782-b44d-c2ed1ce37522",
            "userId": "player-123",
            "username": "Test Player",
            "avatar": "https://example.com/avatar.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar.jpg",
            "joinedAt": "2025-06-13T11:36:37.203Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.212] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "5a7afdfb-e66c-4782-b44d-c2ed1ce37522",
            "userId": "player-123",
            "username": "Test Player",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.214] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "player-123",
          "socketId": "ZQSczgiB8s08vZpOAAAB"
        },
        "room": "game_TST789"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.215] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.216] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
        "lobbyCount": 0,
        "gameCount": 0,
        "totalCount": 0
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.217] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "RF2-LKH6N2GsEDyNAAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.217] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "RF2-LKH6N2GsEDyNAAAE",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.217] [32mINFO [0m [GameHandlers] {
        "socketId": "RF2-LKH6N2GsEDyNAAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.217] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "RF2-LKH6N2GsEDyNAAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.217] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "RF2-LKH6N2GsEDyNAAAE"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: RF2-LKH6N2GsEDyNAAAE

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-13 13:36:37.218] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "RF2-LKH6N2GsEDyNAAAE"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.218] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.218] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.218] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.218] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.218] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.218] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.218] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.218] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.218] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "RF2-LKH6N2GsEDyNAAAE"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.219] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 1,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.220] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "4zqXgQqXYC6Ggl8lAAAF"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.220] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "4zqXgQqXYC6Ggl8lAAAF",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.220] [32mINFO [0m [GameHandlers] {
        "socketId": "4zqXgQqXYC6Ggl8lAAAF"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.221] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "4zqXgQqXYC6Ggl8lAAAF"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.221] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "4zqXgQqXYC6Ggl8lAAAF"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 4zqXgQqXYC6Ggl8lAAAF

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-13 13:36:37.221] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "4zqXgQqXYC6Ggl8lAAAF"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.221] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.221] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.221] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.221] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.221] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.221] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.221] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.222] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.222] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "4zqXgQqXYC6Ggl8lAAAF"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.230] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "ef024266-dca3-4992-a044-55bb6627e5bd",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'RF2-LKH6N2GsEDyNAAAE',
        joinedRoomSocketIds: [ 'RF2-LKH6N2GsEDyNAAAE' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:113:25)

    console.log
      [2025-06-13 13:36:37.233] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.233] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.233] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.233] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.233] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.233] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.233] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.234] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.236] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.236] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: '4zqXgQqXYC6Ggl8lAAAF',
        joinedRoomSocketIds: [ 'RF2-LKH6N2GsEDyNAAAE', '4zqXgQqXYC6Ggl8lAAAF' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:113:25)

    console.log
      [2025-06-13 13:36:37.237] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.237] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.237] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.237] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.237] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.237] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.238] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.239] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.240] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.240] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.245] [32mINFO [0m [GameParticipantService] {
        "userId": "player-1",
        "accessCode": "TST789",
        "participantId": "50b9c9c0-65bf-4e0d-a996-04a6f5ca8438"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.246] [32mINFO [0m [GameParticipantService] {
        "userId": "player-2",
        "accessCode": "TST789",
        "participantId": "e82a0118-5cd6-4f8a-b003-d4acf5042260"
      } Created new participant

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.246] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "50b9c9c0-65bf-4e0d-a996-04a6f5ca8438",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-13T11:36:37.241Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.246] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "50b9c9c0-65bf-4e0d-a996-04a6f5ca8438",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.247] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "e82a0118-5cd6-4f8a-b003-d4acf5042260",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "https://example.com/avatar2.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar2.jpg",
            "joinedAt": "2025-06-13T11:36:37.242Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.247] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "e82a0118-5cd6-4f8a-b003-d4acf5042260",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.248] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
        "lobbyCount": 0,
        "gameCount": 2,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.249] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
        "lobbyCount": 0,
        "gameCount": 2,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.249] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 3,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.250] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 3,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: Redis participants: {
        'player-2': '{"id":"e82a0118-5cd6-4f8a-b003-d4acf5042260","userId":"player-2","username":"Player 2","avatar":"https://example.com/avatar2.jpg","score":0,"avatarEmoji":"https://example.com/avatar2.jpg","joinedAt":"2025-06-13T11:36:37.242Z","online":true,"socketId":"4zqXgQqXYC6Ggl8lAAAF"}',
        'player-1': '{"id":"50b9c9c0-65bf-4e0d-a996-04a6f5ca8438","userId":"player-1","username":"Player 1","avatar":"https://example.com/avatar1.jpg","score":0,"avatarEmoji":"https://example.com/avatar1.jpg","joinedAt":"2025-06-13T11:36:37.241Z","online":true,"socketId":"RF2-LKH6N2GsEDyNAAAE"}'
      }

      at Object.<anonymous> (tests/integration/gameHandler.test.ts:528:17)

    console.log
      [2025-06-13 13:36:37.344] [32mINFO [0m [DisconnectHandler] {
        "socketId": "RF2-LKH6N2GsEDyNAAAE",
        "userId": "player-1",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.345] [32mINFO [0m [DisconnectHandler] {
        "socketId": "4zqXgQqXYC6Ggl8lAAAF",
        "userId": "player-2",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.347] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-1",
        "accessCode": "TST789",
        "disconnectedSocketId": "RF2-LKH6N2GsEDyNAAAE",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.347] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TST789",
        "disconnectedSocketId": "4zqXgQqXYC6Ggl8lAAAF",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.351] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "hDCk4NuuOU8mHlhzAAAI"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.351] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "hDCk4NuuOU8mHlhzAAAI",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.351] [32mINFO [0m [GameHandlers] {
        "socketId": "hDCk4NuuOU8mHlhzAAAI"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.352] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "hDCk4NuuOU8mHlhzAAAI"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.352] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "hDCk4NuuOU8mHlhzAAAI"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: hDCk4NuuOU8mHlhzAAAI

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-13 13:36:37.352] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "hDCk4NuuOU8mHlhzAAAI"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.352] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.352] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.352] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.352] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.352] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.352] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.353] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.353] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.353] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "hDCk4NuuOU8mHlhzAAAI"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.354] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "7FRwo8mA-Ip-erzSAAAJ"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.354] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "7FRwo8mA-Ip-erzSAAAJ",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.354] [32mINFO [0m [GameHandlers] {
        "socketId": "7FRwo8mA-Ip-erzSAAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.354] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "7FRwo8mA-Ip-erzSAAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.354] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "7FRwo8mA-Ip-erzSAAAJ"
      } teacherControlHandler called

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG] registerTeacherControlHandlers called for socket: 7FRwo8mA-Ip-erzSAAAJ

      at log (src/sockets/handlers/teacherControl/index.ts:22:13)

    console.log
      [2025-06-13 13:36:37.354] [32mINFO [0m [TeacherControlIndex] {
        "socketId": "7FRwo8mA-Ip-erzSAAAJ"
      } Registering teacher control handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.355] [32mINFO [0m [TeacherControlIndex] {
        "event": "join_dashboard"
      } Registering join_dashboard handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.355] [32mINFO [0m [TeacherControlIndex] {
        "event": "set_question"
      } Registering set_question handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.355] [32mINFO [0m [TeacherControlIndex] {
        "event": "quiz_timer_action"
      } Registering timer_action handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.355] [32mINFO [0m [TeacherControlIndex] {
        "event": "lock_answers"
      } Registering lock_answers handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.355] [32mINFO [0m [TeacherControlIndex] {
        "event": "end_game"
      } Registering end_game handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.355] [32mINFO [0m [TeacherControlIndex] {
        "event": "start_timer"
      } Registering start_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.355] [32mINFO [0m [TeacherControlIndex] {
        "event": "pause_timer"
      } Registering pause_timer handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.355] [32mINFO [0m [TeacherControlIndex] Registering disconnect handler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.355] [32mINFO [0m [TeacherControlHandler] {
        "socketId": "7FRwo8mA-Ip-erzSAAAJ"
      } teacherControlHandler registration complete

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.363] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "ef024266-dca3-4992-a044-55bb6627e5bd",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'hDCk4NuuOU8mHlhzAAAI',
        joinedRoomSocketIds: [ 'hDCk4NuuOU8mHlhzAAAI' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:113:25)

    console.log
      [2025-06-13 13:36:37.365] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.366] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.366] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.366] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.366] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.366] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: '7FRwo8mA-Ip-erzSAAAJ',
        joinedRoomSocketIds: [ 'hDCk4NuuOU8mHlhzAAAI', '7FRwo8mA-Ip-erzSAAAJ' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:113:25)

    console.log
      [2025-06-13 13:36:37.367] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.368] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.370] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.370] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.374] [32mINFO [0m [GameParticipantService] {
        "userId": "player-1",
        "accessCode": "TST789",
        "participantId": "50b9c9c0-65bf-4e0d-a996-04a6f5ca8438"
      } Updated existing participant join time

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.374] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "50b9c9c0-65bf-4e0d-a996-04a6f5ca8438",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-13T11:36:37.368Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.375] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "50b9c9c0-65bf-4e0d-a996-04a6f5ca8438",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.375] [32mINFO [0m [GameParticipantService] {
        "userId": "player-2",
        "accessCode": "TST789",
        "participantId": "e82a0118-5cd6-4f8a-b003-d4acf5042260"
      } Updated existing participant join time

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.376] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.376] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.376] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.376] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.376] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.376] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.376] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
        "lobbyCount": 0,
        "gameCount": 2,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.377] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "e82a0118-5cd6-4f8a-b003-d4acf5042260",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "https://example.com/avatar2.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar2.jpg",
            "joinedAt": "2025-06-13T11:36:37.371Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.377] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "e82a0118-5cd6-4f8a-b003-d4acf5042260",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.378] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.378] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "durationMs": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.379] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 3,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.379] [32mINFO [0m [ParticipantCountUtils] {
        "accessCode": "TST789",
        "gameId": "ef024266-dca3-4992-a044-55bb6627e5bd",
        "lobbyCount": 0,
        "gameCount": 2,
        "totalCount": 2
      } Emitting participant count to dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.380] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.380] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.381] [32mINFO [0m [JoinGameHandler] {
        "participantCount": 3,
        "room": "game_TST789"
      } Emitting participant_count_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: Redis participants: {
        'player-2': '{"userId":"player-2","username":"Player 2","avatarEmoji":"https://example.com/avatar2.jpg","score":0,"answers":[],"online":true,"lastSocketId":"7FRwo8mA-Ip-erzSAAAJ","joinedAt":"2025-06-13T11:36:37.380Z"}',
        'player-1': '{"id":"50b9c9c0-65bf-4e0d-a996-04a6f5ca8438","userId":"player-1","username":"Player 1","avatar":"https://example.com/avatar1.jpg","score":0,"avatarEmoji":"https://example.com/avatar1.jpg","joinedAt":"2025-06-13T11:36:37.368Z","online":true,"socketId":"hDCk4NuuOU8mHlhzAAAI"}'
      }

      at Object.<anonymous> (tests/integration/gameHandler.test.ts:624:17)

    console.log
      [2025-06-13 13:36:37.886] [32mINFO [0m [DisconnectHandler] {
        "socketId": "hDCk4NuuOU8mHlhzAAAI",
        "userId": "player-1",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.887] [32mINFO [0m [DisconnectHandler] {
        "socketId": "7FRwo8mA-Ip-erzSAAAJ",
        "userId": "player-2",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.890] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-1",
        "accessCode": "TST789",
        "disconnectedSocketId": "hDCk4NuuOU8mHlhzAAAI",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-13 13:36:37.891] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TST789",
        "disconnectedSocketId": "7FRwo8mA-Ip-erzSAAAJ",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

