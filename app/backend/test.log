
> backend@1.0.0 test
> jest

Environment variables loaded from .env
Prisma schema loaded from prisma/schema.prisma

‚úî Generated Prisma Client (v6.7.0) to ./src/db/generated/client in 74ms

Start by importing your Prisma Client (See: https://pris.ly/d/importing-client)

Tip: Want to react to database changes in your app as they happen? Discover how with Pulse: https://pris.ly/tip-1-pulse

Test setup complete, using port 5383
Database URL: postgresql://postgre:Phuf0pohooFee8auohFahk7vChae4Iv0wiem5voT@localhost:5432/mathquest_test
Redis URL: redis://localhost:6379
Cleaning test database...
Database cleaned successfully
Inserted default test questions.
Seeded integration teacher, template, questions, and game instance.
PASS tests/integration/tournament2.test.ts (47.754 s)
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-06 15:30:19.258] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:19.269] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:19.456] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "a8cb52de-7c80-4098-ac6b-c1cd2a7e23de",
        "accessCode": "SLQUZ4"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:19.646] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "4Rq7S7FCJKKZwxQqAAAC",
        "user": {
          "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.151] [32mINFO [0m [GameHandlers] {
        "socketId": "4Rq7S7FCJKKZwxQqAAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.153] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "4Rq7S7FCJKKZwxQqAAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.159] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "6N6_U_lBozRkWKidAAAD",
        "user": {
          "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.160] [32mINFO [0m [GameHandlers] {
        "socketId": "6N6_U_lBozRkWKidAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.160] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "6N6_U_lBozRkWKidAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.162] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_SLQUZ4",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.167] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_SLQUZ4",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.167] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_SLQUZ4",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.168] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_SLQUZ4",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.168] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_SLQUZ4",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.168] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_SLQUZ4",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.168] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_SLQUZ4",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.169] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_SLQUZ4",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.171] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_SLQUZ4",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "a8cb52de-7c80-4098-ac6b-c1cd2a7e23de",
          "accessCode": "SLQUZ4",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.173] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_SLQUZ4",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "a8cb52de-7c80-4098-ac6b-c1cd2a7e23de",
          "accessCode": "SLQUZ4",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.174] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_SLQUZ4",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "a8cb52de-7c80-4098-ac6b-c1cd2a7e23de",
          "accessCode": "SLQUZ4",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.174] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_SLQUZ4",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "a8cb52de-7c80-4098-ac6b-c1cd2a7e23de",
          "accessCode": "SLQUZ4",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.178] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.178] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.178] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.178] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.195] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "a8cb52de-7c80-4098-ac6b-c1cd2a7e23de",
        "templateId": "c0be0050-b98e-4613-9056-81d01d82c262",
        "initiator": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "SLQUZ4",
        "socketId": "4Rq7S7FCJKKZwxQqAAAC"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.398] [32mINFO [0m [GameStateService] {
        "accessCode": "SLQUZ4"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:20.402] [32mINFO [0m [TournamentHandler] {
        "room": "game_SLQUZ4",
        "duration": 5,
        "accessCode": "SLQUZ4",
        "socketId": "4Rq7S7FCJKKZwxQqAAAC"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.404] [32mINFO [0m [GameStateService] {
        "accessCode": "SLQUZ4"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.415] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SLQUZ4"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.417] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SLQUZ4",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.417] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SLQUZ4"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.418] [32mINFO [0m [GameStateService] {
        "accessCode": "SLQUZ4"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.418] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SLQUZ4",
        "room": "game_SLQUZ4",
        "socketIds": [
          "4Rq7S7FCJKKZwxQqAAAC",
          "6N6_U_lBozRkWKidAAAD"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.418] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SLQUZ4",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.418] [32mINFO [0m [SharedGameFlow] {
        "room": "game_SLQUZ4",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-06T13:30:15.345Z",
            "updatedAt": "2025-06-06T13:30:19.360Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.418] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SLQUZ4",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.420] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "4Rq7S7FCJKKZwxQqAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.420] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "4Rq7S7FCJKKZwxQqAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.421] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "4Rq7S7FCJKKZwxQqAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.421] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "4Rq7S7FCJKKZwxQqAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.421] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "6N6_U_lBozRkWKidAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.421] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "6N6_U_lBozRkWKidAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.422] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "6N6_U_lBozRkWKidAAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.422] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "6N6_U_lBozRkWKidAAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.431] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.441] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.442] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:25.442] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "SLQUZ4",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.419] [32mINFO [0m [SharedGameFlow] {
        "room": "game_SLQUZ4",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.420] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SLQUZ4",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.421] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SLQUZ4",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.430] [32mINFO [0m [GameStateService] {
        "accessCode": "SLQUZ4",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.431] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SLQUZ4",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.435] [32mINFO [0m [GameStateService] {
        "accessCode": "SLQUZ4",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
          "username": "p1-extended",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
          "username": "p2-extended",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament2.test.ts:327:17)

    console.log
      [2025-06-06 15:30:27.465] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "ed1510c8-0453-4572-bded-f02a582ad9e6",
        "accessCode": "2Y7YB7"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.609] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "vYFFNb92ioqCo5CNAAAG",
        "user": {
          "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.609] [32mINFO [0m [GameHandlers] {
        "socketId": "vYFFNb92ioqCo5CNAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.609] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "vYFFNb92ioqCo5CNAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.611] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "6j8QPGV0exrboqpUAAAH",
        "user": {
          "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.611] [32mINFO [0m [GameHandlers] {
        "socketId": "6j8QPGV0exrboqpUAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.611] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "6j8QPGV0exrboqpUAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.612] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_2Y7YB7",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.612] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_2Y7YB7",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.612] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_2Y7YB7",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.612] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_2Y7YB7",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.613] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_2Y7YB7",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.613] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_2Y7YB7",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.613] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_2Y7YB7",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.613] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_2Y7YB7",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.614] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_2Y7YB7",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "ed1510c8-0453-4572-bded-f02a582ad9e6",
          "accessCode": "2Y7YB7",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.615] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_2Y7YB7",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "ed1510c8-0453-4572-bded-f02a582ad9e6",
          "accessCode": "2Y7YB7",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.616] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_2Y7YB7",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "ed1510c8-0453-4572-bded-f02a582ad9e6",
          "accessCode": "2Y7YB7",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.616] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_2Y7YB7",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "ed1510c8-0453-4572-bded-f02a582ad9e6",
          "accessCode": "2Y7YB7",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.618] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.618] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.618] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.618] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.633] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "ed1510c8-0453-4572-bded-f02a582ad9e6",
        "templateId": "6a466604-10d4-4a8d-ab01-ba44e10c40a5",
        "initiator": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "2Y7YB7",
        "socketId": "vYFFNb92ioqCo5CNAAAG"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.835] [32mINFO [0m [GameStateService] {
        "accessCode": "2Y7YB7"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:27.841] [32mINFO [0m [TournamentHandler] {
        "room": "game_2Y7YB7",
        "duration": 5,
        "accessCode": "2Y7YB7",
        "socketId": "vYFFNb92ioqCo5CNAAAG"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:29.431] [32mINFO [0m [SharedGameFlow] {
        "room": "game_SLQUZ4",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:29.432] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SLQUZ4",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:29.432] [32mINFO [0m [SharedGameFlow] {
        "room": "game_SLQUZ4",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:29.432] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "SLQUZ4",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.849] [32mINFO [0m [GameStateService] {
        "accessCode": "2Y7YB7"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.859] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2Y7YB7"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.859] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2Y7YB7",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.859] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2Y7YB7"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.861] [32mINFO [0m [GameStateService] {
        "accessCode": "2Y7YB7"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.862] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2Y7YB7",
        "room": "game_2Y7YB7",
        "socketIds": [
          "vYFFNb92ioqCo5CNAAAG",
          "6j8QPGV0exrboqpUAAAH"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.862] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2Y7YB7",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.862] [32mINFO [0m [SharedGameFlow] {
        "room": "game_2Y7YB7",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-06T13:30:15.345Z",
            "updatedAt": "2025-06-06T13:30:19.360Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.862] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2Y7YB7",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.864] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "vYFFNb92ioqCo5CNAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.864] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "vYFFNb92ioqCo5CNAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.864] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "vYFFNb92ioqCo5CNAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.864] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "vYFFNb92ioqCo5CNAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.865] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "6j8QPGV0exrboqpUAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.865] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "6j8QPGV0exrboqpUAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.865] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "6j8QPGV0exrboqpUAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.865] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "6j8QPGV0exrboqpUAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.867] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1"
      } Participant already answered this question. Updating answer.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.870] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.871] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.871] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:32.871] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "2Y7YB7",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:34.863] [32mINFO [0m [SharedGameFlow] {
        "room": "game_2Y7YB7",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:34.864] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2Y7YB7",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:34.864] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2Y7YB7",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:34.868] [32mINFO [0m [GameStateService] {
        "accessCode": "2Y7YB7",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:34.868] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2Y7YB7",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:34.870] [32mINFO [0m [GameStateService] {
        "accessCode": "2Y7YB7",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
          "username": "p1-extended",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
          "username": "p2-extended",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament2.test.ts:442:17)

    console.log
      [2025-06-06 15:30:34.891] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "9fdba530-33dc-49fc-a427-5047496520fe",
        "accessCode": "Z86VEF"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.023] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "09nvImbb-WqtBXlHAAAK",
        "user": {
          "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.023] [32mINFO [0m [GameHandlers] {
        "socketId": "09nvImbb-WqtBXlHAAAK"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.023] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "09nvImbb-WqtBXlHAAAK"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.025] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "Rnvn_BPlCbM7S3Z8AAAL",
        "user": {
          "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.025] [32mINFO [0m [GameHandlers] {
        "socketId": "Rnvn_BPlCbM7S3Z8AAAL"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.026] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "Rnvn_BPlCbM7S3Z8AAAL"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.027] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_Z86VEF",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.027] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_Z86VEF",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.027] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_Z86VEF",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.027] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_Z86VEF",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.027] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_Z86VEF",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.027] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_Z86VEF",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.028] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_Z86VEF",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.028] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_Z86VEF",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.028] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_Z86VEF",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "9fdba530-33dc-49fc-a427-5047496520fe",
          "accessCode": "Z86VEF",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.029] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_Z86VEF",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "9fdba530-33dc-49fc-a427-5047496520fe",
          "accessCode": "Z86VEF",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.030] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_Z86VEF",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "9fdba530-33dc-49fc-a427-5047496520fe",
          "accessCode": "Z86VEF",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.031] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_Z86VEF",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "9fdba530-33dc-49fc-a427-5047496520fe",
          "accessCode": "Z86VEF",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.033] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.034] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.035] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.035] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.047] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "9fdba530-33dc-49fc-a427-5047496520fe",
        "templateId": "4c5cdb10-8383-4c5e-b531-e5cff4d5ee6e",
        "initiator": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 2,
        "nbParticipants": 2,
        "accessCode": "Z86VEF",
        "socketId": "09nvImbb-WqtBXlHAAAK"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.248] [32mINFO [0m [GameStateService] {
        "accessCode": "Z86VEF"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:35.253] [32mINFO [0m [TournamentHandler] {
        "room": "game_Z86VEF",
        "duration": 5,
        "accessCode": "Z86VEF",
        "socketId": "09nvImbb-WqtBXlHAAAK"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:36.869] [32mINFO [0m [SharedGameFlow] {
        "room": "game_2Y7YB7",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:36.870] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2Y7YB7",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:36.870] [32mINFO [0m [SharedGameFlow] {
        "room": "game_2Y7YB7",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:36.870] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "2Y7YB7",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.256] [32mINFO [0m [GameStateService] {
        "accessCode": "Z86VEF"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.266] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.266] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF",
        "playMode": "tournament",
        "questionCount": 2
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.266] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.269] [32mINFO [0m [GameStateService] {
        "accessCode": "Z86VEF"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.270] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF",
        "room": "game_Z86VEF",
        "socketIds": [
          "09nvImbb-WqtBXlHAAAK",
          "Rnvn_BPlCbM7S3Z8AAAL"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.270] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.270] [32mINFO [0m [SharedGameFlow] {
        "room": "game_Z86VEF",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-06T13:30:15.345Z",
            "updatedAt": "2025-06-06T13:30:19.360Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.270] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.272] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "09nvImbb-WqtBXlHAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.272] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "09nvImbb-WqtBXlHAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.274] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "09nvImbb-WqtBXlHAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.274] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "09nvImbb-WqtBXlHAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.275] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "Rnvn_BPlCbM7S3Z8AAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.275] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "Rnvn_BPlCbM7S3Z8AAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.275] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "Rnvn_BPlCbM7S3Z8AAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.276] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "Rnvn_BPlCbM7S3Z8AAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.284] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.284] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.286] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:40.286] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:42.272] [32mINFO [0m [SharedGameFlow] {
        "room": "game_Z86VEF",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:42.273] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:42.273] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:42.277] [32mINFO [0m [GameStateService] {
        "accessCode": "Z86VEF",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:42.277] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.279] [32mINFO [0m [SharedGameFlow] {
        "room": "game_Z86VEF",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.280] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.283] [32mINFO [0m [GameStateService] {
        "accessCode": "Z86VEF"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.283] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF",
        "questionIndex": 1,
        "questionUid": "q-late-2"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.283] [32mINFO [0m [SharedGameFlow] {
        "room": "game_Z86VEF",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-2",
            "title": null,
            "text": "What is 7 x 3?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "multiplication"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "multiplication",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-06T13:30:15.345Z",
            "updatedAt": "2025-06-06T13:30:19.365Z",
            "answerOptions": [
              "20",
              "21",
              "24",
              "27"
            ],
            "correctAnswers": [
              false,
              true,
              false,
              false
            ],
            "feedbackWaitTime": 0
          },
          "index": 1,
          "feedbackWaitTime": 1.5
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.283] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF",
        "event": "game_question",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.284] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "09nvImbb-WqtBXlHAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.285] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "09nvImbb-WqtBXlHAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.286] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "09nvImbb-WqtBXlHAAAK"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.286] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-2",
        "answer": "20",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "09nvImbb-WqtBXlHAAAK"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.287] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "Rnvn_BPlCbM7S3Z8AAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.287] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "Rnvn_BPlCbM7S3Z8AAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.287] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "Rnvn_BPlCbM7S3Z8AAAL"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.287] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-2",
        "answer": "21",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "Rnvn_BPlCbM7S3Z8AAAL"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.293] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.294] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.294] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:44.295] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "Z86VEF",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-2",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.285] [32mINFO [0m [SharedGameFlow] {
        "room": "game_Z86VEF",
        "event": "correct_answers",
        "questionId": "q-late-2"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.286] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF",
        "event": "correct_answers",
        "questionUid": "q-late-2"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.286] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF",
        "questionId": "q-late-2"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.292] [32mINFO [0m [GameStateService] {
        "accessCode": "Z86VEF",
        "questionId": "q-late-2"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.292] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF",
        "questionId": "q-late-2"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.307] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "7728c755-3b46-4113-8a4c-a63f5513553c",
        "accessCode": "GE4EBR"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.444] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "qgpCMR_6khov451fAAAO",
        "user": {
          "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
          "username": "p1-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.446] [32mINFO [0m [GameHandlers] {
        "socketId": "qgpCMR_6khov451fAAAO"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.447] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "qgpCMR_6khov451fAAAO"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.448] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "OIqJjpo9GicbhGfFAAAP",
        "user": {
          "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
          "username": "p2-extended",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.449] [32mINFO [0m [GameHandlers] {
        "socketId": "OIqJjpo9GicbhGfFAAAP"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.449] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "OIqJjpo9GicbhGfFAAAP"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.452] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_GE4EBR",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.452] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_GE4EBR",
        "playMode": "tournament",
        "username": "p1-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.452] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_GE4EBR",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.453] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_GE4EBR",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.453] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_GE4EBR",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.453] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_GE4EBR",
        "playMode": "tournament",
        "username": "p2-extended"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.453] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_GE4EBR",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.454] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_GE4EBR",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.455] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_GE4EBR",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "7728c755-3b46-4113-8a4c-a63f5513553c",
          "accessCode": "GE4EBR",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.455] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "room": "game_GE4EBR",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "7728c755-3b46-4113-8a4c-a63f5513553c",
          "accessCode": "GE4EBR",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.455] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_GE4EBR",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "7728c755-3b46-4113-8a4c-a63f5513553c",
          "accessCode": "GE4EBR",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.456] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "room": "game_GE4EBR",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "7728c755-3b46-4113-8a4c-a63f5513553c",
          "accessCode": "GE4EBR",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.458] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.458] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.458] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.459] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.473] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "7728c755-3b46-4113-8a4c-a63f5513553c",
        "templateId": "af32f92b-b8a8-43b7-9133-e821ed3e7b0b",
        "initiator": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 2,
        "nbParticipants": 2,
        "accessCode": "GE4EBR",
        "socketId": "qgpCMR_6khov451fAAAO"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.676] [32mINFO [0m [GameStateService] {
        "accessCode": "GE4EBR"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:46.680] [32mINFO [0m [TournamentHandler] {
        "room": "game_GE4EBR",
        "duration": 5,
        "accessCode": "GE4EBR",
        "socketId": "qgpCMR_6khov451fAAAO"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:47.793] [32mINFO [0m [SharedGameFlow] {
        "room": "game_Z86VEF",
        "event": "feedback",
        "questionId": "q-late-2"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:47.794] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF",
        "event": "feedback",
        "questionUid": "q-late-2"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:47.794] [32mINFO [0m [SharedGameFlow] {
        "room": "game_Z86VEF",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:47.795] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "Z86VEF",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.682] [32mINFO [0m [GameStateService] {
        "accessCode": "GE4EBR"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.688] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.688] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR",
        "playMode": "tournament",
        "questionCount": 2
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.688] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.691] [32mINFO [0m [GameStateService] {
        "accessCode": "GE4EBR"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.691] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR",
        "room": "game_GE4EBR",
        "socketIds": [
          "qgpCMR_6khov451fAAAO",
          "OIqJjpo9GicbhGfFAAAP"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.691] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.691] [32mINFO [0m [SharedGameFlow] {
        "room": "game_GE4EBR",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-06T13:30:15.345Z",
            "updatedAt": "2025-06-06T13:30:19.360Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.692] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.692] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "qgpCMR_6khov451fAAAO"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.695] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "qgpCMR_6khov451fAAAO"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.696] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "qgpCMR_6khov451fAAAO"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.696] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "qgpCMR_6khov451fAAAO"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.697] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "OIqJjpo9GicbhGfFAAAP"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.697] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "OIqJjpo9GicbhGfFAAAP"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.697] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "OIqJjpo9GicbhGfFAAAP"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.697] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "OIqJjpo9GicbhGfFAAAP"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.705] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.705] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.706] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:51.706] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.692] [32mINFO [0m [SharedGameFlow] {
        "room": "game_GE4EBR",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.693] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.693] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.697] [32mINFO [0m [GameStateService] {
        "accessCode": "GE4EBR",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.698] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.972] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "C0Gz_kWHjbplFw_NAAAR",
        "user": {
          "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
          "username": "p3",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.972] [32mINFO [0m [GameHandlers] {
        "socketId": "C0Gz_kWHjbplFw_NAAAR"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.972] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "C0Gz_kWHjbplFw_NAAAR"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.975] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "room": "game_GE4EBR",
        "playMode": "tournament",
        "username": "p3"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.975] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "room": "game_GE4EBR",
        "playMode": "tournament",
        "username": "p3"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.975] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "room": "game_GE4EBR",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.976] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "room": "game_GE4EBR",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.979] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "room": "game_GE4EBR",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "7728c755-3b46-4113-8a4c-a63f5513553c",
          "accessCode": "GE4EBR",
          "status": "active",
          "currentQuestionIndex": 0,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 1749216651688,
            "duration": 2000,
            "isPaused": false
          },
          "question": {
            "uid": "q-late-1",
            "type": "single_correct",
            "text": "What is 10 + 5?",
            "answers": [
              "12",
              "13",
              "14",
              "15"
            ]
          }
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.980] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "room": "game_GE4EBR",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "7728c755-3b46-4113-8a4c-a63f5513553c",
          "accessCode": "GE4EBR",
          "status": "active",
          "currentQuestionIndex": 0,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 1749216651688,
            "duration": 2000,
            "isPaused": false
          },
          "question": {
            "uid": "q-late-1",
            "type": "single_correct",
            "text": "What is 10 + 5?",
            "answers": [
              "12",
              "13",
              "14",
              "15"
            ]
          }
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.983] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.984] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.986] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "socketId": "C0Gz_kWHjbplFw_NAAAR",
        "liveRoom": "game_GE4EBR",
        "socketIds": [
          "qgpCMR_6khov451fAAAO",
          "OIqJjpo9GicbhGfFAAAP",
          "C0Gz_kWHjbplFw_NAAAR"
        ]
      } [DEBUG] Late joiner socket and current live room members before emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.987] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "currentIndex": 0,
        "questionId": "q-late-1",
        "questionState": "stopped",
        "timer": 0,
        "playMode": "tournament",
        "phase": "show_answers",
        "feedbackRemaining": 0
      } [DEBUG] Emitted game_question to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.987] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "questionId": "q-late-1",
        "playMode": "tournament",
        "questionState": "stopped",
        "phase": "show_answers"
      } [DEBUG] Emitted correct_answers to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.987] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "socketId": "C0Gz_kWHjbplFw_NAAAR",
        "liveRoom": "game_GE4EBR",
        "socketIds": [
          "qgpCMR_6khov451fAAAO",
          "OIqJjpo9GicbhGfFAAAP",
          "C0Gz_kWHjbplFw_NAAAR"
        ]
      } [DEBUG] Late joiner socket and current live room members before emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.987] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "currentIndex": 0,
        "questionId": "q-late-1",
        "questionState": "stopped",
        "timer": 0,
        "playMode": "tournament",
        "phase": "show_answers",
        "feedbackRemaining": 0
      } [DEBUG] Emitted game_question to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:53.987] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "questionId": "q-late-1",
        "playMode": "tournament",
        "questionState": "stopped",
        "phase": "show_answers"
      } [DEBUG] Emitted correct_answers to late joiner

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:55.698] [32mINFO [0m [SharedGameFlow] {
        "room": "game_GE4EBR",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:55.699] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:55.701] [32mINFO [0m [GameStateService] {
        "accessCode": "GE4EBR"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:55.701] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR",
        "questionIndex": 1,
        "questionUid": "q-late-2"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:55.701] [32mINFO [0m [SharedGameFlow] {
        "room": "game_GE4EBR",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-2",
            "title": null,
            "text": "What is 7 x 3?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "multiplication"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "multiplication",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-06T13:30:15.345Z",
            "updatedAt": "2025-06-06T13:30:19.365Z",
            "answerOptions": [
              "20",
              "21",
              "24",
              "27"
            ],
            "correctAnswers": [
              false,
              true,
              false,
              false
            ],
            "feedbackWaitTime": 0
          },
          "index": 1,
          "feedbackWaitTime": 1.5
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:55.701] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR",
        "event": "game_question",
        "questionUid": "q-late-2"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:57.702] [32mINFO [0m [SharedGameFlow] {
        "room": "game_GE4EBR",
        "event": "correct_answers",
        "questionId": "q-late-2"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:57.703] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR",
        "event": "correct_answers",
        "questionUid": "q-late-2"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:57.703] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR",
        "questionId": "q-late-2"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:57.705] [32mINFO [0m [GameStateService] {
        "accessCode": "GE4EBR",
        "questionId": "q-late-2"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:57.705] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR",
        "questionId": "q-late-2"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.207] [32mINFO [0m [SharedGameFlow] {
        "room": "game_GE4EBR",
        "event": "feedback",
        "questionId": "q-late-2"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.207] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR",
        "event": "feedback",
        "questionUid": "q-late-2"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.207] [32mINFO [0m [SharedGameFlow] {
        "room": "game_GE4EBR",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.208] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "GE4EBR",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.209] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "receivedPlayMode": "tournament",
        "socketId": "C0Gz_kWHjbplFw_NAAAR"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.209] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "finalPlayMode": "tournament",
        "socketId": "C0Gz_kWHjbplFw_NAAAR"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.209] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "receivedPlayMode": "tournament",
        "socketId": "C0Gz_kWHjbplFw_NAAAR"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.209] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 1,
        "finalPlayMode": "tournament",
        "socketId": "C0Gz_kWHjbplFw_NAAAR"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.212] [33mWARN [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "questionId": "q-late-1"
      } Answer submitted after timer expired (tournament mode).

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.212] [33mWARN [0m [SharedLiveHandler] {
        "accessCode": "GE4EBR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "questionId": "q-late-1"
      } Answer submitted after timer expired (tournament mode).

      at log (src/utils/logger.ts:102:21)

    console.log
      socket3 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:790:33)

    console.log
      Starting afterAll cleanup...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:74:17)

    console.log
      Processing socket1...

      at disconnectSocket (tests/integration/tournament2.test.ts:82:21)

    console.log
      socket1 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament2.test.ts:87:25)

    console.log
      socket1 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:97:37)

    console.log
      socket1 processing complete.

      at disconnectSocket (tests/integration/tournament2.test.ts:113:21)

    console.log
      Processing socket2...

      at disconnectSocket (tests/integration/tournament2.test.ts:82:21)

    console.log
      socket2 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament2.test.ts:87:25)

    console.log
      socket2 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament2.test.ts:97:37)

    console.log
      socket2 processing complete.

      at disconnectSocket (tests/integration/tournament2.test.ts:113:21)

    console.log
      [2025-06-06 15:30:59.221] [32mINFO [0m [DisconnectHandler] {
        "socketId": "C0Gz_kWHjbplFw_NAAAR",
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "accessCode": "GE4EBR",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.226] [32mINFO [0m [DisconnectHandler] {
        "socketId": "qgpCMR_6khov451fAAAO",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "accessCode": "GE4EBR",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.228] [32mINFO [0m [DisconnectHandler] {
        "socketId": "OIqJjpo9GicbhGfFAAAP",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "accessCode": "GE4EBR",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.232] [32mINFO [0m [DisconnectHandler] {
        "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
        "accessCode": "GE4EBR",
        "socketId": "C0Gz_kWHjbplFw_NAAAR"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.232] [32mINFO [0m [DisconnectHandler] {
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "accessCode": "GE4EBR",
        "socketId": "qgpCMR_6khov451fAAAO"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.233] [32mINFO [0m [DisconnectHandler] {
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "accessCode": "GE4EBR",
        "socketId": "OIqJjpo9GicbhGfFAAAP"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.236] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "38904386-9e8e-427e-bc10-a6e9211faba9",
          "socketId": "C0Gz_kWHjbplFw_NAAAR"
        },
        "room": "game_GE4EBR"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.237] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
          "socketId": "qgpCMR_6khov451fAAAO"
        },
        "room": "game_GE4EBR"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.237] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
          "socketId": "OIqJjpo9GicbhGfFAAAP"
        },
        "room": "game_GE4EBR"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing Socket.IO server...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:124:21)

    console.log
      [2025-06-06 15:30:59.720] [32mINFO [0m [DisconnectHandler] {
        "socketId": "4Rq7S7FCJKKZwxQqAAAC",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "accessCode": "SLQUZ4",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-06 15:30:59.720] [32mINFO [0m [DisconnectHandler] {
        "socketId": "6N6_U_lBozRkWKidAAAD",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "accessCode": "SLQUZ4",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-06 15:30:59.720] [32mINFO [0m [DisconnectHandler] {
        "socketId": "vYFFNb92ioqCo5CNAAAG",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "accessCode": "2Y7YB7",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-06 15:30:59.721] [32mINFO [0m [DisconnectHandler] {
        "socketId": "6j8QPGV0exrboqpUAAAH",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "accessCode": "2Y7YB7",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-06 15:30:59.721] [32mINFO [0m [DisconnectHandler] {
        "socketId": "09nvImbb-WqtBXlHAAAK",
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "accessCode": "Z86VEF",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-06 15:30:59.721] [32mINFO [0m [DisconnectHandler] {
        "socketId": "Rnvn_BPlCbM7S3Z8AAAL",
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "accessCode": "Z86VEF",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      Socket.IO server closed successfully.

      at Server.<anonymous> (tests/integration/tournament2.test.ts:136:33)

    console.log
      Attempting to close HTTP server...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:144:17)

    console.log
      HTTP server was not listening. Assuming already closed or handled by Socket.IO close.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:164:25)

    console.log
      Waiting longer for server resources to release before closing Redis...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:170:17)

    console.log
      [2025-06-06 15:30:59.729] [32mINFO [0m [DisconnectHandler] {
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "accessCode": "SLQUZ4",
        "socketId": "4Rq7S7FCJKKZwxQqAAAC"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.729] [32mINFO [0m [DisconnectHandler] {
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "accessCode": "SLQUZ4",
        "socketId": "6N6_U_lBozRkWKidAAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.729] [32mINFO [0m [DisconnectHandler] {
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "accessCode": "2Y7YB7",
        "socketId": "vYFFNb92ioqCo5CNAAAG"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.730] [32mINFO [0m [DisconnectHandler] {
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "accessCode": "2Y7YB7",
        "socketId": "6j8QPGV0exrboqpUAAAH"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.730] [32mINFO [0m [DisconnectHandler] {
        "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
        "accessCode": "Z86VEF",
        "socketId": "09nvImbb-WqtBXlHAAAK"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.730] [32mINFO [0m [DisconnectHandler] {
        "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
        "accessCode": "Z86VEF",
        "socketId": "Rnvn_BPlCbM7S3Z8AAAL"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.734] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
          "socketId": "4Rq7S7FCJKKZwxQqAAAC"
        },
        "room": "game_SLQUZ4"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.735] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
          "socketId": "6N6_U_lBozRkWKidAAAD"
        },
        "room": "game_SLQUZ4"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.735] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
          "socketId": "vYFFNb92ioqCo5CNAAAG"
        },
        "room": "game_2Y7YB7"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.735] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
          "socketId": "6j8QPGV0exrboqpUAAAH"
        },
        "room": "game_2Y7YB7"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.735] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "3a48d743-7c67-4cf0-97a7-aba23063d984",
          "socketId": "09nvImbb-WqtBXlHAAAK"
        },
        "room": "game_Z86VEF"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:30:59.736] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "aaa1748e-be7c-4591-b167-4e4c416b3d1b",
          "socketId": "Rnvn_BPlCbM7S3Z8AAAL"
        },
        "room": "game_Z86VEF"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing SocketIO Redis clients (subClient)...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:174:17)

    console.log
      SocketIO Redis clients closed.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:177:21)

    console.log
      Closing main Redis client...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:185:17)

    console.log
      Main Redis client quit successfully.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:189:25)

    console.log
      Cleaning up database...

      at Object.<anonymous> (tests/integration/tournament2.test.ts:200:17)

    console.log
      Database cleanup successful.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:212:21)

    console.warn
      Error cleaning up Redis keys: Connection is closed.

      222 |             }
      223 |         } catch (e: any) {
    > 224 |             console.warn('Error cleaning up Redis keys:', e.message || e);
          |                     ^
      225 |         }
      226 |
      227 |         await new Promise(resolve => setTimeout(resolve, 300));

      at Object.<anonymous> (tests/integration/tournament2.test.ts:224:21)

    console.log
      afterAll cleanup complete.

      at Object.<anonymous> (tests/integration/tournament2.test.ts:228:17)

PASS tests/integration/tournament.test.ts (19.638 s)
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-06 15:31:04.075] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.153] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.187] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "865ca13f-ee48-4938-910f-43709741f700",
        "accessCode": "HD76AC"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.338] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "51rntsk4BLTMcDTEAAAC",
        "user": {
          "userId": "689d5e46-9938-438d-97b1-89c15864d486",
          "username": "p1-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.344] [32mINFO [0m [GameHandlers] {
        "socketId": "51rntsk4BLTMcDTEAAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.344] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "51rntsk4BLTMcDTEAAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.351] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "g6jUoZdBjRkb4XT-AAAD",
        "user": {
          "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
          "username": "p2-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.351] [32mINFO [0m [GameHandlers] {
        "socketId": "g6jUoZdBjRkb4XT-AAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.351] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "g6jUoZdBjRkb4XT-AAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.352] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "room": "game_HD76AC",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.353] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "room": "game_HD76AC",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.353] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "room": "game_HD76AC",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.353] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "room": "game_HD76AC",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.353] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "room": "game_HD76AC",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.353] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "room": "game_HD76AC",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.354] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "room": "game_HD76AC",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.354] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "room": "game_HD76AC",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.355] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "room": "game_HD76AC",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "865ca13f-ee48-4938-910f-43709741f700",
          "accessCode": "HD76AC",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.355] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "room": "game_HD76AC",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "865ca13f-ee48-4938-910f-43709741f700",
          "accessCode": "HD76AC",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.356] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "room": "game_HD76AC",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "865ca13f-ee48-4938-910f-43709741f700",
          "accessCode": "HD76AC",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.356] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "room": "game_HD76AC",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "865ca13f-ee48-4938-910f-43709741f700",
          "accessCode": "HD76AC",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.359] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.359] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.359] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.360] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.373] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "865ca13f-ee48-4938-910f-43709741f700",
        "templateId": "f6f68ab8-cc7a-44b6-a609-5cfc80c5b1dc",
        "initiator": "689d5e46-9938-438d-97b1-89c15864d486",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "HD76AC",
        "socketId": "51rntsk4BLTMcDTEAAAC"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.575] [32mINFO [0m [GameStateService] {
        "accessCode": "HD76AC"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:04.578] [32mINFO [0m [TournamentHandler] {
        "room": "game_HD76AC",
        "duration": 5,
        "accessCode": "HD76AC",
        "socketId": "51rntsk4BLTMcDTEAAAC"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.581] [32mINFO [0m [GameStateService] {
        "accessCode": "HD76AC"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.593] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "HD76AC"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.593] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "HD76AC",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.593] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "HD76AC"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.596] [32mINFO [0m [GameStateService] {
        "accessCode": "HD76AC"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.596] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "HD76AC",
        "room": "game_HD76AC",
        "socketIds": [
          "51rntsk4BLTMcDTEAAAC",
          "g6jUoZdBjRkb4XT-AAAD"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.597] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "HD76AC",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.597] [32mINFO [0m [SharedGameFlow] {
        "room": "game_HD76AC",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-06T13:31:04.149Z",
            "updatedAt": "2025-06-06T13:31:04.162Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.597] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "HD76AC",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.599] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "51rntsk4BLTMcDTEAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.599] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "51rntsk4BLTMcDTEAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.599] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "51rntsk4BLTMcDTEAAAC"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.599] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "51rntsk4BLTMcDTEAAAC"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.599] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "g6jUoZdBjRkb4XT-AAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.599] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "g6jUoZdBjRkb4XT-AAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.600] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "g6jUoZdBjRkb4XT-AAAD"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.600] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "g6jUoZdBjRkb4XT-AAAD"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.606] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.607] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.620] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:09.621] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "HD76AC",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.599] [32mINFO [0m [SharedGameFlow] {
        "room": "game_HD76AC",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.600] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "HD76AC",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.600] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "HD76AC",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.607] [32mINFO [0m [GameStateService] {
        "accessCode": "HD76AC",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.607] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "HD76AC",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.612] [32mINFO [0m [GameStateService] {
        "accessCode": "HD76AC",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "689d5e46-9938-438d-97b1-89c15864d486",
          "username": "p1-basic",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
          "username": "p2-basic",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament.test.ts:331:17)

    console.log
      [2025-06-06 15:31:11.636] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "954188a4-61b1-40e3-8670-e3fb781a6a41",
        "accessCode": "T4GVMM"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.778] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "Ydir__1l2Pxwxm-PAAAG",
        "user": {
          "userId": "689d5e46-9938-438d-97b1-89c15864d486",
          "username": "p1-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.778] [32mINFO [0m [GameHandlers] {
        "socketId": "Ydir__1l2Pxwxm-PAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.778] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "Ydir__1l2Pxwxm-PAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.779] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "U3Uv8qNkR4npG2SnAAAH",
        "user": {
          "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
          "username": "p2-basic",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.779] [32mINFO [0m [GameHandlers] {
        "socketId": "U3Uv8qNkR4npG2SnAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.779] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "U3Uv8qNkR4npG2SnAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.780] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "room": "game_T4GVMM",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.780] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "room": "game_T4GVMM",
        "playMode": "tournament",
        "username": "p1-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.780] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "room": "game_T4GVMM",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.780] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "room": "game_T4GVMM",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.780] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "room": "game_T4GVMM",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.781] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "room": "game_T4GVMM",
        "playMode": "tournament",
        "username": "p2-basic"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.781] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "room": "game_T4GVMM",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.781] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "room": "game_T4GVMM",
        "playMode": "tournament"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.782] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "room": "game_T4GVMM",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "954188a4-61b1-40e3-8670-e3fb781a6a41",
          "accessCode": "T4GVMM",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.782] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "room": "game_T4GVMM",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "954188a4-61b1-40e3-8670-e3fb781a6a41",
          "accessCode": "T4GVMM",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.782] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "room": "game_T4GVMM",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "954188a4-61b1-40e3-8670-e3fb781a6a41",
          "accessCode": "T4GVMM",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.782] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "room": "game_T4GVMM",
        "playMode": "tournament",
        "gameJoinPayload": {
          "gameId": "954188a4-61b1-40e3-8670-e3fb781a6a41",
          "accessCode": "T4GVMM",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.789] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.789] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.789] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.789] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "playMode": "tournament"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:11.802] [32mINFO [0m [TournamentHandler] {
        "gameInstanceId": "954188a4-61b1-40e3-8670-e3fb781a6a41",
        "templateId": "72ad24b2-a9ec-4d6b-a87e-9318149f4c1d",
        "initiator": "689d5e46-9938-438d-97b1-89c15864d486",
        "playMode": "tournament",
        "nbQuestionsFromTemplate": 1,
        "nbParticipants": 2,
        "accessCode": "T4GVMM",
        "socketId": "Ydir__1l2Pxwxm-PAAAG"
      } [TournamentHandler] Fetched gameInstance for start_tournament

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:12.006] [32mINFO [0m [GameStateService] {
        "accessCode": "T4GVMM"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:12.018] [32mINFO [0m [TournamentHandler] {
        "room": "game_T4GVMM",
        "duration": 5,
        "accessCode": "T4GVMM",
        "socketId": "Ydir__1l2Pxwxm-PAAAG"
      } [TournamentHandler] Emitting tournament_starting and waiting 5s before starting game.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:13.609] [32mINFO [0m [SharedGameFlow] {
        "room": "game_HD76AC",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:13.611] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "HD76AC",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:13.611] [32mINFO [0m [SharedGameFlow] {
        "room": "game_HD76AC",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:13.612] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "HD76AC",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.020] [32mINFO [0m [GameStateService] {
        "accessCode": "T4GVMM"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.033] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "T4GVMM"
      } [SharedGameFlow] runGameFlow entry

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.033] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "T4GVMM",
        "playMode": "tournament",
        "questionCount": 1
      } [SharedGameFlow] Starting game flow. Initial delay removed as countdown is now handled by caller.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.033] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "T4GVMM"
      } [SharedGameFlow] Proceeding with first question immediately.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.035] [32mINFO [0m [GameStateService] {
        "accessCode": "T4GVMM"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.035] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "T4GVMM",
        "room": "game_T4GVMM",
        "socketIds": [
          "Ydir__1l2Pxwxm-PAAAG",
          "U3Uv8qNkR4npG2SnAAAH"
        ]
      } [DEBUG] Sockets in live room before emitting first game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.036] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "T4GVMM",
        "questionIndex": 0,
        "questionUid": "q-late-1"
      } [DEBUG] Preparing to emit game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.036] [32mINFO [0m [SharedGameFlow] {
        "room": "game_T4GVMM",
        "event": "game_question",
        "payload": {
          "question": {
            "uid": "q-late-1",
            "title": null,
            "text": "What is 10 + 5?",
            "questionType": "single_correct",
            "discipline": "math",
            "themes": [
              "arithmetic"
            ],
            "difficulty": 1,
            "gradeLevel": "elementary",
            "author": null,
            "explanation": null,
            "tags": [
              "addition",
              "late-join"
            ],
            "timeLimit": 2,
            "isHidden": false,
            "createdAt": "2025-06-06T13:31:04.149Z",
            "updatedAt": "2025-06-06T13:31:04.162Z",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              true
            ],
            "feedbackWaitTime": 2
          },
          "index": 0,
          "feedbackWaitTime": 2
        }
      } [DEBUG] Emitting game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.037] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "T4GVMM",
        "event": "game_question",
        "questionUid": "q-late-1"
      } [TRACE] Emitted game_question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.039] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "Ydir__1l2Pxwxm-PAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.039] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "Ydir__1l2Pxwxm-PAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.040] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "Ydir__1l2Pxwxm-PAAAG"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.040] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "questionId": "q-late-1",
        "answer": "15",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "Ydir__1l2Pxwxm-PAAAG"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.040] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "U3Uv8qNkR4npG2SnAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.040] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "U3Uv8qNkR4npG2SnAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.040] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "receivedPlayMode": "tournament",
        "socketId": "U3Uv8qNkR4npG2SnAAAH"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.040] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "questionId": "q-late-1",
        "answer": "12",
        "timeSpent": 2,
        "finalPlayMode": "tournament",
        "socketId": "U3Uv8qNkR4npG2SnAAAH"
      } [SHARED_LIVE_HANDLER] Processing game_answer with playMode

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.046] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.046] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.046] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:17.046] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "T4GVMM",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "questionId": "q-late-1",
        "scoreAwarded": 0
      } Answer processed, feedback sent

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:19.037] [32mINFO [0m [SharedGameFlow] {
        "room": "game_T4GVMM",
        "event": "correct_answers",
        "questionId": "q-late-1"
      } [DEBUG] Emitting correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:19.038] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "T4GVMM",
        "event": "correct_answers",
        "questionUid": "q-late-1"
      } [TRACE] Emitted correct_answers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:19.038] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "T4GVMM",
        "questionId": "q-late-1"
      } [SharedGameFlow] Calculating scores for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:19.042] [32mINFO [0m [GameStateService] {
        "accessCode": "T4GVMM",
        "questionId": "q-late-1"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:19.043] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "T4GVMM",
        "questionId": "q-late-1"
      } [SharedGameFlow] Scores calculated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:19.045] [32mINFO [0m [GameStateService] {
        "accessCode": "T4GVMM",
        "count": 2
      } Formatted leaderboard from Redis/DB.

      at log (src/utils/logger.ts:102:21)

    console.log
      Leaderboard response: [
        {
          "userId": "689d5e46-9938-438d-97b1-89c15864d486",
          "username": "p1-basic",
          "score": 980,
          "rank": 1
        },
        {
          "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
          "username": "p2-basic",
          "score": 0,
          "rank": 2
        }
      ]

      at Object.<anonymous> (tests/integration/tournament.test.ts:446:17)

    console.log
      Starting afterAll cleanup...

      at Object.<anonymous> (tests/integration/tournament.test.ts:78:17)

    console.log
      Processing socket1...

      at disconnectSocket (tests/integration/tournament.test.ts:86:21)

    console.log
      socket1 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament.test.ts:91:25)

    console.log
      socket1 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament.test.ts:101:37)

    console.log
      socket1 processing complete.

      at disconnectSocket (tests/integration/tournament.test.ts:117:21)

    console.log
      Processing socket2...

      at disconnectSocket (tests/integration/tournament.test.ts:86:21)

    console.log
      socket2 is connected. Attempting graceful disconnect...

      at disconnectSocket (tests/integration/tournament.test.ts:91:25)

    console.log
      socket2 disconnected. Reason: io client disconnect

      at Socket.<anonymous> (tests/integration/tournament.test.ts:101:37)

    console.log
      socket2 processing complete.

      at disconnectSocket (tests/integration/tournament.test.ts:117:21)

    console.log
      [2025-06-06 15:31:19.050] [32mINFO [0m [DisconnectHandler] {
        "socketId": "Ydir__1l2Pxwxm-PAAAG",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "accessCode": "T4GVMM",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:19.050] [32mINFO [0m [DisconnectHandler] {
        "socketId": "U3Uv8qNkR4npG2SnAAAH",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "accessCode": "T4GVMM",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:19.052] [32mINFO [0m [DisconnectHandler] {
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "accessCode": "T4GVMM",
        "socketId": "Ydir__1l2Pxwxm-PAAAG"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:19.053] [32mINFO [0m [DisconnectHandler] {
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "accessCode": "T4GVMM",
        "socketId": "U3Uv8qNkR4npG2SnAAAH"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:19.054] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "689d5e46-9938-438d-97b1-89c15864d486",
          "socketId": "Ydir__1l2Pxwxm-PAAAG"
        },
        "room": "game_T4GVMM"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:19.054] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
          "socketId": "U3Uv8qNkR4npG2SnAAAH"
        },
        "room": "game_T4GVMM"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing Socket.IO server...

      at Object.<anonymous> (tests/integration/tournament.test.ts:128:21)

    console.log
      [2025-06-06 15:31:19.551] [32mINFO [0m [DisconnectHandler] {
        "socketId": "51rntsk4BLTMcDTEAAAC",
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "accessCode": "HD76AC",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-06 15:31:19.551] [32mINFO [0m [DisconnectHandler] {
        "socketId": "g6jUoZdBjRkb4XT-AAAD",
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "accessCode": "HD76AC",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-06 15:31:19.554] [32mINFO [0m [DisconnectHandler] {
        "userId": "689d5e46-9938-438d-97b1-89c15864d486",
        "accessCode": "HD76AC",
        "socketId": "51rntsk4BLTMcDTEAAAC"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:19.554] [32mINFO [0m [DisconnectHandler] {
        "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
        "accessCode": "HD76AC",
        "socketId": "g6jUoZdBjRkb4XT-AAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket.IO server closed successfully.

      at Server.<anonymous> (tests/integration/tournament.test.ts:140:33)

    console.log
      Attempting to close HTTP server...

      at Object.<anonymous> (tests/integration/tournament.test.ts:148:17)

    console.log
      HTTP server was not listening. Assuming already closed or handled by Socket.IO close.

      at Object.<anonymous> (tests/integration/tournament.test.ts:168:25)

    console.log
      Waiting longer for server resources to release before closing Redis...

      at Object.<anonymous> (tests/integration/tournament.test.ts:174:17)

    console.log
      [2025-06-06 15:31:19.556] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "689d5e46-9938-438d-97b1-89c15864d486",
          "socketId": "51rntsk4BLTMcDTEAAAC"
        },
        "room": "game_HD76AC"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:19.557] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "be92ced3-6eb8-4a5e-8848-d6665bf1aa84",
          "socketId": "g6jUoZdBjRkb4XT-AAAD"
        },
        "room": "game_HD76AC"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:21.043] [32mINFO [0m [SharedGameFlow] {
        "room": "game_T4GVMM",
        "event": "feedback",
        "questionId": "q-late-1"
      } [DEBUG] Emitting feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:21.044] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "T4GVMM",
        "event": "feedback",
        "questionUid": "q-late-1"
      } [TRACE] Emitted feedback

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:21.044] [32mINFO [0m [SharedGameFlow] {
        "room": "game_T4GVMM",
        "event": "game_end"
      } [DEBUG] Emitting game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:21.044] [32mINFO [0m [SharedGameFlow] {
        "accessCode": "T4GVMM",
        "event": "game_end"
      } [TRACE] Emitted game_end

      at log (src/utils/logger.ts:102:21)

    console.log
      Closing SocketIO Redis clients (subClient)...

      at Object.<anonymous> (tests/integration/tournament.test.ts:178:17)

    console.log
      SocketIO Redis clients closed.

      at Object.<anonymous> (tests/integration/tournament.test.ts:181:21)

    console.log
      Closing main Redis client...

      at Object.<anonymous> (tests/integration/tournament.test.ts:189:17)

    console.log
      Main Redis client quit successfully.

      at Object.<anonymous> (tests/integration/tournament.test.ts:193:25)

    console.log
      Cleaning up database...

      at Object.<anonymous> (tests/integration/tournament.test.ts:204:17)

    console.log
      Database cleanup successful.

      at Object.<anonymous> (tests/integration/tournament.test.ts:216:21)

    console.warn
      Error cleaning up Redis keys: Connection is closed.

      226 |             }
      227 |         } catch (e: any) {
    > 228 |             console.warn('Error cleaning up Redis keys:', e.message || e);
          |                     ^
      229 |         }
      230 |
      231 |         await new Promise(resolve => setTimeout(resolve, 300));

      at Object.<anonymous> (tests/integration/tournament.test.ts:228:21)

    console.log
      afterAll cleanup complete.

      at Object.<anonymous> (tests/integration/tournament.test.ts:232:17)

PASS tests/integration/teacherAuth.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-06 15:31:23.523] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:23.529] [32mINFO [0m [TeachersAPI] Teacher registered successfully via deprecated endpoint {
        "userId": "teacher-uuid",
        "username": "testteacher",
        "email": "test@example.com"
      }

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/mockedGameHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-06 15:31:24.184] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.317] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "17357333-e37c-4b0e-98e2-bb9b03ff67e7",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.327] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-0ltvtgp9ywj"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.327] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-0ltvtgp9ywj"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'socket-0ltvtgp9ywj',
        joinedRoomSocketIds: []
      }

      at log (src/sockets/handlers/game/joinGame.ts:111:25)

    console.log
      [2025-06-06 15:31:24.344] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "87c3598e-51c8-4555-8c2d-5d6b2a83b952",
            "userId": "player-1_mbkug7mcxfkjsu",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-06T13:31:24.340Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.345] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "87c3598e-51c8-4555-8c2d-5d6b2a83b952",
            "userId": "player-1_mbkug7mcxfkjsu",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.467] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-64tegw2ueyj"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.468] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-64tegw2ueyj"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.483] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-00s6dqifr4k3"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.483] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-00s6dqifr4k3"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        questionId: 'q-3',
        answer: { selectedOption: 'b' },
        timeSpent: 5000
      } Socket ID: socket-00s6dqifr4k3 Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-06 15:31:24.488] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-00s6dqifr4k3",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "questionId": "q-3",
          "answer": {
            "selectedOption": "b"
          },
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.489] [33mWARN [0m [GameAnswerHandler] {
        "socketId": "socket-00s6dqifr4k3",
        "error": "Invalid payload",
        "details": {
          "_errors": [],
          "userId": {
            "_errors": [
              "Required"
            ]
          },
          "answer": {
            "_errors": [
              "Expected string, received object",
              "Expected number, received object",
              "Expected array, received object",
              "Expected array, received object"
            ]
          }
        }
      } Invalid game answer payload

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        questionId: 'q-3',
        answer: { selectedOption: 'b' },
        timeSpent: 5000
      } Socket ID: socket-00s6dqifr4k3 Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-06 15:31:24.490] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-00s6dqifr4k3",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "questionId": "q-3",
          "answer": {
            "selectedOption": "b"
          },
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.490] [33mWARN [0m [GameAnswerHandler] {
        "socketId": "socket-00s6dqifr4k3",
        "error": "Invalid payload",
        "details": {
          "_errors": [],
          "userId": {
            "_errors": [
              "Required"
            ]
          },
          "answer": {
            "_errors": [
              "Expected string, received object",
              "Expected number, received object",
              "Expected array, received object",
              "Expected array, received object"
            ]
          }
        }
      } Invalid game answer payload

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.504] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-wy85w54k1vo"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.504] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-wy85w54k1vo"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.669] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-jxo74f582ih"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.669] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-jxo74f582ih"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.715] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-b786n1sodx4"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.715] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-b786n1sodx4"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.732] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "DIFF123",
          "participant": {
            "id": "539ab344-591a-4454-9479-05930ee2b687",
            "userId": "player-1_mbkug7mcxfkjsu",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-06T13:31:24.726Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": true,
          "differedAvailableFrom": "2025-06-06T13:31:24.700Z",
          "differedAvailableTo": "2025-06-06T14:31:24.700Z"
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.747] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-ectbrrctif9"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.747] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-ectbrrctif9"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.749] [33mWARN [0m [JoinGameHandler] {
        "errorPayload": {
          "message": "Differed mode not available at this time."
        }
      } Emitting game_error: differed window not available

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.770] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-cczdcble92q"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.771] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-cczdcble92q"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.774] [32mINFO [0m [JoinGameHandler] {
        "gameAlreadyPlayedPayload": {
          "accessCode": "DIFF123"
        }
      } Emitting game_already_played

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.789] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-737ugmxhb7"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.789] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-737ugmxhb7"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.811] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "DIFF123",
          "participant": {
            "id": "d89dd5cd-3f02-4709-b085-9148f39cf069",
            "userId": "player-3_mbkug7mcxfkjsu",
            "username": "Player 3",
            "avatar": "https://example.com/avatar3.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar3.jpg",
            "joinedAt": "2025-06-06T13:31:24.804Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": true,
          "differedAvailableFrom": "2025-06-06T13:31:24.750Z",
          "differedAvailableTo": "2025-06-06T14:31:24.750Z"
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'DIFF123',
        userId: 'player-3_mbkug7mcxfkjsu',
        questionId: '1de7d79b-11fb-40fd-9410-49c707be6f66',
        answer: 'b',
        timeSpent: 2000
      } Socket ID: socket-737ugmxhb7 Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-06 15:31:24.812] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-737ugmxhb7",
        "event": "game_answer",
        "payload": {
          "accessCode": "DIFF123",
          "userId": "player-3_mbkug7mcxfkjsu",
          "questionId": "1de7d79b-11fb-40fd-9410-49c707be6f66",
          "answer": "b",
          "timeSpent": 2000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.838] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbkug7mcxfkjsu",
        "questionId": "1de7d79b-11fb-40fd-9410-49c707be6f66"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at log (src/sockets/handlers/game/gameAnswer.ts:181:25)

    console.log
      [GAME_ANSWER] Adding current questionId 1de7d79b-11fb-40fd-9410-49c707be6f66 to answered questions

      at log (src/sockets/handlers/game/gameAnswer.ts:193:29)

    console.log
      [GAME_ANSWER] Found 1/1 answered questions: [ '1de7d79b-11fb-40fd-9410-49c707be6f66' ]

      at log (src/sockets/handlers/game/gameAnswer.ts:200:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=1

      at log (src/sockets/handlers/game/gameAnswer.ts:209:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at log (src/sockets/handlers/game/gameAnswer.ts:219:29)

    console.log
      [2025-06-06 15:31:24.839] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbkug7mcxfkjsu",
        "questionId": "1de7d79b-11fb-40fd-9410-49c707be6f66"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'DIFF123',
        userId: 'player-3_mbkug7mcxfkjsu',
        questionId: '1de7d79b-11fb-40fd-9410-49c707be6f66',
        answer: 'b',
        timeSpent: 2000
      } Socket ID: socket-737ugmxhb7 Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-06 15:31:24.840] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-737ugmxhb7",
        "event": "game_answer",
        "payload": {
          "accessCode": "DIFF123",
          "userId": "player-3_mbkug7mcxfkjsu",
          "questionId": "1de7d79b-11fb-40fd-9410-49c707be6f66",
          "answer": "b",
          "timeSpent": 2000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.859] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbkug7mcxfkjsu",
        "questionId": "1de7d79b-11fb-40fd-9410-49c707be6f66"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":"b","timestamp":"2025-06-06T13:31:24.819Z","questionUid":"1de7d79b-11fb-40fd-9410-49c707be6f66","timeTakenMs":2000}]

      at log (src/sockets/handlers/game/gameAnswer.ts:181:25)

    console.log
      [GAME_ANSWER] Found 1/1 answered questions: [ '1de7d79b-11fb-40fd-9410-49c707be6f66' ]

      at log (src/sockets/handlers/game/gameAnswer.ts:200:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=1

      at log (src/sockets/handlers/game/gameAnswer.ts:209:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at log (src/sockets/handlers/game/gameAnswer.ts:219:29)

    console.log
      [2025-06-06 15:31:24.860] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "DIFF123",
        "userId": "player-3_mbkug7mcxfkjsu",
        "questionId": "1de7d79b-11fb-40fd-9410-49c707be6f66"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.881] [32mINFO [0m [GameHandlers] {
        "socketId": "socket-0ilwvpc2uqk"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.881] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-0ilwvpc2uqk"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'socket-0ilwvpc2uqk',
        joinedRoomSocketIds: []
      }

      at log (src/sockets/handlers/game/joinGame.ts:111:25)

    console.log
      [2025-06-06 15:31:24.893] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "87c3598e-51c8-4555-8c2d-5d6b2a83b952",
            "userId": "player-1_mbkug7mcxfkjsu",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-06T13:31:24.887Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.893] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "87c3598e-51c8-4555-8c2d-5d6b2a83b952",
            "userId": "player-1_mbkug7mcxfkjsu",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.899] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.903] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789",
        "questionIndex": 0
      } Current question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        userId: 'player-1_mbkug7mcxfkjsu',
        questionId: 'fe483390-5292-46f6-bdf5-21d7ad001ea2',
        answer: 1,
        timeSpent: 5000
      } Socket ID: socket-0ilwvpc2uqk Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-06 15:31:24.903] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-0ilwvpc2uqk",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "userId": "player-1_mbkug7mcxfkjsu",
          "questionId": "fe483390-5292-46f6-bdf5-21d7ad001ea2",
          "answer": 1,
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.915] [32mINFO [0m [GameAnswerHandler] {
        "leaderboard": [
          {
            "userId": "player-1_mbkug7mcxfkjsu",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0
          }
        ],
        "roomName": "teacher_b6c42e93-c26f-4392-9c15-fbb0ce0d684c_TST789"
      } Emitting leaderboard_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.916] [32mINFO [0m [GameAnswerHandler] {
        "questionId": "fe483390-5292-46f6-bdf5-21d7ad001ea2",
        "timeSpent": 5000
      } Emitting answer_received for non-differed mode

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Successfully emitted answer_received for question fe483390-5292-46f6-bdf5-21d7ad001ea2 to socket socket-0ilwvpc2uqk

      at log (src/sockets/handlers/game/gameAnswer.ts:245:29)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'TST789',
        userId: 'player-1_mbkug7mcxfkjsu',
        questionId: 'fe483390-5292-46f6-bdf5-21d7ad001ea2',
        answer: 1,
        timeSpent: 5000
      } Socket ID: socket-0ilwvpc2uqk Connected: undefined

      at log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-06 15:31:24.916] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "socket-0ilwvpc2uqk",
        "event": "game_answer",
        "payload": {
          "accessCode": "TST789",
          "userId": "player-1_mbkug7mcxfkjsu",
          "questionId": "fe483390-5292-46f6-bdf5-21d7ad001ea2",
          "answer": 1,
          "timeSpent": 5000
        }
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.925] [32mINFO [0m [GameAnswerHandler] {
        "leaderboard": [
          {
            "userId": "player-1_mbkug7mcxfkjsu",
            "username": "Player 1",
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "score": 0
          }
        ],
        "roomName": "teacher_b6c42e93-c26f-4392-9c15-fbb0ce0d684c_TST789"
      } Emitting leaderboard_update to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:24.926] [32mINFO [0m [GameAnswerHandler] {
        "questionId": "fe483390-5292-46f6-bdf5-21d7ad001ea2",
        "timeSpent": 5000
      } Emitting answer_received for non-differed mode

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Successfully emitted answer_received for question fe483390-5292-46f6-bdf5-21d7ad001ea2 to socket socket-0ilwvpc2uqk

      at log (src/sockets/handlers/game/gameAnswer.ts:245:29)

    console.log
      [DEBUG before scoring] Redis key: mathquest:game:answers:TST789:fe483390-5292-46f6-bdf5-21d7ad001ea2 value: {
        'player-1_mbkug7mcxfkjsu': '{"userId":"player-1_mbkug7mcxfkjsu","answer":1,"timeSpent":5000,"submittedAt":1749216684923}'
      }

      at Object.<anonymous> (tests/integration/mockedGameHandler.test.ts:920:21)

    console.log
      [2025-06-06 15:31:24.932] [32mINFO [0m [GameStateService] {
        "accessCode": "TST789",
        "questionId": "fe483390-5292-46f6-bdf5-21d7ad001ea2"
      } Scores calculated for question

      at log (src/utils/logger.ts:102:21)

    console.log
      [DEBUG after scoring] Redis key: mathquest:game:answers:TST789:fe483390-5292-46f6-bdf5-21d7ad001ea2 value: {
        'player-1_mbkug7mcxfkjsu': '{"userId":"player-1_mbkug7mcxfkjsu","answer":1,"timeSpent":5000,"submittedAt":1749216684923}'
      }

      at Object.<anonymous> (tests/integration/mockedGameHandler.test.ts:927:21)

PASS tests/integration/lobbyHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-06 15:31:25.311] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.382] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "DFEcjjC7iW3UbcIrAAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.384] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "DFEcjjC7iW3UbcIrAAAB",
        "user": {
          "id": "player-123",
          "userId": "player-123",
          "username": "Test Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.400] [32mINFO [0m [GameHandlers] {
        "socketId": "DFEcjjC7iW3UbcIrAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.400] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "DFEcjjC7iW3UbcIrAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.401] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-123",
        "username": "Test Player",
        "socketId": "DFEcjjC7iW3UbcIrAAAB"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.409] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "DFEcjjC7iW3UbcIrAAAB"
      } Player leaving lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.415] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "DFEcjjC7iW3UbcIrAAAB"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.415] [32mINFO [0m [DisconnectHandler] {
        "socketId": "DFEcjjC7iW3UbcIrAAAB",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.416] [33mWARN [0m [DisconnectHandler] {
        "socketId": "DFEcjjC7iW3UbcIrAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.429] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "kBa79VZujC5nLyMqAAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.429] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "kBa79VZujC5nLyMqAAAE",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.429] [32mINFO [0m [GameHandlers] {
        "socketId": "kBa79VZujC5nLyMqAAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.429] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "kBa79VZujC5nLyMqAAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.430] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "JYyLpXuxKJ-JCcXHAAAG"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.431] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "JYyLpXuxKJ-JCcXHAAAG",
        "user": {
          "id": "player-3",
          "userId": "player-3",
          "username": "Player 3",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.431] [32mINFO [0m [GameHandlers] {
        "socketId": "JYyLpXuxKJ-JCcXHAAAG"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.431] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "JYyLpXuxKJ-JCcXHAAAG"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.432] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "k39vh1WmYX0fgmyUAAAH"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.432] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "k39vh1WmYX0fgmyUAAAH",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.432] [32mINFO [0m [GameHandlers] {
        "socketId": "k39vh1WmYX0fgmyUAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.433] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "k39vh1WmYX0fgmyUAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.433] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-1",
        "username": "Player 1",
        "socketId": "kBa79VZujC5nLyMqAAAE"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.441] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-2",
        "username": "Player 2",
        "socketId": "k39vh1WmYX0fgmyUAAAH"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.445] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-3",
        "username": "Player 3",
        "socketId": "JYyLpXuxKJ-JCcXHAAAG"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.449] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "kBa79VZujC5nLyMqAAAE"
      } Player leaving lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.452] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "JYyLpXuxKJ-JCcXHAAAG"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.453] [32mINFO [0m [DisconnectHandler] {
        "socketId": "JYyLpXuxKJ-JCcXHAAAG",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.453] [33mWARN [0m [DisconnectHandler] {
        "socketId": "JYyLpXuxKJ-JCcXHAAAG",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.453] [32mINFO [0m [DisconnectHandler] {
        "socketId": "kBa79VZujC5nLyMqAAAE",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.453] [33mWARN [0m [DisconnectHandler] {
        "socketId": "kBa79VZujC5nLyMqAAAE",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.454] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "k39vh1WmYX0fgmyUAAAH"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.454] [32mINFO [0m [DisconnectHandler] {
        "socketId": "k39vh1WmYX0fgmyUAAAH",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.454] [33mWARN [0m [DisconnectHandler] {
        "socketId": "k39vh1WmYX0fgmyUAAAH",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.458] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "6MZDwVGd5FSTmF6rAAAJ"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.458] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "6MZDwVGd5FSTmF6rAAAJ",
        "user": {
          "id": "player-redirect-test",
          "userId": "player-redirect-test",
          "username": "Redirect Test",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.458] [32mINFO [0m [GameHandlers] {
        "socketId": "6MZDwVGd5FSTmF6rAAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.459] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "6MZDwVGd5FSTmF6rAAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:25.459] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-redirect-test",
        "username": "Redirect Test",
        "socketId": "6MZDwVGd5FSTmF6rAAAJ"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.465] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "gameId": "f2ed7a66-00e4-4a48-ae01-e76f3b84c2cc",
        "socketId": "6MZDwVGd5FSTmF6rAAAJ"
      } Game is now active, sending redirect

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.474] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "6MZDwVGd5FSTmF6rAAAJ"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.474] [32mINFO [0m [DisconnectHandler] {
        "socketId": "6MZDwVGd5FSTmF6rAAAJ",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.475] [33mWARN [0m [DisconnectHandler] {
        "socketId": "6MZDwVGd5FSTmF6rAAAJ",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.483] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "pcyxE8H8n4ZNz_Z0AAAM"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.483] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "pcyxE8H8n4ZNz_Z0AAAM",
        "user": {
          "id": "player-d1",
          "userId": "player-d1",
          "username": "Disconnect Test 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.484] [32mINFO [0m [GameHandlers] {
        "socketId": "pcyxE8H8n4ZNz_Z0AAAM"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.484] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "pcyxE8H8n4ZNz_Z0AAAM"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.485] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "rbWYOqERbWxTqcYzAAAN"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.485] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "rbWYOqERbWxTqcYzAAAN",
        "user": {
          "id": "player-d2",
          "userId": "player-d2",
          "username": "Disconnect Test 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.485] [32mINFO [0m [GameHandlers] {
        "socketId": "rbWYOqERbWxTqcYzAAAN"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.486] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "rbWYOqERbWxTqcYzAAAN"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.486] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-d1",
        "username": "Disconnect Test 1",
        "socketId": "pcyxE8H8n4ZNz_Z0AAAM"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.487] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "userId": "player-d2",
        "username": "Disconnect Test 2",
        "socketId": "rbWYOqERbWxTqcYzAAAN"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.501] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "pcyxE8H8n4ZNz_Z0AAAM"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.501] [32mINFO [0m [DisconnectHandler] {
        "socketId": "pcyxE8H8n4ZNz_Z0AAAM",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.501] [33mWARN [0m [DisconnectHandler] {
        "socketId": "pcyxE8H8n4ZNz_Z0AAAM",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.502] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "pcyxE8H8n4ZNz_Z0AAAM",
        "userId": "player-d1",
        "username": "Disconnect Test 1"
      } Participant disconnected from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.805] [32mINFO [0m [LobbyHandler] {
        "accessCode": "TEST123",
        "socketId": "rbWYOqERbWxTqcYzAAAN"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.805] [32mINFO [0m [DisconnectHandler] {
        "socketId": "rbWYOqERbWxTqcYzAAAN",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:27.805] [33mWARN [0m [DisconnectHandler] {
        "socketId": "rbWYOqERbWxTqcYzAAAN",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

FAIL tests/integration/gameHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-06 15:31:28.438] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.587] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "402f5f1e-2478-4b62-aff8-e3f189f923d3",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.595] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "pCIySUSjE7_uYOYjAAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.595] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "pCIySUSjE7_uYOYjAAAB",
        "user": {
          "id": "player-123",
          "userId": "player-123",
          "username": "Test Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.603] [32mINFO [0m [GameHandlers] {
        "socketId": "pCIySUSjE7_uYOYjAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.604] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "pCIySUSjE7_uYOYjAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.610] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "402f5f1e-2478-4b62-aff8-e3f189f923d3",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.616] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.616] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Test Player",
        "avatarEmoji": "https://example.com/avatar.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.616] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.616] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Test Player",
        "avatarEmoji": "https://example.com/avatar.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.616] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.616] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.617] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "402f5f1e-2478-4b62-aff8-e3f189f923d3",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.618] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "402f5f1e-2478-4b62-aff8-e3f189f923d3",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.620] [32mINFO [0m [DisconnectHandler] {
        "socketId": "pCIySUSjE7_uYOYjAAAB",
        "userId": "player-123",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.621] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.621] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-123",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.624] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-123",
        "accessCode": "TST789",
        "disconnectedSocketId": "pCIySUSjE7_uYOYjAAAB",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'pCIySUSjE7_uYOYjAAAB',
        joinedRoomSocketIds: []
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:111:25)

    console.log
      [2025-06-06 15:31:28.627] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "0hUDy4IYyGZjpZE_AAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.628] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "0hUDy4IYyGZjpZE_AAAE",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.628] [32mINFO [0m [GameHandlers] {
        "socketId": "0hUDy4IYyGZjpZE_AAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.628] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "0hUDy4IYyGZjpZE_AAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.630] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "sCQ0T8vNbPqqGPFrAAAF"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.630] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "sCQ0T8vNbPqqGPFrAAAF",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.630] [32mINFO [0m [GameHandlers] {
        "socketId": "sCQ0T8vNbPqqGPFrAAAF"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.631] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "sCQ0T8vNbPqqGPFrAAAF"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.635] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "402f5f1e-2478-4b62-aff8-e3f189f923d3",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: '0hUDy4IYyGZjpZE_AAAE',
        joinedRoomSocketIds: [ '0hUDy4IYyGZjpZE_AAAE' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:111:25)

    console.log
      [2025-06-06 15:31:28.638] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.638] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.638] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.638] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.639] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.639] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.640] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "402f5f1e-2478-4b62-aff8-e3f189f923d3",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.640] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "402f5f1e-2478-4b62-aff8-e3f189f923d3",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.642] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.642] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'sCQ0T8vNbPqqGPFrAAAF',
        joinedRoomSocketIds: [ '0hUDy4IYyGZjpZE_AAAE', 'sCQ0T8vNbPqqGPFrAAAF' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:111:25)

    console.log
      [2025-06-06 15:31:28.644] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.644] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.644] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.644] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.644] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.644] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.645] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "402f5f1e-2478-4b62-aff8-e3f189f923d3",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.646] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "402f5f1e-2478-4b62-aff8-e3f189f923d3",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.647] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.647] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.653] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "856e20fb-fafa-4600-aca5-3a32b31b7f5d",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-06T13:31:28.647Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.653] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "856e20fb-fafa-4600-aca5-3a32b31b7f5d",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.654] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "66b72bb8-99d3-4b03-9b7e-81c40308ee21",
            "userId": "player-123",
            "username": "Test Player",
            "avatar": "https://example.com/avatar.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar.jpg",
            "joinedAt": "2025-06-06T13:31:28.637Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.654] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "66b72bb8-99d3-4b03-9b7e-81c40308ee21",
            "userId": "player-123",
            "username": "Test Player",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.658] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "52e93c95-2986-4805-8a5e-ed1c8ff3cbf9",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "https://example.com/avatar2.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar2.jpg",
            "joinedAt": "2025-06-06T13:31:28.652Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.658] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "52e93c95-2986-4805-8a5e-ed1c8ff3cbf9",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: Redis participants: {
        'player-1': '{"id":"856e20fb-fafa-4600-aca5-3a32b31b7f5d","userId":"player-1","username":"Player 1","avatar":"https://example.com/avatar1.jpg","score":0,"avatarEmoji":"https://example.com/avatar1.jpg","joinedAt":"2025-06-06T13:31:28.647Z","online":true,"socketId":"0hUDy4IYyGZjpZE_AAAE"}',
        'player-123': '{"id":"66b72bb8-99d3-4b03-9b7e-81c40308ee21","userId":"player-123","username":"Test Player","avatar":"https://example.com/avatar.jpg","score":0,"avatarEmoji":"https://example.com/avatar.jpg","joinedAt":"2025-06-06T13:31:28.637Z","online":true,"socketId":"pCIySUSjE7_uYOYjAAAB"}',
        'player-2': '{"id":"52e93c95-2986-4805-8a5e-ed1c8ff3cbf9","userId":"player-2","username":"Player 2","avatar":"https://example.com/avatar2.jpg","score":0,"avatarEmoji":"https://example.com/avatar2.jpg","joinedAt":"2025-06-06T13:31:28.652Z","online":true,"socketId":"sCQ0T8vNbPqqGPFrAAAF"}'
      }

      at Object.<anonymous> (tests/integration/gameHandler.test.ts:527:17)

    console.log
      [2025-06-06 15:31:28.751] [32mINFO [0m [DisconnectHandler] {
        "socketId": "0hUDy4IYyGZjpZE_AAAE",
        "userId": "player-1",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.752] [32mINFO [0m [DisconnectHandler] {
        "socketId": "sCQ0T8vNbPqqGPFrAAAF",
        "userId": "player-2",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.754] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-1",
        "accessCode": "TST789",
        "disconnectedSocketId": "0hUDy4IYyGZjpZE_AAAE",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.765] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TST789",
        "disconnectedSocketId": "sCQ0T8vNbPqqGPFrAAAF",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.770] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "n_JtyoRISX6r1e8dAAAI"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.770] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "n_JtyoRISX6r1e8dAAAI",
        "user": {
          "id": "player-1",
          "userId": "player-1",
          "username": "Player 1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.771] [32mINFO [0m [GameHandlers] {
        "socketId": "n_JtyoRISX6r1e8dAAAI"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.771] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "n_JtyoRISX6r1e8dAAAI"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.772] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "qZLQRJEH09FzE1VbAAAJ"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.772] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "qZLQRJEH09FzE1VbAAAJ",
        "user": {
          "id": "player-2",
          "userId": "player-2",
          "username": "Player 2",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.772] [32mINFO [0m [GameHandlers] {
        "socketId": "qZLQRJEH09FzE1VbAAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.772] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "qZLQRJEH09FzE1VbAAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.779] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "402f5f1e-2478-4b62-aff8-e3f189f923d3",
        "accessCode": "TST789"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'n_JtyoRISX6r1e8dAAAI',
        joinedRoomSocketIds: [ 'n_JtyoRISX6r1e8dAAAI' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:111:25)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_TST789',
        socketId: 'qZLQRJEH09FzE1VbAAAJ',
        joinedRoomSocketIds: [ 'n_JtyoRISX6r1e8dAAAI', 'qZLQRJEH09FzE1VbAAAJ' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:111:25)

    console.log
      [2025-06-06 15:31:28.782] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.782] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.782] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.782] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 2",
        "avatarEmoji": "https://example.com/avatar2.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.782] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.782] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.783] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.783] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.783] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.783] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "username": "Player 1",
        "avatarEmoji": "https://example.com/avatar1.jpg"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.783] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.783] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.784] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "402f5f1e-2478-4b62-aff8-e3f189f923d3",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.785] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "402f5f1e-2478-4b62-aff8-e3f189f923d3",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.786] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "402f5f1e-2478-4b62-aff8-e3f189f923d3",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.786] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "room": "game_TST789",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "402f5f1e-2478-4b62-aff8-e3f189f923d3",
          "accessCode": "TST789",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.786] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.787] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-2",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.787] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.787] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "TST789",
        "userId": "player-1",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.789] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "856e20fb-fafa-4600-aca5-3a32b31b7f5d",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "https://example.com/avatar1.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar1.jpg",
            "joinedAt": "2025-06-06T13:31:28.784Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.789] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "856e20fb-fafa-4600-aca5-3a32b31b7f5d",
            "userId": "player-1",
            "username": "Player 1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.790] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "TST789",
          "participant": {
            "id": "52e93c95-2986-4805-8a5e-ed1c8ff3cbf9",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "https://example.com/avatar2.jpg",
            "score": 0,
            "avatarEmoji": "https://example.com/avatar2.jpg",
            "joinedAt": "2025-06-06T13:31:28.785Z",
            "online": true
          },
          "gameStatus": "active",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:28.790] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "52e93c95-2986-4805-8a5e-ed1c8ff3cbf9",
            "userId": "player-2",
            "username": "Player 2",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_TST789"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: Redis participants: {
        'player-1': '{"id":"856e20fb-fafa-4600-aca5-3a32b31b7f5d","userId":"player-1","username":"Player 1","avatar":"https://example.com/avatar1.jpg","score":0,"avatarEmoji":"https://example.com/avatar1.jpg","joinedAt":"2025-06-06T13:31:28.784Z","online":true,"socketId":"n_JtyoRISX6r1e8dAAAI"}',
        'player-2': '{"id":"52e93c95-2986-4805-8a5e-ed1c8ff3cbf9","userId":"player-2","username":"Player 2","avatar":"https://example.com/avatar2.jpg","score":0,"avatarEmoji":"https://example.com/avatar2.jpg","joinedAt":"2025-06-06T13:31:28.785Z","online":true,"socketId":"qZLQRJEH09FzE1VbAAAJ"}'
      }

      at Object.<anonymous> (tests/integration/gameHandler.test.ts:623:17)

    console.log
      [2025-06-06 15:31:29.289] [32mINFO [0m [DisconnectHandler] {
        "socketId": "n_JtyoRISX6r1e8dAAAI",
        "userId": "player-1",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:29.290] [32mINFO [0m [DisconnectHandler] {
        "socketId": "qZLQRJEH09FzE1VbAAAJ",
        "userId": "player-2",
        "accessCode": "TST789",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:29.291] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-1",
        "accessCode": "TST789",
        "disconnectedSocketId": "n_JtyoRISX6r1e8dAAAI",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:29.292] [32mINFO [0m [DisconnectHandler] {
        "userId": "player-2",
        "accessCode": "TST789",
        "disconnectedSocketId": "qZLQRJEH09FzE1VbAAAJ",
        "currentActiveSocketId": null
      } Disconnected socket was not the last known active socket for the user. No "offline" status change needed based on this disconnect.

      at log (src/utils/logger.ts:102:21)

  ‚óè Game Handler ‚Ä∫ Multiple players can join a game and see each other

    expect(received).toBe(expected) // Object.is equality

    Expected: 2
    Received: 3

      529 |         // Verify participants in Redis
      530 |         const participantsCount = await redisClient.hlen(`mathquest:game:participants:${TEST_ACCESS_CODE}`);
    > 531 |         expect(participantsCount).toBe(2);
          |                                   ^
      532 |
      533 |         // Listen for game_participants event
      534 |         const participantsPromise = waitForEvent(socket1, 'game_participants');

      at Object.<anonymous> (tests/integration/gameHandler.test.ts:531:35)

PASS tests/integration/lobbyDeduplication.test.ts
  ‚óè Console

    console.log
      [2025-06-06 15:31:29.849] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:29.948] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "psPyL8viwXgXYIgzAAAC"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:29.949] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "psPyL8viwXgXYIgzAAAC",
        "user": {
          "id": "user-1",
          "userId": "user-1",
          "username": "Test User",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:29.972] [32mINFO [0m [GameHandlers] {
        "socketId": "psPyL8viwXgXYIgzAAAC"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:29.973] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "psPyL8viwXgXYIgzAAAC"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:29.978] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "6kBY3ZD64weSGowRAAAE"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:29.979] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "6kBY3ZD64weSGowRAAAE",
        "user": {
          "id": "user-1",
          "userId": "user-1",
          "username": "Test User",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:29.980] [32mINFO [0m [GameHandlers] {
        "socketId": "6kBY3ZD64weSGowRAAAE"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:29.980] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "6kBY3ZD64weSGowRAAAE"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:29.984] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "KZGJS8Xbfvc9-NZJAAAF"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:29.985] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "KZGJS8Xbfvc9-NZJAAAF",
        "user": {
          "id": "user-1",
          "userId": "user-1",
          "username": "Test User",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:29.985] [32mINFO [0m [GameHandlers] {
        "socketId": "KZGJS8Xbfvc9-NZJAAAF"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:29.986] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "KZGJS8Xbfvc9-NZJAAAF"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.089] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-1",
        "username": "Test User",
        "socketId": "psPyL8viwXgXYIgzAAAC"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.140] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-1",
        "username": "Test User",
        "socketId": "6kBY3ZD64weSGowRAAAE"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.143] [32mINFO [0m [LobbyHandler] {
        "existingSocketIds": [
          "psPyL8viwXgXYIgzAAAC"
        ],
        "newSocketId": "6kBY3ZD64weSGowRAAAE",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "count": 1
      } Removing existing participant connections for user

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.190] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-1",
        "username": "Test User",
        "socketId": "KZGJS8Xbfvc9-NZJAAAF"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.193] [32mINFO [0m [LobbyHandler] {
        "existingSocketIds": [
          "6kBY3ZD64weSGowRAAAE"
        ],
        "newSocketId": "KZGJS8Xbfvc9-NZJAAAF",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "count": 1
      } Removing existing participant connections for user

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.394] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "psPyL8viwXgXYIgzAAAC"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.395] [32mINFO [0m [DisconnectHandler] {
        "socketId": "psPyL8viwXgXYIgzAAAC",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.395] [33mWARN [0m [DisconnectHandler] {
        "socketId": "psPyL8viwXgXYIgzAAAC",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.395] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "6kBY3ZD64weSGowRAAAE"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.396] [32mINFO [0m [DisconnectHandler] {
        "socketId": "6kBY3ZD64weSGowRAAAE",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.396] [33mWARN [0m [DisconnectHandler] {
        "socketId": "6kBY3ZD64weSGowRAAAE",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.396] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "KZGJS8Xbfvc9-NZJAAAF"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.396] [32mINFO [0m [DisconnectHandler] {
        "socketId": "KZGJS8Xbfvc9-NZJAAAF",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.396] [33mWARN [0m [DisconnectHandler] {
        "socketId": "KZGJS8Xbfvc9-NZJAAAF",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.503] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "VGcjsLGQH1bdUo0aAAAI"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.503] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "VGcjsLGQH1bdUo0aAAAI",
        "user": {
          "id": "user-1",
          "userId": "user-1",
          "username": "User One",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.503] [32mINFO [0m [GameHandlers] {
        "socketId": "VGcjsLGQH1bdUo0aAAAI"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.503] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "VGcjsLGQH1bdUo0aAAAI"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.505] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "aPGMt2rbJ2Y72vRNAAAK"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.505] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "aPGMt2rbJ2Y72vRNAAAK",
        "user": {
          "id": "user-1",
          "userId": "user-1",
          "username": "User One",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.505] [32mINFO [0m [GameHandlers] {
        "socketId": "aPGMt2rbJ2Y72vRNAAAK"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.505] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "aPGMt2rbJ2Y72vRNAAAK"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.506] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "OjulIOVMyw_1OvrRAAAL"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.506] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "OjulIOVMyw_1OvrRAAAL",
        "user": {
          "id": "user-2",
          "userId": "user-2",
          "username": "User Two",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.507] [32mINFO [0m [GameHandlers] {
        "socketId": "OjulIOVMyw_1OvrRAAAL"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.507] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "OjulIOVMyw_1OvrRAAAL"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.608] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-1",
        "username": "User One",
        "socketId": "VGcjsLGQH1bdUo0aAAAI"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.660] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-2",
        "username": "User Two",
        "socketId": "OjulIOVMyw_1OvrRAAAL"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.711] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-1",
        "username": "User One",
        "socketId": "aPGMt2rbJ2Y72vRNAAAK"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.713] [32mINFO [0m [LobbyHandler] {
        "existingSocketIds": [
          "VGcjsLGQH1bdUo0aAAAI"
        ],
        "newSocketId": "aPGMt2rbJ2Y72vRNAAAK",
        "userId": "user-1",
        "accessCode": "DEDUP123",
        "count": 1
      } Removing existing participant connections for user

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.915] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "VGcjsLGQH1bdUo0aAAAI"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.915] [32mINFO [0m [DisconnectHandler] {
        "socketId": "VGcjsLGQH1bdUo0aAAAI",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.916] [33mWARN [0m [DisconnectHandler] {
        "socketId": "VGcjsLGQH1bdUo0aAAAI",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.916] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "aPGMt2rbJ2Y72vRNAAAK"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.916] [32mINFO [0m [DisconnectHandler] {
        "socketId": "aPGMt2rbJ2Y72vRNAAAK",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.916] [33mWARN [0m [DisconnectHandler] {
        "socketId": "aPGMt2rbJ2Y72vRNAAAK",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.916] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "OjulIOVMyw_1OvrRAAAL"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.917] [32mINFO [0m [DisconnectHandler] {
        "socketId": "OjulIOVMyw_1OvrRAAAL",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:30.917] [33mWARN [0m [DisconnectHandler] {
        "socketId": "OjulIOVMyw_1OvrRAAAL",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.026] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "cYg-cFqlOQjfJtfJAAAO"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.027] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "cYg-cFqlOQjfJtfJAAAO",
        "user": {
          "id": "user-cleanup",
          "userId": "user-cleanup",
          "username": "Cleanup User",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.027] [32mINFO [0m [GameHandlers] {
        "socketId": "cYg-cFqlOQjfJtfJAAAO"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.027] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "cYg-cFqlOQjfJtfJAAAO"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.029] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "pvTenzum9f-OpdS7AAAP"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.030] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "pvTenzum9f-OpdS7AAAP",
        "user": {
          "id": "user-cleanup",
          "userId": "user-cleanup",
          "username": "Cleanup User",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.030] [32mINFO [0m [GameHandlers] {
        "socketId": "pvTenzum9f-OpdS7AAAP"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.030] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "pvTenzum9f-OpdS7AAAP"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.132] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-cleanup",
        "username": "Cleanup User",
        "socketId": "cYg-cFqlOQjfJtfJAAAO"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.182] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "userId": "user-cleanup",
        "username": "Cleanup User",
        "socketId": "pvTenzum9f-OpdS7AAAP"
      } Player joining lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.184] [32mINFO [0m [LobbyHandler] {
        "existingSocketIds": [
          "cYg-cFqlOQjfJtfJAAAO"
        ],
        "newSocketId": "pvTenzum9f-OpdS7AAAP",
        "userId": "user-cleanup",
        "accessCode": "DEDUP123",
        "count": 1
      } Removing existing participant connections for user

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.385] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "pvTenzum9f-OpdS7AAAP"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.385] [32mINFO [0m [DisconnectHandler] {
        "socketId": "pvTenzum9f-OpdS7AAAP",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.386] [33mWARN [0m [DisconnectHandler] {
        "socketId": "pvTenzum9f-OpdS7AAAP",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.387] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "pvTenzum9f-OpdS7AAAP",
        "userId": "user-cleanup",
        "username": "Cleanup User"
      } Participant disconnected from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.586] [32mINFO [0m [LobbyHandler] {
        "accessCode": "DEDUP123",
        "socketId": "cYg-cFqlOQjfJtfJAAAO"
      } Socket disconnecting from lobby

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.587] [32mINFO [0m [DisconnectHandler] {
        "socketId": "cYg-cFqlOQjfJtfJAAAO",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:31.587] [33mWARN [0m [DisconnectHandler] {
        "socketId": "cYg-cFqlOQjfJtfJAAAO",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/teacherQuiz.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-06 15:31:32.334] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.336] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      Creating game template with payload: {
        name: 'My First Quiz Template',
        discipline: 'math',
        gradeLevel: 'middle',
        themes: [ 'arithmetic' ],
        questions: [ { questionUid: 'test-q-quiz-1', sequence: 1 } ]
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:94:17)

    console.log
      [2025-06-06 15:31:32.407] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJiNWRkNDliMS1iNDczLTRkNDktYTE3MS1jNjY5ODI0MDVmNGIiLCJ1c2VybmFtZSI6InF1aXpUZWFjaGVyIiwicm9sZSI6IlRFQUNIRVIiLCJpYXQiOjE3NDkyMTY2OTIsImV4cCI6MTc0OTIyMDI5Mn0.Xxrb85gM9K6psxsqU0CQCFNmVBX4QDR_MBLZ25xpfyc"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.409] [32mINFO [0m [GameTemplatesAPI] {
        "body": {
          "name": "My First Quiz Template",
          "discipline": "math",
          "gradeLevel": "middle",
          "themes": [
            "arithmetic"
          ],
          "questions": [
            {
              "questionUid": "test-q-quiz-1",
              "sequence": 1
            }
          ]
        },
        "user": {
          "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
          "username": "quizTeacher",
          "role": "TEACHER",
          "iat": 1749216692,
          "exp": 1749220292
        }
      } Received request for game template creation

      at log (src/utils/logger.ts:102:21)

    console.log
      Game template response status: 201

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:111:17)

    console.log
      Game template response body: {
        gameTemplate: {
          id: '5782f35b-88a9-40dc-baa9-680dc350ff99',
          name: 'My First Quiz Template',
          gradeLevel: 'middle',
          themes: [ 'arithmetic' ],
          discipline: 'math',
          description: null,
          defaultMode: null,
          createdAt: '2025-06-06T13:31:32.412Z',
          updatedAt: '2025-06-06T13:31:32.412Z',
          creatorId: 'b5dd49b1-b473-4d49-a171-c66982405f4b',
          questions: [ [Object] ]
        }
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:112:17)

    console.log
      Creating game instance with payload: {
        name: 'Live Quiz Session 1',
        playMode: 'quiz',
        gameTemplateId: '5782f35b-88a9-40dc-baa9-680dc350ff99'
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:118:17)

    console.log
      [2025-06-06 15:31:32.435] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "accessCode": "VF33QQ"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      Game instance response status: 201

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:131:17)

    console.log
      Game instance response body: {
        gameInstance: {
          id: 'ce7d86df-dd2a-4d9f-9dc4-933335aafb76',
          name: 'Live Quiz Session 1',
          accessCode: 'VF33QQ',
          status: 'pending',
          playMode: 'quiz',
          leaderboard: null,
          currentQuestionIndex: null,
          settings: {},
          createdAt: '2025-06-06T13:31:32.428Z',
          startedAt: null,
          endedAt: null,
          differedAvailableFrom: null,
          differedAvailableTo: null,
          isDiffered: false,
          gameTemplateId: '5782f35b-88a9-40dc-baa9-680dc350ff99',
          initiatorUserId: 'b5dd49b1-b473-4d49-a171-c66982405f4b',
          gameTemplate: {
            name: 'My First Quiz Template',
            themes: [Array],
            discipline: 'math',
            gradeLevel: 'middle'
          }
        }
      }

      at Object.<anonymous> (tests/integration/teacherQuiz.test.ts:132:17)

    console.log
      [2025-06-06 15:31:32.439] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "J1LomdMOkwRZNNl7AAAB",
        "user": {
          "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
          "role": "TEACHER"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.445] [32mINFO [0m [GameHandlers] {
        "socketId": "J1LomdMOkwRZNNl7AAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.445] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "J1LomdMOkwRZNNl7AAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.446] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "J1LomdMOkwRZNNl7AAAB",
        "socketData": {
          "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
          "user": {
            "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
            "role": "TEACHER"
          },
          "connectionInfo": {
            "id": "J1LomdMOkwRZNNl7AAAB",
            "address": "::ffff:127.0.0.1",
            "time": "2025-06-06T13:31:32.439Z"
          }
        },
        "auth": {
          "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJiNWRkNDliMS1iNDczLTRkNDktYTE3MS1jNjY5ODI0MDVmNGIiLCJ1c2VybmFtZSI6InF1aXpUZWFjaGVyIiwicm9sZSI6IlRFQUNIRVIiLCJpYXQiOjE3NDkyMTY2OTIsImV4cCI6MTc0OTIyMDI5Mn0.Xxrb85gM9K6psxsqU0CQCFNmVBX4QDR_MBLZ25xpfyc",
          "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
          "userType": "teacher"
        },
        "headers": {
          "sec-websocket-version": "13",
          "sec-websocket-key": "aT03yO8N8e+yPu0RQJCyug==",
          "connection": "Upgrade",
          "upgrade": "websocket",
          "sec-websocket-extensions": "permessage-deflate; client_max_window_bits",
          "host": "localhost:33061"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.447] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
        "socketId": "J1LomdMOkwRZNNl7AAAB"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.449] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "J1LomdMOkwRZNNl7AAAB",
        "allRooms": [
          "J1LomdMOkwRZNNl7AAAB",
          "dashboard_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
          "projection_ce7d86df-dd2a-4d9f-9dc4-933335aafb76"
        ],
        "dashboardRoom": "dashboard_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "dashboardSockets": [
          "J1LomdMOkwRZNNl7AAAB"
        ],
        "projectionRoom": "projection_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "projectionSockets": [
          "J1LomdMOkwRZNNl7AAAB"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.454] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
        "socketId": "J1LomdMOkwRZNNl7AAAB"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:215:25)

    console.log
      [2025-06-06 15:31:32.457] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "H4oH0_QsBiIEtvCqAAAD",
        "user": {
          "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
          "username": "quizPlayer1",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.457] [32mINFO [0m [GameHandlers] {
        "socketId": "H4oH0_QsBiIEtvCqAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.458] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "H4oH0_QsBiIEtvCqAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [joinGame] Player joined room: {
        roomName: 'game_VF33QQ',
        socketId: 'H4oH0_QsBiIEtvCqAAAD',
        joinedRoomSocketIds: [ 'H4oH0_QsBiIEtvCqAAAD' ]
      }

      at Socket.log (src/sockets/handlers/game/joinGame.ts:111:25)

    console.log
      [2025-06-06 15:31:32.470] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "VF33QQ",
        "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.470] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "VF33QQ",
        "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
        "room": "game_VF33QQ",
        "playMode": "quiz",
        "username": "quizPlayer1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.470] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "VF33QQ",
        "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
        "determinedPlayMode": "quiz"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.470] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "VF33QQ",
        "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
        "room": "game_VF33QQ",
        "playMode": "quiz",
        "username": "quizPlayer1"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.470] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "VF33QQ",
        "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
        "room": "game_VF33QQ",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.471] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "VF33QQ",
        "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
        "room": "game_VF33QQ",
        "playMode": "quiz"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.471] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "VF33QQ",
        "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
        "room": "game_VF33QQ",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
          "accessCode": "VF33QQ",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.472] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "VF33QQ",
        "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
        "room": "game_VF33QQ",
        "playMode": "quiz",
        "gameJoinPayload": {
          "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
          "accessCode": "VF33QQ",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 1,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.478] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
        "questionUid": "test-q-quiz-1"
      } Setting question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.480] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "VF33QQ",
        "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.481] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "VF33QQ",
        "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
        "playMode": "quiz"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.484] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "VF33QQ",
          "participant": {
            "id": "ab0e71c4-7886-4981-a6e5-c363345d4c57",
            "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
            "username": "quizPlayer1",
            "avatar": "üòÄ",
            "score": 0,
            "joinedAt": "2025-06-06T13:31:32.477Z",
            "online": true
          },
          "gameStatus": "pending",
          "isDiffered": false
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.485] [32mINFO [0m [JoinGameHandler] {
        "playerJoinedPayload": {
          "participant": {
            "id": "ab0e71c4-7886-4981-a6e5-c363345d4c57",
            "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
            "username": "quizPlayer1",
            "avatar": "üòÄ",
            "score": 0,
            "online": true
          }
        },
        "room": "game_VF33QQ"
      } Emitting player_joined_game to room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.485] [32mINFO [0m [GameStateService] {
        "accessCode": "VF33QQ"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.486] [32mINFO [0m [SetQuestionHandler] {
        "liveRoom": "game_VF33QQ",
        "liveRoomSocketIds": [
          "H4oH0_QsBiIEtvCqAAAD"
        ],
        "payload": {
          "question": {
            "uid": "test-q-quiz-1",
            "text": "What is 2+2 for quiz?",
            "answerOptions": [
              "3",
              "4",
              "5"
            ],
            "correctAnswers": [
              false,
              false,
              false
            ],
            "questionType": "multiple_choice_single_answer",
            "timeLimit": 30,
            "currentQuestionIndex": 0,
            "totalQuestions": 1
          },
          "timer": {
            "startedAt": 1749216692485,
            "duration": 30000,
            "isPaused": true
          }
        }
      } [DEBUG] Emitting game_question to live room

      at log (src/utils/logger.ts:102:21)

    console.log
      [setQuestion] Emitting game_question: {
        liveRoom: 'game_VF33QQ',
        liveRoomSocketIds: [ 'H4oH0_QsBiIEtvCqAAAD' ],
        payload: {
          question: {
            uid: 'test-q-quiz-1',
            title: undefined,
            text: 'What is 2+2 for quiz?',
            answerOptions: [Array],
            correctAnswers: [Array],
            questionType: 'multiple_choice_single_answer',
            timeLimit: 30,
            currentQuestionIndex: 0,
            totalQuestions: 1
          },
          timer: { startedAt: 1749216692485, duration: 30000, isPaused: true }
        }
      }

      at Socket.log (src/sockets/handlers/teacherControl/setQuestion.ts:193:25)

    console.log
      [2025-06-06 15:31:32.486] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "questionUid": "test-q-quiz-1",
        "questionIndex": 0
      } Question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.489] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
          "action": "resume"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.490] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
        "action": "resume"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.490] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
        "action": "resume"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.494] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "resume",
        "timer": {
          "startedAt": 1749216692494,
          "duration": 30000,
          "isPaused": false
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.494] [32mINFO [0m [GameStateService] {
        "accessCode": "VF33QQ"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.494] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "resume",
        "dashboardRoom": "dashboard_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "liveRoom": "game_VF33QQ",
        "projectionRoom": "projection_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "timer": {
          "startedAt": 1749216692494,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.495] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "resume",
        "dashboardRoom": "dashboard_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "timer": {
          "startedAt": 1749216692494,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.495] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "resume",
        "liveRoom": "game_VF33QQ",
        "timer": {
          "startedAt": 1749216692494,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.495] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "resume",
        "projectionRoom": "projection_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "timer": {
          "startedAt": 1749216692494,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.495] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "resume"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.496] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
          "action": "pause"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.496] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
        "action": "pause"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.496] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
        "action": "pause"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.499] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "pause",
        "timer": {
          "startedAt": 1749216692494,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1749216692499,
          "timeRemaining": 29995
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.499] [32mINFO [0m [GameStateService] {
        "accessCode": "VF33QQ"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.499] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "pause",
        "dashboardRoom": "dashboard_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "liveRoom": "game_VF33QQ",
        "projectionRoom": "projection_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "timer": {
          "startedAt": 1749216692494,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1749216692499,
          "timeRemaining": 29995
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.500] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "pause",
        "dashboardRoom": "dashboard_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "timer": {
          "startedAt": 1749216692494,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1749216692499,
          "timeRemaining": 29995
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.500] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "pause",
        "liveRoom": "game_VF33QQ",
        "timer": {
          "startedAt": 1749216692494,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1749216692499,
          "timeRemaining": 29995
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.500] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "pause",
        "projectionRoom": "projection_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "timer": {
          "startedAt": 1749216692494,
          "duration": 30000,
          "isPaused": true,
          "pausedAt": 1749216692499,
          "timeRemaining": 29995
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:32.500] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "pause"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.501] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
          "action": "resume"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.502] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
        "action": "resume"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.502] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
        "action": "resume"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.506] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "resume",
        "timer": {
          "startedAt": 1749216693506,
          "duration": 29995,
          "isPaused": false
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.507] [32mINFO [0m [GameStateService] {
        "accessCode": "VF33QQ"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.507] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "resume",
        "dashboardRoom": "dashboard_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "liveRoom": "game_VF33QQ",
        "projectionRoom": "projection_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "timer": {
          "startedAt": 1749216693506,
          "duration": 29995,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.507] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "resume",
        "dashboardRoom": "dashboard_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "timer": {
          "startedAt": 1749216693506,
          "duration": 29995,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.508] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "resume",
        "liveRoom": "game_VF33QQ",
        "timer": {
          "startedAt": 1749216693506,
          "duration": 29995,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.508] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "resume",
        "projectionRoom": "projection_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "timer": {
          "startedAt": 1749216693506,
          "duration": 29995,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.508] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "resume"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.509] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
          "action": "stop"
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.509] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
        "action": "stop"
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.510] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
        "action": "stop"
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.514] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "stop",
        "timer": {
          "startedAt": 0,
          "duration": 29995,
          "isPaused": true,
          "timeRemaining": 0
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.515] [32mINFO [0m [GameStateService] {
        "accessCode": "VF33QQ"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.515] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "stop",
        "dashboardRoom": "dashboard_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "liveRoom": "game_VF33QQ",
        "projectionRoom": "projection_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "timer": {
          "startedAt": 0,
          "duration": 29995,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.516] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "stop",
        "dashboardRoom": "dashboard_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "timer": {
          "startedAt": 0,
          "duration": 29995,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.516] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "stop",
        "liveRoom": "game_VF33QQ",
        "timer": {
          "startedAt": 0,
          "duration": 29995,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.516] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "stop",
        "projectionRoom": "projection_ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "timer": {
          "startedAt": 0,
          "duration": 29995,
          "isPaused": true,
          "timeRemaining": 0
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.516] [32mINFO [0m [TimerActionHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "action": "stop"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.518] [32mINFO [0m [DisconnectHandler] {
        "socketId": "J1LomdMOkwRZNNl7AAAB",
        "userId": "b5dd49b1-b473-4d49-a171-c66982405f4b",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.518] [33mWARN [0m [DisconnectHandler] {
        "socketId": "J1LomdMOkwRZNNl7AAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.518] [32mINFO [0m [DisconnectHandler] {
        "socketId": "H4oH0_QsBiIEtvCqAAAD",
        "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
        "accessCode": "VF33QQ",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.521] [32mINFO [0m [DisconnectHandler] {
        "gameId": "ce7d86df-dd2a-4d9f-9dc4-933335aafb76",
        "socketId": "J1LomdMOkwRZNNl7AAAB"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.522] [32mINFO [0m [DisconnectHandler] {
        "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
        "accessCode": "VF33QQ",
        "socketId": "H4oH0_QsBiIEtvCqAAAD"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:33.523] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "432c4d3f-21ae-43db-b33a-69dc71f28205",
          "socketId": "H4oH0_QsBiIEtvCqAAAD"
        },
        "room": "game_VF33QQ"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

PASS tests/unit/gameParticipantService.test.ts
PASS tests/integration/socketConnection.test.ts
  ‚óè Console

    console.log
      Connecting to server...

      at Object.<anonymous> (tests/integration/socketConnection.test.ts:80:17)

    console.log
      [2025-06-06 15:31:34.006] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:34.010] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "oBHGovKtO0lyUOD3AAAB"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:34.010] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "oBHGovKtO0lyUOD3AAAB",
        "user": {
          "id": "test-player-123",
          "userId": "test-player-123",
          "username": "test-player-123",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:34.017] [32mINFO [0m [GameHandlers] {
        "socketId": "oBHGovKtO0lyUOD3AAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:34.017] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "oBHGovKtO0lyUOD3AAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket connected successfully

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:60:21)

    console.log
      Received connection_established event: {
        socketId: 'oBHGovKtO0lyUOD3AAAB',
        timestamp: '2025-06-06T13:31:34.010Z',
        user: {
          role: 'STUDENT',
          userId: 'test-player-123',
          username: 'test-player-123'
        }
      }

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:71:21)

    console.log
      Authentication test connecting to server...

      at Object.<anonymous> (tests/integration/socketConnection.test.ts:122:17)

    console.log
      [2025-06-06 15:31:34.030] [33mWARN [0m [TestSocketAuth] {
        "tokenRole": "STUDENT",
        "queryRole": "player",
        "socketId": "DfoRI4UAE7N9Iq5HAAAD"
      } Role mismatch between JWT and query parameter in testSetup.ts. Using token role.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:34.030] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "DfoRI4UAE7N9Iq5HAAAD",
        "user": {
          "id": "test-player-123",
          "userId": "test-player-123",
          "username": "test-player-123",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:34.030] [32mINFO [0m [GameHandlers] {
        "socketId": "DfoRI4UAE7N9Iq5HAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:34.030] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "DfoRI4UAE7N9Iq5HAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      Authentication test socket connected successfully

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:103:21)

    console.log
      Authentication test received connection_established event: {
        socketId: 'DfoRI4UAE7N9Iq5HAAAD',
        timestamp: '2025-06-06T13:31:34.030Z',
        user: {
          role: 'STUDENT',
          userId: 'test-player-123',
          username: 'test-player-123'
        }
      }

      at Socket.<anonymous> (tests/integration/socketConnection.test.ts:113:21)

    console.log
      [2025-06-06 15:31:34.032] [32mINFO [0m [DisconnectHandler] {
        "socketId": "DfoRI4UAE7N9Iq5HAAAD",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:34.032] [33mWARN [0m [DisconnectHandler] {
        "socketId": "DfoRI4UAE7N9Iq5HAAAD",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:34.033] [32mINFO [0m [DisconnectHandler] {
        "socketId": "oBHGovKtO0lyUOD3AAAB",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:34.033] [33mWARN [0m [DisconnectHandler] {
        "socketId": "oBHGovKtO0lyUOD3AAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/teacherDashboard.test.ts
  ‚óè Console

    console.log
      [2025-06-06 15:31:35.179] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.262] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "accessCode": "TEST123"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.272] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "DzBxkQHzRuyM3glrAAAB",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.280] [32mINFO [0m [GameHandlers] {
        "socketId": "DzBxkQHzRuyM3glrAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.280] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "DzBxkQHzRuyM3glrAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.284] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "DzBxkQHzRuyM3glrAAAB",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "DzBxkQHzRuyM3glrAAAB",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-06-06T13:31:35.272Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.284] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "socketId": "DzBxkQHzRuyM3glrAAAB"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.286] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "DzBxkQHzRuyM3glrAAAB",
        "allRooms": [
          "DzBxkQHzRuyM3glrAAAB",
          "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
          "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f"
        ],
        "dashboardRoom": "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "dashboardSockets": [
          "DzBxkQHzRuyM3glrAAAB"
        ],
        "projectionRoom": "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "projectionSockets": [
          "DzBxkQHzRuyM3glrAAAB"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.290] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "socketId": "DzBxkQHzRuyM3glrAAAB"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:215:25)

    console.log
      [2025-06-06 15:31:35.291] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "DzBxkQHzRuyM3glrAAAB",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "DzBxkQHzRuyM3glrAAAB",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-06-06T13:31:35.272Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.291] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "socketId": "DzBxkQHzRuyM3glrAAAB"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.292] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "DzBxkQHzRuyM3glrAAAB",
        "allRooms": [
          "DzBxkQHzRuyM3glrAAAB",
          "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
          "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f"
        ],
        "dashboardRoom": "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "dashboardSockets": [
          "DzBxkQHzRuyM3glrAAAB"
        ],
        "projectionRoom": "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "projectionSockets": [
          "DzBxkQHzRuyM3glrAAAB"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.296] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "socketId": "DzBxkQHzRuyM3glrAAAB"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:215:25)

    console.log
      [2025-06-06 15:31:35.304] [32mINFO [0m [DisconnectHandler] {
        "socketId": "DzBxkQHzRuyM3glrAAAB",
        "userId": "teacher-1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.304] [33mWARN [0m [DisconnectHandler] {
        "socketId": "DzBxkQHzRuyM3glrAAAB",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.307] [32mINFO [0m [DisconnectHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "socketId": "DzBxkQHzRuyM3glrAAAB"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.310] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "uHIjaUuT4m5zrM1GAAAD",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.310] [32mINFO [0m [GameHandlers] {
        "socketId": "uHIjaUuT4m5zrM1GAAAD"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.310] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "uHIjaUuT4m5zrM1GAAAD"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.312] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "uHIjaUuT4m5zrM1GAAAD",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "uHIjaUuT4m5zrM1GAAAD",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-06-06T13:31:35.310Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.313] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "socketId": "uHIjaUuT4m5zrM1GAAAD"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.314] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "uHIjaUuT4m5zrM1GAAAD",
        "allRooms": [
          "uHIjaUuT4m5zrM1GAAAD",
          "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
          "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f"
        ],
        "dashboardRoom": "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "dashboardSockets": [
          "uHIjaUuT4m5zrM1GAAAD"
        ],
        "projectionRoom": "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "projectionSockets": [
          "uHIjaUuT4m5zrM1GAAAD"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.318] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "socketId": "uHIjaUuT4m5zrM1GAAAD"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:215:25)

    console.log
      [2025-06-06 15:31:35.319] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "questionUid": "q-late-1"
      } Setting question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.323] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.324] [32mINFO [0m [SetQuestionHandler] {
        "liveRoom": "game_TEST123",
        "liveRoomSocketIds": [],
        "payload": {
          "question": {
            "uid": "q-late-1",
            "text": "What is 10 + 5?",
            "answerOptions": [
              "12",
              "13",
              "14",
              "15"
            ],
            "correctAnswers": [
              false,
              false,
              false,
              false
            ],
            "questionType": "single_correct",
            "timeLimit": 2,
            "currentQuestionIndex": 0,
            "totalQuestions": 14
          },
          "timer": {
            "startedAt": 1749216695322,
            "duration": 2000,
            "isPaused": true
          }
        }
      } [DEBUG] Emitting game_question to live room

      at log (src/utils/logger.ts:102:21)

    console.log
      [setQuestion] Emitting game_question: {
        liveRoom: 'game_TEST123',
        liveRoomSocketIds: [],
        payload: {
          question: {
            uid: 'q-late-1',
            title: undefined,
            text: 'What is 10 + 5?',
            answerOptions: [Array],
            correctAnswers: [Array],
            questionType: 'single_correct',
            timeLimit: 2,
            currentQuestionIndex: 0,
            totalQuestions: 14
          },
          timer: { startedAt: 1749216695322, duration: 2000, isPaused: true }
        }
      }

      at Socket.log (src/sockets/handlers/teacherControl/setQuestion.ts:193:25)

    console.log
      [2025-06-06 15:31:35.324] [32mINFO [0m [SetQuestionHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "questionUid": "q-late-1",
        "questionIndex": 0
      } Question set successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.326] [32mINFO [0m [DisconnectHandler] {
        "socketId": "uHIjaUuT4m5zrM1GAAAD",
        "userId": "teacher-1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.326] [33mWARN [0m [DisconnectHandler] {
        "socketId": "uHIjaUuT4m5zrM1GAAAD",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.328] [32mINFO [0m [DisconnectHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "socketId": "uHIjaUuT4m5zrM1GAAAD"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.331] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "w6U_TwGNliw7dbY9AAAF",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.331] [32mINFO [0m [GameHandlers] {
        "socketId": "w6U_TwGNliw7dbY9AAAF"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.332] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "w6U_TwGNliw7dbY9AAAF"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.334] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "w6U_TwGNliw7dbY9AAAF",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "w6U_TwGNliw7dbY9AAAF",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-06-06T13:31:35.331Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.335] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "socketId": "w6U_TwGNliw7dbY9AAAF"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.336] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "w6U_TwGNliw7dbY9AAAF",
        "allRooms": [
          "w6U_TwGNliw7dbY9AAAF",
          "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
          "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f"
        ],
        "dashboardRoom": "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "dashboardSockets": [
          "w6U_TwGNliw7dbY9AAAF"
        ],
        "projectionRoom": "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "projectionSockets": [
          "w6U_TwGNliw7dbY9AAAF"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.341] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "socketId": "w6U_TwGNliw7dbY9AAAF"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:215:25)

    console.log
      [2025-06-06 15:31:35.341] [32mINFO [0m [Test] [TEST] About to emit quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.342] [32mINFO [0m [Test] [TEST] quiz_timer_action event emitted

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.342] [32mINFO [0m [TimerActionHandler] {
        "payload": {
          "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
          "action": "start",
          "duration": 30
        }
      } Received quiz_timer_action event

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.342] [32mINFO [0m [TimerActionHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "action": "start",
        "duration": 30
      } Timer action handler entered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.342] [32mINFO [0m [TimerActionHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "action": "start",
        "duration": 30
      } Timer action requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.344] [32mINFO [0m [TimerActionHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "action": "start",
        "now": 1749216695344,
        "validDuration": 30,
        "timer": {
          "startedAt": 1749216695322,
          "duration": 2000,
          "isPaused": true
        }
      } [TIMER_ACTION] Processing start action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.344] [32mINFO [0m [TimerActionHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "action": "start",
        "timer": {
          "startedAt": 1749216695344,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Timer object after start processing

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.344] [32mINFO [0m [TimerActionHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "action": "start",
        "timer": {
          "startedAt": 1749216695344,
          "duration": 30000,
          "isPaused": false
        }
      } Timer state after action

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.344] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.345] [32mINFO [0m [TimerActionHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "action": "start",
        "dashboardRoom": "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "liveRoom": "game_TEST123",
        "projectionRoom": "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "timer": {
          "startedAt": 1749216695344,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitting timer updates to rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.345] [32mINFO [0m [TimerActionHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "action": "start",
        "dashboardRoom": "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "timer": {
          "startedAt": 1749216695344,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to dashboardRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.345] [32mINFO [0m [TimerActionHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "action": "start",
        "liveRoom": "game_TEST123",
        "timer": {
          "startedAt": 1749216695344,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to liveRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.345] [32mINFO [0m [TimerActionHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "action": "start",
        "projectionRoom": "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "timer": {
          "startedAt": 1749216695344,
          "duration": 30000,
          "isPaused": false
        }
      } [TIMER_ACTION] Emitted to projectionRoom

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.345] [32mINFO [0m [TimerActionHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "action": "start"
      } Timer updated successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.345] [32mINFO [0m [Test] [TEST] Received dashboard_timer_updated event {
        "timer": {
          "startedAt": 1749216695344,
          "duration": 30000,
          "isPaused": false
        }
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.347] [32mINFO [0m [DisconnectHandler] {
        "socketId": "w6U_TwGNliw7dbY9AAAF",
        "userId": "teacher-1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.347] [33mWARN [0m [DisconnectHandler] {
        "socketId": "w6U_TwGNliw7dbY9AAAF",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.349] [32mINFO [0m [DisconnectHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "socketId": "w6U_TwGNliw7dbY9AAAF"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.352] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "03foP8zCQ99p7g6eAAAH",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.352] [32mINFO [0m [GameHandlers] {
        "socketId": "03foP8zCQ99p7g6eAAAH"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.353] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "03foP8zCQ99p7g6eAAAH"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.354] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "03foP8zCQ99p7g6eAAAH",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "03foP8zCQ99p7g6eAAAH",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-06-06T13:31:35.352Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.355] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "socketId": "03foP8zCQ99p7g6eAAAH"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.357] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "03foP8zCQ99p7g6eAAAH",
        "allRooms": [
          "03foP8zCQ99p7g6eAAAH",
          "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
          "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f"
        ],
        "dashboardRoom": "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "dashboardSockets": [
          "03foP8zCQ99p7g6eAAAH"
        ],
        "projectionRoom": "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "projectionSockets": [
          "03foP8zCQ99p7g6eAAAH"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.363] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "socketId": "03foP8zCQ99p7g6eAAAH"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:215:25)

    console.log
      [2025-06-06 15:31:35.364] [32mINFO [0m [LockAnswersHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "lock": true
      } Answer lock requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.367] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.367] [32mINFO [0m [LockAnswersHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "lock": true
      } Answers lock status updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.369] [32mINFO [0m [DisconnectHandler] {
        "socketId": "03foP8zCQ99p7g6eAAAH",
        "userId": "teacher-1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.369] [33mWARN [0m [DisconnectHandler] {
        "socketId": "03foP8zCQ99p7g6eAAAH",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.370] [32mINFO [0m [DisconnectHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "socketId": "03foP8zCQ99p7g6eAAAH"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.374] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "9x9wks99e7nJ74snAAAJ",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.375] [32mINFO [0m [GameHandlers] {
        "socketId": "9x9wks99e7nJ74snAAAJ"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.375] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "9x9wks99e7nJ74snAAAJ"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.377] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "9x9wks99e7nJ74snAAAJ",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "9x9wks99e7nJ74snAAAJ",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-06-06T13:31:35.374Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.378] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "socketId": "9x9wks99e7nJ74snAAAJ"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.379] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "9x9wks99e7nJ74snAAAJ",
        "allRooms": [
          "9x9wks99e7nJ74snAAAJ",
          "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
          "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f"
        ],
        "dashboardRoom": "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "dashboardSockets": [
          "9x9wks99e7nJ74snAAAJ"
        ],
        "projectionRoom": "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "projectionSockets": [
          "9x9wks99e7nJ74snAAAJ"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.384] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "socketId": "9x9wks99e7nJ74snAAAJ"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:215:25)

    console.log
      [2025-06-06 15:31:35.385] [32mINFO [0m [EndGameHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1"
      } Game end requested

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.391] [32mINFO [0m [GameStateService] {
        "accessCode": "TEST123"
      } Game state updated

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.395] [32mINFO [0m [EndGameHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f"
      } Game ended successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.397] [32mINFO [0m [DisconnectHandler] {
        "socketId": "9x9wks99e7nJ74snAAAJ",
        "userId": "teacher-1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.397] [33mWARN [0m [DisconnectHandler] {
        "socketId": "9x9wks99e7nJ74snAAAJ",
        "reason": "client namespace disconnect"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.399] [32mINFO [0m [DisconnectHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "socketId": "9x9wks99e7nJ74snAAAJ"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.401] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "E7so13029iyO8KQfAAAL",
        "user": {
          "userId": "teacher-1",
          "role": "teacher"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.401] [32mINFO [0m [GameHandlers] {
        "socketId": "E7so13029iyO8KQfAAAL"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.401] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "E7so13029iyO8KQfAAAL"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.404] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "E7so13029iyO8KQfAAAL",
        "socketData": {
          "userId": "teacher-1",
          "user": {
            "userId": "teacher-1",
            "role": "teacher"
          },
          "connectionInfo": {
            "id": "E7so13029iyO8KQfAAAL",
            "address": "::ffff:127.0.0.1",
            "userAgent": "node-XMLHttpRequest",
            "time": "2025-06-06T13:31:35.401Z"
          }
        },
        "auth": {
          "userId": "teacher-1"
        },
        "headers": {
          "user-agent": "node-XMLHttpRequest",
          "accept": "*/*",
          "host": "localhost:3001",
          "connection": "close"
        }
      } Socket authentication data

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.404] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "socketId": "E7so13029iyO8KQfAAAL"
      } User joining dashboard

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.405] [32mINFO [0m [JoinDashboardHandler] {
        "socketId": "E7so13029iyO8KQfAAAL",
        "allRooms": [
          "E7so13029iyO8KQfAAAL",
          "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
          "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f"
        ],
        "dashboardRoom": "dashboard_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "dashboardSockets": [
          "E7so13029iyO8KQfAAAL"
        ],
        "projectionRoom": "projection_99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "projectionSockets": [
          "E7so13029iyO8KQfAAAL"
        ]
      } Socket joined dashboard and projection rooms

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:35.410] [32mINFO [0m [JoinDashboardHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "userId": "teacher-1",
        "socketId": "E7so13029iyO8KQfAAAL"
      } User joined dashboard successfully

      at log (src/utils/logger.ts:102:21)

    console.log
      No callback provided for join_dashboard event

      at Socket.log (src/sockets/handlers/teacherControl/joinDashboard.ts:215:25)

    console.log
      [2025-06-06 15:31:35.413] [32mINFO [0m [DisconnectHandler] {
        "socketId": "E7so13029iyO8KQfAAAL",
        "userId": "teacher-1",
        "reason": "server shutting down"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-06 15:31:35.413] [33mWARN [0m [DisconnectHandler] {
        "socketId": "E7so13029iyO8KQfAAAL",
        "reason": "server shutting down"
      } Disconnected socket had no userId or accessCode in socket.data. Cannot process participant update.

      at log (src/utils/logger.ts:102:21)
          at Map.forEach (<anonymous>)
          at Array.map (<anonymous>)

    console.log
      [2025-06-06 15:31:35.415] [32mINFO [0m [DisconnectHandler] {
        "gameId": "99fbb168-cb36-4519-bd86-b26fbe291d2f",
        "socketId": "E7so13029iyO8KQfAAAL"
      } Teacher disconnected from dashboard

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/projectorHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-06 15:31:35.996] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.057] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "dd213eab-a255-4ddf-b957-96db01ee1d0d",
        "accessCode": "PROJ123"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.059] [31mERROR[0m [GameStateService] {
        "gameInstanceId": "PROJ123"
      } Game instance not found

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.069] [32mINFO [0m [ProjectorHandler] Projector joined room: projector_dd213eab-a255-4ddf-b957-96db01ee1d0d

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.073] [32mINFO [0m [ProjectorHandler] Projector left room: projector_dd213eab-a255-4ddf-b957-96db01ee1d0d

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/practiceMode.test.ts
  ‚óè Console

    console.log
      [2025-06-06 15:31:36.718] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.794] [32mINFO [0m [GameStateService] {
        "gameInstanceId": "e2af6400-835a-4156-87ed-a0ec64c9dbb1",
        "accessCode": "PRACTICE1"
      } Game state initialized in Redis

      at log (src/utils/logger.ts:102:21)

    console.log
      Socket query params: {
        token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJwcmFjdGljZS1wbGF5ZXItMSIsInVzZXJuYW1lIjoiUHJhY3RpY2UgUGxheWVyIiwicm9sZSI6IlNUVURFTlQiLCJpYXQiOjE3NDkyMTY2OTYsImV4cCI6MTc0OTIyMDI5Nn0.UU8hD9TnIeZe918xXhqkO3D8OFBZSq-gnM2bOO_K_vk',
        role: 'STUDENT'
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:134:17)

    console.log
      [2025-06-06 15:31:36.798] [32mINFO [0m [ConnectionHandlers] {
        "socketId": "3ERF-RRoq75xNzsTAAAB",
        "user": {
          "id": "practice-player-1",
          "userId": "practice-player-1",
          "username": "Practice Player",
          "role": "STUDENT"
        },
        "address": "::ffff:127.0.0.1"
      } New socket connection established

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.806] [32mINFO [0m [GameHandlers] {
        "socketId": "3ERF-RRoq75xNzsTAAAB"
      } Registering game handlers

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.806] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "3ERF-RRoq75xNzsTAAAB"
      } gameAnswerHandler registered

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] connection_established [
        {
          socketId: '3ERF-RRoq75xNzsTAAAB',
          timestamp: '2025-06-06T13:31:36.799Z',
          user: {
            role: 'STUDENT',
            userId: 'practice-player-1',
            username: 'Practice Player'
          }
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      Socket connected and ready to emit events, ID: 3ERF-RRoq75xNzsTAAAB

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:162:17)

    console.log
      Waiting for event: game_joined with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-06-06 15:31:36.819] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.820] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "username": "Practice Player"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.820] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice"
      } Determined playMode from game instance

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.820] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "username": "Practice Player"
      } [DEBUG] Attempting to join room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.820] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.820] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice"
      } [DEBUG] Joined room

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.821] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "gameJoinPayload": {
          "gameId": "e2af6400-835a-4156-87ed-a0ec64c9dbb1",
          "accessCode": "PRACTICE1",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.822] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "room": "game_PRACTICE1",
        "playMode": "practice",
        "gameJoinPayload": {
          "gameId": "e2af6400-835a-4156-87ed-a0ec64c9dbb1",
          "accessCode": "PRACTICE1",
          "status": "pending",
          "currentQuestionIndex": -1,
          "totalQuestions": 2,
          "timer": {
            "startedAt": 0,
            "duration": 0,
            "isPaused": true
          },
          "question": null
        }
      } [DEBUG] Emitted game_joined with timer and state

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          gameId: 'e2af6400-835a-4156-87ed-a0ec64c9dbb1',
          accessCode: 'PRACTICE1',
          status: 'pending',
          currentQuestionIndex: -1,
          totalQuestions: 2,
          timer: { startedAt: 0, duration: 0, isPaused: true },
          question: null
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      ‚úÖ Event received: game_joined {
        gameId: 'e2af6400-835a-4156-87ed-a0ec64c9dbb1',
        accessCode: 'PRACTICE1',
        status: 'pending',
        currentQuestionIndex: -1,
        totalQuestions: 2,
        timer: { startedAt: 0, duration: 0, isPaused: true },
        question: null
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      [SOCKET EVENT] participant_joined [
        {
          userId: 'practice-player-1',
          username: 'Practice Player',
          playMode: 'practice'
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          gameId: 'e2af6400-835a-4156-87ed-a0ec64c9dbb1',
          accessCode: 'PRACTICE1',
          status: 'pending',
          currentQuestionIndex: -1,
          totalQuestions: 2,
          timer: { startedAt: 0, duration: 0, isPaused: true },
          question: null
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [SOCKET EVENT] participant_joined [
        {
          userId: 'practice-player-1',
          username: 'Practice Player',
          playMode: 'practice'
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      Successfully received game_joined event, now starting game...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:171:17)

    console.log
      Emitted start_game again to ensure it gets processed

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:187:17)

    console.log
      [2025-06-06 15:31:36.825] [32mINFO [0m [GameHandlers] {
        "socketId": "3ERF-RRoq75xNzsTAAAB",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1"
        }
      } Start game event received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.825] [32mINFO [0m [GameHandlers] {
        "socketId": "3ERF-RRoq75xNzsTAAAB",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1"
        }
      } Start game event received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.825] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.826] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Participant joined live room via sharedLiveHandler

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.826] [32mINFO [0m [JoinGameHandler] {
        "gameJoinedPayload": {
          "accessCode": "PRACTICE1",
          "participant": {
            "id": "e6b16945-a784-4732-860b-6e69598ecd47",
            "userId": "practice-player-1",
            "username": "Practice Player",
            "avatar": "üòÄ",
            "score": 0,
            "joinedAt": "2025-06-06T13:31:36.819Z",
            "online": true
          },
          "gameStatus": "waiting",
          "isDiffered": true
        }
      } Emitting game_joined

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_joined [
        {
          accessCode: 'PRACTICE1',
          participant: {
            id: 'e6b16945-a784-4732-860b-6e69598ecd47',
            userId: 'practice-player-1',
            username: 'Practice Player',
            avatar: 'üòÄ',
            score: 0,
            joinedAt: '2025-06-06T13:31:36.819Z',
            online: true
          },
          gameStatus: 'waiting',
          isDiffered: true
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [2025-06-06 15:31:36.832] [32mINFO [0m [GameHandlers] {
        "socketId": "3ERF-RRoq75xNzsTAAAB",
        "questionId": "bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0"
      } Sending first question

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_question [
        {
          uid: 'bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0',
          text: 'What is 1+1?',
          answerOptions: [ '1', '2', '3' ],
          correctAnswers: [ false, true, false ],
          timeLimit: 20,
          questionType: 'multiple_choice_single_answer',
          themes: [ 'arithmetic' ],
          difficulty: 1,
          discipline: 'math',
          title: 'Practice Q1',
          currentQuestionIndex: 0,
          totalQuestions: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        uid: 'bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0',
        text: 'What is 1+1?',
        answerOptions: [ '1', '2', '3' ],
        correctAnswers: [ false, true, false ],
        timeLimit: 20,
        questionType: 'multiple_choice_single_answer',
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q1',
        currentQuestionIndex: 0,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:156:21)

    console.log
      ‚úÖ Direct handler for game_question event received: {
        uid: 'bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0',
        text: 'What is 1+1?',
        answerOptions: [ '1', '2', '3' ],
        correctAnswers: [ false, true, false ],
        timeLimit: 20,
        questionType: 'multiple_choice_single_answer',
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q1',
        currentQuestionIndex: 0,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:180:25)

    console.log
      Promise resolved with game_question data

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:191:17)

    console.log
      Waiting for event: answer_received with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-06-06 15:31:36.834] [32mINFO [0m [GameHandlers] {
        "socketId": "3ERF-RRoq75xNzsTAAAB",
        "questionId": "bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0"
      } Sending first question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.834] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0",
        "answer": 1,
        "timeSpent": 1000,
        "socketId": "3ERF-RRoq75xNzsTAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: 'bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0',
        answer: 1,
        timeSpent: 1000
      } Socket ID: 3ERF-RRoq75xNzsTAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-06 15:31:36.835] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "3ERF-RRoq75xNzsTAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0",
          "answer": 1,
          "timeSpent": 1000
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: 'bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0',
        answer: 1,
        timeSpent: 1000
      } Socket ID: 3ERF-RRoq75xNzsTAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-06 15:31:36.835] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "3ERF-RRoq75xNzsTAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0",
          "answer": 1,
          "timeSpent": 1000
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.835] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0",
        "answer": 1,
        "timeSpent": 1000,
        "socketId": "3ERF-RRoq75xNzsTAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_question [
        {
          uid: 'bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0',
          text: 'What is 1+1?',
          answerOptions: [ '1', '2', '3' ],
          correctAnswers: [ false, true, false ],
          timeLimit: 20,
          questionType: 'multiple_choice_single_answer',
          themes: [ 'arithmetic' ],
          difficulty: 1,
          discipline: 'math',
          title: 'Practice Q1',
          currentQuestionIndex: 0,
          totalQuestions: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        uid: 'bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0',
        text: 'What is 1+1?',
        answerOptions: [ '1', '2', '3' ],
        correctAnswers: [ false, true, false ],
        timeLimit: 20,
        questionType: 'multiple_choice_single_answer',
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q1',
        currentQuestionIndex: 0,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:156:21)

    console.log
      [2025-06-06 15:31:36.838] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.838] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.838] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.838] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: 'bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0',
          timeSpent: 1000,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      ‚úÖ Event received: answer_received {
        questionId: 'bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0',
        timeSpent: 1000,
        correct: true,
        correctAnswers: [ false, true, false ]
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: 'bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0',
          timeSpent: 1000,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      Waiting for event: game_question with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-06-06 15:31:36.851] [32mINFO [0m [RequestNextQuestionHandler] {
        "socketId": "3ERF-RRoq75xNzsTAAAB",
        "event": "request_next_question",
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "currentQuestionId": "bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0"
      } Player requested next question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.858] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:181:25)

    console.log
      [GAME_ANSWER] Adding current questionId bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0 to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:193:29)

    console.log
      [GAME_ANSWER] Found 1/2 answered questions: [ 'bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0' ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:200:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:209:25)

    console.log
      [GAME_ANSWER] Not all questions answered yet. Waiting for client to request next question.

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:226:29)

    console.log
      [2025-06-06 15:31:36.858] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: []

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:181:25)

    console.log
      [GAME_ANSWER] Adding current questionId bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0 to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:193:29)

    console.log
      [GAME_ANSWER] Found 1/2 answered questions: [ 'bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0' ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:200:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=1, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:209:25)

    console.log
      [GAME_ANSWER] Not all questions answered yet. Waiting for client to request next question.

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:226:29)

    console.log
      [2025-06-06 15:31:36.861] [32mINFO [0m [RequestNextQuestionHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "nextQuestionId": "bea117b8-606b-4f30-b713-b6dfbf9698a7"
      } Sending next question

      at log (src/utils/logger.ts:102:21)

    console.log
      [REQUEST_NEXT_QUESTION] About to send question: {
        uid: 'bea117b8-606b-4f30-b713-b6dfbf9698a7',
        text: 'What is 2+2?',
        index: 1
      }

      at Socket.log (src/sockets/handlers/game/requestNextQuestion.ts:84:25)

    console.log
      [SOCKET EVENT] game_question [
        {
          uid: 'bea117b8-606b-4f30-b713-b6dfbf9698a7',
          text: 'What is 2+2?',
          answerOptions: [ '3', '4', '5' ],
          correctAnswers: [ false, true, false ],
          questionType: 'multiple_choice_single_answer',
          timeLimit: 20,
          themes: [ 'arithmetic' ],
          difficulty: 1,
          discipline: 'math',
          title: 'Practice Q2',
          currentQuestionIndex: 1,
          totalQuestions: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [DIRECT LISTENER] game_question event received: {
        uid: 'bea117b8-606b-4f30-b713-b6dfbf9698a7',
        text: 'What is 2+2?',
        answerOptions: [ '3', '4', '5' ],
        correctAnswers: [ false, true, false ],
        questionType: 'multiple_choice_single_answer',
        timeLimit: 20,
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q2',
        currentQuestionIndex: 1,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:156:21)

    console.log
      ‚úÖ Event received: game_question {
        uid: 'bea117b8-606b-4f30-b713-b6dfbf9698a7',
        text: 'What is 2+2?',
        answerOptions: [ '3', '4', '5' ],
        correctAnswers: [ false, true, false ],
        questionType: 'multiple_choice_single_answer',
        timeLimit: 20,
        themes: [ 'arithmetic' ],
        difficulty: 1,
        discipline: 'math',
        title: 'Practice Q2',
        currentQuestionIndex: 1,
        totalQuestions: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      Answering second question: {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: 'bea117b8-606b-4f30-b713-b6dfbf9698a7',
        answer: 1,
        timeSpent: 1200
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:207:17)

    console.log
      Waiting for event: answer_received with timeout 10000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-06-06 15:31:36.862] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "bea117b8-606b-4f30-b713-b6dfbf9698a7",
        "answer": 1,
        "timeSpent": 1200,
        "socketId": "3ERF-RRoq75xNzsTAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: 'bea117b8-606b-4f30-b713-b6dfbf9698a7',
        answer: 1,
        timeSpent: 1200
      } Socket ID: 3ERF-RRoq75xNzsTAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-06 15:31:36.863] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "3ERF-RRoq75xNzsTAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "bea117b8-606b-4f30-b713-b6dfbf9698a7",
          "answer": 1,
          "timeSpent": 1200
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER EVENT RECEIVED] {
        accessCode: 'PRACTICE1',
        userId: 'practice-player-1',
        questionId: 'bea117b8-606b-4f30-b713-b6dfbf9698a7',
        answer: 1,
        timeSpent: 1200
      } Socket ID: 3ERF-RRoq75xNzsTAAAB Connected: true

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:27:17)

    console.log
      [2025-06-06 15:31:36.863] [32mINFO [0m [GameAnswerHandler] {
        "socketId": "3ERF-RRoq75xNzsTAAAB",
        "event": "game_answer",
        "payload": {
          "accessCode": "PRACTICE1",
          "userId": "practice-player-1",
          "questionId": "bea117b8-606b-4f30-b713-b6dfbf9698a7",
          "answer": 1,
          "timeSpent": 1200
        },
        "connected": true
      } TOP OF HANDLER: gameAnswerHandler invoked

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.863] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "bea117b8-606b-4f30-b713-b6dfbf9698a7",
        "answer": 1,
        "timeSpent": 1200,
        "socketId": "3ERF-RRoq75xNzsTAAAB"
      } [SHARED_LIVE_HANDLER] game_answer received

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.866] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.866] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.866] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "determinedPlayMode": "practice",
        "gameStatus": "active"
      } Determined playMode from game instance for answer

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.866] [32mINFO [0m [SharedLiveHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "playMode": "practice"
      } Practice mode answer, bypassing sharedLiveHandler logic. GameAnswer.ts should handle.

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: 'bea117b8-606b-4f30-b713-b6dfbf9698a7',
          timeSpent: 1200,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      ‚úÖ Event received: answer_received {
        questionId: 'bea117b8-606b-4f30-b713-b6dfbf9698a7',
        timeSpent: 1200,
        correct: true,
        correctAnswers: [ false, true, false ]
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      Received feedback for second question: {
        questionId: 'bea117b8-606b-4f30-b713-b6dfbf9698a7',
        timeSpent: 1200,
        correct: true,
        correctAnswers: [ false, true, false ]
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:210:17)

    console.log
      Requesting to proceed after last question...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:221:17)

    console.log
      Waiting for game_ended event after requesting next question...

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:225:17)

    console.log
      Waiting for event: game_ended with timeout 15000ms

      at waitForEvent (tests/integration/practiceMode.test.ts:10:13)

    console.log
      [2025-06-06 15:31:36.877] [32mINFO [0m [RequestNextQuestionHandler] {
        "socketId": "3ERF-RRoq75xNzsTAAAB",
        "event": "request_next_question",
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "currentQuestionId": "bea117b8-606b-4f30-b713-b6dfbf9698a7"
      } Player requested next question

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] answer_received [
        {
          questionId: 'bea117b8-606b-4f30-b713-b6dfbf9698a7',
          timeSpent: 1200,
          correct: true,
          correctAnswers: [ false, true, false ]
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      [2025-06-06 15:31:36.878] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "bea117b8-606b-4f30-b713-b6dfbf9698a7"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":1,"timestamp":"2025-06-06T13:31:36.840Z","questionUid":"bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0","timeTakenMs":1000}]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:181:25)

    console.log
      [GAME_ANSWER] Adding current questionId bea117b8-606b-4f30-b713-b6dfbf9698a7 to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:193:29)

    console.log
      [GAME_ANSWER] Found 2/2 answered questions: [
        'bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0',
        'bea117b8-606b-4f30-b713-b6dfbf9698a7'
      ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:200:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=2, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:209:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:219:29)

    console.log
      [2025-06-06 15:31:36.878] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "bea117b8-606b-4f30-b713-b6dfbf9698a7"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.879] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "bea117b8-606b-4f30-b713-b6dfbf9698a7"
      } Waiting for client to request next question via request_next_question event

      at log (src/utils/logger.ts:102:21)

    console.log
      [GAME_ANSWER] Raw answers array: [{"answer":1,"timestamp":"2025-06-06T13:31:36.840Z","questionUid":"bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0","timeTakenMs":1000}]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:181:25)

    console.log
      [GAME_ANSWER] Adding current questionId bea117b8-606b-4f30-b713-b6dfbf9698a7 to answered questions

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:193:29)

    console.log
      [GAME_ANSWER] Found 2/2 answered questions: [
        'bcc2c5ca-f7ae-4ce1-8b46-5c7b879c90f0',
        'bea117b8-606b-4f30-b713-b6dfbf9698a7'
      ]

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:200:25)

    console.log
      [GAME_ANSWER] Checking if all questions are answered: answeredSet.size=2, totalQuestions=2

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:209:25)

    console.log
      [GAME_ANSWER] All questions answered! Waiting for player to request game end via request_next_question

      at Socket.log (src/sockets/handlers/game/gameAnswer.ts:219:29)

    console.log
      [2025-06-06 15:31:36.879] [32mINFO [0m [GameAnswerHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "questionId": "bea117b8-606b-4f30-b713-b6dfbf9698a7"
      } All questions answered, waiting for request_next_question to complete game

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.883] [32mINFO [0m [RequestNextQuestionHandler] {
        "accessCode": "PRACTICE1",
        "userId": "practice-player-1",
        "correctCount": 2,
        "total": 2
      } Practice mode completed, sending final score

      at log (src/utils/logger.ts:102:21)

    console.log
      [SOCKET EVENT] game_ended [
        {
          accessCode: 'PRACTICE1',
          score: 2,
          totalQuestions: 2,
          correct: 2,
          total: 2
        }
      ]

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:145:21)

    console.log
      üëÄ DIRECT LISTENER: game_ended event received: {
        accessCode: 'PRACTICE1',
        score: 2,
        totalQuestions: 2,
        correct: 2,
        total: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:216:21)

    console.log
      ‚úÖ Event received: game_ended {
        accessCode: 'PRACTICE1',
        score: 2,
        totalQuestions: 2,
        correct: 2,
        total: 2
      }

      at Socket.<anonymous> (tests/integration/practiceMode.test.ts:17:21)

    console.log
      ‚úÖ Successfully received game_ended event: {
        accessCode: 'PRACTICE1',
        score: 2,
        totalQuestions: 2,
        correct: 2,
        total: 2
      }

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:227:17)

    console.log
      Test completed successfully, disconnecting socket

      at Object.<anonymous> (tests/integration/practiceMode.test.ts:232:17)

    console.log
      [2025-06-06 15:31:36.885] [32mINFO [0m [DisconnectHandler] {
        "socketId": "3ERF-RRoq75xNzsTAAAB",
        "userId": "practice-player-1",
        "accessCode": "PRACTICE1",
        "reason": "client namespace disconnect"
      } Client disconnected

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.887] [32mINFO [0m [DisconnectHandler] {
        "userId": "practice-player-1",
        "accessCode": "PRACTICE1",
        "socketId": "3ERF-RRoq75xNzsTAAAB"
      } Disconnected socket was the last known active socket for the user.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:36.887] [32mINFO [0m [DisconnectHandler] {
        "playerLeftPayload": {
          "userId": "practice-player-1",
          "socketId": "3ERF-RRoq75xNzsTAAAB"
        },
        "room": "game_PRACTICE1"
      } Emitting player_left_game to room

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/updated-gameHandler.test.ts
  ‚óè Console

    console.log
      [2025-06-06 15:31:37.381] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/gamesApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-06 15:31:37.799] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:37.836] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:37.894] [31mERROR[0m [GameStateService] {
        "gameInstanceId": "game-123"
      } Game instance not found

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG response: 200 application/json; charset=utf-8 {"games":[{"id":"game-1","status":"pending","name":"Game 1"},{"id":"game-2","status":"active","name":"Game 2"}]}

      at Object.<anonymous> (tests/integration/gamesApi.test.ts:376:21)

PASS tests/integration/quizTemplateApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.204] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.207] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.208] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.213] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.213] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.218] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.219] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.221] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.221] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.224] [32mINFO [0m [Auth] {
        "authHeader": "Bearer invalid-token"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.225] [31mERROR[0m [Auth] {
        "error": {
          "name": "JsonWebTokenError",
          "message": "jwt malformed"
        }
      } Authentication error

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.228] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.229] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.232] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.232] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.239] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.240] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.243] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.244] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.247] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.247] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.249] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.250] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.253] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.255] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.260] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.260] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.261] [31mERROR[0m [gameTemplatesAPI] {
        "error": {}
      } Error updating quiz template

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.265] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.265] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.267] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.268] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.274] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.275] [32mINFO [0m [Auth] {
        "authHeader": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg"
      } DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.276] [31mERROR[0m [gameTemplatesAPI] {
        "error": {}
      } Error deleting quiz template

      at log (src/utils/logger.ts:102:21)

    console.log
      DEBUG: teacherToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJ0ZWFjaGVyLTEiLCJ1c2VybmFtZSI6InRlYWNoZXItMSIsInJvbGUiOiJURUFDSEVSIiwiaWF0IjoxNzQ5MjE2Njk4LCJleHAiOjE3NDkyMjAyOTh9.McMT5Up86v6mUyCCQZEdR2bbYjOn0sjOg3GK-XQ8Jeg

      at Object.<anonymous> (tests/integration/quizTemplateApi.test.ts:81:17)

    console.log
      [2025-06-06 15:31:38.278] [32mINFO [0m [Auth] {} DEBUG: Received Authorization header

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.278] [32mINFO [0m [Auth] {
        "cookiesAvailable": true,
        "teacherToken": false,
        "authToken": false,
        "allCookies": []
      } DEBUG: Checking cookies for token

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/questionApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-06 15:31:38.615] [32mINFO [0m [SocketIO] Socket.IO server initialized with Redis adapter

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.625] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.670] [31mERROR[0m [QuestionsAPI] {
        "error": {}
      } Error updating question

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:38.678] [31mERROR[0m [QuestionsAPI] {
        "error": {}
      } Error deleting question

      at log (src/utils/logger.ts:102:21)

PASS tests/unit/quizTemplateService.test.ts
PASS tests/integration/playerApi.test.ts
  ‚óè Console

    console.log
      Test environment detected, server not automatically started

      at Object.log (src/server.ts:80:13)

    console.log
      [2025-06-06 15:31:39.736] [32mINFO [0m [Server] Successfully connected to Redis.

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:39.738] [32mINFO [0m [PlayersAPI] Student registered successfully via deprecated endpoint {
        "userId": "user-uuid",
        "username": "testuser",
        "hasEmail": false,
        "hasCookieId": false
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:39.742] [32mINFO [0m [PlayersAPI] Student registered successfully via deprecated endpoint {
        "userId": "user-uuid",
        "username": "testuser",
        "hasEmail": true,
        "hasCookieId": false
      }

      at log (src/utils/logger.ts:102:21)

    console.log
      [2025-06-06 15:31:39.748] [32mINFO [0m [PlayersAPI] Student registered successfully via deprecated endpoint {
        "userId": "user-uuid",
        "username": "existinguser",
        "hasEmail": false,
        "hasCookieId": false
      }

      at log (src/utils/logger.ts:102:21)

PASS tests/integration/lobbyBasic.test.ts
  ‚óè Console

    console.log
      Server listening on port 31515

      at Server.<anonymous> (tests/integration/lobbyBasic.test.ts:72:25)

    console.log
      Socket connected: 1EKFm9UdfyEAqbN5AAAB

      at Namespace.<anonymous> (tests/integration/lobbyBasic.test.ts:41:21)

    console.log
      Client connected

      at Socket.<anonymous> (tests/integration/lobbyBasic.test.ts:171:21)

    console.log
      Player Test Player 1 joining lobby TEST123

      at Socket.<anonymous> (tests/integration/lobbyBasic.test.ts:46:25)

    console.log
      Received participants list: {
        participants: [
          {
            id: '1EKFm9UdfyEAqbN5AAAB',
            username: 'Test Player 1',
            userId: 'test-player-1'
          }
        ],
        gameId: 'test-game-id',
        gameName: 'Test Game'
      }

      at Socket.<anonymous> (tests/integration/lobbyBasic.test.ts:181:21)

PASS tests/unit/gameInstanceService.test.ts
PASS tests/integration/basic-check.test.ts
node:internal/process/promises:394
    triggerUncaughtException(err, true /* fromPromise */);
    ^

Error: Test timed out waiting for projector_state
    at Timeout._onTimeout (/home/aflesch/mathquest/app/backend/tests/integration/projectorHandler.test.ts:128:18)
    at listOnTimeout (node:internal/timers:594:17)
    at processTimers (node:internal/timers:529:7)

Node.js v22.12.0
